{"meta":{"title":"ä¸æ’ç”µç å†œ","subtitle":"unpluggedcoder","description":"A Coder, love drums and sketches.","author":"ä¸æ’ç”µç å†œ","url":"https://unpluggedcoder.me","root":"/"},"pages":[{"title":"Search","date":"2017-10-30T02:10:26.000Z","updated":"2022-09-15T15:51:05.341Z","comments":true,"path":"Search/index.html","permalink":"https://unpluggedcoder.me/Search/index.html","excerpt":"","text":""},{"title":"about","date":"2017-10-29T14:12:45.000Z","updated":"2022-09-15T15:51:05.355Z","comments":true,"path":"about/index.html","permalink":"https://unpluggedcoder.me/about/index.html","excerpt":"","text":"Coder, love sketch and drumming.Creator of Shuide.email. Proudly powered by Hexo and Theme by pure"},{"title":"åˆ†ç±»","date":"2022-09-15T15:51:05.355Z","updated":"2022-09-15T15:51:05.355Z","comments":false,"path":"categories/index.html","permalink":"https://unpluggedcoder.me/categories/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2022-09-15T15:51:05.427Z","updated":"2022-09-15T15:51:05.427Z","comments":false,"path":"repository/index.html","permalink":"https://unpluggedcoder.me/repository/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2022-09-15T15:51:05.427Z","updated":"2022-09-15T15:51:05.427Z","comments":false,"path":"tags/index.html","permalink":"https://unpluggedcoder.me/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"FILCO-MINILA-R Convertible Review","slug":"FILCO-MINILA-R-Convertible-Review","date":"2022-09-30T08:04:36.000Z","updated":"2022-09-30T08:49:02.539Z","comments":true,"path":"2022/09/30/FILCO-MINILA-R-Convertible-Review/","link":"","permalink":"https://unpluggedcoder.me/2022/09/30/FILCO-MINILA-R-Convertible-Review/","excerpt":"Iâ€™ve been use FILCO MNILA Series(1st Gen MINILA Air &amp; 2nd Gen: MNILA-R Convertible) for almost 6 years. During these years, Iâ€™ve used some other mechanical keyboards on trial and sold them out finally. In my opinion, the FILCO MINILA still the best mechanical keyboard, especially for programmer.","text":"Iâ€™ve been use FILCO MNILA Series(1st Gen MINILA Air &amp; 2nd Gen: MNILA-R Convertible) for almost 6 years. During these years, Iâ€™ve used some other mechanical keyboards on trial and sold them out finally. In my opinion, the FILCO MINILA still the best mechanical keyboard, especially for programmer. Here I want share some strengths of FILCO MINILA, especially the 2nd generation MINILA-R Convertible. So, basically these points are main considerations when I choosing a mechanical keyboard. Layout &amp; Built-in shortcuts For me these are the most important consideration. It has direct impact on productivity, when it used by programmer, this effective comes double. I believe less finger move bring faster strike, thatâ€™s why I prefer compact keyboards. But not just the layout, the built-in shortcuts must came help for the arrow and other feature keys. The MNILA-R Convertible inherit most shortcuts from last gen and imporve the built-in shortcuts support for Mac, like volume, screen brightness. Wow! The DIP Switch, for me, I setup as the above picture. The most useful switch for me is replace CapsLock with Ctrl key. Before I switch it ON, I cannot figure why there is such thing. I turned it ON at one day four years ago, that feeling just hit me from deep mind. Iâ€™ve realized that I barely use CapsLock for all the time, more over, it set my little finger free, no longer to touch left corner for Ctrl key. The Fn key position, it have two Fn key beside the Space key, very convenient for many shortcuts. Thatâ€™s why I prefer it to HHKB. Here is the original description of Fn key by FILCO: The worldâ€™s first double function keyboard!Majestouch MINILA is the Mini layout version of Majestouch and weâ€™ve made it as compact as possible by sharing Function keys with other keys. It has the same key pitch as our famous Majestouch keyboards.The most striking feature of MINILA is the â€œDouble Function keysâ€ located each side of the spacebar. We focused on less frequently used finger, the thumb, and let it work with Function keys. Just keep your thumbs busy and you get a lot of work done much easier than a normal keyboard! You can use whichever thumb you want. This keyboard can work well for anybody! Professionals, intermediate or even beginner class! Once you get used to typing on MINILA, you will not want to go back typing on normal keyboards! [You can use MINILA even more conveniently with FN keys] You can type cursor keys with a combination of FN key.Pressing FN key and E&#x2F;S&#x2F;D&#x2F;F simultaneously corresponds to â†‘&#x2F;â†&#x2F;â†“&#x2F;â†’ respectively.With this solution, you can keep your home position and still you get to type arrows very easily.Pressing FN key plus [:;] key simultaneously functions as backspace.This will allow you to command backspace without changing your home position.Those combinations will offer you a faster typing environment. Keycap The MINILA-Airâ€™s keycap is what attracted me in first place. It is made by ABS, but the sense of touch is a icy feeling and smoothly. To keep that feeling I keep clean the keycap surface before it come to greasy. Then I tried to replace them by PBT keycap. After a few month, I change back to original keycap, miss that feeling. The MINILA-R Convertible keycap is a so called â€˜Patch Keycapâ€™ made by PBT. So the touch area is a litter smaller than MINILA-Air. It doesnâ€™t like other frosted feeling PBT stuff, keep the glossy surface from last generation. It still be greasy after years using, but much slower. Battery If someone around you used FILCO, then youâ€™ve must heard of its battery life. Just load the AA batteries in, then forget it. For years I canâ€™t believe itâ€™s powered by AA batteries and I donâ€™t know how it accomplish that. It seems have nothing to do with bluetooth version(1st: v3, 2nd: v5.1). In contrast, some keyboard with lithium battery pack(Niz Keyboard), only stand for few months, and I have to plugged it in frequently, finally it becomes a USB cable keyboard. Multiple Connections I switch devices often, it was a pain suffer. MINILA-R Convertible had done a great of that by just add 4 devices key, and moreover, it had a USB 2.0 connection! The 1st Gen MNILA Air had some connection issue every time reconnect to a device(Chances, especially hit Cmd key during connection initialization, key comes to Alt code). The issue is gone on MINILA-R Convertible and more smoothly. Appearance I like simple color, my first mechanical keyboard is MINILA-Air in black, then the white. In 2020 MINILA-R Convertible came out with Sky Gray&#x2F;Black&#x2F;ASAGI color, the ASAGI color is a kind of blue, looks better than two. I donâ€™t know why it missing white. FILCO seems like mod colors. Unitl the MINILA-R Convertible anniversary, the white color finally came out(above picture). The white part like some kinde of baked paint, shining and beauty. It was fortunate that no light in MINILA. RGB lights are totaly not necessary for keyboard. Switch This is the most trivial part, because many mechanical keyboard manufacturers do use the Cherry MX Switch. MINILA-R Convertible add MX SILENT Red switch, which became my favorite one. Before that is MX Red switch, but the new MINILA-R Convertibleâ€™s red switch distance of strike is clearly shorter than MINILA-Air. These are my share review of FILCO MINILA, hope you can find your best mechanical keyboard.ğŸ˜€","categories":[],"tags":[{"name":"FILCO","slug":"FILCO","permalink":"https://unpluggedcoder.me/tags/FILCO/"},{"name":"Minila","slug":"Minila","permalink":"https://unpluggedcoder.me/tags/Minila/"},{"name":"Mechanical Keyboard","slug":"Mechanical-Keyboard","permalink":"https://unpluggedcoder.me/tags/Mechanical-Keyboard/"}]},{"title":"Improved Differential Flame Graph","slug":"Improved Differential Flame Graph","date":"2021-05-22T00:29:20.000Z","updated":"2022-09-15T15:51:05.344Z","comments":true,"path":"2021/05/22/Improved Differential Flame Graph/","link":"","permalink":"https://unpluggedcoder.me/2021/05/22/Improved%20Differential%20Flame%20Graph/","excerpt":"","text":"The Differential Flame Graph was introduced by Brendan Gregg in FlameGraph toolkit , which can let us debug the performance regressions. But it also has its known issue. â€œIf code paths vanish completely in the second profile, then thereâ€™s nothing to color blue.â€ For me there is another issue. The width of frame doesnâ€™t present the REAL difference between two flame graphs. Letâ€™s see an exampleğŸŒ°. Assume we have two folded files like below: 123456789101112131415# before.folded_start;main;func1 5_start;main;func2 10_start;main;func4;func3 8_start;main;func4 25_start;main;func5;func6 15_start;main;func5 6# after.folded_start;main;func2 35_start;main;func4 0_start;main;func4;func3 18_start;main;func5;func6 5_start;main;func5 20_start;main;func7 7 To get a clear view for function changes, we can put it in a table like below: Name Before After Delta func1 5 0 -5 func2 10 35 +25 func3 8 18 +10 func4 25 0 -25 func5 6 20 +14 func6 15 5 -10 func7 0 7 +7 Total 69 86 &amp;#124;96&amp;#124; Original Differential Flame Graph func1 was totally lost. Although we can use Negation to get another differential flame graph. func3 have +10 delta and func4 have down to zero with -25 delta. But they share the SAME frame width because the diff-graph is just based on after.folded. Differential Flame Graph With Delta WidthI changed the way calculate diff-frame width which is based on Delta column in the above table, cause itâ€™s REAL differentials. Here is the screenshot. The width of frame is based on delta, not any one of samples. So the width percentage is stand for: How much does it effects in all changes. Now, func1 shows up and func4 has outstanding optimization from the view. The frame color is calculated by its OWN delta. So it means: How does the frameâ€™s SELF samples(time) changes. For the function has not real samples, I put the total delta width on the hint message. Try itYou can try the improved differential flame graph at my fork from the RustğŸ¦€ version of flame graph toolkit inferno(which is ğŸ’¥20x faster than Perl version).","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"Flamegraph","slug":"Rust/Flamegraph","permalink":"https://unpluggedcoder.me/categories/Rust/Flamegraph/"}],"tags":[]},{"title":"2020-04ä¹¦å•","slug":"2020-04ä¹¦å•","date":"2020-05-31T13:44:20.000Z","updated":"2022-09-15T15:51:05.341Z","comments":true,"path":"2020/05/31/2020-04ä¹¦å•/","link":"","permalink":"https://unpluggedcoder.me/2020/05/31/2020-04%E4%B9%A6%E5%8D%95/","excerpt":"","text":"æ•°å­¦ä¸æ³›å‹ç¼–ç¨‹-é«˜æ•ˆç¼–ç¨‹çš„å¥¥ç§˜ è¿™æœ¬ä¹¦è™½ç„¶ä¸åš, ä½†æ˜¯èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰è¯»å®Œ. æœ¬ä¹¦çš„ä½œè€…ä¹Ÿæ˜¯æ˜¯C++ STLçš„ä½œè€….ä»–æœ¬äººä¹Ÿæ˜¯æ‹¥æœ‰è€…æ®¿å ‚çº§çš„å±¥å†! è¿™æœ¬ä¹¦å°è±¡æœ€æ·±çš„æ˜¯è´¯ç©¿æ•´æœ¬ä¹¦çš„æ•°å­¦å†å². å¯¹äºç¨‹åºå‘˜æ¥è¯´, é‡Œé¢çš„æ•°å­¦çŸ¥è¯†å¯èƒ½ä¸æ˜¯éå¸¸å®ç”¨,ä½†æ˜¯å‰å‡ ç« é‡Œå±•ç°çš„åˆ©ç”¨æ•°å­¦çŸ¥è¯†è¿›è¡Œä»£ç æ€§èƒ½ä¼˜åŒ–çš„æŠ€æœ¯ä»¤äººä½©æœ. é™¤æ­¤ä¹‹å¤–, è¿™æœ¬ä¹¦ç®€ç›´å¯ä»¥ç§°ä½œä¸€æœ¬æ•°å­¦å†å²ä¹¦, æœ€å¥½å¥‡çš„æ˜¯ä½œè€…æåˆ°çš„äººç±»å†å²ä¸­, æœ‰ä¸€åƒå¤šå¹´çš„æ•°å­¦ç©ºç™½, å‡ ä¹æ²¡æœ‰ä»€ä¹ˆæ•°å­¦æˆæœ. å¦‚æœç¨‹åºå‘˜å¸Œæœ›ä»è¿™æœ¬ä¹¦ä¸­äº†è§£åˆ°ä»€ä¹ˆå¥‡æŠ€æ·«å·§, é‚£å¯èƒ½ä¼šå¤±æœ›ğŸ¤¦â€â™‚ï¸. çœ‹åˆ°ç¬¬åç« çš„æ ‡é¢˜æ˜¯â€œç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µâ€, ä½ ä»¥ä¸ºä»–ç»ˆäºå¼€å§‹ç»™ä½ è®²ç¼–ç¨‹äº†ï¼Œç»“æœä¸€ä¸Šæ¥åˆç»™ä½ ä¸Šäº†èŠ‚å†å²è¯¾ï¼ŒçœŸé¦™ï¼åˆ°æœ€å, æŠŠè´¯ç©¿å…¨ä¹¦çš„ç´ æ•°ç»“åˆå…¶åº”ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥ä½œä¸ºæ”¶å°¾, ç»ˆäºæœ‰ç§æ„Ÿè§‰è¿™æœ¬ä¹¦æ²¡ç™½çœ‹. ä»¥åè¿™å°±æ˜¯æˆ‘çš„æ•°å­¦å†å²å‚è€ƒä¹¦. ETFå¤§å¸ˆæŠ•èµ„ç­–ç•¥ è¿™æœ¬ä¹¦ç¿»è¯‘è¿‡æ¥çš„ä¸­æ–‡åå¤ªèŠ±å“¨äº†, è‹±æ–‡ååªæ˜¯ã€ŠETF Investment Strategiesã€‹, è¯‘è€…åŠ ä¸Šâ€œå¤§å¸ˆâ€ä¸¤ä¸ªå­—å¯èƒ½ä¼šæ¯”è¾ƒå¥½å–å§. ä½œè€…æ˜¯éå¸¸çš„åŠ¡å®, ä»‹ç»äº†ETFçš„æ–¹æ–¹é¢é¢, æˆ‘å¹¶ä¸æœŸæœ›ä»è¿™ç±»ä¹¦ä¸­èƒ½å¤Ÿå­¦åˆ°ä»€ä¹ˆæŠ•èµ„é‡‘æ‰‹æŒ‡, æˆ‘çš„ç›®çš„æ˜¯å°±æ˜¯æ‰«ç›². ä½œè€…æŠŠETFçš„å„ç§æ•å£è®²å¾—å¾ˆæ¸…æ™°, ä»¥åŠå„ç§äº¤æ˜“æ•å£é€‚åˆä»€ä¹ˆæ ·çš„æŠ•èµ„è€…, éƒ½å¯ä»¥å¯¹å·å…¥åº§. è¿˜ç»“åˆäº†å¾ˆå¤šå¤§å…¬å¸çš„æŠ•èµ„æ¡ˆä¾‹. çœ‹å®Œè¿™æœ¬ä¹¦çš„æ—¶å€™, ETFå·²ç»æ˜¯æˆ‘å®šæŠ•çš„é‡ä»“äº§å“äº†, æ¶µç›–äº†ä¸åŒçš„è¡Œä¸š. å¯¹äºç§æ•£æˆ·æ¥è¯´, ETFçœŸçš„æ˜¯åˆé€‚ä¸è¿‡äº†.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[]},{"title":"The Gray Rhino","slug":"ç°çŠ€ç‰›","date":"2020-04-20T15:44:20.000Z","updated":"2022-09-20T15:47:43.845Z","comments":true,"path":"2020/04/20/ç°çŠ€ç‰›/","link":"","permalink":"https://unpluggedcoder.me/2020/04/20/%E7%81%B0%E7%8A%80%E7%89%9B/","excerpt":"","text":"æ¨èåº¦: 3.5åˆ† è¿™æœ¬ä¹¦å¾ˆæ—©å°±èººåœ¨äº†ç”µå­ä¹¦é‡Œ, ä¹Ÿæ˜¯æœ€è¿‘ç–«æƒ…, æƒ³èµ·æ¥çœ‹çš„. ä»Šå¤©åˆšçœ‹å®Œ. ä¹¦çš„ä¸€å¼€å§‹, å®Œå…¨æ²¡ææ˜ç™½ä»€ä¹ˆæ˜¯ç°çŠ€ç‰›? å’Œå¤§æ¦‚ç‡å±æœºæœ‰å•¥å…³ç³»? åé¢æ‰æ…¢æ…¢æ˜ç™½. å…¶å®, è‡ªå·±ç”Ÿæ´»ä¸­æœ‰å¥½å¤šè¿™æ ·çš„äº‹æƒ…åœ¨ä¸€æ­¥æ­¥é€¼è¿‘. æ€æ ·æ‰èƒ½åˆ©ç”¨è¿™äº›å¤§çš„è¶‹åŠ¿å‘¢? å°±åƒæˆ‘åœ¨æ¨ç‰¹ä¸ŠèŠåˆ°çš„ä¸€ç‚¹:â€œè®¾æƒ³ä¸€ä¸‹,å‡å¦‚Rustè¿™é—¨è¯­è¨€åƒç°åœ¨Javaä¸€æ ·å¤§è§„æ¨¡ä½¿ç”¨èµ·æ¥ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–?ç”¨æˆ·ä½“éªŒæå‡,ä¼šæ·˜æ±°æ‰æ€§èƒ½å·®çš„äº§å“ä¹ˆ? å¯¹ä¼ä¸šæ¥è¯´,ä¼šèŠ‚çœä¸‹éå¸¸å¤šçš„ç®—åŠ›,æˆ–è€…è¯´åŒç­‰èµ„æºä¸‹ä¼ä¸šæˆ–ç¡¬ä»¶å¯ä»¥åšæ›´å¤šçš„è®¡ç®—.ä¸‹ä¸€ä»£ç¼–ç¨‹è¯­è¨€çš„å‡ºç°åº”è¯¥æ˜¯å¤§æ¦‚ç‡äº‹ä»¶,å¯ä»¥è¯´æ˜¯æ­£å‘æˆ‘ä»¬å†²æ¥çš„ç°çŠ€ç‰›,å¦‚ä½•åˆ©ç”¨è¿™ä¸ªè¶‹åŠ¿?â€ åƒè¿™æ ·çš„æƒ…å†µå¾ˆå¤š, ä¹¦é‡Œæåˆ°ä¸€ç‚¹ä¹Ÿæ˜¯è®©æˆ‘è§‰å¾—å¾ˆæœ‰æ„æ€: å¯¹æ°´èµ„æºä¿æŠ¤èŠ‚çº¦ç›¸å½“é‡è§†çš„ä¸ä»…æœ‰æ”¿åºœå’Œå…¬ç›Šç»„ç»‡, è¿˜æœ‰å¤§å‹çš„é£Ÿå“å•†ä¸šå…¬å¸, è¿™äº›å…³ä¹ä»–ä»¬çš„åˆ©ç›Šå’Œæˆæœ¬. å…¶å®å¦‚æœä»ç±»ä¼¼è¿™æ ·çš„è§’åº¦å»çœ‹å¾…å±æœº, é‚£ä¹ˆæˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½æ„¿æ„å±•å¼€è¡ŒåŠ¨. å”¯ä¸€ä¸å˜çš„æ˜¯å˜åŒ–, æ¥~æ‹¥æŠ±ä¸ªå˜åŒ–ğŸ˜‚.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[]},{"title":"ç®—æ³•è¯¦è§£ï¼ˆå·1ï¼‰â€”ç®—æ³•åŸºç¡€","slug":"Algorithms Illuminated, Part 1","date":"2020-04-20T15:40:20.000Z","updated":"2022-09-20T15:49:35.487Z","comments":true,"path":"2020/04/20/Algorithms Illuminated, Part 1/","link":"","permalink":"https://unpluggedcoder.me/2020/04/20/Algorithms%20Illuminated,%20Part%201/","excerpt":"æ¨èåº¦: 4.5åˆ† è¿™æœ¬ä¹¦å¼ºçƒˆæ¨è, è–„è–„çš„ä¸€æœ¬, ä¸“æ³¨åœ¨åˆ†æ²»ç®—æ³•ä¸Š. ä»æ•´æ•°ä¹˜æ³•åˆ°æ’åº, æ…¢æ…¢åœ°å¼•å‡ºäº†åˆ†æ²»ç®—æ³•çš„æ ¸å¿ƒä¸»æ–¹æ³•. ç©¿æ’åœ¨ä¹¦ä¸­çš„å°æ€è€ƒé¢˜ä¹Ÿå¾ˆç®€å•. è¾¹å­¦è¾¹ç»ƒ, å¾ˆå®¹æ˜“æŠŠä¸»æ–¹æ³•æŒæ¡. è¿™æ‰çŸ¥é“åˆ†æ²»ç®—æ³•çš„è¯„ä¼°åŸæ¥æœ‰è¿™äº›é—¨é“.","text":"æ¨èåº¦: 4.5åˆ† è¿™æœ¬ä¹¦å¼ºçƒˆæ¨è, è–„è–„çš„ä¸€æœ¬, ä¸“æ³¨åœ¨åˆ†æ²»ç®—æ³•ä¸Š. ä»æ•´æ•°ä¹˜æ³•åˆ°æ’åº, æ…¢æ…¢åœ°å¼•å‡ºäº†åˆ†æ²»ç®—æ³•çš„æ ¸å¿ƒä¸»æ–¹æ³•. ç©¿æ’åœ¨ä¹¦ä¸­çš„å°æ€è€ƒé¢˜ä¹Ÿå¾ˆç®€å•. è¾¹å­¦è¾¹ç»ƒ, å¾ˆå®¹æ˜“æŠŠä¸»æ–¹æ³•æŒæ¡. è¿™æ‰çŸ¥é“åˆ†æ²»ç®—æ³•çš„è¯„ä¼°åŸæ¥æœ‰è¿™äº›é—¨é“. æœ€åå‡ ç« ä»QuickSortå¼€å§‹, æ­ç¤ºäº†ä¸ºä»€ä¹ˆéšæœºåŒ–QuickSortä¹Ÿæœ‰O(nlogn)çš„æ•ˆç‡. å†ä»è¿™é‡Œå¼•ç”³åˆ°RSelectå’ŒDSelectç®—æ³•ä¸Š, æ„Ÿè§‰éå¸¸å·§å¦™, ç›´è§‚ä¸Šæˆ‘ä»¥ä¸ºæ˜¯å®Œå…¨ä¸¤ä¸ªç®—æ³•é¢˜(åªèƒ½è¯´è‡ªå·±å¤ªå¼±äº†ğŸ˜‚), æ²¡æƒ³åˆ°QuickSortçš„æ€æƒ³å®Œå…¨å¯ä»¥ä½¿ç”¨åœ¨åé¢çš„ä¸¤ä¸ªç®—æ³•ä¸Š. è€ŒDSelectçš„æ€è·¯å¾ˆå¥½, ä½†ä»…ä»…å› ä¸ºéœ€è¦ç®¡ç†é¢å¤–çš„å†…å­˜ç©ºé—´, å¯¼è‡´äº†è¢«å¼ƒç”¨, å¯è§ç®—æ³•å’Œå®é™…çš„æ€§èƒ½å·¥ç¨‹è¿˜æ˜¯æœ‰ä¸€äº›å–èˆçš„. è¿™ä¸ªç³»åˆ—åŸåæ˜¯ã€Š Algorithms Illuminatedã€‹, æ€»å…±æœ‰ä¸‰å·, æ²¡çœ‹çš„ä¹¦å¤ªå¤šäº†, ç­‰åˆ°åˆ·å®Œäº†æ‰‹ä¸Šçš„ä¹¦å†è€ƒè™‘åé¢ä¸¤å·å§. ä¹°ä¹¦å¦‚å±±å€’, è¯»ä¹¦å¦‚æŠ½ä¸æ˜¯çœŸçš„.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://unpluggedcoder.me/tags/%E7%AE%97%E6%B3%95/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://unpluggedcoder.me/tags/Algorithm/"}]},{"title":"Rust High Performance","slug":"RustHighPerformance","date":"2020-04-20T14:46:20.000Z","updated":"2022-09-20T15:50:29.756Z","comments":true,"path":"2020/04/20/RustHighPerformance/","link":"","permalink":"https://unpluggedcoder.me/2020/04/20/RustHighPerformance/","excerpt":"","text":"æ¨èåº¦: 2.0åˆ† æ€ä¹ˆè¯´å‘¢? è¿™æœ¬ä¹¦å‡ ä¹å°±æ²¡æœ‰è°ˆä»»ä½•Rusté«˜æ€§èƒ½çš„ç¼–ç¨‹æŠ€å·§, åè€Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›Rustæ–¹é¢çš„â€œæœ€ä½³å®è·µâ€. æ¯”å¦‚ä½¿ç”¨Clippyã€Criterion. å”¯ä¸€ä¸€ä¸ªå°è±¡æ¯”è¾ƒæ·±åˆ»çš„å°±æ˜¯: ä¸è¦åœ¨forå¾ªç¯ä¸­ä½¿ç”¨vec[]ä¸‹æ ‡ç´¢å¼•çš„æ–¹å¼è¿­ä»£è®¿é—®å…ƒç´ , è¿™æ˜¯å…¶å®ƒè¯­è¨€ç»å¸¸åšçš„äº‹æƒ…, è€Œåœ¨Rustä¸­, ä¸‹æ ‡è®¿é—®ä¼šè¿›è¡Œè¿è¡Œæ—¶æ£€æŸ¥, å¦‚æœè¶Šç•Œåˆ™ä¼španic, è¿™ç§æ£€æŸ¥ä¼šæŸè€—æ€§èƒ½. æ›´å¥½çš„æ–¹å¼æ˜¯åº”è¯¥ç”¨è¿­ä»£å™¨æ–¹æ³•iter() è¿™ä¸ªç‚¹æ˜¯åœ¨ä¹¦çš„å¼€å¤´å‰ä¸¤ç« æåˆ°çš„, ç„¶åæ•´æœ¬ä¹¦å°±æ²¡æœ‰å†è°ˆä»»ä½•çš„Rusté«˜æ€§èƒ½ç¼–ç¨‹æŠ€å·§äº†. å€’ä¸å¦‚ã€ŠRust Programmingã€‹æ¥å¾—å®åœ¨. å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„è®©å¤§å®¶ä¸è¦è¸©å‘äº†.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"}]},{"title":"å¥ˆé£æ–‡åŒ–æ‰‹å†Œ","slug":"å¥ˆé£æ–‡åŒ–æ‰‹å†Œ","date":"2020-04-20T14:44:20.000Z","updated":"2022-09-20T15:48:28.611Z","comments":true,"path":"2020/04/20/å¥ˆé£æ–‡åŒ–æ‰‹å†Œ/","link":"","permalink":"https://unpluggedcoder.me/2020/04/20/%E5%A5%88%E9%A3%9E%E6%96%87%E5%8C%96%E6%89%8B%E5%86%8C/","excerpt":"æ¨èåº¦: 4.0åˆ† è¿™æœ¬ä¹¦å¸¦è¯»è€…ä»ä¸€ä¸ªäººåŠ›èµ„æºçš„è§†è§’æ¥çœ‹å¥ˆé£æ–‡åŒ–. ä¹¦çš„è‹±æ–‡åæ˜¯ã€ŠPowerful: Building a Culture of Freedom and Responsibilityã€‹, ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸å¥½å¥½ç¿»è¯‘.","text":"æ¨èåº¦: 4.0åˆ† è¿™æœ¬ä¹¦å¸¦è¯»è€…ä»ä¸€ä¸ªäººåŠ›èµ„æºçš„è§†è§’æ¥çœ‹å¥ˆé£æ–‡åŒ–. ä¹¦çš„è‹±æ–‡åæ˜¯ã€ŠPowerful: Building a Culture of Freedom and Responsibilityã€‹, ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸å¥½å¥½ç¿»è¯‘. ![img](images/s29923776.jpg) è¿™æœ¬ä¹¦ç»™æˆ‘ä¸¤ä¸ªå°è±¡æ¯”è¾ƒæ·±åˆ»çš„ç‚¹. ä¸€. åªæ‹›æˆå¹´äºº. è¿™ä¸ªçœ‹ä¼¼ç®€å•, å®é™…è¯„ä»·çš„æ ‡å‡†å´å› äººè€Œå¼‚. æ•´æœ¬ä¹¦æè¿°çš„æ–‡åŒ–å‰æå°±æ˜¯åœ¨è¿™æ ·çš„ä¸€ç¾¤äººä¸­æ‰å¾—ä»¥æ¨å¹¿çš„æ–‡åŒ–. è®¤åŒå…¬å¸çš„ä»·å€¼è§‚, èƒ½å¤Ÿæœ‰è‡ªé©±åŠ›å»ä¸ºå…¬å¸åšæ­£ç¡®çš„äº‹. äºŒ. è®©äººäº‹ä¹Ÿæ·±å…¥ç†è§£å…¬å¸ä¸šåŠ¡. è¿™ä¸ªæ¦‚å¿µæ˜¯æˆ‘ä»¥å‰æ²¡æœ‰å¬è¯´è¿‡çš„, ä¹Ÿè®©æˆ‘æƒ³èµ·æ¥æ›¾ç»çœ‹è¿‡ä¸€ä¸ªHRä¸ºäº†æ‰¾åˆ°å¥½çš„ç¨‹åºå‘˜, åˆ›å»ºè‡ªå·±çš„GitHubè´¦å·, å¼€Repo, ç”šè‡³æœ‰è‡ªå·±çš„ä¸ªäººç«™. ä½œè€…è¿™é‡Œè¯´çš„ä¸ä»…ä»…æ˜¯èå…¥æŠ€æœ¯æ–‡åŒ–, è€Œæ˜¯å‚ä¸åˆ°å…¬å¸çš„ä¸šåŠ¡ä¸­å», æ·±å…¥äº†è§£å…¬å¸éœ€è¦ä»€ä¹ˆæ ·çš„äººæ‰. é™¤äº†ä¸Šé¢ä¸¤ç‚¹ä¹‹å¤–çš„ç†å¿µå¯ä»¥åœ¨ã€Šç²¾ç›Šåˆ›ä¸šã€‹å’Œã€Šå¯Œäººæ€ç»´ã€‹é‡Œçœ‹åˆ°ä¸€äº›ç±»ä¼¼çš„è§‚ç‚¹. å…¶å®æœ€éš¾å®è·µçš„å¯èƒ½å°±æ˜¯é€æ˜åº¦äº†, åœ¨å›½å†…è¿™ç§å…¬å¸æ°›å›´ä¸‹, ä¸996å°±ç®—æ˜¯å¹¸ç¦çš„äº†.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[]},{"title":"ç»Ÿè®¡æ€ç»´","slug":"Think Stats","date":"2020-04-20T14:40:20.000Z","updated":"2022-09-15T15:51:05.350Z","comments":true,"path":"2020/04/20/Think Stats/","link":"","permalink":"https://unpluggedcoder.me/2020/04/20/Think%20Stats/","excerpt":"","text":"ã€Šç»Ÿè®¡æ€ç»´â€”ç¨‹åºå‘˜æ•°å­¦ä¹‹æ¦‚ç‡ç»Ÿè®¡ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹ æ¨èåº¦: 4.0åˆ† è¿™æœ¬ä¹¦è‹±æ–‡åæ˜¯ã€ŠThink Statsã€‹, ä½œè€… [[ç¾] Allen B. Downey](https://book.douban.com/search/Allen B. Downey)è¿˜å†™äº†ä¸€æœ¬æ˜¯ã€ŠThink Bayesã€‹. è¿™æœ¬ä¹¦è¯»å®Œä¸€ä¸ªå¤šæœˆ, åˆ°ç°åœ¨æ¯”è¾ƒæœ‰å°è±¡çš„å°±æ˜¯åˆ†å¸ƒç´¯è®¡å‡½æ•°(CDF), ä»è¿™ä¸ªè§’åº¦å¯ä»¥å‘ç°å‡ºå¾ˆå¤šæœ‰æ„æ€çš„æ¨¡å‹. æ¯”å¦‚, ä¸€ä¸ªç¨‹åºmallocçš„sizeå¤§å°, å°±å¾ˆåƒæŒ‡æ•°åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°(æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯). ä½†å®é™…ä¸Šå‡†ç¡®è¯´åº”è¯¥æ˜¯åå¡æ–¹åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°. è¿™ä¸€ç‚¹æˆ‘ä¹Ÿæ˜¯åœ¨glibcçš„benchtestsä¸­å‘ç°çš„. æ­¤å¤–, è¿˜æœ‰å‡è®¾æ£€éªŒç­‰ç­‰æµç¨‹. è®©ç¨‹åºå‘˜å¯ä»¥çŸ¥é“å¦‚ä½•å‡†ç¡®åœ°è¡¨è¿°å‡ºä¸€ä¸ªæ•°æ®æŒ‡æ ‡(è™½ç„¶å®é™…è¿ç”¨ä¸­ä¸ä¼šè¿™ä¹ˆå»æ£€éªŒâ€¦).","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"ç»Ÿè®¡å­¦","slug":"ç»Ÿè®¡å­¦","permalink":"https://unpluggedcoder.me/tags/%E7%BB%9F%E8%AE%A1%E5%AD%A6/"}]},{"title":"å›¾è¯´é‡‘èå²","slug":"å›¾è¯´é‡‘èå²","date":"2020-03-16T15:40:20.000Z","updated":"2022-09-20T15:50:47.594Z","comments":true,"path":"2020/03/16/å›¾è¯´é‡‘èå²/","link":"","permalink":"https://unpluggedcoder.me/2020/03/16/%E5%9B%BE%E8%AF%B4%E9%87%91%E8%9E%8D%E5%8F%B2/","excerpt":"æ¨èåº¦: 3.5åˆ† å¦‚æœä¸ç®—æ—©äº›å¹´è¯»çš„ã€Šè´§å¸æˆ˜äº‰ã€‹, è¿™åº”è¯¥æ˜¯ä»è±¡ç‰™å¡”é‡Œå‡ºæ¥åè¯»çš„ç¬¬ä¸€æœ¬å†å²ä¹¦äº†. æ²¡æœ‰ç‰¹æ„æŒ‘å“ªæœ¬ä¹¦, éšæ„åœ¨äºšé©¬é€Šä¸Šçœ‹åˆ°å°±è¯»äº†. æ„Ÿå—è¿˜æ˜¯ä¸ä¸€æ ·çš„.","text":"æ¨èåº¦: 3.5åˆ† å¦‚æœä¸ç®—æ—©äº›å¹´è¯»çš„ã€Šè´§å¸æˆ˜äº‰ã€‹, è¿™åº”è¯¥æ˜¯ä»è±¡ç‰™å¡”é‡Œå‡ºæ¥åè¯»çš„ç¬¬ä¸€æœ¬å†å²ä¹¦äº†. æ²¡æœ‰ç‰¹æ„æŒ‘å“ªæœ¬ä¹¦, éšæ„åœ¨äºšé©¬é€Šä¸Šçœ‹åˆ°å°±è¯»äº†. æ„Ÿå—è¿˜æ˜¯ä¸ä¸€æ ·çš„. è¿™æœ¬ä¹¦å‰åŠæœ¬éƒ½æ„Ÿè§‰éå¸¸å¥½, ä»é‡‘èè§’åº¦çœ‹ä¸–ç•Œçš„å˜é©, å»å¯»æ‰¾ä¸­å›½è¿‘ä»£å²çš„è£‚å˜çš„æ ¹å› . æ—¶é—´è½´å¾ˆæ¸…æ™°, å¾ªåºæ¸è¿›, çœ‹åˆ°è¿‘ä»£ä¸­å›½ä¸€å‡ºä¸å¯é¿å…çš„æ‚²å‰§æ­£ä¸Šæ¼”. å¯èƒ½å’Œä½œè€…è®ºæ–‡ä¸»é¢˜å°±æ˜¯è¿™ä¸ªæ—¶ä»£çš„å…³ç³», è¿‡äº†è¿™ä¸ªæ—¶ä»£, ä¹Ÿå°±æ˜¯ä¸‹åŠæœ¬ä¹¦æ„Ÿè§‰ä¸å‡ºä½œè€…æƒ³è¡¨è¾¾ä»€ä¹ˆæ ·çš„ä¸»é¢˜, ä¸œæ¡ä¸€éƒ¨åˆ†å†å²è¯´è¯´, è¥¿æŒ‘ä¸€ä¸ªäººç‰©è®²è®², æ—¶é—´çº¿æ¯”è¾ƒæ··ä¹±. å½“ç„¶æˆ‘æœ¬èº«çš„é‡‘èæ°´å¹³å’Œä½œè€…ç›¸æ¯”æœ‰å¤©å£¤ä¹‹åˆ«, æˆ–è®¸æ— æ³•ç†è§£ä¸€äº›è¿‘ç°ä»£é‡‘èè¡ç”Ÿç‰©çš„æœ¯è¯­. è±†ç“£ä¸Šæœ‰äº›è¯„è®ºé’ˆå¯¹ä½œè€…çš„å›¾ç‰‡å¼•ç”¨, ç”±äºæœ¬èº«æ˜¯CSå‡ºèº«çš„åŸå› , çš„ç¡®å‘ç°ä½œè€…å¼•ç”¨çš„å›¾ç‰‡å¾ˆå°‘æœ‰ç‰ˆæƒå‡ºå¤„è¯´æ˜, ä¸è¿‡ä½œè€…çš„ç›®çš„æ˜¯è¾¾åˆ°äº†, ç”¨å¾ˆå¤šå›¾ç‰‡è®²è¿°äº†å†å²æ€§çš„äº§ç‰©. æ¢ä¸ªè§’åº¦çœ‹å†å², è¿™æ‰æ˜¯æˆ‘å»äº†è§£å†å²çš„æœ€å¤§åŠ¨åŠ›. å­¦æ ¡é‡Œçš„å†å²å…¨éƒ¨éƒ½æ˜¯å›´ç»•ç€xxxä¸»ä¹‰æ¥æè¿°, è€Œå­¦ç”Ÿå®Œå…¨ä¸çŸ¥é“èƒŒåç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆ?çœŸæ­£çš„åŸå› åˆæ˜¯ä»€ä¹ˆ?æ‰€æœ‰çš„å†å²å˜é©éƒ½é€ƒä¸å¼€é‡‘é’±å’ŒæƒåŠ›, äº¦å•†äº¦æ”¿éƒ½å…³ä¹è¿™äº›. æˆ‘å°†æ¥ç»™å­©å­è®²å†å², ä¸€å®šæ˜¯å›´ç»•ç€è¿™äº›å®çš„ä¸œè¥¿å˜é©æ¥å™è¿°. å†å²æ€»æ˜¯æƒŠäººçš„ç›¸ä¼¼, æœ‰å¤ªå¤šå¯ä»¥å€Ÿé‰´äº†, ä»å†å²ä¸­æ‰¾åˆ°ç»éªŒå’Œç­”æ¡ˆæ¥ç»™ç°ä»£çš„è‡ªå·±é¿å‘. å°±åƒä½œè€…å‰¯æ ‡é¢˜æ‰€è¯´çš„:â€œæ­£è§†å†å², æ˜¯å¯¹æœªæ¥æœ€å¥½çš„é¦ˆèµ .â€ æœ€å, æ„Ÿè°¢ä½œè€…æå¼˜ğŸ™!","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"é‡‘èå­¦","slug":"é‡‘èå­¦","permalink":"https://unpluggedcoder.me/tags/%E9%87%91%E8%9E%8D%E5%AD%A6/"}]},{"title":"é‚£äº›ç”±Rustæ‰“é€ çš„é«˜æ•ˆç”Ÿäº§åŠ›å·¥å…·(Updated on 2020-2-25)","slug":"RustTools","date":"2020-02-18T14:36:20.000Z","updated":"2022-09-20T15:46:38.322Z","comments":true,"path":"2020/02/18/RustTools/","link":"","permalink":"https://unpluggedcoder.me/2020/02/18/RustTools/","excerpt":"æœ€è¿‘æ²‰è¿·äºä¸€æ‰¹Rustç¼–å†™çš„ç”Ÿäº§åŠ›å·¥å…·, æ¯ä¸ªéƒ½æ˜¯blazing-fast, æœ‰çš„è¿˜å¾ˆé…·ç‚«. åœ¨è¿™é‡Œåšä¸ªæ”¶é›†åˆ†äº«, å…·ä½“å®‰è£…ã€æ•™ç¨‹å°±ä¸ç»†è¯´äº†, è‡ªè¡ŒæŸ¥é˜….","text":"æœ€è¿‘æ²‰è¿·äºä¸€æ‰¹Rustç¼–å†™çš„ç”Ÿäº§åŠ›å·¥å…·, æ¯ä¸ªéƒ½æ˜¯blazing-fast, æœ‰çš„è¿˜å¾ˆé…·ç‚«. åœ¨è¿™é‡Œåšä¸ªæ”¶é›†åˆ†äº«, å…·ä½“å®‰è£…ã€æ•™ç¨‹å°±ä¸ç»†è¯´äº†, è‡ªè¡ŒæŸ¥é˜…. ripgrepæœ€åˆçš„åº”è¯¥å°±æ˜¯ripgrepäº†, åç§°ä¹Ÿèµ·å¾—å¾ˆè°ƒçš®: R.I.P grep, æ„å›¾å¾ˆæ˜æ˜¾äº†, å°±æ˜¯å–ä»£grepçš„, ä¸”å®é™…æ€§èƒ½ç¢¾å‹grep. ä½œè€…åœ¨ä»–çš„æ–‡ç« ä¸­åˆ—ä¸¾äº†å¾ˆå¤šbenchmark. æˆªå–ä¸€ä¸ªæ„Ÿå—ä¸€ä¸‹: Tool Command Line count Time ripgrep rg -L -u -tc -n -w &#39;[A-Z]+_SUSPEND&#39; 404 0.079s ucg ucg --type=cc -w &#39;[A-Z]+_SUSPEND&#39; 390 0.163s GNU grep egrep -R -n --include=&#39;*.c&#39; --include=&#39;*.h&#39; -w &#39;[A-Z]+_SUSPEND&#39; 404 0.611s ä¸è¿‡, æˆ‘ç”¨å¾—æœ€å¤šçš„å¹¶ä¸æ˜¯rgå‘½ä»¤, è€Œæ˜¯åœ¨vimä¸­çš„LeaderFæ’ä»¶çš„æ¨¡ç³ŠåŒ¹é…, é€Ÿåº¦ä¹Ÿæ˜¯è´¼å¿«. infernoinfernoè¿™ä¸ªå·¥å…·å¾ˆå¤šäººä¸å¸¸ç”¨, ä½†æ˜¯å¯¹æˆ‘çš„å¸®åŠ©æ˜¯æœ€å¤§çš„. å‡ ä¹ç§’ç”ŸæˆğŸ”¥ç«ç„°å›¾çš„å·¥å…·, å’ŒåŸç‰ˆFlameGraphç›¸æ¯”, é€Ÿåº¦å¿«äº†18~20å€. è´´ä¸€ä¸ªä½œè€…çš„benchmark: 123456789101112131415collapse/dtrace/1 time: [8.2767 ms 8.2817 ms 8.2878 ms] thrpt: [159.08 MiB/s 159.20 MiB/s 159.29 MiB/s]collapse/dtrace/12 time: [3.8631 ms 3.8819 ms 3.9019 ms] thrpt: [337.89 MiB/s 339.63 MiB/s 341.28 MiB/s]collapse/perf/1 time: [16.386 ms 16.401 ms 16.416 ms] thrpt: [182.37 MiB/s 182.53 MiB/s 182.70 MiB/s]collapse/perf/12 time: [4.8056 ms 4.8254 ms 4.8460 ms] thrpt: [617.78 MiB/s 620.41 MiB/s 622.97 MiB/s]collapse/sample time: [8.9132 ms 8.9196 ms 8.9264 ms] thrpt: [155.49 MiB/s 155.61 MiB/s 155.72 MiB/s]flamegraph time: [16.071 ms 16.118 ms 16.215 ms] thrpt: [38.022 MiB/s 38.250 MiB/s 38.363 MiB/s] æ„Ÿå—ä¸€ä¸‹å¯¹æ¯”: brootè¿˜åœ¨ç”¨treeå‘½ä»¤å—? è¯•è¯•brootå§! äº¤äº’å¼çš„æ ‘å½¢ç»“æ„æŸ¥æ‰¾, ä¸€ç›®äº†ç„¶, å…³é”®æ˜¯æ¯«ç§’çº§çš„æŸ¥è¯¢å“åº”. dudua-clidua (-&gt; Disk Usage Analyzer) , ç±»ä¼¼duå‘½ä»¤, ä½†æ˜¯æä¾›äº¤äº’å¼çš„æŸ¥çœ‹æ–¹å¼. dustdu + rust &#x3D; dust. æ›´ç›´è§‚çš„æ–¹å¼æ˜¾ç¤ºduå‘½ä»¤. ä¸è¿‡ä¸æ˜¯å¸¸è§„çš„æ ‘å‹ç»“æ„, è€Œæ˜¯å€’æ ‘å‹. dutreedutree, duå‘½ä»¤+treeå‘½ä»¤, æä¾› files-only åŠŸèƒ½. ä¸Šé¢ä¸‰ä¸ªå·¥å…·, ç”±äºdua-cliä¸åŒ…å«æ ‘å‹ç­‰å¤æ‚çš„å›¾å½¢, æ‰€ä»¥åœ¨ç»Ÿè®¡ä¸Šé€Ÿåº¦æœ€å¿«(ä»¥--depth 1æµ‹è¯•). å„æœ‰åƒç§‹, å¤§å®¶å¯ä»¥è‡ªé€‰. batè¿™ä¸ªbatä¸æ˜¯æˆ‘ä»¬æƒ³çš„BAT. ç›®çš„æ˜¯å–ä»£cat(cat with wings -&gt; bat). ä»¥å‰ä¸€ç›´è®¤ä¸ºcatå°±æ˜¯æ‰“å°åˆ°ç»ˆç«¯, ç”¨æ¥æŸ¥çœ‹æ–‡ä»¶è€Œå·², ç›´åˆ°çœ‹åˆ°äº†bat: è‡ªåŠ¨æ ¹æ®æ–‡ä»¶ç±»å‹åšè¯­æ³•é«˜äº®, å¥½çœ‹å¤šäº†. è¿˜æœ‰å…¶å®ƒçš„å‘½ä»¤å‚æ•°, ç”šè‡³æœ‰ä¸€ä¸ªå’Œripgrepç»“åˆçš„å‘½ä»¤: batgrep, å¸¦é«˜äº®åœ°æ‰“å°å‰è€…çš„è¾“å‡º. hexyl å¦‚æœè¦æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹æ€ä¹ˆåŠ? batåªèƒ½æ‰“å°å‡ºæ¥å‘Šè¯‰ä½ æ˜¯ &lt;BINARY&gt;. è¿™æ—¶å€™éœ€è¦hexyl, éå¸¸å‹å¥½çš„äºŒè¿›åˆ¶æŸ¥çœ‹å·¥å…·, æ›¾ç»è¿˜åœ¨è‹¦è‹¦å¯»æ‰¾å¥½ç”¨GUIå·¥å…·. å½“ç„¶è¿˜æ”¯æŒå¾ˆå¤šå‚æ•°, è‡ªå®šä¹‰æŸ¥çœ‹æ–¹å¼. dtoolé™¤äº†æŸ¥çœ‹æ–‡ä»¶å†…å®¹æˆ–è€…äºŒè¿›åˆ¶æ•°æ®å¤–, æˆ‘ä»¬é€šå¸¸è¿˜ä¼šè®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼æˆ–è€…ä¸€äº›å…¶å®ƒçš„æ–‡ä»¶å¸¸è§æ“ä½œ, è€Œdtoolè¿™ä¸ªå·¥å…·å°±åƒä¸€ä¸ªå¼€å‘è€…çš„å°å‹ç‘å£«å†›åˆ€, æä¾›äº†å¼€å‘è€…å¾ˆå¤šå¸¸è§å‘½ä»¤æ“ä½œ, å¦‚è®¡ç®—å“ˆå¸Œå€¼ã€ç¼–ç è½¬æ¢ç­‰ç­‰å¸¸è§æ“ä½œ. convert a string to base64 12$ echo -n abc | dtool s2h | dtool h2b64YWJj convert a encoded timestamp to date 12$ echo -n 2c28e75d | dtool nd -tu32 | dtool ts2d2019-12-04 11:29:48 convert a jpeg to base64 12$ cat pic.jpg | dtool b2h | dtool h2b64/9j/4AAQSkZJR... calculate file md5 12$ cat pic.jpg | dtool b2h | dtool hash -a md50x1884b72e23b0c93320bac6b050478ff4 ytopå¸¸ç”¨çš„htopå‘½ä»¤ä¹Ÿæœ‰ä¸€ä¸ªRustçš„ç‰ˆæœ¬, å«ytop, æ ·å­ä¹Ÿæ˜¯å¾ˆé…·ç‚«. procsæ›¾ç»ä¹Ÿæ˜¯å„ç§è®°pså‘½ä»¤çš„å‚æ•°, åæ¥ç”¨htop. ç°åœ¨æœ‰äº†procs, åŠŸèƒ½ä¸Šè™½ä¸å¦‚htopä¸°å¯Œ, ä½†æ˜¯èƒ½å¤ŸæŸ¥çœ‹dockerå®¹å™¨çš„çŠ¶æ€. åé¢å†åˆ†äº«ä¸¤ä¸ªæ¯”è¾ƒfancyçš„å·¥å…·. lsdlsdçœ‹åç§°å°±æ˜¯æ›¿ä»£lsçš„, åŠ äº†å„ç§iconå’Œé«˜äº®, éœ€è¦å®‰è£…nerdå­—ä½“ starship å…‰çœ‹logoå’Œåå­—å°±çŸ¥é“å¾ˆfancyäº†, ä»¥æ¨¡å—çš„å“²å­¦æ¥å®šä¹‰shellç»ˆç«¯å±•ç¤º. è¿˜æœ‰å¦å¤–ä¸€ä¸ªå«nushell, ç”¨ç»ˆç«¯åˆ¶è¡¨çš„æ–¹å¼æ‰“å°è¾“å‡º, å’Œä¸Šé¢å‡ ä¸ªç›¸æ¯”å°±æ²¡æœ‰é«˜äº®äº†. tui-rsæœ€åç¥­å‡ºtui-rs, æ˜¯ä¸€ä¸ªRustçš„ç»ˆç«¯GUI library, æä¾›å„ç§Widget, å¯ä»¥ç”¨æ¥DIYè‡ªå·±çš„ç¥å™¨. åŒ…æ‹¬ä¸Šé¢çš„ytopä¹Ÿæ˜¯åŸºäºtui-rså¼€å‘çš„. æ„Ÿè°¢å„ä½ä½œè€…å’ŒRust, ç»™å¤§å®¶å¸¦æ¥çš„è¿™äº›é«˜æ•ˆå·¥å…·, æ¬¢è¿æ¨èğŸ‘. å¼€äº†ä¸€ä¸ªä»“åº“ç”¨æ¥è®°å½•å’Œå­˜æ”¾ï¼šhttps://github.com/unpluggedcoder/awesome-rust-toolsï¼Œä¸å®šæœŸæ›´æ–°ä¸­ã€‚","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Productivity tools","slug":"Productivity-tools","permalink":"https://unpluggedcoder.me/tags/Productivity-tools/"},{"name":"ripgrep","slug":"ripgrep","permalink":"https://unpluggedcoder.me/tags/ripgrep/"},{"name":"lsd","slug":"lsd","permalink":"https://unpluggedcoder.me/tags/lsd/"},{"name":"broot","slug":"broot","permalink":"https://unpluggedcoder.me/tags/broot/"},{"name":"starship","slug":"starship","permalink":"https://unpluggedcoder.me/tags/starship/"},{"name":"procs","slug":"procs","permalink":"https://unpluggedcoder.me/tags/procs/"},{"name":"dua-cli","slug":"dua-cli","permalink":"https://unpluggedcoder.me/tags/dua-cli/"},{"name":"dust","slug":"dust","permalink":"https://unpluggedcoder.me/tags/dust/"},{"name":"dutree","slug":"dutree","permalink":"https://unpluggedcoder.me/tags/dutree/"},{"name":"inferno","slug":"inferno","permalink":"https://unpluggedcoder.me/tags/inferno/"},{"name":"dtool","slug":"dtool","permalink":"https://unpluggedcoder.me/tags/dtool/"},{"name":"ytop","slug":"ytop","permalink":"https://unpluggedcoder.me/tags/ytop/"},{"name":"bat","slug":"bat","permalink":"https://unpluggedcoder.me/tags/bat/"},{"name":"tui-rs","slug":"tui-rs","permalink":"https://unpluggedcoder.me/tags/tui-rs/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Macros","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Macros","date":"2020-02-14T16:25:20.000Z","updated":"2022-09-15T15:51:05.348Z","comments":true,"path":"2020/02/15/Rustå…¥é—¨å¤±è´¥ä¹‹Macros/","link":"","permalink":"https://unpluggedcoder.me/2020/02/15/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BMacros/","excerpt":"","text":"Macroå’Œå‡½æ•°çš„åŒºåˆ«å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£. ç®€å•åœ°è¯´Macroæ˜¯Rustå…ƒç¼–ç¨‹çš„å¼ºå¤§æ­¦å™¨, å’ŒC++çš„æ¨¡æ¿åœ¨åŒä¸€ä¸ªé€»è¾‘å±‚é¢. å’ŒCè¯­è¨€çš„å®æœ€å¤§çš„åŒºåˆ«ä¸æ˜¯Cè¯­è¨€å®çš„ç®€å•æ–‡æœ¬æ›¿æ¢, è€Œæ˜¯è¯­æ³•å±‚é¢çš„å¤„ç†. Marcosçš„æ‰©å±•æ—¶æœºæ˜¯åœ¨ç±»å‹æ£€æŸ¥ä¹‹å‰, ä¹Ÿè¿œåœ¨æœºå™¨ä»£ç ç ç”Ÿæˆå‰. å®ä¼šè¢«ç‰¹æ¢æˆRustä»£ç . Rust Macroçš„åŒæ ·ä¹Ÿæ˜¯ä¹‹å‰è¯´è¿‡çš„åŸºäºæ¨¡å¼åŒ¹é…, å› æ­¤ä¸ä¼šå‡ºç°æ’å…¥ä¸å¯¹ç§°æ‹¬å·çš„Rustä»£ç ç­‰è¿™ç±»é”™è¯¯. Ruståœ¨æ‰©å±•Macroæ—¶å¿…é¡»è¦å…ˆå®šä¹‰, è¿™å’Œå‡½æ•°ä¸åŒ, å‡½æ•°çš„å®šä¹‰ä½ç½®é¡ºåºæ²¡æœ‰è¦æ±‚, è€ŒRustä»£ç åœ¨ç¼–è¯‘æ—¶é‡åˆ°Macroå¿…é¡»å…ˆå±•å¼€, è€Œä¸ä¼šç»§ç»­èµ°ä¸‹å». Macroæ¨¡å¼åŒ¹é…è§„åˆ™ ä»¥assert_eq!ä¸ºä¾‹, æ¥è§£é‡Šä¸‹Macroçš„æ¨¡å¼åŒ¹é…: assert_eqæ˜¯Macroçš„åç§°, åé¢ç´§éšçš„delimiteræ²¡æœ‰å¼ºåˆ¶è¦æ±‚æ˜¯å¤§æ‹¬å·, ç”šè‡³å¯ä»¥æ˜¯å°æ‹¬å·æˆ–è€…ä¸­æ‹¬å·. è°ƒç”¨æ—¶ä¹Ÿæ˜¯ä¸€æ ·, ä¸‹é¢çš„éƒ½æ˜¯åˆæ³•çš„: 123456assert_eq!(gcd(6, 10), 2);assert_eq![gcd(6, 10), 2];assert_eq!&#123;gcd(6, 10), 2&#125;;let x = vec![1,2,3];let y = vec!&#123;1,2,3&#125;; â‡’ç¬¦å·å·¦è¾¹çš„å«MacroMatcher, ç®€å•åœ°è¯´å¯ä»¥ç†è§£ä¸ºpattern, å³æ¨¡å¼åŒ¹é…. å®ƒçš„åŒ¹é…è§„åˆ™æ˜¯ä»¥tokenä¸ºå¯¼å‘çš„, è¿™ç‚¹å’Œæ­£åˆ™åŒ¹é…ä¸åŒ(ä»¥å­—ç¬¦ä¸ºå¯¼å‘çš„åŒ¹é…). å› æ­¤åœ¨patterné‡ŒåŠ å…¥ç©ºæ ¼æˆ–è€…æ³¨é‡Šéƒ½æ˜¯å…è®¸çš„. æ¯ä¸ªpatternç”±ä¸€å¯¹$name:designator(ä»£å·)ç»„æˆ, å‰è€…æ˜¯ä»£å·çš„å˜é‡å, åè€…ä»£å·æŒ‡ç¤ºè¿™ä¸ªå˜é‡å°†æŒ‰å“ªç§ç±»å‹è§„åˆ™æ¥åŒ¹é…. å¸¸è§çš„æœ‰: item: an item, such as a function, a struct, a module, etc. block: a block (i.e. a block of statements and&#x2F;or an expression, surrounded by braces) stmt: a statement pat: a pattern expr: an expression ty: a type ident: an identifier path: a path (e.g. foo, ::std::mem::replace, transmute::&lt;_, int&gt;, â€¦) meta: a meta item; the things that go inside #[...] and #![...] attributes tt: a single token tree æ¯”è¾ƒéš¾ç†è§£çš„æ˜¯å¤šé‡åŒ¹é…, æ ¼å¼å¦‚ä¸‹: ä¸­é—´çš„éƒ¨åˆ†å’Œå•ä¸ªpatternä¸€æ ·, ä¸åŒçš„æ˜¯å¤šäº†ä¸€å¯¹$() å’Œ ,* , *å·ä»£è¡¨å‰é¢$(...)å†…çš„å†…å®¹ä¼šå‡ºç°0æˆ–å¤šæ¬¡, å’Œæ­£åˆ™ä¸€æ ·. è€Œé€—å·,åªæ˜¯ä¸€ä¸ªåˆ†éš”ç¬¦, ç”šè‡³ä¸è¦æ±‚æ˜¯é€—å·. ç¼–è¯‘(å±•å¼€)å®çš„æ—¶å€™, é‡å¤patternçš„å†…å®¹ç”¨æ³•ä¹Ÿå’Œä¸Šé¢åŸºæœ¬ç±»ä¼¼, å¤šçš„ä¹Ÿåªæ˜¯ä¸€ä¸ª$(...)*ç¬¦å·, ç”¨ä¸‹é¢çš„æ¯”è¾ƒå¥½ç†è§£: å¯¹äºæ¯ä¸€å¯¹å‡ºç°å¯¹$keyå’Œ$value, éƒ½å°†ç”¨$(...)*å†…çš„hm.insert(...); è¯­å¥æ›¿æ¢. Macroè°ƒè¯• æœ‰çš„æ—¶å€™ä¸çŸ¥é“è‡ªå·±å†™çš„macroæœ€ç»ˆè¢«æ‰©å±•æˆä»€ä¹ˆæ ·å­, è¿™æ—¶å€™æœ‰ä¸¤ç§æ–¹æ³•æ¥æ‰“å°å‡ºrustcæ‰©å±•åçš„ä»£ç : ç›´æ¥è°ƒç”¨rustcç¼–è¯‘å™¨(éœ€è¦nightlyç‰ˆæœ¬): 1$ cargo +nightly rustc --profile=check -- -Zunstable-options --pretty=expanded ç”¨ç¬¬ä¸‰æ–¹åº“cargo-expand , å®ƒæœ‰ä¸ªä¼˜ç‚¹å°±æ˜¯æ‰“å°å‡ºæ¥çš„æ˜¯æ ¼å¼åŒ–ä¸”å¸¦è¯­æ³•é«˜äº®çš„ä»£ç , å¯è¯»æ€§éå¸¸å¥½. 12345678910$ cargo expand# or expand a particular test target:$ cargo expand --test test_something# or expand bench target$ cargo expand --bench bench_name# or expand a specific module or type or function only:$ cargo expand path::to::module æœ€å, å‘ç°ä¸€ç¯‡å¯¹macroè§£é‡Šéå¸¸å¥½çš„æ–‡ç« , å¯ä»¥å‚è€ƒ:A Beginnerâ€™s Guide to Rust Macros âœ¨","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Pattern","slug":"Pattern","permalink":"https://unpluggedcoder.me/tags/Pattern/"},{"name":"Macros","slug":"Macros","permalink":"https://unpluggedcoder.me/tags/Macros/"}]},{"title":"æ·±åº¦å­¦ä¹ å…¥é—¨ï¼šåŸºäºPythonçš„ç†è®ºä¸å®ç°","slug":"æ·±åº¦å­¦ä¹ å…¥é—¨ï¼šåŸºäºPythonçš„ç†è®ºä¸å®ç°","date":"2020-02-01T02:06:20.000Z","updated":"2022-09-20T15:44:50.731Z","comments":true,"path":"2020/02/01/æ·±åº¦å­¦ä¹ å…¥é—¨ï¼šåŸºäºPythonçš„ç†è®ºä¸å®ç°/","link":"","permalink":"https://unpluggedcoder.me/2020/02/01/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8%EF%BC%9A%E5%9F%BA%E4%BA%8EPython%E7%9A%84%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"æ¨èåº¦: 4.5åˆ† ä½œè€…ä»åŸºç¡€çš„ä¸æˆ–éçŸ¥è¯†å¼€å§‹æ™®åŠç¥ç»ç½‘ç»œ, è€Œä¸”ä¸»è¦ä¸€ç‚¹åœ¨äºå…¨ä¹¦éå¸¸å–„äºç”¨è¨€ä¹‹æ˜“æ‡‚çš„ç±»æ¯”æ¥ä¸¾ä¾‹è¯´æ˜. ä¸ºåˆå­¦è€…äº†è§£è¿™é—¨å­¦ç§‘èµ·åˆ°äº†å¾ˆå¥½çš„å¸®åŠ©. å¯¹æ•°å­¦çš„è¦æ±‚æœ€å¤šå°±åˆ°åå¯¼æ•°å’Œçº¿æ€§ä»£æ•°çš„çŸ©é˜µä¹˜æ³•, è€ŒèƒŒåæ›´å¤šçš„ç®—æ³•å’Œæ•°å­¦åŸç†ä½œè€…å¹¶æ²¡æœ‰ä¸€ä¸€å±•å¼€ç»†è¯´. ä½†æ˜¯é€šè¿‡ä¸Šé¢ä¸€ç‚¹, å¤§è‡´çš„éƒ½èƒ½äº†è§£åˆ°æ·±åº¦å­¦ä¹ ä¼˜åŒ–ç®—æ³•å’Œå‚æ•°èƒŒåçš„æ„ä¹‰, ä¸ºæƒ³è¦æ›´åŠ æ·±å…¥ç ”ç©¶çš„äººé“ºå¹³äº†é“è·¯. å¦‚æœéœ€è¦æŠ•å…¥åˆ°æœºå™¨å­¦ä¹ å®è·µä¸­çš„è¯, è¿™æœ¬ç»ä¸æ˜¯é‚£ç§çœ‹è¿‡ä¸€éå°±æŸä¹‹é«˜é˜çš„ä¹¦ç±.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"Deep Learning","slug":"Deep-Learning","permalink":"https://unpluggedcoder.me/tags/Deep-Learning/"}]},{"title":"å°ç‹—é’±é’±","slug":"å°ç‹—é’±é’±","date":"2020-02-01T01:46:20.000Z","updated":"2022-09-20T15:44:43.736Z","comments":true,"path":"2020/02/01/å°ç‹—é’±é’±/","link":"","permalink":"https://unpluggedcoder.me/2020/02/01/%E5%B0%8F%E7%8B%97%E9%92%B1%E9%92%B1/","excerpt":"","text":"ã€Šå°ç‹—é’±é’±ã€‹æ¨èåº¦: 3.5åˆ† è¿™æ˜¯çœ‹åšå¤šÂ·èˆè´¹å°”çš„ç¬¬äºŒæœ¬ä¹¦, è¿™æœ¬ä¹¦å¯ä»¥è¯´æ˜¯æŠŠã€Šè´¢åŠ¡è‡ªç”±ä¹‹è·¯ã€‹çš„ç»éªŒæ€»ç»“æˆäº†éå¸¸å¥½ç†è§£çš„å„¿ç«¥è´¢å•†åŸ¹å…»æ•…äº‹. ã€Šå°ç‹—é’±é’±2ã€‹è¿™æœ¬ä¹¦å°±ä¸æ¨èäº†, å‰¯æ ‡é¢˜æ˜¯â€œå‘æ˜å’ŒåŸ¹å…»å­©å­çš„ä¼˜ç§€å“æ ¼â€. æ„Ÿè§‰å€’ä¸å¦‚ç”¨è¿™ä¸ªåšä¹¦å. éå¸¸ç‰µå¼ºçš„æƒ…èŠ‚, ä¸»é¢˜ä¸å†æ˜¯å°ç‹—, ä¹Ÿä¸æ˜¯é’±, æ»¡æ»¡çš„é¸¡æ±¤, å¹²å°±å®Œäº†.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"è‚²å„¿","slug":"è‚²å„¿","permalink":"https://unpluggedcoder.me/tags/%E8%82%B2%E5%84%BF/"},{"name":"ç†è´¢","slug":"ç†è´¢","permalink":"https://unpluggedcoder.me/tags/%E7%90%86%E8%B4%A2/"}]},{"title":"å¯¹å†²ï¼šä¸ç¡®å®šæ—¶ä»£å¦‚ä½•èªæ˜åœ°å†’é™©","slug":"å¯¹å†²","date":"2020-01-28T13:17:20.000Z","updated":"2022-09-20T15:44:40.508Z","comments":true,"path":"2020/01/28/å¯¹å†²/","link":"","permalink":"https://unpluggedcoder.me/2020/01/28/%E5%AF%B9%E5%86%B2/","excerpt":"","text":"æ¨èåˆ†ï¼š3.5 è¿™ä¹¦åæ€ä¹ˆè¯´å‘¢ï¼Œå­—é¢ç¿»è¯‘è¿‡æ¥åº”è¯¥æ˜¯ã€Šä¸€ä½èµ°è¿›å¦“é™¢çš„ç»æµå­¦å®¶ã€‹ğŸ˜‚ ä½œè€…åœ¨å‰å…«ç« éƒ½æ²¡æœ‰è°ˆâ€œå¯¹å†²â€è¿™ä¸ªè¯ï¼Œä¸€ç›´åœ¨è®¨è®ºé£é™©è¿™ä¸ªæ¦‚å¿µã€‚ä½œä¸ºä¸€ä½ç»æµå­¦å®¶ï¼Œå¹¶æ²¡æœ‰å¤§è°ˆé‡‘èé¢†åŸŸçš„å¯¹å†²æ“ä½œï¼Œè€Œæ˜¯åˆ—ä¸¾äº†ç”Ÿæ´»ä¸­å¾ˆå¤šé«˜é£é™©èŒä¸šç®¡ç†é£é™©çš„æ–¹æ³•ï¼Œè¿›è€Œå¼•ç”³åˆ°é‡‘èé¢†åŸŸã€‚æ¯”å¦‚ï¼Œä¹¦åä¸­çš„å¦“é™¢ï¼Œè¿˜æœ‰ç‹—ä»”é˜Ÿã€ç”µå½±è¡Œä¸šã€ç§é©¬ã€é­”æœ¯ç­‰ã€‚ ä¸ªäººæ„Ÿè§‰å¯¹å†²å¹¶ä¸æ˜¯æ•´æœ¬ä¹¦çš„ä¸»é¢˜ã€‚ç›¸æ¯”äºå¯¹å†²æ“ä½œæœ¬èº«ï¼Œæ„Ÿè§‰ä½œè€…æ›´å¸Œæœ›è¯»è€…æ¸…æ¥šè‡ªå·±çš„ç›®æ ‡, ä»¥åŠå¦‚ä½•å¤„ç†éœ€è¦é¢ä¸´çš„é£é™©ã€‚é¦–å…ˆï¼Œè¦æ¸…æ¥šè‡ªå·±çš„ç›®æ ‡ï¼Œä¸è¦ç›²ç›®çš„è¿½æ±‚é«˜é£é™©ï¼Œè¿™å’Œã€Šä½é£é™©ï¼Œé«˜å›æŠ¥ã€‹ä¸€ä¹¦çš„ä½œè€…ä¸€æ ·ï¼Œå¯¹å¤§å¤šæ•°äººæ¥è¯´ï¼Œé«˜é£é™©ä¸æ˜¯ä»€ä¹ˆå¥½äº‹ï¼Œæœ‰å¾ˆå¤šä½é£é™©çš„é€‰æ‹©ã€‚å…¶æ¬¡ï¼Œé£é™©æœ‰ç³»ç»Ÿé£é™©å’Œç‰¹æ®Šé£é™©ã€‚å‰è€…æ˜¯æ•´ä¸ªç»æµå‘å±•çš„è¶‹åŠ¿é£é™©ï¼Œåè€…å¯ä»¥ç†è§£ä¸ºä¸ªä½“çš„é£é™©å› ç´ ã€‚ä¸åŒé£é™©æœ‰ä¸åŒçš„ç®¡ç†ç­–ç•¥ã€‚å†æ¬¡ï¼Œé¢å¯¹é£é™©ï¼Œç†æ€§å¾ˆé‡è¦ã€‚èµŒå¾’å¿ƒæ€æ˜¯å¾ˆå¤§çš„å¿Œè®³ã€‚ è¿™äº›æ˜¯æˆ‘è®¤ä¸ºä½œè€…æ€»ç»“å‡ºçš„é¢å¯¹é£é™©çš„å®è§‚åŸåˆ™ï¼Œè€Œä½œè€…åœ¨ä¹¦ååŠéƒ¨æåˆ°çš„å¯¹å†²å’Œä¿é™©æ˜¯ç®¡ç†é£é™©çš„æ‰‹æ®µã€‚çœ‹åˆ°ä¹ˆï¼Œå¯¹å†²åªæ˜¯æ‰‹æ®µä¹‹ä¸€ï¼Œç›¸æ¯”ä¿é™©è§£å†³ä¸‹è·Œé£é™©çš„æ‰‹æ®µï¼Œå¯¹å†²ç¼©å°äº†é£é™©å½±å“çš„åŒæ—¶ä¹Ÿå‡å°‘äº†æ”¶ç›Šçš„ä¸Šé™(åˆ‡æ–­äº†é£é™©ä¸Šä¸‹ç«¯)ã€‚åº”è¯¥åˆç†çš„åˆ©ç”¨å¯¹å†²ï¼ŒæŠŠå®ƒå½“æˆé™ä½é£é™©çš„å·¥å…·ï¼Œè€Œä¸æ˜¯å†’é™©è¿½æ±‚é«˜å›æŠ¥çš„æ‰‹æ®µã€‚ æœ€åï¼Œä»»ä½•é£é™©ç®¡ç†ç­–ç•¥éƒ½æ— æ³•åº”å¯¹æ‰€æœ‰æƒ…å†µï¼Œé¢å¯¹ä¸ç¡®å®šæ€§ä¸ä»…éœ€è¦é ç»éªŒæ€»ç»“, å¿ƒæ€æ›´é‡è¦, è®©æˆ‘æƒ³èµ·:â€œå”¯ä¸€ä¸å˜çš„å°±æ˜¯å˜åŒ–â€ğŸ˜‚, åƒµåŒ–çš„æƒ¯æ€§æ€ç»´ä¼šè®©è‡ªå·±å¤„äºè¢«åŠ¨çš„çŠ¶æ€. ä¸»åŠ¨å»è¿æ¥æœªçŸ¥çš„æœªçŸ¥, é¢å¯¹é£é™©çš„å¥—è·¯å§‹ç»ˆä¸å˜: å®šä¹‰ç›®æ ‡, æ‰¾åˆ°å®Œæˆç›®æ ‡çš„æœ€ä½³æ–¹å¼, åŒæ—¶æœ€å°åŒ–ä¸‹è·Œé£é™©.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"é£é™©","slug":"é£é™©","permalink":"https://unpluggedcoder.me/tags/%E9%A3%8E%E9%99%A9/"},{"name":"ç»æµå­¦","slug":"ç»æµå­¦","permalink":"https://unpluggedcoder.me/tags/%E7%BB%8F%E6%B5%8E%E5%AD%A6/"}]},{"title":"çˆ±ã€é‡‘é’±å’Œå­©å­ï¼šè‚²å„¿ç»æµå­¦","slug":"çˆ±ã€é‡‘é’±å’Œå­©å­ï¼šè‚²å„¿ç»æµå­¦","date":"2020-01-20T15:59:20.000Z","updated":"2022-09-20T15:24:01.518Z","comments":true,"path":"2020/01/20/çˆ±ã€é‡‘é’±å’Œå­©å­ï¼šè‚²å„¿ç»æµå­¦/","link":"","permalink":"https://unpluggedcoder.me/2020/01/20/%E7%88%B1%E3%80%81%E9%87%91%E9%92%B1%E5%92%8C%E5%AD%A9%E5%AD%90%EF%BC%9A%E8%82%B2%E5%84%BF%E7%BB%8F%E6%B5%8E%E5%AD%A6/","excerpt":"","text":"æ¨èåº¦: 2.5 å½“æ—¶åœ¨æ¨ä¸Šçœ‹åˆ°çš„è¿™æœ¬ä¹¦, ä»æ ‡é¢˜ä¸Šçœ‹å¾ˆæœ‰å¸å¼•åŠ›, ä¸€ç›´æƒ³è¦è¯», åæ¥äºšé©¬é€Šæ‰“æŠ˜, åªè¦RMB14.99, ç°åœ¨é•¿æœŸæ˜¯13.99. æˆ–è®¸æœŸæœ›å¤ªé«˜, ä¹Ÿæˆ–è®¸ä»·æ ¼ååº”å‡ºäº†ä»·å€¼â€¦ å…¶å®åº”è¯¥æŠŠå‰¯æ ‡é¢˜ç¿»è¯‘å‡ºæ¥: å¦‚ä½•ç”¨ç»æµå­¦æ¥è§£é‡Šæˆ‘ä»¬çš„è‚²å„¿æ–¹å¼. è¿™ä¸ªè§’åº¦éå¸¸æœ‰æ„æ€, æ€•è¯»è€…ä»¥ä¸ºæ˜¯è‚²å„¿ä¹¦, ä½œè€…ä¸Šæ¥å°±è¯´: è¿™ä¸æ˜¯ä¸€æœ¬æ•™ä½ å¦‚ä½•è‚²å„¿çš„ä¹¦. çš„ç¡®, ä½œè€…ä¾‹ä¸¾äº†å¾ˆå¤šå®éªŒæ•°æ®æ¥éªŒè¯ä¸åŒæ•™å…»æ–¹å¼èƒŒåçš„åŠ¨æœº, æ‰€ä»¥, ä¸€é¡µå°±èƒ½è®²æ˜ç™½çš„é“ç†, æ„£æ˜¯æ‘†äº‹å®è®²é“ç†è¯´äº†å¥½å‡ é¡µ. å›åˆ°ä¹¦çš„å†…å®¹ä¸Š, é¦–å…ˆæ ¹æ®å¯¹å­©å­çš„å¹²é¢„ç¨‹åº¦ä¸åŒ, ä½œè€…ä¸€ä¸Šæ¥å…ˆå’Œè¯»è€…æ‹‰é€šå››ä¸ªæ•™å…»æ–¹å¼çš„å…±è¯†. è¿™å››ç§æ•™å…»æ–¹å¼å¤§è‡´æ˜¯ä¸‹é¢è¿™å‡ ä¸ªæ„æ€: å¿½è§†å‹: å¨ƒ, ä½ æ˜¯è°?ä»å“ªé‡Œæ¥?è¦åˆ°å“ªé‡Œå»? æ”¾ä»»å‹: å¨ƒ, ä½ çˆ±å’‹æ»´å’‹æ»´. ä¸“æ–­å‹: å¨ƒ, æ‰“ä½ æ˜¯ä¸ºä½ å¥½. æƒå¨å‹: å¨ƒ, å’±ä»¬è®²é“ç†! å½“ç„¶, ä»ä¸Šåˆ°ä¸‹, å­©å­çš„å¹³å‡æˆç»©è¡¨ç°(æ³¨æ„, æ˜¯æˆç»©)æ˜¯é€å±‚é€’å¢. åœ¨æŸäº›å‘è¾¾å›½å®¶å¿½è§†å‹çš„çˆ¶æ¯å¯èƒ½å·²ç»è§¦çŠ¯æ³•å¾‹; è€Œå¤§å¤šåŒ—æ¬§å›½å®¶é‡‡å–æ”¾ä»»å‹; æ„å¤§åˆ©å’ŒæŸäº›å®—æ•™å›½åå‘ä¸“æ–­å‹; ä¸­å›½ã€ç¾å›½çˆ¶æ¯å¤§å¤šå½’ä¸ºæƒå¨å‹. ä½œè€…ä»ç»æµå­¦è§’åº¦çš„åŠ¨æœºæ¥è¯´æ˜çˆ¶æ¯é‡‡å–è¿™äº›ä¸åŒæ•™å…»æ–¹å¼èƒŒåçš„åŠ¨æœº. ç»“åˆäº†ä¸åŒæ—¶ä»£ã€ç¤¾ä¼šç¯å¢ƒã€æ•™è‚²æ”¿ç­–ã€æ€§åˆ«ã€ç”Ÿè‚²æ”¿ç­–ã€å®—æ•™ç­‰ç­‰å„æ–¹é¢å› ç´ åå¤è®ºè¯. å›½å¤–çš„ä½œè€…å¤§éƒ½æ¯”è¾ƒä¸¥è°¨, è¿™æœ¬ä¹¦å’Œã€Šè´«ç©·çš„æœ¬è´¨ã€‹å¾ˆåƒ, éƒ½æ˜¯ç”¨äº†è®¸å¤šä¸åŒè§’åº¦çš„éšæœºå¯¹ç…§æ•°æ®æ¥è¯´æ˜é—®é¢˜. ä¸è¿‡è¿™æœ¬ä¹¦èƒŒåçš„é“ç†æ¯”ã€Šè´«ç©·çš„æœ¬è´¨ã€‹æ›´ç®€å•ä¸€äº›, ç®€å•åœ°è¯´: ç»å¤§å¤šæ•°çˆ¶æ¯å¯¹å­©å­çš„æ•™å…»æ–¹å¼å·®å¼‚çš„èƒŒååŠ¨æœºæ˜¯å‡ºäºå¯¹å­©å­å°†æ¥çš„é¡¾è™‘. å¬ä¸Šå»åƒæ˜¯åºŸè¯, é‚£æ¢ä¸ªæ–¹å¼è¯´å°±æ˜¯æ•™è‚²çš„æŠ•èµ„å›æŠ¥ç‡. åœ¨ç¤¾ä¼šä¸å¹³ç­‰ç¨‹åº¦è¾ƒä½çš„åŒ—æ¬§å‘è¾¾å›½å®¶, å¤§éƒ¨åˆ†äººå°†æ¥çš„å°±ä¸šéƒ½æ¯”è¾ƒç¨³å®š, å­¦æ ¡ä¹ŸåŸºæœ¬ä¸è€ƒæ ¸, è€å¸ˆçš„åœ°ä½å¾ˆé«˜(ä¼˜ç§€çš„äººæ‰æ›´æ„¿æ„æŠ•å…¥åˆ°æ•™è‚²äº‹ä¸šä¸­), å› æ­¤çˆ¶æ¯éƒ½æ›´åŠ é‡è§†å­©å­çš„åˆ›é€ åŠ›ã€ç‹¬ç«‹æ€§è€Œéæˆç»©. è€Œåœ¨å·¥ä¸šæ—¶ä»£, å‘è¾¾å›½å®¶ä¹Ÿæ›¾ç»ç»å†è¿‡ä¸“æ–­å‹, é‚£æ—¶å€™ç¤¾ä¼šé˜¶å±‚åˆ†æ˜, ä¸åŠªåŠ›å°±æ²¡æœ‰å‡ºè·¯, å› æ­¤çˆ¶æ¯å¯¹å­©å­ä½“ç½š, ç”šè‡³è®©å­©å­å‚åŠ å·¥ä½œ. ç›¸æ¯”æ•™è‚²çš„æŠ•èµ„å›æŠ¥ç‡, ç›´æ¥å½“ç«¥å·¥å¯¹å®¶åº­æ›´æœ‰åˆ©. è€Œç°åœ¨çš„ä¸­å›½å’Œç¾å›½, é€šè¿‡æ•™è‚²å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šæ”¹å˜ä¸€ä¸ªäººçš„å‘½è¿, å› æ­¤å…´èµ·äº†â€œç›´å‡æœºâ€çˆ¶æ¯. ç›˜æ—‹åœ¨å­©å­ä¸Šå¤´, å„ç§æ—©æ•™ã€è¡¥ä¹ ç­éƒ½æ˜¯ä¸ºäº†å°†æ¥çš„æŸä¸ªè€ƒè¯•. å­©å­çš„åˆ›é€ åŠ›å’Œç‹¬ç«‹æ€§è¢«å¤§å¤§é™ä½. å›½å¤–æ˜¯å¦åƒä¹¦é‡Œè¯´çš„é‚£æ ·æˆ‘ä¹Ÿä¸çŸ¥é“, ä½†æ˜¯å›½å†…çš„ç¡®å¦‚æ­¤. æˆ‘çš„æ„Ÿè§‰æ˜¯æœªæ¥å­©å­çš„æ•™è‚²æ–¹å¼ä»ç„¶ä¼šå‘ç”Ÿå˜åŒ–, æƒå¨å‹æ•™å…»ä¹Ÿä¸å†é€‚ç”¨. å› ä¸ºå¾ˆå¤šèŒä¸šå°†è¢«æœºå™¨å–ä»£, å‰©ä¸‹çš„èŒä¸šåˆ™æ˜¯æ›´å…·æœ‰åˆ›é€ æ€§æˆ–è€…å¯¹æ•™è‚²è¦æ±‚é—¨æ§›è¶Šé«˜çš„èŒä¸š. äººä»ç”Ÿæ¥å°±è¦ä¸åœåœ°å­¦ä¹ , ä½†å­¦ä¹ çš„ç›®çš„ä¸æ˜¯å­¦ä¹ çŸ¥è¯†, è€Œæ˜¯è¦å°½å¿«å­¦ä¹ æ€ä¹ˆåšè‡ªå·±, æ€ä¹ˆåœ¨ç¤¾ä¼šåšä¸€ä¸ªè‡ªå·±æƒ³æˆä¸ºçš„äºº.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"ç»æµå­¦","slug":"ç»æµå­¦","permalink":"https://unpluggedcoder.me/tags/%E7%BB%8F%E6%B5%8E%E5%AD%A6/"},{"name":"è‚²å„¿","slug":"è‚²å„¿","permalink":"https://unpluggedcoder.me/tags/%E8%82%B2%E5%84%BF/"}]},{"title":"Understanding Compression","slug":"Understanding Compression","date":"2020-01-17T15:46:20.000Z","updated":"2022-09-15T15:51:05.350Z","comments":true,"path":"2020/01/17/Understanding Compression/","link":"","permalink":"https://unpluggedcoder.me/2020/01/17/Understanding%20Compression/","excerpt":"","text":"æ¨èåº¦: 4.5åˆ† æ¨èç†ç”± çŸ­çŸ­200é¡µ, æŠŠå‹ç¼©ç®—æ³•ç”±ç®€å…¥æ·±, å›¾æ–‡å¹¶èŒ‚, è®²å¾—éå¸¸é€šä¿—ç†è§£. è·Ÿéšæ•´ä¸ªå‹ç¼©ç®—æ³•æ¼”è¿›çš„å†å², ç»“åˆé‚£äº›ä¼Ÿå¤§å‹ç¼©ç®—æ³•èƒŒåçš„äººå’Œæ•…äº‹, å†åŠ ä¸Šä½œè€…çš„å¹½é»˜æ„Ÿ, å¯ä»¥è¯´æ•´æœ¬ä¹¦è¯»èµ·æ¥å…¨ç¨‹æ— å°¿ç‚¹. å¯¹å¼€å‘è€…(åƒæˆ‘è¿™æ ·æ•°å­¦æ°´å¹³å·®çš„ç å†œ)éå¸¸å‹å¥½, ä¸éœ€è¦å¤ªå¤šæ•°å­¦çŸ¥è¯†. æ²¡æœ‰ç”¨ä»»ä½•ä¸€è¡Œä»£ç , ä½†æ˜¯çœ‹å®Œè¿™æœ¬ä¹¦å†å»çœ‹é‚£äº›å‹ç¼©ç®—æ³•ä»£ç å°±æœ‰ä¸€ç§äº†ç„¶äºèƒ¸çš„æ„Ÿè§‰, å°¤å…¶æ˜¯å¯¹æ¯ç±»ç®—æ³•ç‰¹æ€§å’Œå†å²èƒŒæ™¯æœ‰äº†å®è§‚ä¸Šçš„æ·±åˆ»ç†è§£. ä½œè€…çš„ç›®çš„æ˜¯è®©ç°ä»£ç¨‹åºå‘˜å¯¹å„ç±»å‹ç¼©ç®—æ³•çš„ç‰¹æ€§æœ‰ä¸€ä¸ªå…¨å±€çš„ç†è§£, å¹¶ä¸”å¸Œæœ›ç¨‹åºå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­èƒ½å¤Ÿå¾ˆå¥½çš„ç†è§£è‡ªå·±å¤„ç†çš„æ•°æ®ç‰¹æ€§, ä»è€Œä½¿ç”¨æœ€åˆé€‚çš„å‹ç¼©ç®—æ³•æ¥æé«˜æ€§èƒ½.","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://unpluggedcoder.me/tags/Algorithm/"},{"name":"Compression","slug":"Compression","permalink":"https://unpluggedcoder.me/tags/Compression/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Concurrency","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Concurrency","date":"2019-12-24T15:52:20.000Z","updated":"2022-09-15T15:51:05.347Z","comments":true,"path":"2019/12/24/Rustå…¥é—¨å¤±è´¥ä¹‹Concurrency/","link":"","permalink":"https://unpluggedcoder.me/2019/12/24/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BConcurrency/","excerpt":"","text":"Thread mainå‡½æ•°ç»“æŸ, åˆ™ç¨‹åºé€€å‡º, å³ä½¿ä»ç„¶æœ‰çº¿ç¨‹åœ¨è¿è¡Œ; ç”¨spawnè¿”å›çš„handle.join()æ¥ç­‰å¾…çº¿ç¨‹ç»“æŸ, ä½†æ˜¯æœ‰ä¸€ç‚¹ä¸ä¸€æ ·, Rustçº¿ç¨‹å´©æºƒ(panic)ä¸ä¼šå½±å“åˆ°å…¶å®ƒçº¿ç¨‹, å› æ­¤ç¨‹åºå¯ä»¥å¾ˆå®¹æ˜“ä»æŸä¸ªé”™è¯¯çŠ¶æ€ä¸‹æ¢å¤. å½“éœ€è¦åœ¨çº¿ç¨‹é—´å…±äº«immutableæ•°æ®æ—¶, ä½¿ç”¨std::sync::Arcæ™ºèƒ½æŒ‡é’ˆ, å¹¶è°ƒç”¨å®ƒçš„clone()æ–¹æ³•. Channel std::sync::mpsc::channel()è¿”å›ä¸€ä¸ªSenderå’ŒReceiver, åˆ†åˆ«è°ƒç”¨send(item) å’Œ recv()æ–¹æ³•å‘é€å’Œæ¥æ”¶æ•°æ®, åè€…ä¼šblockä½çº¿ç¨‹. Rustä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¨æ–­Channelæ“ä½œçš„æ•°æ®ç±»å‹. Rustçš„Channelæ¯”Unixçš„pipeæœºåˆ¶æ›´å¿«, æ•°æ®ç§»åŠ¨è€Œéæ‹·è´. ä¾‹å¦‚å‘é€ä¸€ä¸ªString, å®é™…æˆæœ¬åªå‘é€äº†ä¸‰ä¸ªæœºå™¨å­—(machine word): length, capacity and pointer. sendå’Œrecvä¸¤ä¸ªè°ƒç”¨åªä¼šåœ¨å¦ä¸€ä¸ªè¢«droppedçš„æ—¶å€™å¤±è´¥. æ¢å¥è¯è¯´å°±æ˜¯å¦‚æœReceiverè¢«dropäº†, é‚£sendä¼šå¤±è´¥, åä¹‹äº¦ç„¶. å› æ­¤, å¦‚æœå­˜åœ¨ä¸€ä¸ªSender, é‚£ä¹ˆä¸‹é¢è¿™ä¸ªå¾ªç¯recvå°±ä¼šåœ¨Senderé”€æ¯æ—¶æ­£å¸¸ç»ˆæ­¢ç»“æŸ: 123while let Ok(text) = receiver.recv() &#123; do_something_with(text);&#125; Receiveræ”¯æŒè¿­ä»£, å› æ­¤æ›´ä¼˜é›…çš„å†™æ³•æ˜¯(äºŒè€…ç­‰ä»·): 123for text in receiver &#123; do_something_with(text);&#125; Channelæ˜¯std::sync::mpscæ¨¡å—é‡Œçš„, å…¨ç§°æ˜¯multi-producer, single-consumer. è¿™ç§æ“ä½œåœ¨ç¼–ç¨‹ä¸­å¾ˆå¸¸è§. å› æ­¤Sender&lt;T&gt;å®ç°é‡ŒClone trait. å¯ä»¥æ‹·è´å‡ºå¤šä¸ª, ç„¶ååœ¨ä¸åŒçš„çº¿ç¨‹é‡Œsend. å½“ç„¶, ç”±äºæ˜¯single-consumer, Receiver&lt;T&gt;ä¸èƒ½clone. Rust Channelé«˜æ€§èƒ½çš„åŸå› åœ¨äºæœ‰å‡ ç§ä¸åŒçš„å®ç°: å¦‚æœåªå‘é€ä¸€ä¸ªobject, é‚£ä¹ˆRustå†…éƒ¨æœ‰ä¸€ä¸ªç‰¹æ®Šçš„â€œone-shotâ€é˜Ÿåˆ—ä½¿å¾—å‘é€ä¸€ä¸ªçš„æˆæœ¬æœ€å°åŒ–. ä½†æ˜¯å½“ä½ å‘é€ç¬¬äºŒä¸ªobjectçš„æ—¶å€™, Rustä¼šåˆ‡æ¢åˆ°å¦ä¸€ç§é˜Ÿåˆ—å®ç°. è¿™ä¸ªé˜Ÿåˆ—ä¸“é—¨ä¸ºå®ç°å¤§é‡æ•°æ®ä¼ è¾“åšäº†ä¼˜åŒ–, å°½å¯èƒ½é™ä½ä¼ è¾“å¤§å¼€é”€. ä½†æ˜¯å¦‚æœä½ Cloneäº†Sender, é‚£ä¹ˆRuståˆä¼šä½¿ç”¨å¦ä¸€ç§çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ç‰ˆæœ¬. ç›¸æ¯”äºå‰ä¸¤ç§å®ç°, è¿™ä¸ªçš„æ€§èƒ½è‡ªç„¶æ˜¯æœ€æ…¢çš„, ä½†æ˜¯å³ä¾¿æœ€æ…¢, å®ƒçš„overheadä¹Ÿå¾ˆä½.å®ƒçš„é˜Ÿåˆ—é‡‡ç”¨äº†ä¸€ä¸ªæ— é”çš„é˜Ÿåˆ—. å› æ­¤, å‘é€å’Œæ¥æ”¶æ—¶é™¤äº†moveä¹‹å¤–, ä»…æœ‰ä¸€äº›å †ä¸Šå†…å­˜åˆ†é…çš„åŸå­æ“ä½œ. è€Œä¸”åªæœ‰åœ¨Receiveréœ€è¦sleepæ—¶æ‰ä¼šç”¨åˆ°ç³»ç»Ÿè°ƒç”¨, å› æ­¤åŸºæœ¬ä¸Šå¯¹ååé‡æ²¡æœ‰ä»»ä½•è®¾é™. ç”±äºRust Channelçš„é«˜æ€§èƒ½, é€šå¸¸ä¼šå¼•èµ·é—®é¢˜çš„å°±æ˜¯å‘é€æ•°æ®çš„é€Ÿåº¦å¤§äºReceiverå¤„ç†çš„é€Ÿåº¦. å¯ä»¥ä½¿ç”¨sync_channel, å½“å‘é€çš„é˜Ÿåˆ—è¾¾åˆ°æŒ‡å®šæ•°é‡å, sendæ“ä½œä¼šè¢«é˜»å¡. 123use std::sync::mpsc::sync_channel;let (sender, receiver) = sync_channel(1000); Thread Safety: Send and Syncä¸Šé¢è°ˆåˆ°çš„åœ¨çº¿ç¨‹é—´ä¼ é€’å’Œå…±äº«æ•°æ®çš„èƒ½åŠ›æ¥è‡ªäºä¸¤ä¸ªtrait: std::marker::Send å’Œ std::marker::Sync å®ç°äº†Sendçš„ç±»å‹å¯ä»¥å®‰å…¨åœ°moveç»™å…¶å®ƒçº¿ç¨‹. å®ç°äº†Syncçš„ç±»å‹å¯ä»¥åœ¨çº¿ç¨‹é—´è¿›è¡Œnon-mut referenceå…±äº«, åŒæ—¶è¦æ±‚è¯¥ç±»å‹çš„å¼•ç”¨ç±»å‹&amp;Tå®ç°Send trait. å¦‚ä¸‹å›¾: å¯ä»¥çœ‹åˆ°æœ‰ä¸€ç§ç±»å‹æ˜¯ä¸èƒ½Sendçš„, Rc&lt;String&gt;, åšä¸ºä¸€ä¸ªå¸¦å¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆ, å½“ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰å®ƒæ—¶, åŒæ—¶å¯¹å¼•ç”¨è®¡æ•°æ“ä½œå°±ä¼šå¼•èµ·data race. Mutex&lt;T&gt; å¤§éƒ¨åˆ†å¯ä»¥çœ‹æ–‡æ¡£, å’Œå…¶å®ƒè¯­è¨€çš„äº’æ–¥é”ç±»ä¼¼. æœ‰ä¸€ä¸ªç»†èŠ‚å€¼å¾—æ³¨æ„: 1234567891011121314151617181920212223/// All threads have shared access to this big context struct.struct FernEmpireApp &#123; ... waiting_list: Mutex&lt;WaitingList&gt;, ...&#125;impl FernEmpireApp &#123; /// Add a player to the waiting list for the next game. /// Start a new game immediately if enough players are waiting. fn join_waiting_list(&amp;self, player: PlayerId) &#123; // Lock the mutex and gain access to the data inside. // The scope of `guard` is a critical section. let mut guard = self.waiting_list.lock().unwrap(); // Now do the game logic. guard.push(player); if guard.len() == GAME_SIZE &#123; let players = guard.split_off(0); self.start_game(players); &#125; &#125;&#125; è¿™ä¸ªå‡½æ•°å¯¹waiting_listè¿›è¡Œäº†ä¿®æ”¹, è€Œå‡½æ•°ç­¾åæ˜¯immutable çš„ &amp;self. å…¶å®è¿™é‡Œéœ€è¦é‡æ–°ç†è§£Rustä¸­çš„mutå¦ä¸€å±‚å«ä¹‰. åœ¨Rustä¸­mutæ„å‘³ç€æ’ä»–æ€§è®¿é—®(exclusive access); Non-mutæ„å‘³ç€å…±äº«è®¿é—®(shared access); è¿™é‡Œçš„Mutex.lock()å¯ä»¥ä¿è¯ä¸ä¼šæœ‰ç«äº‰, å› æ­¤å…è®¸åœ¨å³ä½¿Mutexæ‹¿åˆ°çš„æ˜¯shared(non-mut)æƒ…å†µä¸‹åšexclusive(mut)æ“ä½œ. å¦å¤–ä¸€ç‚¹, Rustçš„Mutexæ˜¯ä¸å¯é‡å…¥çš„, åŒä¸€ä¸ªçº¿ç¨‹è¿ç»­ä¸¤æ¬¡è°ƒç”¨lockä¼šå¼•èµ·æ­»é”. Poisoned Mutex(åå­—æœ‰äº›å¤¸å¼ , ä¸­æ¯’é”), æ˜¯åœ¨æŒæœ‰é”çš„çº¿ç¨‹å´©æºƒå, Rustä¼šå°†è¿™ä¸ªé”æ ‡è®°ä¸ºä¸­æ¯’æ±¡æŸ“çŠ¶æ€. åç»­å…¶å®ƒçº¿ç¨‹å¯¹å®ƒçš„lockè¯·æ±‚éƒ½ä¼šè¿”å›ä¸€ä¸ªPoisonError. å› æ­¤ç”¨lock().unwrap()ä¼šæŠŠpanicä¼ æ’­åˆ°å¦ä¸€ä¸ªçº¿ç¨‹. Condvar Condvar::notify_all() å’Œ Condvar::wait() ä¸¤ä¸ªæ“ä½œ; ä¸åŒçš„æ˜¯waitæ“ä½œæœ‰äº›ä¸å¯»å¸¸ 123while !guard.has_data() &#123; guard = self.has_data_condvar.wait(guard).unwrap();&#125; wait(guard), æ¥æ”¶ä¸€ä¸ªMutexGuardçš„æ‰€æœ‰æƒ, å¹¶è¿”å›ä¸€ä¸ªæ–°çš„MutexGuard. å¦‚æœç”¨è¿‡pthreadæ¥å£çš„è¯å°±ä¸ä¼šå¯¹è¿™ä¸ªæ„Ÿåˆ°é™Œç”Ÿ. ç±»ä¼¼pthread_cond_waitå‡½æ•°, åœ¨waitå‰éœ€è¦å…ˆé‡Šæ”¾è¿™ä¸ªmutex, ç„¶ååœ¨è¿”å›å‰é‡æ–°è·å–, å¯ä»¥ç†è§£ä¸ºMutexæˆæƒç»™waitæ“ä½œå®ƒ. Atomics ä¸åŒäºMutex&lt;T&gt;, Atomicsæ‹¥æœ‰æœ€å°åŒ–å¼€é”€, æ€§èƒ½æˆæœ¬æä½, é€šå¸¸å°±æ˜¯ä¸€æ¡loadæˆ–storeæŒ‡ä»¤. æ²¡æœ‰ä»»ä½•ç³»ç»Ÿè°ƒç”¨. All images are copyrighted by original authors Jim Blandy &amp; Jason Orendorff who wrote in the book Programming Rust.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://unpluggedcoder.me/tags/Concurrency/"},{"name":"Mutex","slug":"Mutex","permalink":"https://unpluggedcoder.me/tags/Mutex/"},{"name":"Channel","slug":"Channel","permalink":"https://unpluggedcoder.me/tags/Channel/"},{"name":"Sync","slug":"Sync","permalink":"https://unpluggedcoder.me/tags/Sync/"},{"name":"Send","slug":"Send","permalink":"https://unpluggedcoder.me/tags/Send/"},{"name":"Atmoic","slug":"Atmoic","permalink":"https://unpluggedcoder.me/tags/Atmoic/"},{"name":"Condvar","slug":"Condvar","permalink":"https://unpluggedcoder.me/tags/Condvar/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Read&Write","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Read&Write","date":"2019-12-10T17:00:20.000Z","updated":"2022-09-15T15:51:05.349Z","comments":true,"path":"2019/12/11/Rustå…¥é—¨å¤±è´¥ä¹‹Read&Write/","link":"","permalink":"https://unpluggedcoder.me/2019/12/11/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BRead&Write/","excerpt":"","text":"Rust std::ioçš„æ ¸å¿ƒæ˜¯Readå’ŒWriteä¸¤ä¸ªtrait. Readers std::io::Readçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯&amp;mut self, ä¹Ÿå°±æ˜¯å¿…é¡»æ‹¥æœ‰å¯¹è±¡çš„mut reference. readæ–¹æ³•, å‡½æ•°åŸå‹: 1fn read(&amp;mut self, buf: &amp;mut [u8]) -&gt; Result&lt;usize&gt; ä»å¯¹è±¡é‡Œè¯»å–æœ€é•¿ä¸è¶…è¿‡buf.len()é•¿åº¦çš„å­—èŠ‚æ•°æ®. å¦‚æœè¿”å›0, æœ‰ä¸¤ç§å¯èƒ½: ä¸€æ˜¯å¯èƒ½åˆ°è¾¾äº†EOF(End Of File), è¿™ä¸ªå¯¹è±¡ä¸ä¼šå†æœ‰ä»»ä½•æ•°æ®å¯è¯»; äºŒæ˜¯bufé•¿åº¦ä¸º0. è¿™ä¸ªå‡½æ•°ä¸èƒ½ä¾èµ–bufä¸­ä»»ä½•åŸæœ‰çš„æ•°æ®, ä½†ä¹Ÿä¸ä¿è¯å‡½æ•°è°ƒç”¨åbufçš„å†…å®¹ä¼šæ˜¯ä»€ä¹ˆ. å®ç°æ—¶å»ºè®®æ­£å¸¸ç‚¹, å†™å…¥bufå°±å¥½. buféœ€è¦æå‰åˆå§‹åŒ–, å¦åˆ™undefined behavior. è¿˜æœ‰å…¶å®ƒçš„ä¸€äº›readå‡½æ•°: read_to_end: ä¸€ç›´è¯»åˆ°EOFä¸ºæ­¢, æœ€å¥½ä¸è¦è°ƒç”¨ä¸ä¿¡ä»»çš„Readerçš„è¿™ä¸ªæ–¹æ³•, æ¯”å¦‚ç½‘ç»œæ•°æ®. read_to_string: è¯»åˆ°&amp;mut stringå‚æ•°ä¸­, å‰ææ¡ä»¶è¦æ˜¯æœ‰æ•ˆçš„UTF-8å­—ç¬¦, å¦åˆ™ä¼šæŠ¥é”™. read_exact: è¯»æŒ‡å®šé•¿åº¦, å¦‚æœæ•°æ®æå‰ç»“å°¾, é‚£ä¹ˆä¼šæŠ¥é”™. BufReadæ˜¯å¸¦ç¼“å†²åŒºçš„Reader, ç±»ä¼¼fread(freadä¸€æ¬¡ä¼šé¢„è¯»ä¸€ä¸ªblocksizeå¤§å°çš„æ•°æ®å—). BufReadä¹Ÿæ˜¯ç±»ä¼¼, å®ƒæä¾›äº†ä¸€ä¸ªread_lineå‡½æ•°, è¯»å–ä¸€è¡Œ, è€Œå®é™…å†…éƒ¨è°ƒç”¨äº†read, å¯èƒ½é¢„è¯»äº†8kçš„å¤§å°, è¶³å¤Ÿæ»¡è¶³åé¢å‡ ç™¾æ¬¡çš„read_lineè°ƒç”¨è¯·æ±‚. ä»stdinè¯»å–. åœ¨Cä¸­, å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä»stdinä¸­è¯»æ•°æ®ä¼šé€ æˆæœªå®šä¹‰çš„è¡Œä¸º. æ ‡å‡†çš„åšæ³•æ˜¯åŠ é”. Rustä¹Ÿæ˜¯ä¸€æ ·, å”¯ä¸€çš„åŒºåˆ«æ˜¯åŠ é”è¿™ä¸ªåŠ¨ä½œæ˜¯Rust APIè‡ªå¸¦æä¾›çš„. 123456use std::io;let stdin = io::stdin();for line in stdin.lock().lines() &#123; println!(&quot;&#123;&#125;&quot;, line);&#125; ä»æ–‡ä»¶è¯»å–. File::opené»˜è®¤è¿”å›çš„Fileå¯¹è±¡åªå®ç°äº†Read trait, ä¸å¸¦BufRead trait. å› æ­¤éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªBufReader struct. 1234567use std::io::BufReader;use std::fs::File;let f = File::open(&quot;log.txt&quot;)?;let reader = BufReader::new(f);// Or with_capacity// let reader = BufReader::with_capacity(10, f); Writers å’ŒReadç±»ä¼¼, å®ç°Write trait, æœ‰ä¸‰ä¸ªä¸»è¦çš„æ–¹æ³•: write, write_all, flush. åŒæ ·ä¹Ÿæœ‰BufWriter, å¦‚æœBufWriterå¯¹è±¡è¢«drop, é‚£ä¹ˆç¼“å†²åŒºå†…æ‰€æœ‰çš„æ•°æ®ä¼šè¢«å†™å…¥åº•å±‚çš„writerä¸­. å¦‚æœè¿™æ—¶å€™å†™å…¥æœ‰é”™è¯¯çš„è¯ä¼šè¢«å¿½ç•¥.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Read","slug":"Read","permalink":"https://unpluggedcoder.me/tags/Read/"},{"name":"BufRead","slug":"BufRead","permalink":"https://unpluggedcoder.me/tags/BufRead/"},{"name":"Write","slug":"Write","permalink":"https://unpluggedcoder.me/tags/Write/"},{"name":"BufWrite","slug":"BufWrite","permalink":"https://unpluggedcoder.me/tags/BufWrite/"}]},{"title":"2018-2019","slug":"2018-2019","date":"2019-11-20T17:29:03.000Z","updated":"2022-09-15T15:51:05.341Z","comments":true,"path":"2019/11/21/2018-2019/","link":"","permalink":"https://unpluggedcoder.me/2019/11/21/2018-2019/","excerpt":"2018å¹´11æœˆåˆ°2019å¹´11æœˆ, åˆšå¥½ä¸€å¹´äº†. è¿™ä¸€å¹´å˜åŒ–å¾ˆå¤§, å„ç§å˜åŒ–. ä»¥è‡³äºæƒ³å†™ä¸€äº›è‡ªå·±çš„æ€è€ƒ. 15å¹´åˆ°18å¹´è¿™å››å¹´çš„æ–‡ç« æ•°é‡å¾ˆå°‘, ä¸”å‘ˆé€å¹´é€’å‡è¶‹åŠ¿. ä½†è¿™å››å¹´é‡Œå‘ç”Ÿäº†å¾ˆå¤š. åé¢åšäº†ä¸€æ®µæ—¶é—´Pythonçš„å·¥ä½œ, å­¦äº†å¾ˆå¤šPythonçš„fancy stuffs. å½“æ—¶çš„æ„Ÿè§‰å¯ä»¥ç”¨ä¸‹é¢çš„æ¼«ç”»æè¿°:","text":"2018å¹´11æœˆåˆ°2019å¹´11æœˆ, åˆšå¥½ä¸€å¹´äº†. è¿™ä¸€å¹´å˜åŒ–å¾ˆå¤§, å„ç§å˜åŒ–. ä»¥è‡³äºæƒ³å†™ä¸€äº›è‡ªå·±çš„æ€è€ƒ. 15å¹´åˆ°18å¹´è¿™å››å¹´çš„æ–‡ç« æ•°é‡å¾ˆå°‘, ä¸”å‘ˆé€å¹´é€’å‡è¶‹åŠ¿. ä½†è¿™å››å¹´é‡Œå‘ç”Ÿäº†å¾ˆå¤š. åé¢åšäº†ä¸€æ®µæ—¶é—´Pythonçš„å·¥ä½œ, å­¦äº†å¾ˆå¤šPythonçš„fancy stuffs. å½“æ—¶çš„æ„Ÿè§‰å¯ä»¥ç”¨ä¸‹é¢çš„æ¼«ç”»æè¿°: æ²¡é”™, å°±æ˜¯é£èµ·æ¥çš„æ„Ÿè§‰. åšä¸ºä¸€ä¸ªå¤šå¹´çš„C&#x2F;C++å¼€å‘è€…, å®Œå…¨è¢«Pythonè§£æ”¾äº†ä¼¼çš„. çœ‹å®Œäº†å‡ æœ¬Pythonä¹¦å’Œé²¶é±¼ä¹¦ã€ŠLearning Spark: Lightning-Fast Big Data Analysisã€‹å, åšå¤§æ•°æ®å¤„ç†ã€å¯è§†åŒ–ã€Webç­‰ç­‰å„ç§åœºæ™¯å¼ æ‰‹å°±æ¥, æ„Ÿè§‰Pythonè¦ç«. æŒ‰ç°åœ¨å›½å†…çš„PythonçŠ¶å†µ, ç®—æ˜¯çŒœä¸­äº†ä¸€åŠ. å¤§å®¶éƒ½è¯´è¿™å‡ å¹´Pythonç«ä¸»è¦æ˜¯å› ä¸ºæœºå™¨å­¦ä¹ å¸¦èµ·äº†èŠ‚å¥, æˆ‘è§‰å¾—ä¼°è®¡è¿˜æ˜¯è¦å½’åŠŸäºâ€œæˆ‘é è¿™é—¨å¤§æ•°æ®æ¶¨è–ªè¯¾å¹´å…¥ç™¾ä¸‡â€çš„è¥é”€æ‰‹æ®µ, æœ‰ç‚¹æ‰¯è¿œäº†. è¿™å››å¹´é‡Œè¿˜å­¦äº†Angularã€TypeScriptã€JavaScript, è¿™é‡Œçš„å­¦ä¸æ˜¯çœ‹çœ‹æ•™ç¨‹, è€Œæ˜¯æ¯ç§è¯­è¨€éƒ½çœ‹äº†ä¸€æœ¬ä¹¦. ä½†æ˜¯åˆæ„Ÿè§‰ä»€ä¹ˆéƒ½æ²¡å­¦åˆ°. ä¸æ˜¯å‰ç«¯çš„æ–™. ä¸ä»…å¦‚æ­¤, æ€»æ„Ÿè§‰å°‘äº†ç‚¹ä»€ä¹ˆ, åªæ„Ÿè§‰åˆ°ä¸€ä¸ªå­—: æ‚. ä¸€å¹´å‰çš„è¿™æ—¶å€™æƒ³æ˜ç™½äº†: å°‘äº†æ²‰æ·€. ä¸€å¹´å‰å¼€å§‹è¿›å…¥995çš„ç”Ÿæ´». å’Œä¹‹å‰çš„èŠ‚å¥å®Œå…¨æ˜¯ä»å¤©ä¸Šåˆ°åœ°ä¸‹, æ•´ä¸ªä½è½çš„çŠ¶æ€æŒç»­äº†ä¸€ä¸ªå¤šæœˆå§. ç”±äºè‡ªå·±ä¹‹å‰æœ‰çš„å¥èº«ä¹ æƒ¯, æ‰€ä»¥è§‰å¾—å°±ç®—å†æ²¡æ—¶é—´, ä¹Ÿä¸èƒ½æ”¾å¼ƒå¥èº«. ä¸èƒ½è®©è‡ªå·±ç”Ÿæ´»ä¸­ä¸ºæ•°ä¸å¤šçš„å¤šå·´èƒºæ¶ˆå¤±. æ¸æ¸åœ°å¼€å§‹æ‰¾åˆ°è‡ªå·±çš„èŠ‚å¥, å¼€å§‹ç®¡ç†è‡ªå·±çš„æ—¶é—´, å¼€å§‹çœ‹ä¹¦. ğŸ¤­æˆä¸ºæ›´å¥½çš„è‡ªå·±â€¦â€¦ è¯´æ¥ä¹Ÿæœ‰ç‚¹ä¸å¯æ€è®®, ä¸€å¹´çœ‹äº†20å‡ æœ¬ä¹¦, æ¯”å››å¹´å‰çš„çŠ¶æ€è¿˜å¤š. åªä¸è¿‡å››å¹´å‰çœ‹çš„åŸºæœ¬å…¨æ˜¯æŠ€æœ¯ç±»ä¹¦ç±. è€Œç°åœ¨å®Œå…¨ä¸ä¸€æ ·. å¦‚ä½•ä¿æŒç‹¬ç«‹æ€è€ƒ? å¦‚ä½•åšæŒå­¦ä¹ ? æ˜¯å¦æ¸…æ¥šè‡ªå·±æƒ³è¦ä»€ä¹ˆ? å¾ˆå¯æƒœè¿™äº›é—®é¢˜åœ¨æˆ‘è¿™ä¹ˆå¤šå¹´çš„å—æ•™è‚²ç”Ÿæ¶¯ä¸­æ²¡æœ‰æ‚Ÿå‡ºæ¥. ä¸Šé¢æ˜¯è¿™ä¸€å¹´çœ‹çš„ä¹¦å•. ä¸»è¦åˆ†ä¸ºå‡ ç±»: é‡‘èç±»ä¹¦ç±: æˆ–è®¸å¯¹è¿™ç±»ä¹¦ç±çš„å¥½å¥‡å¯ä»¥ä»ä¹¦å•çš„æ ‡é¢˜é‡Œæ‰¾åˆ°ç­”æ¡ˆ. æˆ‘å¯¹è¿™ä¸ªæ§åˆ¶äº†ç¤¾ä¼šå„ä¸ªæ–¹é¢çš„ä¸“ä¸šå‡ ä¹ä¸€æ— æ‰€çŸ¥. è¯´æ¥ä¹Ÿå·§, æˆ‘æ‰€å¤„çš„åŒæ ·ä¹Ÿæ˜¯å……æ–¥åœ¨ç°ä»£ç¤¾ä¼šå„ä¸ªè§’è½é‡Œçš„ä¸€ä¸ªä¸“ä¸š: ITä¿¡æ¯è¡Œä¸š. å› æ­¤æˆ‘è§‰å¾—æœ‰å¿…è¦å¥½å¥½äº†è§£ä¸€ä¸‹è¿™ä¸ªâ€œåŒç±»â€, æ¯•ç«Ÿå®ƒçš„å†å²æ¯”äºŒè¿›åˆ¶bitçš„å†å²è¦ä¹…å¾—å¤š. æœ‰ä¸€æ¬¡é€›ä¹¦åŸ, çœ‹åˆ°æ¨èä¹¦æ¶ä¸Šã€Šæˆ˜èƒœä¸€åˆ‡å¸‚åœºçš„äººã€‹å’Œã€ŠåŸåˆ™ã€‹ä¸¤æœ¬æ”¾åœ¨ä¸€èµ·, æ‰å‘ç°, æˆ‘æ§½, è¿™ä¸¤æœ¬ä¹¦åŸæ¥è¿™ä¹ˆåš. è‚²å„¿ç±»ä¹¦ç±: ã€Šå¤å±±å­¦æ ¡ã€‹ã€ã€Šéæš´åŠ›æ²Ÿé€šã€‹å’Œã€Šæ¸¸æˆåŠ›ã€‹è¿™ä¸‰æœ¬æˆ‘è§‰å¾—éƒ½å¾ˆå¥½, ç»™æˆ‘çš„æ„Ÿå—éƒ½å¾ˆå¼ºçƒˆ. ç¬¬ä¸€æ¬¡å½“çˆ¶æ¯, ä¸æ‡‚å¾—æ€ä¹ˆå»ä½“ä¼šå­©å­çš„éœ€æ±‚, ä¸æ‡‚å¾—æ€ä¹ˆå»å¤„ç†å¤æ‚çš„æƒ…å†µ, æ›´ä¸æ‡‚æ€ä¹ˆå»ç®¡ç†è‡ªå·±çš„æƒ…ç»ª, å´æƒ³æ§åˆ¶å­©å­çš„æƒ…ç»ª. æ¯•ç«Ÿå½“çˆ¶æ¯éƒ½ä¸éœ€è¦è€ƒè¯•â€¦â€¦ æŠ€æœ¯ç±»ä¹¦ç±: å¼€å§‹å…¥å‘Rust, å…¥é—¨å¤±è´¥ä¸€æ¬¡äº†. è‡³äºä¸“ä¸šçš„æ–¹å‘, åœ¨æ²¡æ²‰æ·€ä¹‹å‰è¿˜æ˜¯ä¸ç«‹flagäº†, çœå»äº†å°†æ¥è¢«å†æ¬¡æ‰“è„¸çš„å¯èƒ½. å¦å¤–, ç›®å‰åœ¨åšæ€§èƒ½å·¥ç¨‹(Performance Engineering)æ–¹é¢çš„å·¥ä½œ, æ˜¯è‡ªå·±é’Ÿæ„çš„ä¸€ä¸ªå‘.","categories":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"Talk","slug":"Talk","permalink":"https://unpluggedcoder.me/tags/Talk/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹String and str","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹String and str","date":"2019-11-12T16:20:30.000Z","updated":"2022-09-15T15:51:05.349Z","comments":true,"path":"2019/11/13/Rustå…¥é—¨å¤±è´¥ä¹‹String and str/","link":"","permalink":"https://unpluggedcoder.me/2019/11/13/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BString%20and%20str/","excerpt":"","text":"æ‰€æœ‰Stringå’Œstrç±»å‹éƒ½ä¿è¯å†…éƒ¨æŒæœ‰æ­£ç¡®çš„UTF-8æ ¼å¼å­—ç¬¦ä¸². æ‰€æœ‰çš„safeæ“ä½œéƒ½ä¿è¯è¿™ä¸€ç‚¹, å³ä¸ä¼šå¼•å…¥é”™è¯¯æ ¼å¼çš„UTF-8 Stringçš„å†…éƒ¨å®ç°å…¶å®å°±æ˜¯Vec&lt;u8&gt; stråˆ™æ˜¯borrowçš„Stringå¼•ç”¨. &amp;strä¸èƒ½Clone, å› ä¸ºclone(&amp;T)æ–¹æ³•éœ€è¦ä¸€ä¸ªè¿”å›Tå¯¹è±¡, è€Œstråˆæ˜¯unsizedçš„. å¯ä»¥é€šè¿‡slice.to_owned()è·å–ä¸€ä»½é‡æ–°åˆ†é…çš„æ‹·è´. String::new()è¿”å›çš„æ˜¯ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸², è¿˜æ²¡æœ‰åˆ†é…ä»»ä½•å †ä¸Šçš„å†…å­˜. ä¸èƒ½é€šè¿‡å•ä¸ªä¸‹æ ‡è®¿é—®sliceçš„æŸä¸ªå­—ç¬¦(slice[i]), å› ä¸ºUTF-8çš„å­—ç¬¦æ˜¯ä¸å®šé•¿çš„. å¯ä»¥é€šè¿‡chars()æ–¹æ³•è¿”å›å­—ç¬¦çš„è¿­ä»£å™¨: 12 let parenthesized = &quot;Rust (é¥‚)&quot;;assert_eq!(parenthesized[6..].chars().next(), Some(&#x27;é¥‚&#x27;)); Stringå®ç°äº†Add&lt;&amp;str&gt; å’Œ AddAssign&lt;&amp;str&gt;çš„Trait, å› æ­¤å¯ä»¥å¾ˆè‡ªç„¶åœ°ç”¨+æ‹¼æ¥å­—ç¬¦ä¸². ä½†æ˜¯æœ‰ä¸¤ç‚¹è¦æ³¨æ„: å·¦è¾¹çš„æ“ä½œç¬¦ä¸èƒ½æ˜¯&amp;str, ä¸€å®šè¦æ˜¯ä¸€ä¸ªStringå¯¹è±¡. å› ä¸ºä¼šconsumeè¿™ä¸ªå¯¹è±¡, è·å–å…¶æ‰€æœ‰æƒ, ä¸”ä¼šé‡å¤åˆ©ç”¨å®ƒçš„buffer, å¦‚æœcapacityè¶³å¤Ÿå¤§, å°±ä¸éœ€è¦é¢å¤–å†å¼€è¾Ÿå†…å­˜. 12345let string = &quot;partners&quot;.to_string();// ä¸èƒ½è¿™æ ·å†™let parenthetical = &quot;(&quot; + string + &quot;)&quot;;// éœ€è¦è½¬ä¸ºStringlet parenthetical = &quot;(&quot;.to_string() + string + &quot;)&quot;; å¯¹å³è¾¹çš„æ“ä½œç¬¦åªæ˜¯borrow, ä¹Ÿå°±æ„å‘³ç€å®ƒçš„å†…å®¹ä¼šè¢«æ‹·è´åˆ°å‰è€…çš„bufferæœ«å°¾. Stringè½¬æˆå…¶å®ƒç±»å‹éœ€è¦å®ç°std::str::FromStr Trait. æ‰€æœ‰çš„åŸºç¡€ç±»å‹éƒ½å®ç°äº†è¿™ä¸ªTrait. å…¶å®ƒç±»å‹è½¬æˆStringæœ‰ä¸‰ç§æ–¹æ³•: å®ç°std::fmt::Display trait. æ‰€æœ‰çš„æœºå™¨æ•°å­—ç±»å‹éƒ½å®ç°äº†è¿™ä¸ªtrait, å¯ä»¥ç›´æ¥æ˜¾ç¤º. è€ŒåƒBox&lt;T&gt;, Rc&lt;T&gt;, Arc&lt;T&gt; è¿™ç±»æ™ºèƒ½æŒ‡é’ˆç±»å‹, åªæœ‰Tå®ç°äº†Display trait, è¿™ä¸ªç±»å‹æ‰èƒ½Dispaly. å®ç°std::str::ToString trait.å¦‚æœå®ç°äº†ä¸Šé¢çš„Display trait, é‚£ä¹ˆRustè‡ªåŠ¨å¸®æˆ‘ä»¬å®ç°è¿™ä¸ªtrait. å®ç°std::fmt::Debug trait. æ‰€æœ‰æ ‡å‡†åº“å¯è®¿é—®çš„pub ç±»å‹éƒ½å®ç°äº†è¿™ä¸ªæ–¹æ³•. é€šå¸¸å¦‚æœæˆ‘ä»¬æ˜¯åº“çš„å¼€å‘è€…, å¯¹å¤–éƒ¨å¼€æ”¾çš„ç±»å‹ä¹Ÿéƒ½åº”è¯¥å®ç°è¿™ä¸ªtrait, æ–¹ä¾¿ä»–äººæ‰“å°è°ƒè¯•. å¦‚æœåšæ•°æ®å‹ç¼©ä¹‹ç±»çš„, éœ€è¦è®¿é—®å­—ç¬¦ä¸²å†…éƒ¨å­—èŠ‚æ•°æ®æœ‰ä¸¤ç§æ–¹æ³•: slice.as_bytes(): borrowå…¶å†…éƒ¨çš„Vec, è¿”å›&amp;[u8]. immutable, ä¸”éœ€è¦æ³¨æ„ç”Ÿå‘½å‘¨æœŸ. string.into_bytes(): è¿™ä¸ªæˆæœ¬æ¯”è¾ƒä½, ç›´æ¥consumeè¿™ä¸ªStringå¯¹è±¡, æŠŠå†…éƒ¨çš„Vec&lt;u8&gt;äº¤å‡ºæ¥è¿”å›, æ²¡æœ‰ä»»ä½•å¤šä½™çš„æˆæœ¬. 123pub fn into_bytes(self) -&gt; Vec&lt;u8&gt; &#123; self.vec&#125; åŒæ ·ä»åŸå§‹çš„å­—èŠ‚ä¹Ÿå¯ä»¥æ„é€ String, æœ‰ä¸‹é¢å‡ ç§æ–¹æ³•, ä½†æ˜¯éƒ½è¦æ³¨æ„é”™è¯¯æ£€æŸ¥: std::str::from_utf8(v: &amp;[u8]) -&gt; Result&lt;&amp;str, Utf8Error&gt;: ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, ä¸€æ˜¯ä¼šåšé”™è¯¯æ£€æŸ¥, å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„UTF-8æ ¼å¼å­—èŠ‚, åˆ™ä¼šè¿”å›Err; äºŒæ˜¯, è¿”å›çš„&amp;strå’Œ&amp;[u8]æœ‰åŒæ ·çš„ç”Ÿå‘½å‘¨æœŸ. String::from_utf8(vec: Vec&lt;u8&gt;) -&gt; Result: ä¸€, åŒæ ·åšé”™è¯¯æ£€æŸ¥; äºŒ, å‚æ•°ç›´æ¥æ•è·Vecæ‰€æœ‰æƒ, å¹¶æŠŠå®ƒçš„bufferåšä¸ºStringå†…éƒ¨buffer, çœå»äº†å¼€è¾Ÿ, éå¸¸é«˜æ•ˆ;","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"String","slug":"String","permalink":"https://unpluggedcoder.me/tags/String/"},{"name":"str","slug":"str","permalink":"https://unpluggedcoder.me/tags/str/"},{"name":"slice","slug":"slice","permalink":"https://unpluggedcoder.me/tags/slice/"},{"name":"FromStr","slug":"FromStr","permalink":"https://unpluggedcoder.me/tags/FromStr/"},{"name":"ToString","slug":"ToString","permalink":"https://unpluggedcoder.me/tags/ToString/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Collections","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Collections","date":"2019-11-08T16:50:30.000Z","updated":"2022-09-15T15:51:05.347Z","comments":true,"path":"2019/11/09/Rustå…¥é—¨å¤±è´¥ä¹‹Collections/","link":"","permalink":"https://unpluggedcoder.me/2019/11/09/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BCollections/","excerpt":"","text":"Rustå®¹å™¨å’Œå…¶å®ƒè¯­è¨€ä¸åŒä¹‹å¤„: åˆ°å¤„éƒ½æ˜¯moveå’Œborrow, Rustç”¨moveæ¥é¿å…æ·±æ‹·è´. ä¹Ÿå°±æ˜¯è¯´å¯¹ä¸èƒ½å®ç°Copyçš„ç±»å‹(ç®¡ç†å †æˆ–å…¶å®ƒé¢å¤–èµ„æºçš„ç±»å‹)Rustæ’å…¥åˆ°å®¹å™¨é‡Œæ˜¯éå¸¸å¿«çš„. Rustå®¹å™¨é‡Œä¸å­˜åœ¨æ— æ•ˆå€¼é”™è¯¯(invalidation error). Rustæ²¡æœ‰nullç±»å‹ Vec&lt;T&gt; åŒ…å«é•¿åº¦(length), å®¹é‡(capacity)å’Œä¸€ä¸ªæŒ‡å‘å †ä¸Šåˆ†é…çš„å†…å­˜çš„æŒ‡é’ˆ(buffer). ä¾‹å¦‚ä¸‹é¢ä»£ç : 123456// Create an empty vectorlet mut numbers: Vec&lt;i32&gt; = vec![];// Create a vector with given contentslet words = vec![&quot;step&quot;, &quot;on&quot;, &quot;no&quot;, &quot;pets&quot;];let mut buffer = vec![0u8; 1024]; // 1024 zeroed-out bytes ä¸Šé¢çš„ä¸‰ä¸ªVecåœ¨å†…å­˜é‡Œå¸ƒå±€å¦‚ä¸‹: å¤§éƒ¨åˆ†æ“ä½œéƒ½è¿”å›çš„æ˜¯reference, å› ä¸ºå¦‚æœè¿”å›ç±»ä¼¼æ˜¯Tæ„å‘³ç€moveæ‰€æœ‰æƒ. ä½†æ˜¯, æœ‰ä¸€ä¸ªä¾‹å¤–: å°±æ˜¯å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥Copyçš„è¯, é‚£ä¹ˆè¿™äº›å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä»½æ ˆä¸Šçš„æ‹·è´, æ¯”å¦‚æ•´å‹. è€Œto_vec()è¿™ä¸ªæ–¹æ³•ä¹Ÿåªèƒ½ä½œç”¨åœ¨Tå¯ä»¥Copyçš„æ•°ç»„ä¸Š. 12345let v = [1, 2, 3, 4, 5, 6, 7, 8, 9];assert_eq!(v.to_vec(), vec![1, 2, 3, 4, 5, 6, 7, 8, 9]);assert_eq!(v[0..6].to_vec(), vec![1, 2, 3, 4, 5, 6]); Vec&lt;T&gt;çš„è¯¦ç»†æ–¹æ³•ä»¥åŠå…¶å®ƒå®¹å™¨çš„ä½¿ç”¨è¯´æ˜è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç», å¯ä»¥å‚è€ƒå®˜ç½‘. è¿™é‡Œå†è¯´è¯´ä¸€äº›å®¹å™¨çš„æ€§èƒ½æ–¹é¢é€‰æ‹©. Performance of Collections å¦‚æœéå†Vecå®¹å™¨, ä»C++å°¤å…¶æ˜¯Cè¯­è¨€è½¬è¿‡æ¥çš„å¼€å‘è€…ä¼šåå‘ä½¿ç”¨ä¸‹æ ‡çš„å½¢å¼è®¿é—®å…ƒç´ å†…å®¹: 12345let arr = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;];for i in 0..arr.len() &#123; println!(&quot;&#123;&#125;&quot;, arr[i]);&#125; è¿™ä¹ˆå¹²æœ‰ä¸¤ç‚¹é—®é¢˜: è¿™æ ·åœ¨çƒ­ç‚¹ä»£ç ä¸­å¾ˆä¼¤å®³æ€§èƒ½, å› ä¸ºRustå¯¹Vecçš„ä¸‹æ ‡è®¿é—®éƒ½è¦åšæœ‰æ•ˆæ€§åˆ¤æ–­. å¦‚æœè¿™ä¸ªæ‰‹å†™ä¸‹æ ‡iè¶…å‡ºèŒƒå›´, é‚£ä¹ˆRustç¨‹åºå°±ç›´æ¥panicå´©äº†. æ¨èçš„åšæ³•æ˜¯ç”¨ä¹‹å‰å°†çš„Iterator. è¿™æ ·Rustä¼šè°ƒç”¨nextæ–¹æ³•ä¸€ç›´è·‘ä¸‹å», ç›´åˆ°è¿”å›None. å¹¶ä¸”Rustä¼šå°†è¿™ä¸ªä»£ç è½¬æ¢æˆå’Œæ‰‹å†™C&#x2F;C++åŒæ ·æ€§èƒ½çš„ä»£ç , æ²¡æœ‰é¢å¤–æˆæœ¬. 12345let arr = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;];for c in &amp;arr &#123; println!(&quot;&#123;&#125;&quot;, c);&#125; å’ŒC&#x2F;C++ä¸€æ ·, éå†ä¸ŠVec&lt;T&gt;æ€§èƒ½æœ€å¿«, å……åˆ†åˆ©ç”¨Cache-line. LinkedList&lt;T&gt;æ˜¯åŒç«¯åˆ—è¡¨, å¤´å°¾æ’å…¥ã€åˆ é™¤å¿«, ä½†æ˜¯è®¿é—®æ…¢, å¦‚æœåªå…³å¿ƒå¤´å°¾è®¿é—®é€Ÿåº¦åº”è¯¥é€‰æ‹©VecDeque&lt;T&gt;, å’ŒVec&lt;T&gt;ä¸€æ ·çš„å®ç°çš„åŒç«¯é˜Ÿåˆ—. ç›¸æ¯”ä¹‹ä¸‹, LinkedList&lt;T&gt;å”¯ä¸€çš„ä¼˜åŠ¿å°±æ˜¯åˆå¹¶ä¸¤ä¸ªListçš„æ—¶å€™é€Ÿåº¦å¾ˆå¿«. Mapæ–¹é¢æœ‰HashMap&lt;K, V&gt;å’ŒBTreeMap&lt;K, V&gt;. å‰è€…é‡‡ç”¨SipHash 1-3æ•£åˆ—ç®—æ³•(æˆ‘å½“å‰ç‰ˆæœ¬Rust1.38), ä¸»è¦é¢„é˜²*HashDoS attacks*, ä½†å“ˆå¸Œè¡¨çš„å®ç°é‡‡ç”¨çš„æ˜¯Googleçš„SwissTable, é€Ÿåº¦åˆåˆçš„, æŸ¥æ‰¾å¤æ‚åº¦O(1). åè€…å…ƒç´ æœ‰åº, é‡‡ç”¨B-Tree, ç›¸æ¯”å¹³è¡¡äºŒå‰æ ‘æœ‰æ›´å¥½çš„å±€éƒ¨æ€§(locality), Cacheå‹å¥½, é€Ÿåº¦å¿«. æŸ¥æ‰¾å¤æ‚åº¦O(lgN). Setæ–¹é¢ä¹Ÿæœ‰å¯¹åº”çš„HashSet&lt;T&gt;å’ŒBTreeSet&lt;T&gt;. ç”¨Vec, HashMapå’ŒHashSetè¶³ä»¥coverç»å¤§éƒ¨åˆ†åœºæ™¯æ€§èƒ½. All images are copyrighted by original authors Jim Blandy &amp; Jason Orendorff who wrote in the book Programming Rust.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Collections","slug":"Collections","permalink":"https://unpluggedcoder.me/tags/Collections/"},{"name":"Vec","slug":"Vec","permalink":"https://unpluggedcoder.me/tags/Vec/"},{"name":"VecDeque","slug":"VecDeque","permalink":"https://unpluggedcoder.me/tags/VecDeque/"},{"name":"HashMap","slug":"HashMap","permalink":"https://unpluggedcoder.me/tags/HashMap/"},{"name":"HashSet","slug":"HashSet","permalink":"https://unpluggedcoder.me/tags/HashSet/"},{"name":"BTreeMap","slug":"BTreeMap","permalink":"https://unpluggedcoder.me/tags/BTreeMap/"},{"name":"BTreeSet","slug":"BTreeSet","permalink":"https://unpluggedcoder.me/tags/BTreeSet/"},{"name":"Performance","slug":"Performance","permalink":"https://unpluggedcoder.me/tags/Performance/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Iterator Adapters","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Iterator Adapters","date":"2019-11-04T17:56:30.000Z","updated":"2022-09-15T15:51:05.348Z","comments":true,"path":"2019/11/05/Rustå…¥é—¨å¤±è´¥ä¹‹Iterator Adapters/","link":"","permalink":"https://unpluggedcoder.me/2019/11/05/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BIterator%20Adapters/","excerpt":"","text":"æœ‰ä¸€ä¸ªæœˆæ²¡æ›´æ–°äº†, è‡ªä¸Šæ¬¡9æœˆåº•æ›´æ–°åå°±å»æ—…æ¸¸äº†. æ—…æ¸¸å›æ¥æ¥ç€å›½åº†, 10æœˆä»½æƒ³ç€æŠŠã€ŠProgramming Rustã€‹è¿™æœ¬ä¸€èµ·çœ‹å®Œåå†ç»­å†™è¿™ç¯‡Rustå…¥é—¨å¤±è´¥ç³»åˆ—(å…¶å®å°±æ˜¯æŠŠåšçš„è¯»ä¹¦ç¬”è®°é‡æ–°æ‘˜æŠ„å‡ºæ¥, æŠŠä¹¦è¯»è–„æ’’), æ‰€ä»¥å°±ä¸€ç›´æ²¡æ›´æ–°. å½“ç„¶, ä¹Ÿçœ‹å®Œäº†. è½¬çœ¼åŠ ç­ä¸€å¹´äº†, è¿™ä¸€å¹´åè€Œçœ‹äº†20å‡ æœ¬ä¹¦, æ¯”å‰å‡ å¹´éƒ½å¤š. å…¶ä¸­ä¸¤æœ¬Rust, æœŸé—´åˆåœ¨æŸå®ä¸Šä¹°äº†å°åˆ·ç‰ˆã€ŠRust Hight Performanceã€‹å’Œã€ŠHandsâ€‘On Microservices with Rustã€‹, è¿™ä¸¤æœ¬èŠä¸€äº›Rustæœ€ä½³å®è·µçš„ä¹¦, ä»·æ ¼ç›¸å¯¹ä¾¿å®œ. å›½å†…å¼•è¿›çš„Rustä¹¦å®åœ¨å°‘, æ²¡åŠæ³•æ”¯æŒè¿™ä¹ˆå¤šè¶…çº§è´µçš„åŸç‰ˆä¹¦. è¯»å®Œäº†åŸºç¡€çŸ¥è¯†, åšå®Œäº†Rustå®˜æ–¹ç»ƒä¹ , æœ€è¿‘åœ¨çœ‹ã€ŠRust Hight Performanceã€‹, ä¸€ç›´æ‰‹ç—’æƒ³å†™äº›ä¸œè¥¿. æ‰€ä»¥è¿™ä¸ªå…¥é—¨å¤±è´¥ç³»åˆ—ä¸èƒ½ä¿è¯å®Œç¾æ”¶å®˜. å—¯, ä¸èƒ½ç«‹flag. åºŸè¯ä¸å¤šè¯´äº†, ç»§ç»­èŠèŠRustçš„è¿­ä»£å™¨. Iterator Adapterè¿­ä»£å™¨é€‚é…å™¨æ˜¯è¿­ä»£å™¨(Iterator)ä¸Šä¸€ç³»åˆ—ä½¿ç”¨(consume)å…¶è‡ªèº«Itemsçš„é€‚é…æ–¹æ³•(Adapters), è¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªå…·æœ‰æ–°åŠŸèƒ½çš„è¿­ä»£å™¨. å¸¸è§çš„æœ‰map, filterç­‰. è¿™ç±»æ–¹æ³•é€šå¸¸è¿”å›çš„æ˜¯ä¸€ä¸ªå®ç°äº†Iterator traitçš„ç»“æ„ä½“. 1234567891011121314// Iteratorfn map&lt;B, F&gt;(self, f: F) -&gt; Map&lt;Self, F&gt;where F: FnMut(Self::Item) -&gt; B&#123; ... &#125;// Mappub struct Map&lt;I, F&gt; &#123; /* fields omitted */ &#125;impl&lt;B, I, F&gt; Iterator for Map&lt;I, F&gt;where F: FnMut(&lt;I as Iterator&gt;::Item) -&gt; B, I: Iterator&#123; ... &#125; è¿™ç±»é€‚é…å™¨æ–¹æ³•é€šå¸¸ä¼šæ¥å—ä¸€ä¸ªé—­åŒ…. æ ¹æ®é€‚é…å™¨çš„ç”¨é€”ä¸åŒ, é—­åŒ…çš„å‚æ•°ä¹Ÿä¸åŒ. æ¯”å¦‚ä¸Šé¢çš„mapé€‚é…å™¨, å…¶æ¥å—çš„é—­åŒ…å‚æ•°ç±»å‹æ˜¯Self::Item, ä¹Ÿå°±æ˜¯ä¼šæŠŠæ¯ä¸ªå…ƒç´ çš„æ‰€æœ‰æƒè½¬äº¤ç»™é—­åŒ…å†è½¬äº¤ç»™è¿”å›çš„ä¸‹ä¸€ä¸ªè¿­ä»£å™¨. å½“ç„¶, ç±»ä¼¼filterçš„é€‚é…æ–¹æ³•ä¸ä¼šæ•è·å…ƒç´ çš„æ‰€æœ‰æƒ, å› æ­¤å®ƒä»¬çš„é—­åŒ…å‚æ•°å°±æ˜¯Itemçš„å¼•ç”¨ç±»å‹. 1234fn filter&lt;P&gt;(self, predicate: P) -&gt; Filter&lt;Self, P&gt;where P: FnMut(&amp;Self::Item) -&gt; bool,&#123; ... &#125; å¯¹äºè¿­ä»£å™¨é€‚é…å™¨(Iterator Adapter)æœ‰å¾ˆé‡è¦çš„ä¸¤ç‚¹éœ€è¦è®°ä½: å•çº¯è°ƒç”¨é€‚é…å™¨æ–¹æ³•å¹¶ä¸ä¼šæ‰§è¡Œä»»ä½•å…ƒç´ ä¸Šçš„è¿­ä»£(cousmue). ç›´åˆ°è¦æ±‚ä½¿ç”¨æœ€ç»ˆè¿”å›çš„å…ƒç´ æ—¶(ä¾‹å¦‚collectæ–¹æ³•), æ•´ä¸ªè¿­ä»£è¿‡ç¨‹æ‰ä¼šè¢«æ‰§è¡Œ. è¿™å¾ˆå¥½ç†è§£, Lazyè¡Œä¸º. è¿™äº›è¿­ä»£å™¨çš„æ—¶å€™éƒ½æ˜¯é›¶æˆæœ¬æŠ½è±¡(zero-overhead abstraction). åœ¨ä»£ç é‡Œä»è°ƒç”¨map, filterè¿™äº›è¿­ä»£å™¨é€‚é…æ–¹æ³•åˆ°å®ƒä»¬è¿”å›çš„ç±»å‹éƒ½æ˜¯æ³›å‹(generic)çš„, ä¸”Rustæœ‰è¶³å¤Ÿçš„ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶æœŸé€šè¿‡ç±»å‹æ¨å¯¼ç”Ÿæˆæ³›å‹ç‰¹åŒ–çš„é€‚é…å™¨æ–¹æ³•å¹¶ä¸”æŠŠå®ƒä»¬çš„nextæ–¹æ³•å…§è”(inline). ä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡Œæ—¶çš„æ•ˆç‡å’Œæ‰‹å†™è¿™ç±»é€‚é…æ–¹æ³•æ˜¯ä¸€æ ·çš„. æ¯”å¦‚ä¸‹é¢çš„è°ƒç”¨, ä¸¤è€…åœ¨è¿è¡Œä¸Šçš„æ•ˆç‡æ˜¯ç­‰ä»·çš„. 123456789101112131415let text = &quot; ponies \\n giraffes\\niguanas \\nsquid&quot;.to_string(); // Use Iterator Adapters let v: Vec&lt;&amp;str&gt; = text.lines() .map(str::trim) .filter(|s| *s != &quot;iguanas&quot;) // s is a shared reference .collect(); assert_eq!(v, [&quot;ponies&quot;, &quot;giraffes&quot;, &quot;squid&quot;]); // Probably write by hand for line in text.lines() &#123; let line = line.trim(); if line != &quot;iguanas&quot; &#123; v.push(line); &#125; &#125; å®˜æ–¹æ–‡æ¡£æœ‰å¾ˆå¤šé€‚é…å™¨æ–¹æ³•, è¿™é‡Œå°±ä¸ä¸€ä¸€èµ˜è¿°, å‚è€ƒæ–‡æ¡£å³å¯.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Iterator","slug":"Iterator","permalink":"https://unpluggedcoder.me/tags/Iterator/"},{"name":"Adapter","slug":"Adapter","permalink":"https://unpluggedcoder.me/tags/Adapter/"},{"name":"map","slug":"map","permalink":"https://unpluggedcoder.me/tags/map/"},{"name":"filter","slug":"filter","permalink":"https://unpluggedcoder.me/tags/filter/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Iterator Basic","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Iterator Basic","date":"2019-09-25T16:25:30.000Z","updated":"2022-09-15T15:51:05.348Z","comments":true,"path":"2019/09/26/Rustå…¥é—¨å¤±è´¥ä¹‹Iterator Basic/","link":"","permalink":"https://unpluggedcoder.me/2019/09/26/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BIterator%20Basic/","excerpt":"","text":"Iterator Iteratorå®ç°äº†std::iter::Iteratortrait, åŒ…å«nextç­‰æ–¹æ³•. 12345trait Iterator &#123; type Item; fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;; ... // many default methods&#125; iterå’Œiter_mutä¸¤ä¸ªæ–¹æ³•ç”Ÿæˆæ¯ä¸ªItemçš„sharedæˆ–mutable reference, è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å¤§å¤šæ•°å®¹å™¨æä¾›çš„æ–¹æ³•, è€ŒéIteratoræ–¹æ³•. IntoIterator *iterable*æ˜¯æŒ‡å®ç°äº†std::iter::IntoIteratortraitçš„å€¼, åŒ…å«into_iteræ–¹æ³•, ä¹Ÿæ˜¯forå¾ªç¯è°ƒç”¨çš„æ–¹æ³•. 12345trait IntoIterator where Self::IntoIter::Item == Self::Item &#123; type Item; type IntoIter: Iterator; fn into_iter(self) -&gt; Self::IntoIter;&#125; å¾ˆå¤šå®¹å™¨ä¹Ÿå®ç°äº†IntoIteratortrait, ä½†æ˜¯æ ¹æ®è‡ªèº«ä¸åŒçš„åœºæ™¯, æœ‰ä¸åŒçš„å®ç°: shared referenceçš„collection, into_iter()è¿”å›çš„æ˜¯itemsçš„shared reference. *mutable reference*çš„collectionåŒç†. æŒ‰å€¼ä¼ é€’çš„collection(passed collection by value)ä¼šå–å¾—collectionçš„æ‰€æœ‰æƒ, into_iter()è¿”å›çš„ä¹Ÿæ˜¯å–å‡ºItemâ€™s ownershipçš„iterator. å½“è¿™ä¸ªiteratoré”€æ¯æ—¶, æ•´ä¸ªcollectionä¹Ÿé”€æ¯. 12345678910use std::collections::BTreeSet;let mut favorites = BTreeSet::new();favorite.insert(&quot;Game of Thrones&quot;.to_string());favorite.insert(&quot;Breaking Bad&quot;.to_string());let mut it = favorites.into_iter(); // Take ownership of favoritesassert_eq!(it.next(), Some(&quot;Game of Thrones&quot;.to_string()));assert_eq!(it.next(), &quot;Breaking Bad&quot;.to_string());assert_eq!(it.next(), None); // favorites now empty. å¯¹åº”çš„ä¸‰ç§forå¾ªç¯å¦‚ä¸‹: 123for element in &amp;collection &#123;...&#125;for element in &amp;mut collection &#123;...&#125;for element in collection &#123;...&#125; å¹¶ä¸æ˜¯æ‰€æœ‰çš„å®¹å™¨éƒ½å®ç°äº†è¿™ä¸‰ç§: åƒHashMap, BTreeMapè¿™ç±»å®¹å™¨è¿”å›çš„æ˜¯valueçš„mutable reference, keyçš„shared reference. å› ä¸ºkeyçš„hashå€¼ä¸èƒ½å˜. è€ŒHashSet, BTreeSetè¿™ç±»æ²¡æœ‰å®ç°è¿”å›*mutable reference,*åŒæ ·å› ä¸ºå®ƒçš„å€¼å¯¹å®¹å™¨æœ‰ç‰¹æ®Šæ„ä¹‰, ä¸èƒ½å˜. Slicesæ²¡æœ‰å®ç°ç¬¬ä¸‰ç§by value, å› ä¸ºå®ƒå¹¶ä¸æ‹¥æœ‰itemçš„æ‰€æœ‰æƒ. å½“å¯¹IntoIteratorè¿”å›çš„iteratoræœ‰ç±»å‹è¦æ±‚æ—¶(ä¾‹å¦‚forå¾ªç¯), å¯ä»¥ç”¨IntoIterator&lt;Item=xxx&gt;æ³›å‹æ¥æŒ‡å®š: 12345678910use std::fmt::Debug;fn dump&lt;T, U&gt;(t: T) where T: IntoIterator&lt;Item=U&gt;, U: Debug&#123; for u in t &#123; println!(&quot;&#123;:?&#125;&quot;, u); &#125;&#125; å¤§éƒ¨åˆ†å®¹å™¨æä¾›ä¸€ä¸ªdrainæ–¹æ³•, è¯¥æ–¹æ³•ä¸å±äºIntoIterator, å®ƒå’ŒIntoIteratorçš„into_iteræ–¹æ³•ä¸åŒçš„æ˜¯å®ƒä¸ä¼šæ¶ˆè´¹collectionçš„æ‰€æœ‰æƒ, è€Œæ˜¯è·å–collectionçš„ä¸€ä¸ªmutable reference, å¹¶è¿”å›ä¸€ä¸ªè·å–æ¯ä¸ªå…ƒç´ æ‰€æœ‰æƒ(passes ownership of each element to the consumer)çš„iterator. 1234567use std::iter::FromIterator;let mut outer = &quot;Earth&quot;.to_string();let inner = String::from_iter(outer.drain(1..4));assert_eq!(outer, &quot;Eh&quot;);assert_eq!(inner, &quot;art&quot;);","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Iterator","slug":"Iterator","permalink":"https://unpluggedcoder.me/tags/Iterator/"},{"name":"IntoIterator","slug":"IntoIterator","permalink":"https://unpluggedcoder.me/tags/IntoIterator/"},{"name":"into_iter","slug":"into-iter","permalink":"https://unpluggedcoder.me/tags/into-iter/"},{"name":"drain","slug":"drain","permalink":"https://unpluggedcoder.me/tags/drain/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Closure","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Closure","date":"2019-09-04T16:45:30.000Z","updated":"2022-09-15T15:51:05.347Z","comments":true,"path":"2019/09/05/Rustå…¥é—¨å¤±è´¥ä¹‹Closure/","link":"","permalink":"https://unpluggedcoder.me/2019/09/05/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BClosure/","excerpt":"","text":"Rusté—­åŒ…(Closure)æœ‰ä¸¤ç§æ•è·å˜é‡çš„æ–¹å¼: Borrow: å®é™…å°±æ˜¯ä¸€ä¸ªå¼•ç”¨. é—­åŒ…çš„ç”Ÿå­˜å‘¨æœŸä¸ä¼šè¶…è¿‡æ•è·çš„å˜é‡ç”Ÿå­˜å‘¨æœŸæ—¶, é‡‡ç”¨è¿™ç§æ–¹å¼: 123fn sort_by_statistic(cities: &amp;mut Vec&lt;City&gt;, stat: Statistic) &#123; cities.sort_by_key(|city| -city.get_satistic(stat));&#125; Steal(move): å½“é—­åŒ…çš„ç”Ÿå­˜å‘¨æœŸè¶…è¿‡æ•è·å˜é‡æ—¶, éœ€è¦ç”¨å…³é”®å­—moveå‘Šè¯‰Rustè¦æŠŠä½¿ç”¨çš„å˜é‡æ•è·åˆ°é—­åŒ…ä¸­. moveçš„æ–¹å¼æœ‰ä¸‰ç§: å¦‚æœå˜é‡æ˜¯Copyableç±»å‹(å¦‚i32), é‚£ä¹ˆé—­åŒ…ä¼šä½¿ç”¨å˜é‡çš„ä¸€ä»½æ‹·è´å‰¯æœ¬. è€Œåœ¨é—­åŒ…ä¹‹å, ä»ç„¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªCopyableå˜é‡. å¦‚æœå˜é‡æ˜¯NonCopyable(å¦‚Vec&lt;City&gt;), é‚£ä¹ˆé—­åŒ…ä¼šæ”«å–(steal)å˜é‡çš„æ‰€æœ‰æƒ, çœŸæ­£æ„ä¹‰ä¸Šçš„moveåˆ°é—­åŒ…ä¸­. é—­åŒ…ä¹‹åä¹Ÿä¸èƒ½å†ä½¿ç”¨è¯¥å˜é‡. å¦‚æœé—­åŒ…åä»ç„¶è¦ä½¿ç”¨NonCopyableçš„å˜é‡, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨cloneæ–¹æ³•, æ·±æ‹·è´å‡ºä¸€ä»½å‰¯æœ¬ä¾›é—­åŒ…ä½¿ç”¨. Function &amp; Closure Types å’ŒC&#x2F;C++ä¸€æ ·, å‡½æ•°åå°±åƒä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ, æŒ‡å‘å‡½æ•°çš„æœºå™¨ç . é—­åŒ…å’Œå‡½æ•°çš„ç±»å‹ä¸åŒ fntypeçš„å‚æ•°åªèƒ½æ¥å—å‡½æ•°æŒ‡é’ˆ Fntraitæ—¢å¯ä»¥æ¥å—å‡½æ•°æŒ‡é’ˆ, ä¹Ÿèƒ½æ¥å—é—­åŒ…. å®é™…ä¸Šæ¯ä¸ªé—­åŒ…éƒ½å®ç°äº†Fntrait(æ³›æŒ‡ä¸‹é¢çš„Fn/FnOnce/FnMutä¹‹ä¸€). 12345678// åªèƒ½æ¥å—å‡½æ•°æŒ‡é’ˆfn count_selected_cities(cities: &amp;Vec&lt;City&gt;, test_fn: fn(&amp;City) -&gt; bool) -&gt; usize &#123; ...&#125;// æ—¢èƒ½æ¥å—å‡½æ•°æŒ‡é’ˆ, ä¹Ÿèƒ½æ¥å—é—­åŒ…fn count_selected_cities(cities: &amp;Vec&lt;City&gt;, test_fn: F) -&gt; usize where F: Fn(&amp;City) -&gt; bool &#123; ... &#125; æ¯ä¸ªé—­åŒ…éƒ½æœ‰è‡ªå·±ä¸´æ—¶çš„å”¯ä¸€ç±»å‹, æ²¡æœ‰ä»»æ„ä¸¤ä¸ªé—­åŒ…ä¼šæœ‰ç›¸åŒçš„Type Closureæ€§èƒ½ å¤§éƒ¨åˆ†è¯­è¨€æŠŠé—­åŒ…åˆ›å»ºåœ¨å †ä¸Š(ç”±GCå›æ”¶), è°ƒç”¨çš„æ—¶å€™æœ‰ä¸€äº›é¢å¤–çš„æˆæœ¬, æ›´é‡è¦çš„æ˜¯: è¿™æ ·å®Œå…¨æ— æ³•åˆ©ç”¨inlineæå‡æ€§èƒ½. Rustæ²¡æœ‰è¿™æ–¹é¢çš„å¦¥å. é™¤éæ˜¾å¼çš„æŠŠé—­åŒ…åˆ›å»ºåœ¨Box, Vecæˆ–å…¶å®ƒå®¹å™¨ä¸­, Rustä¸ä¼šæŠŠé—­åŒ…æ”¾åœ¨å †ä¸Š. è€Œä¸”å› ä¸ºæ¯ä¸ªé—­åŒ…éƒ½æœ‰å®ƒè‡ªå·±çš„ç±»å‹, Rustä¹Ÿèƒ½é€šè¿‡æ•è·çš„æ–¹å¼çŸ¥é“éœ€è¦å¼€è¾Ÿå¤šå¤§çš„ç©ºé—´ç»™å˜é‡, ä»è€Œå¯ä»¥æŠŠé—­åŒ…åšinlineä¼˜åŒ–. å¦‚ä¸‹å›¾: ![Closure Memory Model](&#x2F;images&#x2F;Screen Shot 2019-09-04 at 01.08.26.png) (a): æŒ‰å¼•ç”¨æ•è·(Borrow), å®é™…åªéœ€è¦ä¸¤ä¸ªæŒ‡é’ˆå¤§å°æŒ‡å‘å˜é‡. (b): ä»¥moveçš„æ–¹å¼æ”«å–(Steal)å˜é‡, å­˜æ”¾ä¸¤ä¸ªæ‹·è´. (c): ä¸éœ€è¦æ•è·ä»»ä½•å˜é‡, 0æˆæœ¬! æ— è®ºå“ªç§å½¢å¼çš„é—­åŒ…, æ²¡æœ‰å¤šä½™çš„å¼€é”€, è¿ä¸€ä¸ªæŒ‡å‘é—­åŒ…çš„æŒ‡é’ˆéƒ½æ²¡æœ‰! å³ä½¿åœ¨å †æ ˆä¸Šçš„é—­åŒ…(ä¸‹é¢ä¼šè¯´), å…¶è°ƒç”¨æ€§èƒ½ä¹Ÿå’ŒTraité‡Œçš„æ–¹æ³•è°ƒç”¨æ€§èƒ½å·®ä¸å¤š. æ„æ€å°±æ˜¯æ¯”C++çš„è™šå‡½æ•°æŒ‡é’ˆå¿«. Fn, FnMut &amp; FnOnce é—­åŒ…å†…ä¼šé”€æ¯(drop)Borrowå˜é‡çš„ä¸èƒ½äºŒæ¬¡è°ƒç”¨, å¦åˆ™å¼•å‘å¤šæ¬¡é”€æ¯, Rustä¼šåœ¨ç¼–è¯‘æ—¶æœŸæ£€æµ‹åˆ°è¿™ç‚¹. 12345let my_str = &quot;hello&quot;.to_string();let f = || drop(my_str);f(); // okf(); // error: use of moved value é’ˆå¯¹ä¸Šé¢çš„æƒ…å†µ, ä¸‹é¢çš„ä»£ç ä¹Ÿä¼šæŠ¥é”™: 123456789fn call_twice&lt;F&gt;(closure: F) where F: Fn() &#123; closure(); closure();&#125;let my_str = &quot;hello&quot;.to_string();let f = || drop(my_str);call_twice(f); // expoected a closure that implements the `Fn` trait, // but this closure only implements `FnOnce` ç¼–è¯‘å™¨æç¤ºfè¿™ä¸ªé—­åŒ…å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸ªFnOnce, å®ƒå’ŒFnä»¥åŠFnMutçš„å£°æ˜å¦‚ä¸‹: 123456789101112pub trait FnOnce&lt;Args&gt; &#123; type Output; extern &quot;rust-call&quot; fn call_once(self, args: Args) -&gt; Self::Output;&#125;pub trait FnMut&lt;Args&gt;: FnOnce&lt;Args&gt; &#123; extern &quot;rust-call&quot; fn call_mut(&amp;mut self, args: Args) -&gt; Self::Output;&#125;pub trait Fn&lt;Args&gt;: FnMut&lt;Args&gt; &#123; extern &quot;rust-call&quot; fn call(&amp;self, args: Args) -&gt; Self::Output;&#125; å¯ä»¥çœ‹åˆ°è¿™ä¸‰ä¸ªç±»å‹çš„çˆ¶å­traitå…³ç³». åœ¨call_twiceè¿™ä¸ªå‡½æ•°å†…, closureå…¶å®ä¼šè¢«æ‰©å±•æˆ: closure.call(), ä½†æ˜¯ç»™å®šçš„fåªå…è®¸closure.call_once(), æ— æ³•åœ¨ç¼–è¯‘æ—¶æœŸæ‰©å±•è¿™ä¸ªgeneric, æ‰€ä»¥æŠ¥é”™. FnOnceçš„å‚æ•°æ˜¯self, æ‰€ä»¥è°ƒç”¨call_onceå, è¿™ä¸ªé—­åŒ…ä¹Ÿå°±ç”¨å°½é”€æ¯äº†(used up). è¦é¿å…è¿™ä¸ªé—®é¢˜çš„è¯å¯ä»¥æ”¹ä¸ºæ•è·å˜é‡çš„å¼•ç”¨(è¿™ä¹ˆæ”¹åå°±è¦æ³¨æ„ä¿è¯å¼•ç”¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸäº†): 123456let dict = produce_dict();let debug_dum_dict = || &#123; for (key, value) in &amp;dict &#123; // does not use up dict println!(&quot;&#123;:?&#125; - &#123;:?&#125;&quot;, key, value); &#125;&#125;; FnMutçš„å‚æ•°æ˜¯&amp;mut self, æ‰€ä»¥å…è®¸ä»¥mut referenceçš„å½¢å¼æ•è·å¹¶ä¿®æ”¹å˜é‡. æˆä¸ºFnMutæœ‰ä¸¤ä¸ªå¿…è¦æ¡ä»¶: mut access a value doesnâ€™t drop any value Callbackæˆ‘ä»¬é€šå¸¸ä¼šæŠŠé—­åŒ…åšä¸ºå›è°ƒä¿å­˜èµ·æ¥, ç­‰åˆ°è§¦å‘çš„æ—¶å€™è°ƒç”¨, æ¯”å¦‚: 12345678910111213141516171819struct BasicRouter&lt;C&gt; where C: Fn(&amp;Request) -&gt; Response &#123; routes: HashMap&lt;String, C&gt;&#125;impl&lt;C&gt; BasicRouter&lt;C&gt; where C: Fn(&amp;Request) -&gt; Response &#123; /// Create an empty router. fn new() -&gt; BasicRouter&lt;C&gt; &#123; BasicRouter &#123; routes: HashMap::new() &#125; &#125; fn add_route(&amp;mut self, url: &amp;str, callback: C) &#123; self.routes.insert(url.to_string(), callback); &#125;&#125;let mut router = BasicRouter::new();router.add_route(&quot;/&quot;, |_| get_form_response());// mismatched type// note: no two closures, even if identical, have the same type è¿™é‡ŒæŠ¥é”™, å› ä¸ºæ²¡æœ‰æ¯ä¸ªé—­åŒ…éƒ½æœ‰è‡ªå·±å”¯ä¸€çš„ç±»å‹, æ‰€ä»¥è¿™ä¸ªHashMapæ— æ³•æ‰©å±•. è§£å†³æ–¹æ³•, ç”¨Boxå»å°è£…ä¸€æ¬¡, ä½¿Box&lt;Fn(&amp;Request)&gt;æˆä¸ºä¸€ä¸ªæŒ‡å‘å †ä¸Šçš„é—­åŒ…çš„æŒ‡é’ˆ, ä¹Ÿå°±æ˜¯å…¶å®ƒè¯­è¨€ä¸­å¸¸è¯´çš„å›è°ƒ. 123456789101112131415161718type BoxedCallback = Box&lt;Fn(&amp;Request) -&gt; Response&gt;;struct BasicRouter &#123; routes: HashMap&lt;String, BoxedCallback&gt;&#125;impl BasicRouter &#123; /// Create an empty router. fn new() &#123; BasicRouter &#123; routes: HashMap::new() &#125; &#125; fn add_route&lt;C&gt;(&amp;mut self, url: &amp;str, callback: C) where C: Fn(&amp;Request) -&gt; Response + &#x27;static &#123; self.routes.insert(url.to_string(), callback); &#125;&#125; è¿™é‡ŒåŠ &#39;staticæ˜¯ä¸ºäº†ä¿è¯é—­åŒ…Borrowçš„å˜é‡å¼•ç”¨åœ¨ç¦»å¼€scopeåä»ç„¶å®‰å…¨.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Closure","slug":"Closure","permalink":"https://unpluggedcoder.me/tags/Closure/"},{"name":"Fn","slug":"Fn","permalink":"https://unpluggedcoder.me/tags/Fn/"},{"name":"FnMut","slug":"FnMut","permalink":"https://unpluggedcoder.me/tags/FnMut/"},{"name":"FnOnce","slug":"FnOnce","permalink":"https://unpluggedcoder.me/tags/FnOnce/"},{"name":"Callback","slug":"Callback","permalink":"https://unpluggedcoder.me/tags/Callback/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Utility Traits","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Utility Traits","date":"2019-09-01T10:58:30.000Z","updated":"2022-09-15T15:51:05.350Z","comments":true,"path":"2019/09/01/Rustå…¥é—¨å¤±è´¥ä¹‹Utility Traits/","link":"","permalink":"https://unpluggedcoder.me/2019/09/01/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BUtility%20Traits/","excerpt":"","text":"Drop è‡ªå®šä¹‰dropæ–¹æ³•åœ¨é»˜è®¤é”€æ¯å‰è°ƒç”¨æ‰§è¡Œ å¦‚æœå®ç°äº†Drop Trait, åˆ™ä¸èƒ½å®ç°Copy Trait. å¦‚æœå®ç°äº†Copy Trait, åˆ™æ„å‘³è¿™ä¸ªç±»å‹å¯ä»¥é€šè¿‡byte-for-byteå¤åˆ¶è·å¾—ä¸€ä»½ç‹¬ç«‹çš„æ•°æ®æ‹·è´, é‚£ä¹ˆdropä¸¤ä»½ç›¸åŒçš„æ•°æ®é€šå¸¸æ˜¯ä¸€ä¸ªé”™è¯¯. stdæœ‰ä¸€ä¸ªå…¨å±€çš„dropæ–¹æ³•, æ¯”è¾ƒfancy: é€šè¿‡å‚æ•°è·å¾—æ‰€æœ‰æƒ, ç„¶åç›´æ¥æ˜¯ä¸ªç©ºå‡½æ•°, å‡½æ•°è¿”å›å°±é‡Šæ”¾äº†å®å‚çš„å˜é‡. 1fn drop&lt;T&gt;(_x: T) &#123; &#125; Sized Rustä¸èƒ½åœ¨å˜é‡é‡Œä¿å­˜unsizedçš„å€¼, ä¹Ÿä¸èƒ½æŠŠunsizeçš„å€¼ä½œä¸ºå‚æ•°. æ‰€æœ‰å›ºå®šå¤§å°çš„ç±»å‹éƒ½å®ç°é‡Œstd::marker::Sizedtrait, è¿™ä¸ªtraitæ²¡æœ‰ä»»ä½•æ–¹æ³•å’Œè”åˆç±»å‹(associated type) ä¸èƒ½å®ç°è‡ªå®šä¹‰çš„Sized trait. Sized traitåªèƒ½ç”¨äºç»‘å®šåˆ°ç±»å‹å‚æ•°, ä¹Ÿå°±æ˜¯ç”¨äºå‚æ•°çš„ç±»å‹å£°æ˜(åŠæ£€æŸ¥), ä¾‹å¦‚ T: Sizedä¸èƒ½ç”¨äºå…¶å®ƒç”¨é€”, è¿™ç§trait å« marker trait ?Sizedå« questionably sized, å…è®¸å›ºå®šå¤§å°, ä¹Ÿå…è®¸éå›ºå®šå¤§å°ç±»å‹. structçš„æœ€åä¸€ä¸ªå­—æ®µå…è®¸æ˜¯?Sizedç±»å‹, ä½†å¦‚æœè¿™æ ·, structæœ¬èº«å°±å˜ä¸ºäº†unsized. ä½†å¦‚æœå†™æˆæ³›å‹, å¹¶ä¼ å…¥ä¸€ä¸ªSizedç±»å‹, é‚£ä¹ˆè¿™ä¸ªç±»å‹çš„structä»ç„¶æ˜¯Sized. å¤§å°å–å†³äºæ³›å‹çš„å‚æ•°ç±»å‹: 1234567891011121314struct RcBox&lt;T: ?Sized&gt; &#123; rec_count: usize, value: T,&#125;// Sized typelet boxed_lunch: RcBox&lt;String&gt; = RcBox &#123; ref_count: 1, value: &quot;lunch&quot;.to_string()&#125;use std::fmt::Display;// UnSized typelet boxed_displayable: &amp;RcBox&lt;Display&gt; = &amp;boxed_lunch; Clone cloneæ–¹æ³•å¿…é¡»è¿”å›å’Œselfç‹¬ç«‹æ— å…³çš„ä¸€ä»½æ‹·è´. Clonetraitæ˜¯Sizedçš„sub-trait, æ‰€ä»¥Selfç±»å‹å¿…é¡»æ˜¯Sized 123456trait Clone: Sized &#123; fn clone(&amp;self) -&gt; Self; fn clone_from(&amp;mut self, source: &amp;Self) &#123; *self = source.clone() &#125;&#125; é€šå¸¸æƒ…å†µä¸‹cloneçš„æˆæœ¬æ¯”è¾ƒé«˜, ä½†æ˜¯å¯¹äºRc&lt;T&gt;å’ŒArc&lt;T&gt;è¿™ç±»çš„ç±»å‹, Rustçš„å¯¹å®ƒä»¬çš„cloneåªæ˜¯ç®€å•çš„å¢åŠ è®¡æ•°. é€šå¸¸å°½å¯èƒ½ä½¿ç”¨clone_fromæ¥å‡å°‘cloneå¼€é”€, è¿™ä¼šå…è®¸ä¸€äº›ä¼˜åŒ–. ä¾‹å¦‚, Stringçš„clone, è¢«èµ‹å€¼çš„Stringå¦‚æœcapacityå¤Ÿå¤§, å¯ä»¥ä¸éœ€è¦é‡Šæ”¾å†…å­˜, ç›´æ¥æŠŠæºçš„å†…å®¹æ‹·è´è¿‡æ¥. å¦‚æœæ‰€æœ‰çš„å­—æ®µéƒ½å®ç°äº†Clone, é‚£ä¹ˆstructå¯ä»¥åŠ ä¸Šå±æ€§: #[derive(Clone)]è‡ªåŠ¨å®ç°Clone trait cloneæ–¹æ³•ä¸èƒ½å¤±è´¥(infallible), å¯¹äºstd::fs::Fileè¿™æ ·çš„ç±»å‹, æœ‰try_cloneæ–¹æ³•, è¿”å›std::io::Result&lt;File&gt; Copy ä¹‹å‰æ–‡ç« æœ‰ä»‹ç»è¿‡, å¦‚æœæ•°æ®ç±»å‹æŒæœ‰ä¸€äº›éœ€è¦é”€æ¯çš„èµ„æº(æ–‡ä»¶å¥æŸ„ã€å †ä¸Šæ•°æ®ç­‰), åˆ™ä¸å…è®¸å®ç°Copy trait. 1trait Copy: Clone &#123; &#125; Rustå¯¹äºå®ç°äº†Copy traitçš„ç±»å‹è¿›è¡Œèµ‹å€¼, ä¸ä¼šMoveåŸå˜é‡çš„æ•°æ®(æ‰€æœ‰æƒ), è€Œæ˜¯å°†åŸå¯¹è±¡åšæµ…æ‹·è´ä¸€ä»½ç»™ç›®æ ‡å˜é‡. ä¾‹å¦‚ç®€å•çš„æ•°æ®ç±»å‹ i32ç­‰. AsRef&lt;T&gt; &amp; Borrow&lt;T&gt; AsRef&lt;T&gt;å’Œ Borrow&lt;Tä¸€æ ·, è¿”å›çš„éƒ½æ˜¯å¼•ç”¨, ä½†æ˜¯æœ‰ä¸€ä¸ªåŒºåˆ«: Borrowä¿è¯å¯¹åŒä¸€æ•°æ®ç±»å‹Borrowå‡ºä¸åŒçš„Téƒ½æœ‰ç›¸åŒå“ˆå¸Œå€¼, è€ŒAsRefæ²¡æœ‰è¿™ç±»ä¿è¯, ä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸€ä¸ªString, ä¸‹é¢ä¸‰ä¸ªAsRefè¿”å›çš„æ˜¯ä¸‰ä¸ªå“ˆå¸Œå€¼ä¸åŒçš„å¼•ç”¨: 1234let s = String::from(&quot;/usr/bin/bash&quot;);let ref1: &amp;Path = s.as_ref();let ref2: &amp;[u8] = s.as_ref();let ref3: &amp;str = s.as_ref(); From and Into Fromå’Œ Intoéƒ½ä¼šè·å–åŸå˜é‡çš„æ‰€æœ‰æƒ, è½¬æ¢åè¿”å›ç»™è°ƒç”¨è€…. äºŒè€…æ˜¯ç›¸åçš„è¿‡ç¨‹, ä¸”ä¹Ÿæ˜¯Sizedçš„sub-trait: 1234567trait Into&lt;T&gt;: Sized &#123; fn into(self) -&gt; T;&#125;trait From&lt;T&gt;: Sized &#123; fn from(T) -&gt; Self; // é™æ€æ–¹æ³•&#125; å¦‚æœè‡ªå®šä¹‰ç±»å‹çš„æ„é€ åªæœ‰ä¸€ä¸ªå‚æ•°, é‚£ä¹ˆå¯ä»¥å†™ä¸€ä¸ªfromæ–¹æ³•å®ç°From, ç„¶åRustä¼šè‡ªåŠ¨å¸®ä½ å®ç°ä¸€ä¸ªInto trait. è¿™ä¸ªTraitæœ‰ä¸ªå¥½å¤„å¯ä»¥è®¿é—®åˆ°ä¸€äº›ç±»å‹çš„å†…éƒ¨æ•°æ®, è€Œåˆä¸ç ´åæ•°æ®åŸæœ‰å†…å®¹. ä¾‹å¦‚: Stringç±»å‹ä¸å…è®¸ç›´æ¥ä¿®æ”¹å†…éƒ¨çš„UTF-8å­—èŠ‚, ä½†æ˜¯é€šè¿‡Into&lt;Vec&lt;u8&gt;&gt;, æˆ‘ä»¬å¯ä»¥å¯¹Stringæ•°æ®è¿›è¡Œå…¶å®ƒæ“ä½œ, å¦‚æœå‹ç¼©ç­‰ç­‰. ToOwned å¦‚æœæ‹¿åˆ°ä¸€ä¸ªç±»å‹å¼•ç”¨(å‡è®¾è¿™ä¸ªç±»å‹å®ç°äº†Clone Trait), æƒ³å¯¹å®ƒè¿›è¡ŒClone, è€Œåœ¨å¼•ç”¨ç±»å‹ä¸Šæ— æ³•è°ƒç”¨clone, ä¾‹å¦‚ &amp;strä¸Šæ— æ³•è°ƒç”¨clone, å› ä¸ºè¿”å›çš„strä¸æ˜¯Sizedç±»å‹. å› æ­¤éœ€è¦æœ‰ä¸ªæ–¹æ³•è·è½¬æ¢åˆ°åŸç±»å‹æ•°æ®æ‹·è´, ä»è€Œè·å–åˆ°æ‰€æœ‰æƒ(æ³¨æ„âš ï¸, è¦æ±‚åŸç±»å‹å®ç°Clone Trait, è¿”å›çš„æ˜¯cloneå‡ºæ¥çš„æ•°æ®, æ˜¯åŸæ•°æ®çš„ä¸€ä»½æ‹·è´, å’ŒåŸæ•°æ®æ²¡æœ‰åŠæ¯›é’±å…³ç³»äº†). 1234trait ToOwned &#123; type Owned: Borrow&lt;Self&gt;; fn to_owned(&amp;self) -&gt; Self::Owned;&#125; è¿”å›çš„æ˜¯å®ç°äº†Borrow&lt;Self&gt;çš„ç±»å‹. å¯ä»¥è¿™ä¹ˆç†è§£, å¯ä»¥ä»å®ç°äº†Borrow&lt;Self&gt;çš„ç±»å‹ä¸Šborrowåˆ°&amp;Self, é‚£ä¹ˆåè¿‡æ¥å¯ä»¥ä»&amp;selfä¸Šè·å¾—åˆ°åŸç±»å‹æ•°æ®. ä¾‹å¦‚: Vec&lt;T&gt;å®ç°äº†Borrow&lt;[T]&gt;çš„trait, å¯ä»¥borrowåˆ°&amp;[T], é‚£ä¹ˆåè¿‡æ¥å¯ä»¥ä»&amp;[T]çš„å®ä¾‹è·å–åˆ°ä¸€ä»½Vec&lt;T&gt;ç±»å‹çš„æ‹·è´. Selfæ˜¯[T], Ownedç±»å‹æ˜¯Vec&lt;T&gt; 12let s: &amp;str = &quot;a&quot;;let ss: String = s.to_owned(); // ss is a new String clone from s(&amp;str) é€šå¸¸å®ç°ToOwnedtraitçš„éƒ½æ˜¯ä¸€äº›borrowå‡ºçš„å¼•ç”¨ç±»å‹, å¦‚str, æˆ–[T]. è€Œå®ƒçš„è”åˆç±»å‹Ownedé€šå¸¸æ˜¯å¯ä»¥è½¬æ¢ä¸ºå®ƒçš„ç±»å‹, å¦‚String, Vec&lt;T&gt;. Cow ä¸Šé¢çš„ToOwnedæ˜¯ç«‹å³æŠŠborrowæ¥çš„å¼•ç”¨è½¬æ¢ç”Ÿæˆä¸€ä»½Ownedçš„æ‹·è´. cloneæ˜¯æœ‰å¼€é”€çš„, æœ‰æ—¶æ— æ³•ç¡®å®šæ˜¯è¦å¤„ç†å¼•ç”¨è¿˜æ˜¯è·å–æ‰€æœ‰æƒ. å¦ä¸€æ–¹é¢, Cowå®é™…å°±æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆ, å®ç°äº†å†™æ—¶å¤åˆ¶(C*opy-On-Write)*çš„åŠŸèƒ½. 123456enum Cow&lt;&#x27;a, B: ?Sized + &#x27;a&gt;where B: ToOwned&#123; Borrow(&amp;&#x27;a B), Owned(&lt;B as ToOwned&gt;::Owned),&#125; Cowæœ‰ä¸ªfromæ–¹æ³•, å¦‚æœCowæ‹¿åˆ°æ˜¯ä¸€ä¸ªæ™®é€šçš„å…±äº«å¼•ç”¨ç±»å‹, é‚£ä¹ˆCowæšä¸¾å½“å‰å€¼å°±æ˜¯Borrow. ä¾‹å¦‚, ä¼ å…¥&amp;[T], é‚£è¾¹B å°±æ˜¯[T]. Cowä¸ä¼šè‡ªåŠ¨è½¬ä¸ºOwnedç±»å‹. ä¹Ÿå°±æ˜¯ä¸ä¼šæŠŠå¼•ç”¨B (stræˆ–[T]ä¹‹ç±»)è‡ªåŠ¨å¤åˆ¶å‡ºä¸€ä»½. é™¤éæ˜¾å¼è°ƒç”¨å®ƒçš„ä¸¤ä¸ªæ–¹æ³•: to_mut(): ä¼šè°ƒç”¨B çš„to_ownedæ–¹æ³•, ç”Ÿæˆä¸€ä»½æ‹·è´, æšä¸¾å€¼è½¬ä¸ºOwned. into_owned(): æå–å‡ºä¸€ä»½Ownedæ•°æ®, å¦‚æœå½“å‰æ˜¯Borrowä¹Ÿä¼šè°ƒç”¨to_ownedè½¬æ¢. æå–æ„å‘³ç€è¿™ä¸ªCowå˜é‡è°ƒç”¨åä¸å†å¯ç”¨. ä¸‹é¢å®˜æ–¹çš„ä¾‹å­å¾ˆå¥½è§£é‡Šè¿™ä¸€ç‚¹: 12345678910111213141516171819202122232425use std::borrow::Cow;fn abs_all(input: &amp;mut Cow&lt;i32&gt;) &#123; for i in 0..input.len() &#123; let v = input[i]; if v &lt; 0 &#123; // Clone into vector if not alread owned. input.to_mut()[i] = -v; &#125; &#125;&#125;// No clone occurs because `input` doesn&#x27;t need to be mutated.let slice = [0, 1, 2];let mut input = Cow::from(&amp;slice[..]);abs_all(&amp;mut input);// Clone occurs because `input` needs to be mutated.let slice = [-1, 0, 1];let mut input = Cow::from(&amp;slice[..]);abs_all(&amp;mut input);// No clone occurs because `input` is already owned.let mut input = Cow::from(vec![-1, 0, 1]);abs_all(&amp;mut input);","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Trait","slug":"Trait","permalink":"https://unpluggedcoder.me/tags/Trait/"},{"name":"Copy","slug":"Copy","permalink":"https://unpluggedcoder.me/tags/Copy/"},{"name":"Clone","slug":"Clone","permalink":"https://unpluggedcoder.me/tags/Clone/"},{"name":"Drop","slug":"Drop","permalink":"https://unpluggedcoder.me/tags/Drop/"},{"name":"Sized","slug":"Sized","permalink":"https://unpluggedcoder.me/tags/Sized/"},{"name":"AsRef","slug":"AsRef","permalink":"https://unpluggedcoder.me/tags/AsRef/"},{"name":"Borrow","slug":"Borrow","permalink":"https://unpluggedcoder.me/tags/Borrow/"},{"name":"ToOwned","slug":"ToOwned","permalink":"https://unpluggedcoder.me/tags/ToOwned/"},{"name":"Cow","slug":"Cow","permalink":"https://unpluggedcoder.me/tags/Cow/"},{"name":"From","slug":"From","permalink":"https://unpluggedcoder.me/tags/From/"},{"name":"Into","slug":"Into","permalink":"https://unpluggedcoder.me/tags/Into/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Traits&Generics","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Traits&Generics","date":"2019-08-30T17:17:30.000Z","updated":"2022-09-15T15:51:05.349Z","comments":true,"path":"2019/08/31/Rustå…¥é—¨å¤±è´¥ä¹‹Traits&Generics/","link":"","permalink":"https://unpluggedcoder.me/2019/08/31/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BTraits&Generics/","excerpt":"","text":"Trait Traitæœ‰scopeçš„æ¦‚å¿µ, å¿…é¡»å£°æ˜å¯è§åæ‰èƒ½ä½¿ç”¨. è¿™æ ·å¯ä»¥é¿å…åç§°å†²çª, åŒæ—¶ä¹Ÿå¯ä»¥çµæ´»åœ°è‡ªå®šä¹‰å®ç°Trait ç±»ä¼¼C&#x2F;C++çš„è™šåŸºç±»æ¥å£å®šä¹‰, ä½†æ˜¯æœ€æ˜æ˜¾çš„å·®åˆ«æ˜¯: C&#x2F;C++çš„è™šåŸºç±»ç»§æ‰¿ä¼šè¦æ±‚åœ¨å­ç±»æ¯ä¸ªå®ä¾‹çš„å†…å­˜æ¨¡å‹ä¸­ç”Ÿæˆè™šå‡½æ•°è¡¨, å ç”¨å¯¹è±¡å†…å­˜. è€Œä¸ºä¸€ä¸ªstructå®ç°ä¸€ä¸ªTraitå¯¹structå®ä¾‹æœ¬èº«æ²¡æœ‰ä»»ä½•å†…å­˜å¼€é”€. Traitæœ¬èº«å¹¶æ²¡æœ‰å›ºå®šçš„å¤§å°(åªæœ‰å¼•ç”¨æŸä¸ªå®ç°è¯¥Traitç±»å‹çš„å®ä¾‹åæ‰æœ‰å ç”¨å¤§å°ä¸€è¯´), å› æ­¤ä¸èƒ½ç›´æ¥å£°æ˜å’Œä½¿ç”¨Traitç±»å‹çš„å˜é‡. å¯¹æŸä¸ªå®ç°è¯¥Traitç±»å‹çš„å®ä¾‹çš„æœ‰æ•ˆå¼•ç”¨ç§°ä¸ºTrait Object 12345use std::io::Write;let mut buf: Vec&lt;u8&gt; = vec![];let writter: Wirte = buf; // error: `Write` does not have a constant sizelet writter: &amp;mut Write = &amp;mut buf; // Ok, writter is a Trait Object Trait Objectå®é™…æ˜¯ä¸€ä¸ªfat pointer, å ç”¨ä¸¤ä¸ªæœºå™¨å­—å­—èŠ‚, ä¸€ä¸ªæŒ‡å‘å®é™…çš„å®ä¾‹å¯¹è±¡, ä¸€ä¸ªæŒ‡å‘è™šåŸºè¡¨vtable. æ³¨æ„, è¿™ä¸ªvtableæœ¬èº«ä¸å±äºå®ä¾‹, è€Œæ˜¯å½“ä½œä¸ºä¸€ä¸ªTrait Objectè¿›è¡Œå¼•ç”¨æ—¶é™„åŠ ç»™è¿™ä¸ªå¼•ç”¨çš„fat pointer, å†…å­˜å¸ƒå±€å¦‚ä¸‹: é»˜è®¤æ–¹æ³•(Default method), å¯ä»¥åœ¨traitçš„å£°æ˜ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•. 123456789trait Write &#123; fn write(&amp;mut self, buf: &amp;[u8]) -&gt; Result&lt;usize&gt;; fn write_all(&amp;mut self, buf: &amp;[u8]) -&gt; Result&lt;()&gt; &#123; let mut bytes_written = 0; while bytes_written &lt; buf.len() &#123; bytes_written += self.write(&amp;buf[bytes_written...])?; &#125; Ok(())&#125; æ‰©å±•trait(extension trait), å¯ä»¥ä¸ºå…¶å®ƒtraitç±»å‹æ‰©å±•å‡ºè‡ªå®šä¹‰traitçš„æ¥å£. 12345678910trait WriteHtml &#123; fn write_html(&amp;mut self, html: &amp;HtmlDocument) -&gt; io::Result&lt;()&gt;;&#125;// For every type W that implements Write, here&#x27;s an implementation for WriteHtml for Wimpl&lt;W: Write&gt; WriteHtml for W &#123; fn write_html(&amp;mut self, html: &amp;HtmlDocument) -&gt; io::Result&lt;()&gt; &#123; ... &#125;&#125; Selfå…³é”®å­—(not self), ç”¨æ¥ä½œä¸ºåˆ«å, å£°æ˜ä¸ºå®ç°è¯¥Traitçš„å…·ä½“ç±»å‹. 123pub trait Clone &#123; fn clone(&amp;self) -&gt; Self;&#125; Subtrait, ç±»ä¼¼æ¥å£ç»§æ‰¿. å¯ä»¥è¿™ä¹ˆç†è§£: å‡¡æ˜¯å®ç°äº†Subtrait(Creature)çš„ç±»å‹, ä¹Ÿå¿…é¡»å®ç°çˆ¶Trait(Visible)çš„æ‰€æœ‰æ–¹æ³•., æœ‰çš„åœ°æ–¹åˆå«Extend trait. 1234// Every type that implements Creature must also implement the Visible trait.trait Creature: Visible &#123; fn ...;&#125; Static Methods, ç±»ä¼¼æ¥å£çš„é™æ€æ–¹æ³•, æ²¡æœ‰selfå‚æ•°, é€šå¸¸ç”¨ä½œå·¥å‚æ¨¡å¼. 1234trait StringSet &#123; fn new() -&gt; Self; fn from_slice(strings: &amp;[&amp;str]) -&gt; Self;&#125; è°ƒç”¨æ–¹å¼æ˜¯å®ç°è¯¥traitçš„ç±»å‹åç§°åŠ ä¸Š::, å¦‚æœæ˜¯æ³›å‹(ä¸‹é¢ä¼šä»‹ç»), åˆ™ç”¨æ³›å‹å˜é‡. 1234567// SortedStringSet impl the StringSet traitlet set1 = SortedStringSet::new();fn func&lt;S: StringSet&gt;() -&gt; S &#123; let mut set2 = S::new(); ...&#125; Generic æ³›å‹Genericç”¨&lt;&gt;æ¥è¡¨ç¤º, é€šå¸¸ç”¨å…¨å¤§å†™å˜é‡è¡¨ç¤ºæ³›å‹å‚æ•°. 12fn hello(out: &amp;mut Write)&#123;&#125;fn hello&lt;W: Write&gt;(out: &amp;mut W)&#123;&#125; ç¼–è¯‘æ—¶Rustä¼šä¸ºä½¿ç”¨æ³›å‹çš„æ¯ä¸ªç±»å‹ç”Ÿæˆä¸€å¥—æœºå™¨ä»£ç , æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€, ä½†æ˜¯ä¼šç”Ÿæˆé¢å¤–çš„æœºå™¨ç , å¢åŠ äºŒè¿›åˆ¶å¤§å°. å¯ä»¥ä½¿ç”¨æ³›å‹çš„åœºæ™¯: å‡½æ•° enumã€structåŠå…¶method ç±»å‹åˆ«å(type aliases): type PancakeResult&lt;T&gt; = Result&lt;T, PancakeError&gt;; å‡½æ•°çš„whereè¯­å¥ Difference between Trait &amp; Generic Genericæ²¡æœ‰è¿è¡Œæ—¶å¼€é”€, é€Ÿåº¦æ›´å¿«, è€ŒTraitéœ€è¦è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“å®é™…ç±»å‹(ä¹Ÿå°±æ˜¯æ‰§è¡Œæ—¶æ ¹æ®Trait Objectæ¥æŸ¥æ‰¾vtableæ–¹æ³•). å¦‚æœéœ€è¦å¤„ç†å¤§é‡å„ç§ä¸åŒç±»å‹å¯¹è±¡çš„ç‰¹æ€§ä¸”å¯¹äºŒè¿›åˆ¶å¤§å°æœ‰è¦æ±‚, å¯ä»¥ç”¨Trait. å¦åˆ™å»ºè®®ä½¿ç”¨Generic. Not every trait can support trait objects. å¹¶ä¸æ˜¯æ‰€æœ‰çš„Traitéƒ½æ”¯æŒTrait Objectæ–¹å¼ä½¿ç”¨. åŒ…å«é™æ€æ–¹æ³•çš„Trait, ç”±äºæ²¡æœ‰selfå‚æ•°, åœ¨æ³›å‹å‡½æ•°ä¸­å…¶é™æ€æ–¹æ³•ä¸èƒ½é€šè¿‡Trait Objectæ¥è°ƒç”¨. ä¾‹å¦‚ä¸‹é¢(ä»ç„¶ä»¥ä¸Šé¢é™æ€æ–¹æ³•ä»£ç ä¸ºä¾‹): 1234567891011// Return the set of words in `document` that aren&#x27;t in `wordlist`.fn unknown_words&lt;S: StringSet&gt;(document: &amp;Vec&lt;String&gt;, wordlist: &amp;S) -&gt; S &#123; // ä¸èƒ½é€šè¿‡Trait Object wordlist è°ƒç”¨new, åªèƒ½é€šè¿‡æ³›å‹å˜é‡S:: let mut unknowns = S::new(); for word in document &#123; if !wordlist.contains(word) &#123; unknowns.add(word); &#125; &#125; unknowns&#125;","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Trait","slug":"Trait","permalink":"https://unpluggedcoder.me/tags/Trait/"},{"name":"Generics","slug":"Generics","permalink":"https://unpluggedcoder.me/tags/Generics/"},{"name":"ç‰¹è´¨","slug":"ç‰¹è´¨","permalink":"https://unpluggedcoder.me/tags/%E7%89%B9%E8%B4%A8/"},{"name":"æ³›å‹","slug":"æ³›å‹","permalink":"https://unpluggedcoder.me/tags/%E6%B3%9B%E5%9E%8B/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Enum&Patterns","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Enum&Patterns","date":"2019-08-28T16:19:30.000Z","updated":"2022-09-15T15:51:05.347Z","comments":true,"path":"2019/08/29/Rustå…¥é—¨å¤±è´¥ä¹‹Enum&Patterns/","link":"","permalink":"https://unpluggedcoder.me/2019/08/29/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BEnum&Patterns/","excerpt":"","text":"Enum æˆå‘˜å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹(with data or without data): 1234567891011enum Pet &#123; // without data Orca, // Starting at 0 by default Giraffe&#125;#[derive(Copy, Clone, Debug, PartialEq)]enum RoughTime &#123; // with data InThePast(TimeUnit, u32), JustNow, InTheFuture(TimeUnit, u32)&#125; å¯ä»¥èŒƒå‹, æœ€å¸¸è§çš„å°±æ˜¯Option&lt;T&gt;å’ŒResult&lt;T, E&gt;: 123456789enum Option&lt;T&gt; &#123; None, Some(T)&#125;enum Result&lt;T, E&gt; &#123; Ok(T), Err(E)&#125; æ‰€æœ‰æˆå‘˜å¤§å°å¿…é¡»å›ºå®š, å¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®å®š. å¦‚æœåŠ¨æ€å¤§å°, éœ€è¦ç”¨Box&lt;T&gt;ç­‰æ™ºèƒ½æŒ‡é’ˆå°è£…. ä¸Šé¢çš„Option&lt;T&gt;ä¸­, å¦‚æœTæ˜¯Boxç­‰æ™ºèƒ½æŒ‡é’ˆç±»å‹, é‚£ä¹ˆæ•´ä¸ªOption&lt;T&gt;å¤§å°å¯èƒ½å°±æ˜¯ä¸€ä¸ªæœºå™¨å­—(machine word), 0ä»£è¡¨None, é0ä»£è¡¨BoxedæŒ‡é’ˆå€¼, æ²¡æœ‰tagå­—æ®µ(ä¸‹é¢è®²åˆ°). å†…å­˜å¸ƒå±€ Rustä¸ºäº†å°†æ¥çš„ä¼˜åŒ–è€ƒè™‘, æ²¡æœ‰å¼ºåˆ¶è§„å®šenumçš„å†…å­˜å¸ƒå±€, ä½†åŒä¸€ç±»å‹çš„æšä¸¾å€¼å¤§å°ä¸€è‡´. é€šå¸¸éƒ½ä¸ºæ¯ä¸ªæšä¸¾å€¼åˆ†é…äº†é€‚åˆçš„small intgerç±»å‹å­˜æ”¾å…¶æšä¸¾*tag* 12345678910111213141516enum Ordering &#123; Less, Equal, Greater&#125;enum HttpStatus &#123; Ok = 200, NotModified = 304, NotFound = 404, ...&#125;use std::mem::size_of;assert_eq!(size_of::&lt;Ordering&gt;(), 1);assert_eq!(size_of::&lt;HttpStatus&gt;(), 2); // 404 doesn&#x27;t fit in a u8 å¯¹äºåŒ…å«æ•°æ®çš„enum, å†…å­˜å¸ƒå±€æœ‰ç‚¹ç±»ä¼¼C&#x2F;C++çš„unionç±»å‹, é™¤äº†tagå­—æ®µå¤–ä¼šç”¨é€‰æ‹©åˆé€‚çš„å­—èŠ‚æ¥å­˜æ”¾å¯ä»¥å®¹çº³æ‰€æœ‰æ•°æ®å¤§å°çš„å†…å­˜å¸ƒå±€. ä¾‹å¦‚: 12345678enum Json &#123; Null, Boolean(bool), Number(f64), String(String), Array(Vec&lt;Json&gt;), Object(Box&lt;HashMap&lt;String, Json&gt;&gt;)&#125; å®ƒçš„å†…å­˜å¸ƒå±€é€šå¸¸å¯èƒ½å¦‚ä¸‹(ä¸Šé¢çŸ­çŸ­çš„8è¡Œä»£ç , å¦‚æœç”¨C&#x2F;C++æ¥å®ç°, å°±éå¸¸å¤æ‚äº†): ![Enum Memory Model](&#x2F;images&#x2F;Screen Shot 2019-08-29 at 00.39.13.png) Patterns æ¨¡å¼åŒ¹é…æ¨¡å¼åŒ¹é…é€šå¸¸ä¼šå’Œenumç±»å‹ä¸€èµ·ä½¿ç”¨, æ‰€ä»¥æ”¾åˆ°ä¸€èµ·è®². åŒ¹é…æ˜¯ä»å·¦åˆ°å³æ£€æŸ¥Patternæ˜¯å¦åŒ¹é…è¡¨è¾¾å¼. è¡¨è¾¾å¼ç”Ÿæˆå€¼, Patternæ¶ˆè´¹è¿™äº›å€¼(Expressions produce values; patterns consume values) refå’Œ ref mutç”¨æ¥é¿å…moveæˆ–è€…CopyåŒ¹é…åˆ°çš„å˜é‡, ä»è€Œç”¨äºmatchçš„å˜é‡åœ¨åç»­å¯ä»¥ç»§ç»­ä½¿ç”¨. ä¾‹å¦‚: 123456match account &#123; Account &#123;name, language, .. &#125; =&gt; &#123; ui.greet(&amp;name, &amp;language); ui.show_settings(&amp;account); // error: use of moved value `account` &#125;&#125; è¿™é‡ŒåŒ¹é…åˆ°çš„æ•°æ®å·²ç»è¢«moveåˆ°*nameå’Œlanguage*ä¸­, åŸå˜é‡accountå·²ç»ä¸ºuninitialized, ä¸èƒ½å†ä½¿ç”¨, ç”¨refå°†åŒ¹é…åˆ°çš„å˜é‡è½¬ä¸ºå¼•ç”¨. 123456match account &#123; Account &#123; ref name, ref language, .. &#125; =&gt; &#123; ui.greet(name, language); ui.show_settings(&amp;account); // ok &#125;&#125; &amp;ç”¨æ¥åŒ¹é…å¼•ç”¨ç±»å‹çš„pattern, è€Œéå°†åŒ¹é…åˆ°çš„å˜é‡è½¬æ¢ä¸ºå¼•ç”¨. 123match sphere.center() &#123; // sphere.center() return &amp;Point3d &#123;...&#125; &amp;Point3d &#123; x, y, z &#125; =&gt; ...&#125; é“ç†å…¶å®ä¸€æ ·, è¡¨è¾¾å¼å’ŒPatternæ˜¯ä¸¤ä¸ªæœ¬è´¨ä¸Šç›¸å(natural opposites)çš„è¿‡ç¨‹.æŠŠè¡¨è¾¾å¼çœ‹æˆæ˜¯æ„é€ ä¸€ä¸ªå€¼çš„è¿‡ç¨‹, è€ŒPatternæ˜¯åè§£ä¸€ä¸ªå€¼çš„è¿‡ç¨‹, åŠ ä¸Š&amp;ä¹Ÿæ˜¯ä¸€æ ·. ![Reference Pattern](&#x2F;images&#x2F;Screen Shot 2019-08-29 at 01.11.53.png) Pattern Guard: pattern if conditionâ‡’ åªæœ‰æ¡ä»¶æ»¡è¶³, patternæ‰ç®—åŒ¹é… var @ pattern: å°†åŒ¹é…çš„æ•´ä¸ªpattern moveæˆ–Copyåˆ°å˜é‡varä¸­, ä¾‹å¦‚æŸäº›åœºæ™¯ä¸‹å¯ä»¥é¿å…é‡å¤æ„é€ å˜é‡. é™¤äº†match var &#123;&#125;è¯­å¥å¯ä»¥ä½¿ç”¨patternå¤–, åªæœ‰ä»¥ä¸‹å››ä¸ªåœºæ™¯å¯ä»¥ä½¿ç”¨pattern: let pattern = var;å°†å˜é‡varæŒ‰åŒ¹é…æ¨¡å¼unpack fn func(parm: pattern) â†’ xxx&#123;&#125;æŒ‰åŒ¹é…æ¨¡å¼unpackå‡½æ•°å®å‚ for pattern in xxxx &#123;&#125;forå¾ªç¯ä¸­æŒ‰åŒ¹é…æ¨¡å¼unpackå®é™…è¿­ä»£çš„æˆå‘˜ let var = func(|pattern| &#123;closure body&#125;)åœ¨é—­åŒ…ä¸­æŒ‰æ¨¡å¼unpacké—­åŒ…çš„å‚æ•°, ä¾‹å¦‚æœ‰æ—¶æœŸæœ›å‚æ•°æ˜¯å¼•ç”¨è€Œéæ‹·è´. let sum = numbers.fold(0, |a, &amp;num| a+ num); è¿™å››ä¸ªåœ°æ–¹å’Œmatchçš„æ¨¡å¼åŒ¹é…æœ€æ ¹æœ¬çš„åŒºåˆ«æ˜¯: matchæ˜¯*refutable pattern*, å…è®¸å‡ºç°æ¨¡å¼ä¸åŒ¹é…çš„æƒ…å†µ è€Œä¸Šè¿°å››ç§åœºæ™¯Rustä¸å…è®¸å‡ºç°ä¸åŒ¹é…(irrefutable)çš„æƒ…å†µ, å±äºä¸¥æ ¼çš„ä¸å¯é©³æ–¥åŒ¹é…æ¨¡å¼. All images are copyrighted by original authors Jim Blandy &amp; Jason Orendorff who wrote in the book Programming Rust.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Enum","slug":"Enum","permalink":"https://unpluggedcoder.me/tags/Enum/"},{"name":"Pattern","slug":"Pattern","permalink":"https://unpluggedcoder.me/tags/Pattern/"},{"name":"PatternGuard","slug":"PatternGuard","permalink":"https://unpluggedcoder.me/tags/PatternGuard/"},{"name":"refutable","slug":"refutable","permalink":"https://unpluggedcoder.me/tags/refutable/"},{"name":"irrefutable","slug":"irrefutable","permalink":"https://unpluggedcoder.me/tags/irrefutable/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Struct","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Struct","date":"2019-08-27T16:23:30.000Z","updated":"2022-09-15T15:51:05.349Z","comments":true,"path":"2019/08/28/Rustå…¥é—¨å¤±è´¥ä¹‹Struct/","link":"","permalink":"https://unpluggedcoder.me/2019/08/28/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BStruct/","excerpt":"","text":"Struct æœ‰ä¸‰ç§Struct: Name-Field Structs 1struct Broom &#123; name: String, height: u32 &#125; Tuple-Like Structs 1struct Bounds(usize, usize); Unit-Like Structs 1struct Onesuch; Structçš„æ–¹æ³•æœ‰ä¸‰ç§selfå¼•ç”¨æ–¹å¼: fn func(self): è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶, åŸstructçš„æ‰€æœ‰æƒå·²ç»è¢«è½¬ç§»(move)åˆ°selfä¸­, åŸå¼•ç”¨ä¸å¯ç”¨. fn func(&amp;self): è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶, åŸå¼•ç”¨ä»ç„¶æ‹¥æœ‰å®ƒçš„æ‰€æœ‰æƒ, ä½†selfä¸èƒ½ä¿®æ”¹è‡ªèº«. fn func(&amp;mut self): åŒä¸Š, ä½†å¯ä¿®æ”¹. èŒƒå‹Struct: impl&lt;T&gt; Queue&lt;T&gt; &#123;&#125;è¿™ä¹ˆç†è§£: For any type T, here are some methods available on Queue&lt;T&gt; é€šè¿‡deriveå±æ€§å¯ä»¥è®©structè·å¾—æŸäº›ç‰¹è´¨èƒ½åŠ›: 12345#[derive(Copy, Clone, Debug, PartialEq)]struct Point &#123; x: f64, y: f64&#125; Cell&lt;T&gt;, RefCell&lt;T&gt;éœ€è¦ä¿®æ”¹å†…éƒ¨å˜é‡æˆ–å¼•ç”¨, ä½¿ç”¨Cellæˆ– RefCellæ¥æä¾›interior mutability. ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªåœºæ™¯, SpiderSensesåŒ…å«å¯¹SpiderRobotçš„å¼•ç”¨, ä½†æ˜¯å¦‚æœæƒ³åœ¨SpiderRobotä¸­æ·»åŠ ä¸€äº›æ–‡ä»¶æ—¥å¿—, å¹¶åœ¨SpiderSensesä¸­è®°å½•, é‚£ä¹ˆå¯¹standard File typeçš„å¼•ç”¨å°±å¿…é¡»æ˜¯mutable. 12345678910111213141516pub struct SpiderRobot &#123; species: String, web_enabled: bool, leg_devices: [fd::FileDesc; 8], ...&#125;use std::rc::Rc;pub struct SpiderSenses &#123; robot: Rc&lt;SpiderRobot&gt;, // &lt;-- pointer to settings and I/O eyes: [Camera; 32], motion: Accelerometer, ...&#125; Cell&lt;T&gt;Cell&lt;T&gt;å®é™…ä¸Šæ˜¯ä¸ªåŒ…å«äº†ç§æœ‰(non-pub)æˆå‘˜å˜é‡Tçš„struct. æä¾›äº†æ˜¾å¼çš„æ–¹æ³•æ¥ä¿®æ”¹å†…éƒ¨æ•°æ®. Cell::new(value): åˆ›å»ºä¸€ä¸ªæ–°çš„Cell, move valueåˆ°é‡Œé¢. cell.get(): è¿”å›çš„æ˜¯ä¸€ä¸ªvalueçš„æ‹·è´. cell.set(value): è¿™ä¸ªæ–¹æ³•å¾ˆç‰¹æ®Š, æ˜¯Rustä¸­ä¸éœ€è¦&amp;mut selfå°±èƒ½ä¿®æ”¹å†…éƒ¨æ•°æ®çš„æ–¹æ³•, ä½†æ˜¯ç”±äºå®ƒæ˜¯æ˜¾å¼çš„set, æ‰€ä»¥å…è®¸ç»•è¿‡å†…éƒ¨å¯å˜æ€§çš„è§„åˆ™. 123pub fn set(&amp;self, val: T) &#123; // note: not &quot;&amp;mut self&quot; ...&#125; å¦‚æœè¯´SpiderRootéœ€è¦åŠ ä¸€ä¸ªé”™è¯¯è®¡æ•°, é‚£ä¹ˆåŒ…å«å®ƒçš„SpiderSensesä¸éœ€è¦mutå¼•ç”¨å°±å¯ä»¥å®ç°: 123456789101112131415use std::cell::Cell;pub struct SpiderRoot &#123; ... hardware_error_count: Cell&lt;u32&gt;, ...&#125;impl SpiderRoot &#123; /// Increase the error count by 1 pub fn add_hardware_error_count(&amp;self) &#123; let n = self.hardware_error_count.get(); self.hardware_error_count.set(n + 1); &#125;&#125; ä½†æ˜¯, Cellæœ‰ä¸€ç‚¹ä¸å¤Ÿçµæ´»getå’Œsetæ“ä½œçš„å¯¹è±¡éƒ½æ˜¯æ˜¯copyableæ•°æ®ç±»å‹. å¯¹äºFileç­‰ä¸å¯æ‹·è´ç±»å‹ä¸å…è®¸. å› æ­¤éœ€è¦RefCell&lt;T&gt; RefCell&lt;T&gt;å’ŒCell&lt;T&gt;ç±»ä¼¼, ä½†æ˜¯æ“ä½œçš„æ˜¯å¼•ç”¨. RefCell::new(value): åŒä¸Š ref_cell.borrow(): è¿”å›çš„æ˜¯Ref&lt;T&gt;,æ˜¯valueçš„shared reference ref_cell.borrow_mut(): è¿”å›çš„æ˜¯RefMut&lt;T&gt;, æ˜¯valueçš„ mutable reference 12345678910111213pub struct SpiderRobot &#123; ... log_file: RefCell&lt;File&gt;, ...&#125;impl SpiderRobot &#123; /// Write a line to the log file. pub fn log(&amp;self, message: &amp;str) &#123; let mut file = self.log_file.borrow_mut(); writeln!(file, &quot;&#123;&#125;&quot;, message).unwrap(); &#125;&#125;","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Struct","slug":"Struct","permalink":"https://unpluggedcoder.me/tags/Struct/"},{"name":"Cell<T>","slug":"Cell-T","permalink":"https://unpluggedcoder.me/tags/Cell-T/"},{"name":"RefCell<T>","slug":"RefCell-T","permalink":"https://unpluggedcoder.me/tags/RefCell-T/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Crates&Modules","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Crates&Modules","date":"2019-08-24T13:15:30.000Z","updated":"2022-09-15T15:51:05.347Z","comments":true,"path":"2019/08/24/Rustå…¥é—¨å¤±è´¥ä¹‹Crates&Modules/","link":"","permalink":"https://unpluggedcoder.me/2019/08/24/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BCrates&Modules/","excerpt":"","text":"Cargo Rust çš„åº“é»˜è®¤æ˜¯.rlibæ ¼å¼, è¿™ä¸ªæ˜¯Rustè‡ªèº«çš„åº“ç±»å‹.é»˜è®¤ä¼šå°†.rlibé™æ€é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶é¡¹ç›®(bin) å¦‚æœéœ€è¦ç¼–è¯‘.soæˆ–.dylib, åœ¨Cargo.tomlé‡Œå¢åŠ ä¸‹é¢çš„å±æ€§: 123[lib]name = &quot;...&quot;crate-type = [&quot;dylib&quot;] # could be `staticlib` as well The available options are dylib, rlib, staticlib, cdylib, and proc-macro. Modules Moduleæ˜¯Rustçš„åç§°ç©ºé—´ æ¯ä¸ªmoduleåˆå§‹æ˜¯ç©ºç™½çŠ¶æ€(blank slate), é™¤äº†ä¸‹é¢çš„ä¾‹å¤–è¢«é»˜è®¤è¢«éšå«å£°æ˜ extern crate std; use std::prelude::v1::*; é€šå¸¸ä¼šå£°æ˜ä¸€ä¸ªå­æ¨¡å—prelude, è®©ç”¨æˆ·å»å¼•ç”¨: use xxxx::prelude::*; crateæ˜¯projectå±‚é¢çš„ä»£ç å¤ç”¨, è€Œmoduleæ˜¯ä¸€ä¸ªprojectå†…çš„ä»£ç ç»„ç»‡ Rustä¸ä¼šå•ç‹¬ç¼–è¯‘æŸä¸ªæ¨¡å—Module, æ¯æ¬¡ç¼–è¯‘ä¸€ä¸ªcrate, ä¼šç¼–è¯‘å®ƒæ‰€æœ‰çš„æ¨¡å— use super::xxxå­æ¨¡å—å¼•ç”¨çˆ¶çº§æ¨¡å—, å’Œunixç›®å½•é‡Œçš„ ../ç±»ä¼¼ user self::xxxçˆ¶æ¨¡å—å¼•ç”¨å­æ¨¡å—, å’Œunixç›®å½•é‡Œçš„ ./ç±»ä¼¼ extern crate xxx;ç±»ä¼¼æŒ‚è½½å…¶å®ƒcrateçš„æ ¹ç›®å½•åˆ°å½“å‰é¡¹ç›®ä¸­ å­æ¨¡å—å¯ä»¥å¼•ç”¨çˆ¶æ¨¡å—çš„ç§æœ‰æˆå‘˜, ä½†å¿…é¡»é€ä¸€åˆ—å‡ºå¼•ç”¨çš„åç§° å­æ¨¡å—å¯ä»¥ç”¨super::*;ç›´æ¥å¼•ç”¨çˆ¶æ¨¡å—æ‰€æœ‰pubæˆå‘˜ Pub implå—ä¸èƒ½è¢«å£°æ˜ä¸ºpub, è€Œå®ƒå†…éƒ¨çš„æ–¹æ³•å¯ä»¥ ç§æœ‰çš„æ–¹æ³•methodså’Œå­—æ®µfieldsåªèƒ½åœ¨å®ƒä»¬è¢«å£°æ˜çš„æ¨¡å—ä½¿ç”¨ å¯ä»¥ç”¨pubä¿®é¥°use, é¿å…å¤–éƒ¨ç”¨æˆ·çš„é•¿ä¸²å¼•ç”¨ Attributes #[allow(...)] ä¾‹å¦‚å…è®¸ä¸€äº›è­¦å‘Š #[cfg] è®¾ç½®ä¸€äº›å±æ€§, ä¾‹å¦‚: target_arch=&quot;x86_64&quot; target_os=&quot;macos&quot; #[inline] è¢«å¤–éƒ¨crateè°ƒç”¨çš„æ–¹æ³•é»˜è®¤ä¸ä¼šinline, é™¤éæ˜¾ç¤ºæŒ‡å®šæˆ–è€…æœ‰é€šç”¨æ¨¡æ¿å‚æ•° #[inline(always)] #[inline(never)] Doc #![doc]ç­‰äº //! ///åå¯ä»¥åŠ å››ä¸ªç©ºæ ¼æˆ–markdownçš„ä»£ç é£æ ¼ ```` åŠ å…¥ä»£ç ä½œä¸ºDoc-Tests&#96; å¦‚æœä¸å¸Œæœ›Doc-Testsä»£ç è¿è¡Œ, ç”¨ &#96; &#96;&#96;&#96;&#96;no_run å¦‚æœä¸å¸Œæœ›Doc-Testsä»£ç ç¼–è¯‘, ç”¨ &#96; &#96;&#96;&#96;&#96;ignore Cargo.lock å¦‚æœprojectæ˜¯ä¸ªâ€œé™æ€åº“â€, ä¸ç”¨æäº¤Cargo.lockåˆ°gitä¸­, æ¯ä¸ªdownstreamç”¨æˆ·æœ‰è‡ªå·±çš„ä¾èµ–å›¾dependency graph. å¦‚æœprojectæ˜¯ä¸ªåŠ¨æ€åº“(è¾“å‡ºæ˜¯.dll, .dylib, .so), æ²¡æœ‰downstreamçš„cargoç”¨æˆ·, å¿…é¡»æäº¤Cargo.lockæ–‡ä»¶","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Crates","slug":"Crates","permalink":"https://unpluggedcoder.me/tags/Crates/"},{"name":"Modules","slug":"Modules","permalink":"https://unpluggedcoder.me/tags/Modules/"},{"name":"pub","slug":"pub","permalink":"https://unpluggedcoder.me/tags/pub/"},{"name":"doc-tests","slug":"doc-tests","permalink":"https://unpluggedcoder.me/tags/doc-tests/"},{"name":"cargo","slug":"cargo","permalink":"https://unpluggedcoder.me/tags/cargo/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Error Handling","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Error Handling","date":"2019-08-24T12:23:30.000Z","updated":"2022-09-15T15:51:05.347Z","comments":true,"path":"2019/08/24/Rustå…¥é—¨å¤±è´¥ä¹‹Error Handling/","link":"","permalink":"https://unpluggedcoder.me/2019/08/24/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BError%20Handling/","excerpt":"","text":"Rusté‡Œçš„é”™è¯¯å¤„ç†ä¸»è¦åˆ†ä¸¤ç§: Panic å’Œ Result ğŸ’€Panic ä¸åƒC++çš„æœªå®šä¹‰æ“ä½œ, paincæ—¶çš„æ“ä½œé¡ºåº: æ‰“å°é”™è¯¯ä¿¡æ¯, å¦‚æœå®šä¹‰äº†RUST_BACKSTRACE=1, è¿˜å°†æ‰“å°å †æ ˆ; æ ˆå›æº¯, æŒ‰ç…§å †æ ˆé¡ºåºé”€æ¯èµ„æº, æ‰€æœ‰ç±»å‹(å«è‡ªå®šä¹‰ç±»å‹)çš„dropæ–¹æ³•è¢«è°ƒç”¨; çº¿ç¨‹é€€å‡º, Panicæ˜¯çº¿ç¨‹çº§, å¦‚æœä¸»çº¿ç¨‹å´©äº†, æ•´ä¸ªè¿›ç¨‹ç»“æŸ, å¦åˆ™å…¶å®ƒçº¿ç¨‹è¿˜ä¼šç»§ç»­. å¯ä»¥ç”¨std::panic::catch_unwind()æ•è·panicæ—¶çš„stack unwinding, è¿™ä¹Ÿæ˜¯Rust testçš„åšæ³•. å½“C&#x2F;C++ç­‰å…¶å®ƒè¯­è¨€è°ƒç”¨Rustä»£ç æ—¶å¯ä»¥ç”¨std::panic::catch_unwind()æ•è·, å› ä¸ºunwinding éRust code çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„. std::panic::catch_unwind()åªèƒ½ç”¨äºæ¢å¤å †æ ˆ, ä¸è¦å°è¯•ç€ç»§ç»­è¿è¡Œ. å¦‚æœæ¸…ç†è¿‡ç¨‹ä¸­dropæ–¹æ³•å†æ¬¡panic, åˆ™Rustä¸ä¼šå†å°è¯•æ¢å¤å †æ ˆunwind stack, ç›´æ¥abort. âš–ï¸Result&lt;T,E&gt;123456789pub enum Result&lt;T, E&gt; &#123; /// Contains the success value #[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)] Ok(#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)] T), /// Contains the error value #[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)] Err(#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)] E),&#125; T, E åˆ†åˆ«å®šä¹‰Okå’ŒErråŒ…å«çš„ç±»å‹ï¼š Ok(T) Err(E) Resultæœ‰ä¸¤ä¸ªæ–¹æ³•: .as_ref()å’Œ .as_mut()åˆ†åˆ«æŠŠResult&lt;T, E&gt;è½¬ä¸º Result&lt;&amp;T, &amp;E&gt;å’Œ Result&lt;&amp;mut T, &amp;mut E&gt;ä»è€Œé¿å…é”€æ¯å®ƒæˆ–è€…move. fn remove_file(path: &amp;Path) â†’ Result&lt;()&gt;, è¿™é‡Œçš„Resultæ˜¯åˆ«å(aliases), éœ€è¦çœ‹å¯¹åº”çš„æ¨¡å—çš„public Resultå®šä¹‰: 1pub type Result&lt;T&gt; = result::Result&lt;T, Error&gt; é€šè¿‡println!(&quot;&#123;:?&#125;&quot;, err);å¯ä»¥æŸ¥çœ‹åˆ°æ›´å¤šçš„æŠ€æœ¯æ€§é”™è¯¯ä¿¡æ¯; err.description()ä»¥&amp;stræ–¹å¼è¿”å›é”™è¯¯ä¿¡æ¯; err.cause()è¿”å›Option&lt;&amp;Error&gt;: å†…éƒ¨é”™è¯¯è¯¦ç»†ä¿¡æ¯. ç”¨ ?å‘ä¸ŠæŠ›å‡ºErr, åªèƒ½ç”¨äºè¿”å›Resultçš„å‡½æ•° errorchaincrate å¯ä»¥ç”¨äºå®šä¹‰error type, æ–¹ä¾¿ ?æŠ›å‡ºä¸åŒç±»å‹Err Custom Error Type é€šå¸¸ç›´æ¥å®šä¹‰é”™è¯¯ä¿¡æ¯ç»“æ„ä½“, ç„¶åç”¨Err()æŠ›å‡ºå°±å¤Ÿäº† 12345678#[derive(Debug, Clone)]pub struct JsonError &#123; pub message: String, pub line: usize, pub column: usize,&#125;return Err(JsonError &#123;...&#125;); å¦‚æœå¸Œæœ›å’Œæ ‡å‡†åº“çš„é”™è¯¯ç±»å‹è¡¨ç°ä¸€è‡´, è¿˜éœ€è¦å®šä¹‰fmt::Displayå’ŒErrorçš„trait. 12345678910111213141516use std;use std::fmt;// Errors should be printableimple fmt::Display for JsonError &#123; fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; Result&lt;(), fmt::Error&gt; &#123; write!(f, &quot;&#123;&#125; (&#123;&#125;:&#123;&#125;)&quot;, self.message, self.line, self.column); &#125;&#125;// Errors should implement the std::error::Error trait.impl std::error::Error for JsonError &#123; fn description(&amp;self) -&gt; &amp;str &#123; &amp;self.message &#125;&#125;","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Error Handling","slug":"Error-Handling","permalink":"https://unpluggedcoder.me/tags/Error-Handling/"},{"name":"Result","slug":"Result","permalink":"https://unpluggedcoder.me/tags/Result/"},{"name":"painc","slug":"painc","permalink":"https://unpluggedcoder.me/tags/painc/"},{"name":"Option","slug":"Option","permalink":"https://unpluggedcoder.me/tags/Option/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Reference","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Reference","date":"2019-08-19T15:23:30.000Z","updated":"2022-09-15T15:51:05.349Z","comments":true,"path":"2019/08/19/Rustå…¥é—¨å¤±è´¥ä¹‹Reference/","link":"","permalink":"https://unpluggedcoder.me/2019/08/19/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BReference/","excerpt":"","text":"Referenceå®é™…åªæ˜¯ä¸€ä¸ªåœ°å€ å¼•ç”¨ä¸å½±å“æ‰€å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ References must never outlive their referents. å¼•ç”¨ç”Ÿå‘½å‘¨æœŸä¸å¾—è¶…è¿‡æ‰€å¼•ç”¨å€¼. Shared Reference å¯ä»¥æœ‰å¤šä¸ªå…±äº«å¼•ç”¨ ä¸€æ—¦æœ‰shared reference, è¢«å¼•ç”¨çš„Ownerå˜æˆåªè¯», ä¸èƒ½ä¿®æ”¹å’Œmove. shared referenceå¯ä»¥ Copy Mutable Reference ä¸€æ—¦æœ‰å¯å˜å¼•ç”¨, é™¤äº†å¯å˜å¼•ç”¨è¡ç”Ÿå‡ºçš„å¼•ç”¨, ä¸èƒ½æœ‰å…¶å®ƒä»»ä½•å½¢å¼çš„å¼•ç”¨è®¿é—®å’Œä¿®æ”¹, ç›´åˆ°å¯å˜å¼•ç”¨é”€æ¯ mutable referenceä¸å¯ Copy å¼•ç”¨è§„åˆ™åˆ¤æ–­æ ‡å‡† å¼•ç”¨ç±»å‹å˜é‡ä¸å¾—è¶…è¿‡Ownerç”Ÿå­˜æœŸâ€”â€”å¼•ç”¨å˜é‡ç”Ÿå‘½å‘¨æœŸçš„ä¸Šé™ å­˜å‚¨äº†å¼•ç”¨çš„å˜é‡å…¶å¼•ç”¨çš„Ownerç”Ÿå‘½å‘¨æœŸå¿…é¡»è‡³å°‘æ¶µç›–åˆ°å˜é‡çš„ç”Ÿå‘½å‘¨æœŸâ€”â€”Ownerç”Ÿå‘½å‘¨æœŸçš„ä¸‹é™ ä¸Šé™è‡³å°‘åŒ…å«ä¸‹é™æ‰ç¬¦åˆè§„åˆ™! ä¾‹å¦‚: 12345678&#123; let r; &#123; let x = 1; r = &amp;x; &#125; assert_eq!(*r, 1); // bad: reads memory `x` used to occupy&#125; xçš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹: è€Œå˜é‡ rçš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹: ä¸Šé™æœªåŒ…å«ä¸‹é™, å› æ­¤ä¸æ»¡è¶³. æŠŠræ”¾å…¥å†…éƒ¨, OK Staticå¼•ç”¨ æ‰€æœ‰é™æ€çš„æ•°æ®éƒ½å¿…é¡»è¢«åˆå§‹åŒ– å¯å˜çš„é™æ€å¼•ç”¨(Mutable statics)é»˜è®¤éƒ½éçº¿ç¨‹å®‰å…¨, åªèƒ½åœ¨unsafe blockå†…è®¿é—®å¯å˜çš„é™æ€å¼•ç”¨ 1234567static mut STASH: &amp;i32 = &amp;10;fn f(p: &amp;&#x27;static i32) &#123; unsafe &#123; STASH = p; &#125;&#125; åŒ…å«å¼•ç”¨çš„å¤åˆç±»å‹ åŒ…å«å¼•ç”¨çš„å¤åˆç±»å‹(å¦‚struct)å¿…é¡»å£°æ˜å…¶ç”Ÿå‘½å‘¨æœŸ 1234567struct T&lt;&#x27;a&gt; &#123; s: S&lt;&#x27;a&gt;&#125;// orstruct T &#123; s: S&lt;&#x27;static&gt;&#125; selfçš„æ–¹æ³•å¦‚æœè¿”å›å¼•ç”¨, é»˜è®¤ä¸selfæ˜¯ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ All images are copyrighted by original authors Jim Blandy &amp; Jason Orendorff who wrote in the book Programming Rust.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Ownership","slug":"Ownership","permalink":"https://unpluggedcoder.me/tags/Ownership/"},{"name":"Reference","slug":"Reference","permalink":"https://unpluggedcoder.me/tags/Reference/"},{"name":"Shared Reference","slug":"Shared-Reference","permalink":"https://unpluggedcoder.me/tags/Shared-Reference/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹Ownership","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹Ownership","date":"2019-08-14T16:55:30.000Z","updated":"2022-09-15T15:51:05.348Z","comments":true,"path":"2019/08/15/Rustå…¥é—¨å¤±è´¥ä¹‹Ownership/","link":"","permalink":"https://unpluggedcoder.me/2019/08/15/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8BOwnership/","excerpt":"","text":"Rule No.1OwnershipèƒŒåå…¨éƒ½å›´ç»•è¿™ä¸‹é¢è¿™ä¸€å”¯ä¸€è§„åˆ™: Every value has a single owner that determines its lifetime. æ¯ä¸ªå€¼åªæœ‰ä¸€ä¸ªæ‹¥æœ‰è€…å¯ä»¥å†³å®šå®ƒçš„ç”Ÿå‘½å‘¨æœŸ. ä¹Ÿå°±æ˜¯è¯´: Owneré”€æ¯(dropped), å€¼ä¹Ÿé”€æ¯. æ•´ä¸ªç¨‹åºçš„æ•°æ®åƒä¸€ä¸ªOwnership TreeğŸŒ² Copy &amp; MoveéCopy types åœ¨èµ‹å€¼ã€ä¼ å‚å’Œè¿”å›æ—¶ç§»åŠ¨(Move)å…¶æ‰€æœ‰æƒ, åŸå˜é‡ä¸å¯å¼•ç”¨. Copy typeåˆ¤æ–­æ ‡å‡†: æ‰€æœ‰åœ¨é”€æ¯(dropped)æ—¶éœ€è¦åšäº›ç‰¹æ®Šå¤„ç†æ“ä½œ(é‡Šæ”¾å †ä¸Šå†…å­˜æˆ–å…¶å®ƒç±»å‹èµ„æº)çš„ç±»å‹, å‡ä¸ºä¸å¯æ‹·è´. ä¾‹å¦‚: String Box&lt;T&gt; File æ–‡ä»¶ç±»å‹ Mutex&lt;T&gt; ç®€å•æ•°å­—ç±»å‹éƒ½å®ç°äº†Copy Trait, èµ‹å€¼æ‹·è´æ—¶ç›´æ¥åœ¨æ ˆä¸Šç”Ÿæˆä¸€ä»½æ‹·è´. 12345let str1 = &quot;somnambulance&quot;.to_string();let str2 = str1;let num1: i32 = 36;let num2 = num1; å¯¹äºæœ‰æŒ‡å‘heapæ•°æ®çš„æ•°æ®ç±»å‹(åŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹)ä¸å…è®¸å®ç°è‡ªå®šä¹‰Copy trait. å¦‚æœè¦å…è®¸ç§»é™¤(Move)ä¸€äº›è¢«ç´¢å¼•çš„å†…å®¹, ä¾‹å¦‚ Vec&lt;String&gt; å¯ä»¥ç”¨Option&lt;T&gt;, è¢«Moveå, åŸå…ˆçš„å€¼ä¸ºNone. 123let s = vec![&quot;udon&quot;.to_string(), &quot;ramen&quot;.to_string(), &quot;soba&quot;.to_string()];let t = s;let u = s; // error[E0382]: use of moved value: `s` æ‰§è¡Œä¸Šé¢ç¬¬ä¸€è¯­å¥å, å†…å­˜å¸ƒå±€å¦‚ä¸‹: èµ‹å€¼ç»™tå, å†…å­˜å¸ƒå±€å¦‚ä¸‹: å†ä½¿ç”¨sèµ‹å€¼å°±æŠ¥é”™äº†, så·²ç»æ˜¯uninitializedçŠ¶æ€. Box&lt;T&gt; ç®€å•çš„æŒ‡å‘å †æ ˆä¸Šæ•°æ®çš„æŒ‡é’ˆ:let b = Box:new(int); èµ‹å€¼MoveåŸæŒ‡é’ˆæ‰€æœ‰æƒ å¯ä»¥ç”¨äºé€’å½’ç±»å‹æˆ–åœ¨ç¼–è¯‘æ—¶æœŸæ— æ³•è®¡ç®—å¯¹è±¡å¤§å°çš„åœºæ™¯ 12345&#123; let point = Box::new((0.625, 0.5)); // point allocated here let label = format!(&quot;&#123;:?&#125;&quot;, point); // label allocated here assert_eq!(label, &quot;(0.625, 0.5)&quot;);&#125; // both dropped here å†…å­˜å¸ƒå±€å¦‚ä¸‹: Rc and Arc: Shared Ownership æœ‰æ—¶å€™å¾ˆéš¾æ»¡è¶³æ•°æ®åªæœ‰ä¸€ä¸ªOwner, å› æ­¤å¼•å…¥å…±äº«æ‰€æœ‰æƒ, å…è®¸å¤šä¸ªå¼•ç”¨.å˜é‡åœ¨æ ˆä¸Šå®é™…åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆ, æŒ‡å‘å †ä¸Šä¸€ä¸ªç»´æŠ¤å¼•ç”¨è®¡æ•°åŠå­˜æ”¾å®é™…æ•°æ®ç±»å‹çš„å†…å­˜.âš ï¸è¿™é‡Œå¹¶æ²¡æœ‰è¿åå‰é¢çš„ç¬¬ä¸€æ¡åŸåˆ™, å› ä¸ºå†³å®šå®é™…æ•°æ®ç”Ÿå‘½å‘¨æœŸçš„Owneræ˜¯è¿™ä¸ªRc&#x2F;Arcæœ¬èº«. å½“æœ€åä¸€ä¸ªå¼•ç”¨dropped, æ•´ä¸ªæ•°æ®é‡Šæ”¾. å…±äº«çš„å¼•ç”¨éƒ½æ˜¯immutable, ä¸å¯ä¿®æ”¹å…±äº«æ•°æ®. å¾ªç¯å¼•ç”¨ä¼šé€ æˆæ­»é”, è¿™æ˜¯Rustå¯èƒ½å†…å­˜æ³„éœ²çš„ä¸€ç‚¹. è¦é¿å…å¯ä»¥ä½¿ç”¨ std::rc::Weak 12345let s: Rc&lt;String&gt; = Rc::new(&quot;shirataki&quot;.to_string());let t: Rc&lt;String&gt; = s.clone();let u: Rc&lt;String&gt; = s.clone();s.push_str(&quot; noodles&quot;); // error: cannot borrow immutable borrowed content as mutable clone()åå†…å­˜å¸ƒå±€å¦‚ä¸‹: äºŒè€…å·®å¼‚(ä»…æ­¤è€Œå·²): Rc&lt;T&gt; éçº¿ç¨‹å®‰å…¨è®¡æ•°å¼•ç”¨ Arc&lt;T&gt; çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å¼•ç”¨, short for Atomic Reference Count All images are copyrighted by original authors Jim Blandy &amp; Jason Orendorff who wrote in the book Programming Rust.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Ownership","slug":"Ownership","permalink":"https://unpluggedcoder.me/tags/Ownership/"},{"name":"Box","slug":"Box","permalink":"https://unpluggedcoder.me/tags/Box/"},{"name":"Rc","slug":"Rc","permalink":"https://unpluggedcoder.me/tags/Rc/"},{"name":"Arc","slug":"Arc","permalink":"https://unpluggedcoder.me/tags/Arc/"}]},{"title":"Rustå…¥é—¨å¤±è´¥ä¹‹åŸºç¡€æ•°æ®ç±»å‹","slug":"Rustå…¥é—¨å¤±è´¥ä¹‹åŸºç¡€æ•°æ®ç±»å‹","date":"2019-08-13T16:43:30.000Z","updated":"2022-09-15T15:51:05.350Z","comments":true,"path":"2019/08/14/Rustå…¥é—¨å¤±è´¥ä¹‹åŸºç¡€æ•°æ®ç±»å‹/","link":"","permalink":"https://unpluggedcoder.me/2019/08/14/Rust%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5%E4%B9%8B%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/","excerpt":"","text":"åŠä¸ªæœˆå‰çœ‹å®Œäº†ã€ŠThe Rust Programming Languageã€‹, ä½†æ˜¯ä»ç„¶æ„Ÿè§‰è‡ªå·±å¯¹Rustè¿˜æ˜¯ä¸€çŸ¥åŠè§£, å…¥é—¨å¤±è´¥. éšåå¼€å§‹çœ‹ã€ŠProgramming rustã€‹å½±å°ç‰ˆ, æ„Ÿè§‰è¿™æœ¬ä¹¦è®²å¾—æ›´å¥½, ä½œè€…ç”¨äº†å¾ˆå¤šå›¾æ¥è§£é‡Š, è¿™æœ¬ä¹¦ä¹Ÿæ˜¯ä¸€æœ¬å·¨åšçš„å‚è€ƒä¹¦ç±»å‹, ç›®å‰å•ƒäº†ä¸€åŠ. so, æŠŠä¹‹å‰çš„ä¸€äº›è¯»ä¹¦ç¬”è®°è®°ä¸‹æ¥, ä¸€æ–¹é¢æŠŠä¹¦è¯»è–„, ä¸€æ–¹é¢ç®—æ˜¯Rustçš„å…¥é—¨å¤±è´¥ç¬”è®°. è¿™ç³»åˆ—ä¸»è¦é¢å‘æœ‰Rustå…¥é—¨å¤±è´¥ç»å†çš„å¼€å‘äººå‘˜, åªåˆ—å‡ºä¸ªäººè§‰å¾—é‡è¦çš„ä¸œè¥¿. bool ä¼šå ä¸€ä¸ªå­—èŠ‚, ä»è€Œå…è®¸æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå­—èŠ‚çš„åœ°å€. numeric ä¸å…è®¸éšå¼è½¬æ¢ å¦‚æœéœ€è¦è°ƒç”¨ç±»å‹çš„æ–¹æ³•, åœ¨æœ‰äºŒæ„çš„æƒ…å†µä¸‹å¿…é¡»æ˜¾å¼è½¬æ¢, ä¾‹å¦‚åŠ åç¼€: (2.0_f64).sqrt() bool, char, enum å¯ä»¥è½¬æ¢ä¸ºä»»æ„æ•´å‹integer, ä½†åå‘è½¬æ¢ä¸è¡Œ, å”¯ä¸€ä¾‹å¤–æ˜¯u8è½¬char char å¤§å°32bit UNICODEç¼–ç  ä¸å…è®¸ä»»ä½•å½¢å¼çš„éšå¼è½¬æ¢ u8æ˜¯å…è®¸ as è½¬æ¢ä¸ºcharçš„å”¯ä¸€å½¢å¼ String ä¸æ˜¯charæ•°ç»„, è€Œæ˜¯UTF-8å˜é•¿åºåˆ— ASCIIå­—ç¬¦å ä¸€ä¸ªå­—èŠ‚, å…¶ä½™å­—ç¬¦å å¤šä¸ªä¸å®šé•¿å­—èŠ‚. len()æ–¹æ³•è¿”å›çš„æ˜¯å­—èŠ‚é•¿åº¦, è€Œéå­—ç¬¦é•¿åº¦ chars().count()è¿”å›å­—ç¬¦é•¿åº¦ ä¸€ä¸ªæ ˆä¸Šçš„Stringå˜é‡åœ¨å†…å­˜ä¸­è¡¨ç¤ºå¦‚ä¸‹: array, vector, slices ä¸‹æ ‡å¼•ç”¨[i]åªèƒ½ç”¨usizeç±»å‹ ä¸€ä¸ªæ ˆä¸Šçš„vectorå˜é‡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¦‚ä¸‹:12345678fn print_padovan() &#123; let mut padovan = vec![1,1,1]; // allocated here for i in 3..10 &#123; let next = padovan[i-3] + padovan[i-2]; padovan.push(next); &#125; println!(&quot;P(1..10) = &#123;:?&#125;&quot;, padovan);&#125; // dropped here All images are copyrighted by original authors Jim Blandy &amp; Jason Orendorff who wrote the book Programming Rust.","categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"}]},{"title":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","date":"2019-07-30T15:43:30.000Z","updated":"2022-09-15T15:51:05.352Z","comments":true,"path":"2019/07/30/å…¬ä¼—å·/","link":"","permalink":"https://unpluggedcoder.me/2019/07/30/%E5%85%AC%E4%BC%97%E5%8F%B7/","excerpt":"","text":"ä¹‹å‰ä¸€ç›´æ–­æ–­ç»­ç»­æŠ˜è…¾çš„å…¬ä¼—å·ä»Šå¤©æ”¹åæˆè‡ªå·±çš„ç½‘ç»œIDï¼šä¸æ’ç”µç å†œã€‚çº¯ç²¹çèŠï¼Œæ¬¢è¿æ‰«(qiÃ¡ng)ç (liÃ¨)å…³æ³¨ã€‚","categories":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"}],"tags":[]},{"title":"5åˆ†é’Ÿè¯»æ‡‚ã€Šå¯Œäººæ€ç»´ã€‹","slug":"5åˆ†é’Ÿè¯»æ‡‚ã€Šå¯Œäººæ€ç»´ã€‹","date":"2019-06-02T13:03:30.000Z","updated":"2022-09-20T15:48:52.272Z","comments":true,"path":"2019/06/02/5åˆ†é’Ÿè¯»æ‡‚ã€Šå¯Œäººæ€ç»´ã€‹/","link":"","permalink":"https://unpluggedcoder.me/2019/06/02/5%E5%88%86%E9%92%9F%E8%AF%BB%E6%87%82%E3%80%8A%E5%AF%8C%E4%BA%BA%E6%80%9D%E7%BB%B4%E3%80%8B/","excerpt":"ã€Šå¯Œäººæ€ç»´ã€‹ ä½œè€…ï¼šè´¾æ£®Â·å¡æ‹‰å¡å°¼æ–¯ï¼ˆJason Calacanisï¼‰ ä¹¦åä¸å…¶è¯´æ˜¯å¯Œäººæ€ç»´ï¼Œ ä¸å¦‚è¯´æ˜¯ï¼ˆå¤©ä½¿ï¼‰æŠ•èµ„äººæ€ç»´ã€‚ å› ä¸ºä½œè€…æ˜¯Uberçš„å¤©ä½¿æŠ•èµ„äººï¼Œé€šè¿‡åœ¨å¤©ä½¿è½®æŠ•èµ„äº†Uberï¼Œç„¶åèµšäº†ä¸€å¤§ç¬”ã€‚äººç”ŸæŠ“ä½è¿™æ ·ä¸€æ¬¡çš„æŠ•èµ„å°±è¶³å¤Ÿäº†ã€‚","text":"ã€Šå¯Œäººæ€ç»´ã€‹ ä½œè€…ï¼šè´¾æ£®Â·å¡æ‹‰å¡å°¼æ–¯ï¼ˆJason Calacanisï¼‰ ä¹¦åä¸å…¶è¯´æ˜¯å¯Œäººæ€ç»´ï¼Œ ä¸å¦‚è¯´æ˜¯ï¼ˆå¤©ä½¿ï¼‰æŠ•èµ„äººæ€ç»´ã€‚ å› ä¸ºä½œè€…æ˜¯Uberçš„å¤©ä½¿æŠ•èµ„äººï¼Œé€šè¿‡åœ¨å¤©ä½¿è½®æŠ•èµ„äº†Uberï¼Œç„¶åèµšäº†ä¸€å¤§ç¬”ã€‚äººç”ŸæŠ“ä½è¿™æ ·ä¸€æ¬¡çš„æŠ•èµ„å°±è¶³å¤Ÿäº†ã€‚ ä½œè€…ä¸»è¦å›´ç»•çš„æ˜¯å¤©ä½¿æŠ•èµ„è¿™ä»¶äº‹ï¼Œä»¥æˆ‘çš„ç†è§£å¤§æ¦‚è®²äº†å‡ ä»¶äº‹æƒ…ï¼š å¤©ä½¿æŠ•èµ„äººçš„ç‰¹è´¨â€œæœ€å¥½çš„å¤©ä½¿æŠ•èµ„äººå…·å¤‡å››ç§èƒ½åŠ›ï¼šï¼ˆ1ï¼‰èƒ½å¤Ÿå‡ºå¾—èµ·é’±ï¼›ï¼ˆ2ï¼‰åœ¨é‡è¦é—®é¢˜ä¸Šèƒ½ä¸åˆ›å§‹äººå…±è¿›é€€ï¼›ï¼ˆ3ï¼‰èƒ½å¤ŸæŠŠå…¬å¸ä»‹ç»ç»™å®¢æˆ·å’ŒæŠ•èµ„äººï¼›ï¼ˆ4ï¼‰èƒ½å¤Ÿä¸ºå…¬å¸æä¾›å¯è¡Œçš„å»ºè®®æ¥èŠ‚çœåˆ›å§‹äººçš„æ—¶é—´ä»¥åŠèµ„é‡‘ï¼Œæˆ–è€…èƒ½è®©ä»–ä»¬å…äºçŠ¯é”™ã€‚â€ç®€å•çš„è¯´ï¼šæœ‰é’±ã€æœ‰äººè„‰ã€æœ‰ç»éªŒå’Œæœ‰æƒ³æ³•ï¼Œå…¶ä¸­èƒŒåéšå«ä¸€ä¸ªç‰¹è´¨è¦æ±‚ï¼Œè¦æ„¿æ„ç¤¾äº¤ã€‚ ç¬¬äºŒéƒ¨åˆ†è¯´äº†åˆ›ä¸šèèµ„çš„ä¸€ä¸ªæµç¨‹ï¼Œ å¤§æ¦‚å°±æ˜¯å¤©ä½¿æŠ•èµ„ -&gt; é£é™©æŠ•èµ„ -&gt; ä¸Šå¸‚èèµ„ä¹‹ç±»ï¼Œå¤©ä½¿æŠ•èµ„äººä¸€èˆ¬åœ¨é£é™©æŠ•èµ„äººæ¥ç›˜çš„æ—¶å€™é€€å‡ºï¼Œèµšåˆ°ä¸€å¤§æ³¢ï¼Œå½“ç„¶ä¹Ÿæœ‰å¤©ä½¿æŠ•èµ„äººè·ŸæŠ•åˆ°ä¸Šå¸‚ï¼Œä½†æ˜¯å¦‚æœåšæŒä¸‹å»ï¼Œé£é™©å°±æ›´å¤§ï¼Œè€Œä¸”é€šå¸¸é£é™©æŠ•èµ„äººä»‹å…¥çš„æ—¶å€™å¤©ä½¿æŠ•èµ„äººçš„è‚¡ä»½å°±è¢«ç¨€é‡Šäº†ã€‚ ç¬¬ä¸‰éƒ¨åˆ†è¯´å…¶å®æ²¡é’±ä¹Ÿå¯ä»¥æå¤©ä½¿æŠ•èµ„ï¼Œæ™®é€šå±æ°‘å¦‚æœæœ‰ç‚¹å°é’±ä¹Ÿå¯ä»¥å‚ä¸åˆ°å¤©ä½¿æŠ•èµ„ä¸­ï¼Œä½†æ˜¯ç›¸æ¯”ç†è´¢å’Œè‚¡ç¥¨ï¼Œè¿™ç®€ç›´å°±æ˜¯æœ€é«˜é£é™©ï¼ˆåšå¥½æ‰“æ°´æ¼‚çš„å‡†å¤‡ï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬äººè¦ç©æœ€å¥½åªæ‹¿ä¸€å°éƒ¨åˆ†èµ„é‡‘ç©ã€‚ç¾å›½æœ‰ä¸€ç§å«è”åˆæŠ•èµ„ç»„ç»‡ï¼Œå°±æ˜¯ç±»ä¼¼ä¼—ç­¹çš„ç½‘ç«™ï¼ˆå›½å†…ä¹Ÿæœ‰ï¼‰ï¼Œåˆ›ä¸šå…¬å¸å¯ä»¥åœ¨ä¸Šé¢å‘å¸ƒé¡¹ç›®ï¼Œæ™®é€šäººå¯ä»¥æŠ•èµ„ï¼Œç„¶åç”±ä¸€ä¸ªè”åˆæŠ•èµ„ä»£è¡¨æ‹¿ç€è¿™ç¬”é’±å‡‘æ¬¾ï¼Œå……å½“ä¸€ä¸ªå¤©ä½¿æŠ•èµ„äººï¼Œè´Ÿè´£ä»£è¡¨æ‰€æœ‰æ™®é€šæŠ•èµ„è€…çš„æƒç›Šï¼Œç­¾è®¢åˆåŒä¹‹ç±»çš„ã€‚åˆ›å§‹äººä¹Ÿè¦åƒè”åˆæŠ•èµ„å§”å‘˜ä¼šæ±‡æŠ¥ã€‚ä½œä¸ºå±æ°‘ï¼Œå¦‚æœä½ å‡ºé’±äº†ï¼Œæœ€å¥½ä¹ŸèŠ±ç‚¹å¿ƒæ€ï¼ŒæŠŠè‡ªå·±å½“å¤©ä½¿æŠ•èµ„äººå¤šå…³å¿ƒä¸‹è‡ªå·±æŠ•çš„åˆ›ä¸šå…¬å¸ï¼Œå¦‚æœèƒ½æ‰¶æŒæœ€å¥½ã€‚ æœ€åä¸€éƒ¨åˆ†å…¶å®æ„Ÿè§‰å°±æ˜¯æ•™ä½ æ€ä¹ˆé€‰é è°±çš„åˆ›å§‹äººï¼Œè¿™é‡Œæ²¡æœ‰è¯´ä»»ä½•çš„è¡Œä¸šï¼Œå› ä¸ºé“ç†å¤§å®¶éƒ½æ‡‚ï¼ŒæŠ•çš„æ˜¯äººè€Œä¸æ˜¯äº‹ï¼Œâ€œäººå¹¶ä¸ä»£è¡¨ä¸€åˆ‡ï¼Œå´æ˜¯å”¯ä¸€çš„è¯„åˆ¤æ ‡å‡†â€ã€‚éœ€è¦é—®åˆ›ä¸šè€…çš„å››ä¸ªé—®é¢˜ï¼šâ€œ1.è¯¥åˆ›ä¸šè€…ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªé¡¹ç›®ï¼Ÿ2.è¯¥åˆ›ä¸šè€…çš„æŠ•å…¥ç¨‹åº¦å¦‚ä½•ï¼Ÿ3.è¯¥åˆ›ä¸šè€…åœ¨è¿™ä¸ªé¡¹ç›®ä»¥åŠç”Ÿæ´»ä¸­å…·å¤‡å“ªäº›æˆåŠŸçš„æ¡ä»¶ï¼Ÿ4.æˆ‘çš„å›æŠ¥æœ‰å¤šå°‘ï¼Ÿâ€ç­‰ç­‰ä¹‹ç±»çš„è€ƒæ ¸ï¼Œä»¥åŠè°ˆäº†å¾ˆå¤šåˆ›ä¸šè€…éœ€è¦å…·å¤‡çš„ç‰¹è´¨ï¼Œè¿™äº›å†…å®¹åœ¨å…¶å®ƒå¾ˆå¤šçš„åˆ›ä¸šä¹¦ç±é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå°±ä¸ä¸€ä¸€åˆ—å‡ºã€‚ä½†æ˜¯å¯¹å¤©ä½¿æŠ•èµ„äººæ¥è¯´ï¼Œä½œè€…åå¤æåˆ°äº†ä¸€ä¸ªå…³é”®è¯â€œåŒæ¯”ä¾‹è·ŸæŠ•æƒâ€ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„åˆ°äº†é£é™©æŠ•èµ„é˜¶æ®µï¼Œåˆ›å§‹äººåº”è¯¥ç»™å¤©ä½¿æŠ•èµ„äººä¼˜å…ˆçš„åŒæ¯”ä¾‹è·ŸæŠ•æƒï¼Œè€Œå¤©ä½¿æŠ•èµ„äººåˆ™å¯ä»¥é€‰æ‹©åŠ ç æŠ•èµ„ï¼Œä¿éšœå¤©ä½¿æŠ•èµ„äººçš„å æ¯”ä¸ä¼šè¢«ç¨€é‡Šã€‚å¦‚æœå¯¹å¤©ä½¿æŠ•èµ„äººéƒ½åšä¸åˆ°è¿™ç‚¹çš„åˆ›å§‹äººï¼Œé‚£å¯ä»¥è®¤å®šä¸ºäººå“æœ‰é—®é¢˜ï¼Œä¸å€¼å¾—æŠ•èµ„ã€‚æœ€å¥½æŠŠè¿™ä¸ªå†™è¿›å¤©ä½¿æŠ•èµ„çš„åè®®é‡Œã€‚ è™½ç„¶ä¹¦åæœ‰äº›è¯¯å¯¼ï¼Œä½†æ˜¯ä¹Ÿç®—æ˜¯äº†è§£åˆ°äº†åˆ›å§‹äººå’Œå¤©ä½¿æŠ•èµ„çš„ä¸¤ç§è§’è‰²çš„ä¸€äº›çŸ¥è¯†ï¼Œå¼¥è¡¥äº†è¿™æ–¹é¢çŸ¥è¯†çš„ç©ºç™½ã€‚","categories":[{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"}],"tags":[{"name":"å¯Œäººæ€ç»´","slug":"å¯Œäººæ€ç»´","permalink":"https://unpluggedcoder.me/tags/%E5%AF%8C%E4%BA%BA%E6%80%9D%E7%BB%B4/"}]},{"title":"[è¯‘]è½¯ä»¶æ€§èƒ½ä»ç„¶é‡è¦å—ï¼Ÿ","slug":"[è¯‘]è½¯ä»¶æ€§èƒ½ä»ç„¶é‡è¦å—ï¼Ÿ","date":"2019-03-27T15:03:30.000Z","updated":"2022-09-15T15:51:05.351Z","comments":true,"path":"2019/03/27/[è¯‘]è½¯ä»¶æ€§èƒ½ä»ç„¶é‡è¦å—ï¼Ÿ/","link":"","permalink":"https://unpluggedcoder.me/2019/03/27/[%E8%AF%91]%E8%BD%AF%E4%BB%B6%E6%80%A7%E8%83%BD%E4%BB%8D%E7%84%B6%E9%87%8D%E8%A6%81%E5%90%97%EF%BC%9F/","excerpt":"","text":"æœ¬æ–‡ç”±Daniel Lemireå‘è¡¨äº2017&#x2F;03&#x2F;20, åŸæ–‡é“¾æ¥åœ¨æ­¤ã€‚ ä»Šå¤©æ—©ä¸Šï¼Œä¸€ä½è¯»è€…è¯·æ•™æˆ‘å…³äºç°å®ä¸–ç•Œé‡Œè½¯ä»¶æ€§èƒ½çš„è¯é¢˜ï¼š æˆ‘å¯¹ä½ åˆ©ç”¨è®¡ç®—æœºæ¶æ„ç›¸å…³æŠ€æœ¯æ¥ä¼˜åŒ–ç®—æ³•æ€§èƒ½çš„å·¥ä½œå¾ˆæ„Ÿå…´è¶£ã€‚ç„¶è€Œï¼Œæˆ‘è§‰å¾—è¿™ç§ä¸œè¥¿åªæœ‰å­¦æœ¯ç•Œæ¯”è¾ƒæ„Ÿå…´è¶£ã€‚ä½ è§‰å¾—è¿™ç§ç‰¹æ®Šçš„é¢†åŸŸæœ‰ä»€ä¹ˆå°±ä¸šæœºä¼šå—ï¼Ÿ ç”¨è¿™ä½è¯»è€…çš„è¯æ¥è¯´ï¼Œè®¡ç®—æœºå’Œè½¯ä»¶å·²ç»å¤Ÿå¿«äº†ã€‚æˆ‘ä»¬å¯èƒ½æ›´éœ€è¦äººä»¬å»å®ç°æ–°çš„åˆ›æ„ï¼Œè€Œæ€§èƒ½å¹¶ä¸é‡è¦ã€‚æ›´æœ‰ç”šè€…è¯´ï¼Œå¦‚æœæƒ³è¦å¾—åˆ°é«˜é…¬åŠ³çš„å·¥ä½œï¼Œå°±ä¸éœ€è¦å…³å¿ƒè½¯ä»¶æ€§èƒ½ã€‚ è¦è¯„ä»·è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»å°±â€œè½¯ä»¶æ€§èƒ½åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿâ€è¾¾æˆå…±è¯†ã€‚è½¯ä»¶æ€§èƒ½å¹¶ä¸æ˜¯è¯´ä½ èƒ½å¤Ÿå¤šå¿«åœ°å¤„ç†ä¸€å †æ•°å­—ã€‚åº”è¯¥æ˜¯ä½ å¦‚ä½•ç®¡ç†å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå’ŒCPUç­‰â€¦è¿™è¿˜å…³ç³»åˆ°æ•´ä¸ªæ¶æ„ã€‚ä¹Ÿå¹¶ä¸æ˜¯è¦æ±‚ç”¨æœºå™¨ç å»é‡å†™ä½ çš„ä»£ç ï¼š ä½ å¯ä»¥ç”¨ JavaScript å»å†™å¿«é€Ÿåº”ç”¨éƒ¨åˆ†ï¼Œç”¨ C++ å»å†™è¿è¡Œæ…¢é€Ÿçš„é‚£éƒ¨åˆ†ã€‚è½¯ä»¶æ€§èƒ½å’Œè®¾è®¡ç®—æ³•æœ‰å…³ï¼Œä½†æ˜¯åˆæœ‰ä¸€ç‚¹å¾ˆé‡è¦çš„åŒºåˆ«ï¼šä½ å¿…é¡»æŠŠä½ çš„æ¶æ„è€ƒè™‘åœ¨å†…ã€‚å¾ˆå¤šç®—æ³•åœ¨ç†è®ºä¸Šçœ‹ä¸Šå»å¾ˆä¼˜ç§€ï¼Œä½†æ˜¯å®é™…è¿è¡Œèµ·æ¥æ€§èƒ½å¾ˆæ¸£ã€‚è€Œé‚£äº›çœ‹ä¸Šå»å¾ˆå‚»å¾ˆå¤©çœŸçš„ç®—æ³•æœ‰æ—¶å€™å´æ˜¯æ€§èƒ½çš„æœ€ä½³é€‰æ‹©ã€‚æŸç§å±‚é¢ä¸Šæ¥è¯´ï¼ŒæŒæ¡è½¯ä»¶æ€§èƒ½å®é™…ä¸Šè¦æ±‚ä½ å¯¹è®¡ç®—æœºç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿå’Œè¿è¡Œæ—¶åº“å¦‚ä½•å·¥ä½œæœ‰éå¸¸æ·±åˆ»çš„ç†è§£ï¼Œ So, éƒ½7102å¹´äº†ï¼Œæˆ‘ä»¬è¿˜è¦careè½¯ä»¶æ€§èƒ½ä¹ˆï¼Ÿ æˆ‘çš„ç®€å•å›ç­”æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬è¯„ä»·ä¸€ä¸ªç¨‹åºå‘˜çš„ä¸¤ä¸ªåŸºæœ¬ç‚¹æ˜¯ï¼šä½ å†™çš„ä»£ç æ˜¯å¦æ­£ç¡®è¿è¡Œï¼Ÿä½ å†™çš„ä»£ç æ˜¯å¦é«˜æ•ˆï¼Ÿå½“ç„¶ç¨‹åºå‘˜è¿˜æœ‰å…¶å®ƒçš„æ–¹å¼è´¡çŒ®ä»·å€¼ï¼šæ¯”å¦‚è¯´åˆ©ç”¨æŸäº›ä¸šåŠ¡é¢†åŸŸçš„ç»éªŒåˆ›é€ ä»·å€¼æˆ–è€…è®¾è®¡å‡ºæƒŠè‰³çš„UIç•Œé¢ã€‚ç„¶è€Œï¼Œåœ¨ç¡¬æ ¸ç¼–ç¨‹éƒ¨åˆ†ï¼Œå‡†ç¡®å’Œé«˜æ•ˆæ˜¯ä¸¤ä¸ªä¸»è¦çš„å› ç´ ã€‚ çœ‹çœ‹ä¼Ÿå¤§çš„ç¨‹åºå‘˜æ˜¯æ€æ ·çš„ã€‚ä»–ä»¬å¾ˆæ“…é•¿ç¼–å†™å³æ­£ç¡®åˆé«˜æ•ˆçš„è½¯ä»¶ã€‚å®é™…ä¸Šè¿™å°±æ˜¯ä¸€ä¸ªä¼Ÿå¤§ç¨‹åºå‘˜çš„å®šä¹‰ã€‚å½“ä½ åŒæ—¶åšåˆ°å‡†ç¡®å’Œé«˜æ•ˆæ—¶ç¼–ç¨‹æ‰æ˜¯ä¸€ä»¶æœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…ã€‚å¦‚æœå…è®¸ä½ å»ç‰ºç‰²ä»»ä½•ä¸€ä¸ªï¼Œé‚£ä½ å¯ä»¥å»è§£å†³è®¸å¤šçš„ä»»åŠ¡äº†ã€‚ åœ¨æ‹›è˜çš„æè¿°é‡Œï¼Œä½ å¯èƒ½ä¸ä¼šçœ‹åˆ°å¤ªå¤šå¯¹ç¨‹åºå‘˜é«˜æ•ˆç¼–ç çš„è¦æ±‚ï¼ŒåŒæ ·ä¹Ÿä¸ä¼šçœ‹åˆ°å¤ªå¤šè¦ç¨‹åºå‘˜ç¼–å†™æ­£ç¡®è¿è¡Œä»£ç çš„è¦æ±‚ã€‚ä½†æ˜¯äºæ­¤åŒæ—¶ï¼Œä½ ä¹Ÿä¸ä¼šçœ‹åˆ°åŒ»ç”Ÿçš„æ‹›è˜è¦æ±‚å†™ç€èƒ½æ²»æ„ˆæ‚£è€…ï¼Œå¾‹å¸ˆçš„æ‹›è˜è¦æ±‚å†™ç€èƒ½ç»™é¿å…æ˜‚è´µçš„è¯‰è®¼è´¹ã€‚ä»ç³»ç»Ÿæ¶æ„çš„è§’åº¦å»ç¼–å†™é«˜æ•ˆçš„ä»£ç æ˜¯ä¸€åç¨‹åºå‘˜çš„åŸºæœ¬å·¥ä½œè¦æ±‚ã€‚ æˆ‘ä¸€äº›æ›´è¯¦ç»†çš„æ€è€ƒï¼š å…³ä¹è½¯ä»¶æ€§èƒ½çš„åªæœ‰é‚£ä¸€å°éƒ¨åˆ†ä»£ç ã€‚æ›´åœ¨ä¹çš„æ˜¯å®ƒçš„ç»å¯¹ä»·å€¼ï¼Œè€Œéç›¸å¯¹ä»£ç æ•°é‡ã€‚ å¦‚æœä½ åªæœ‰å¾ˆå°‘çš„ç”¨æˆ·å’Œæ•°æ®ï¼Œé‚£è½¯ä»¶æ€§èƒ½æ— è¶³è½»é‡ã€‚è¶Šé‡è¦çš„è½¯ä»¶ï¼Œæ€§èƒ½é—®é¢˜ä¹Ÿå˜å¾—æ›´é‡è¦ã€‚ é‰´äºæˆ‘ä»¬ç¼–å†™çš„è½¯ä»¶ä¸­æœ‰90%å®é™…ä¸Šéƒ½å¾ˆå°‘åœ¨å·¥ä½œï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å»èµŒè½¯ä»¶æ€§èƒ½ä¸é‡è¦ï¼Œä½†è¿™ä¹Ÿåªæ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹â€¦ åœ¨è¿™äº›åœºæ™¯ä¸‹è½¯ä»¶å¸¦æ¥çš„ä»·å€¼å¾ˆå°‘ã€‚ è®©æˆ‘ä»¬è®²å¾—æ›´å‡†ç¡®ä¸€äº›ï¼šç»å¤§å¤šæ•°æ€§èƒ½æˆ–å†…å­˜ä¼˜åŒ–æ˜¯æ— ç”¨åŠŸã€‚ è¿™ä¸æ˜¯ä»€ä¹ˆè™šæ„ï¼Œè¿™æ˜¯äº‹å®ã€‚ ä¸€å¤§å †çš„è½¯ä»¶ç”Ÿæ¥å°±ä¸æ˜¯è¿½æ±‚æ€§èƒ½æˆ–è€…ä¸å€¼å¾—ä¸ºæ€§èƒ½è€Œä»˜å‡ºçš„ã€‚å¸•ç´¯æ‰˜æ³•åˆ™å‘Šè¯‰ä½ 20%çš„ä»£ç æ¶ˆè€—80%çš„è¿è¡Œæ—¶é—´ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºæ¯”è¿™ä¸ªè¿˜ç³Ÿã€‚æˆ‘è®¤ä¸º1%çš„ä»£ç å ç”¨äº†99%çš„è¿è¡Œæ—¶é—´â€¦â€¦äº‹å®å¯èƒ½æ›´æç«¯ã€‚ æ‰€ä»¥åªæœ‰ä¸€å°éƒ¨åˆ†ä»£ç æ‰å…³ä¹æ€§èƒ½ï¼Œè€Œä¸”å…¶ä¸­çš„æ›´ä¸€å°éƒ¨åˆ†æ‰å¸¦æ¥å•†ä¸šä»·å€¼ã€‚ ä½†é‡è¦çš„æ˜¯ï¼Œå¦‚æœä½ æ˜¯å‘˜å·¥ï¼Œä½ çš„ä»·å€¼å–å†³äºä½ å¯¹ä¼˜åŒ–ä¸šåŠ¡ä»£ç æ‰€å¸¦æ¥çš„ä»·å€¼ï¼Œè€Œä¸æ˜¯ä»¥ä½ æ¥è§¦åˆ°çš„ä»£ç å¤šå°‘æ¥è¡¡é‡ã€‚ æˆ‘ä»¬å¯ä»¥é‡åŒ–è½¯ä»¶æ€§èƒ½çš„ä»·å€¼ï¼Œè€Œä¸”éå¸¸å…·æœ‰ä»·å€¼ã€‚ å¦‚æœæˆ‘å»è‹¹æœçš„å®˜ç½‘è´­ä¹°ä¸€å°MacBook Proã€‚åŸºç¡€æ¬¾$1800ã€‚å¦‚æœæˆ‘æƒ³è¦ä¸€ä¸ªCPUä¸»é¢‘é«˜10%çš„å‹å·ï¼Œå°†èŠ±è´¹$2100ï¼ˆåŠ ä»·+15%ï¼‰ã€‚ä»…ä»…10%çš„ä¸»é¢‘é€Ÿåº¦æå‡å¹¶ä¸èƒ½å®Œå…¨æ¥è¿‘10%çš„é€Ÿåº¦æå‡ã€‚æˆ‘ä»¬åªèƒ½è¯´å¤§æ¦‚ä¼šå¿«5%ã€‚å› æ­¤ä¸ºäº†è®©è®¡ç®—æœºå¿«5%ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æœ‰äº›äººæ›´æ„¿æ„ä»˜å‡ºå¤š15%ç”šè‡³æ›´é«˜çš„ä»·æ ¼ã€‚å¯¹æ‰‹æœºæ¥è¯´å®Œå…¨ä¹Ÿå¯ä»¥åŒæ ·è¿™ä¹ˆåˆ†æã€‚ å¦‚æœè¯´ä¸æ€§èƒ½ç›¸å…³çš„å¸¸é‡å› ç´ ä¸é‡è¦çš„è¯ï¼Œé‚£ä¹ˆè®©è®¡ç®—æœºå®ç°ä¸¤å€é€Ÿçš„æå‡åº”è¯¥æœ‰åŒç­‰ä»·å€¼çš„ä½“ç°ã€‚å®é™…ä¸Šå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€å°è®¡ç®—æœºèƒ½å¤Ÿä»¥ä¸¤å€é€Ÿè¿è¡Œï¼Œé‚£ä¹ˆå®ƒçš„ä»·æ ¼åŒæ ·ä¹Ÿåº”è¯¥å€¼ä¸¤å€ã€‚ å°±äº‘è®¡ç®—æ¥è¯´ï¼Œç°åœ¨å…¬å¸ç»å¸¸ä»¥ä»–ä»¬ä½¿ç”¨çš„èµ„æºï¼ˆå†…å­˜ã€è®¡ç®—æ—¶é—´ï¼‰æ¥ä»˜è´¹ã€‚è¿™å°±å…è®¸ä»–ä»¬å¾ˆæ–¹ä¾¿åœ°è¡¡é‡ï¼ˆç¾å…ƒï¼‰ç»™å®šä¼˜åŒ–å¸¦æ¥çš„æ”¶ç›Šã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å°å…¬å¸å¦‚ä½•åˆ©ç”¨åˆçº§ä¼˜åŒ–æ‰‹æ®µèŠ‚çœæ•°ç™¾ç”šè‡³æ•°åƒç¾å…ƒã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹çœ‹æµè§ˆå™¨ã€‚é•¿ä¹…ä»¥æ¥ï¼Œå¾®è½¯ä¸€ç›´ä»¥IEæµè§ˆå™¨é¢†å…ˆã€‚åœ¨å¾ˆå¤šå…³é”®å¸‚åœºï¼Œè°·æ­ŒChromeæµè§ˆå™¨ç°åœ¨å·²ç»ä¸»å®°äº†ã€‚äººä»¬é€‰æ‹©è°·æ­ŒChromeæµè§ˆå™¨æœ‰å¾ˆå¤šåŸå› ï¼Œä½†æ˜¯é€Ÿåº¦æ˜¯ä¸€ä¸ªå…³é”®å› ç´ ã€‚ä¸ºäº†éªŒè¯æˆ‘çš„ç†è®ºï¼Œæˆ‘åœ¨è°·æ­Œä¸Šæœäº†ä¸‹ï¼šå¸®æˆ‘é€‰æ‹©Chromeè¿˜æ˜¯IEï¼Œæˆ‘çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªæ¨èæ˜¯ä¸‹é¢è¿™ä¸ªï¼š Chromeæ˜¯ç†è®ºä¸Šé€Ÿåº¦æœ€å¿«çš„æµè§ˆå™¨ï¼Œæœ€å…³é”®çš„åŠŸèƒ½æ˜¯å®ƒæ›´å¤Ÿå¿«é€Ÿåœ°åŠ è½½ç½‘é¡µã€‚æˆ‘ä»¬ç”¨Sunspiderã€Octaveå’ŒHTML 5æµ‹è¯•å¯¹Chromeå’ŒIEæµè§ˆå™¨åšäº†ä¸€ç³»åˆ—çš„æ€§èƒ½æµ‹è¯•ã€‚åœ¨æ¯ä¸€é¡¹æŒ‡æ ‡ä¸­ï¼Œè°·æ­ŒChromeéƒ½é¥é¥é¢†å…ˆã€‚ å› æ­¤ï¼Œæ€§èƒ½å¯¹å¾ˆå¤šç”¨æˆ·æ¥è¯´æ˜¯æœ‰ä»·å€¼çš„ã€‚ æ·»åŠ æ›´å¤šçš„ç¡¬ä»¶å¹¶ä¸ä¼šç¥å¥‡èˆ¬åœ°è®©æ€§èƒ½é—®é¢˜æ¶ˆå¤±ã€‚å®ƒéœ€è¦ç”¨å·¥ç¨‹æ–¹æ³•å»åˆ©ç”¨æ›´å¤šçš„ç¡¬ä»¶ã€‚ æœ‰äººåå¯¹è¯´ï¼Œæ…¢çš„æ—¶å€™æˆ‘ä»¬æ€»æ˜¯å¯ä»¥å †å æ›´å¤šçš„æœºå™¨ã€æ ¸æ•°ã€‚ç„¶è€Œå³ä½¿é˜¿å§†è¾¾å°”å®šå¾‹ä¸é™åˆ¶ä½ ï¼Œä½ ä»ç„¶è¦é¢å¯¹æ— æ³•è®©ä½ çš„è½¯ä»¶åœ¨å¤šå°æœºå™¨ä¸Šè‰¯å¥½è¿è¡Œçš„äº‹å®ã€‚å †å ç¡¬ä»¶åªæ˜¯æå‡è½¯ä»¶æ€§èƒ½çš„ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ã€‚å®ƒæœªå¿…æ˜¯ä¸ªå»‰ä»·çš„æ–¹æ³•ã€‚ å¯ä»¥è¯´ç°å®ä¸–ç•Œé‡Œæ²¡äººèƒ½å¤Ÿæ‹¥æœ‰æ— ç©·å¤šçš„å¤„ç†å™¨ã€‚æ­¤å¤–ï¼Œå½“ä½ æœ‰å¤šä¸ªå¤„ç†å™¨æ—¶ï¼ŒååŒé—®é¢˜ä¼šè®©ä½ åœ¨å¤šä¸ªå¤„ç†å™¨ä¸Šå¤„ç†åŒä¸€ä¸ªé—®é¢˜ä¸Šæ›´åŠ å¤æ‚ï¼ˆå³ä½¿åœ¨ç†è®ºä¸Šä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚ æˆ‘ä»¬åˆæ˜¯å¦‚ä½•å®è·µçš„å‘¢ï¼Ÿè¿‡å»çš„å‡ åå¹´å‘Šè¯‰æˆ‘ä»¬å¹¶è¡Œå¤„ç†é—®é¢˜æ˜¯ä»¶å›°éš¾çš„ä»»åŠ¡ã€‚ä½ æœ€ç»ˆä¼šé‡åˆ°æ›´åŠ å¤æ‚çš„ä»£ç å’Œé«˜æ˜‚çš„å¼€é”€ã€‚æµ‹è¯•å’Œè°ƒè¯•å˜å¾—æ›´åŠ å›°éš¾ã€‚å½“é¢ä¸´è®¸å¤šé—®é¢˜çš„æ—¶å€™ï¼Œä½ å¦‚æœèƒ½å¤Ÿç”¨ä¸‰ä¸ªæ ¸æ•°æ¢å–ä¸¤å€çš„æ€§èƒ½æå‡ï¼Œé‚£å·²ç»å¾ˆå¹¸è¿äº†ã€‚æ¥ç€å¦‚æœä½ æƒ³å†è®©æ€§èƒ½ç¿»å€ï¼Œä¼°è®¡ä½ å¾—éœ€è¦16æ ¸CPUäº†ã€‚ è¿™æ„å‘³ç€å¦‚æœå•çº¿ç¨‹æ€§èƒ½æå‡ä¸¤å€ï¼Œå°†ä¼šå˜å¾—éå¸¸æœ‰ä»·å€¼ã€‚æ¢å¥è¯è¯´ï¼Œè°ƒä¼˜çƒ­ç‚¹ä»£ç çš„æ„ä¹‰æ›´å¤§â€¦â€¦ è€Œä¸”æ·»åŠ æ›´å¤šçš„ç¡¬ä»¶å¹¶ä¸ä¼šè®©æ€§èƒ½é—®é¢˜ç¥å¥‡èˆ¬åœ°æ¶ˆå¤±ï¼Œä½¿ç”¨è¿™äº›ç¡¬ä»¶éœ€è¦é¢å¤–çš„å¤„ç†å·¥ä½œã€‚ æˆ‘ä»¬ä½¿ç”¨é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯åœ¨å¼¥è¡¥æ€§èƒ½ç¼ºå¤±ä¸ŠæŠ•å…¥äº†å¤§é‡çš„å·¥ç¨‹ç²¾åŠ›ã€‚ å½“ä»Šæœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€æ˜¯JavaScriptï¼Œä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæ…¢çš„ç¼–ç¨‹è¯­è¨€ã€‚è¿™éš¾é“æ ‡å¿—ç€æ€§èƒ½ä¸é‡è¦ï¼Ÿåœ¨è¿‡å»å‡ å¹´é‡ŒJavaScriptçš„æ€§èƒ½æˆå€æå‡èƒŒåæ˜¯å¤§é‡çš„å·¥ç¨‹æŠ•å…¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ­£åœ¨æ¨åŠ¨ä¸€äº›é«˜æ€§èƒ½çš„ç½‘ç»œç¼–ç¨‹æŠ€æœ¯ï¼Œä¾‹å¦‚Web Assemblyï¼ˆå‚è§è¿™ä¸ªè§†é¢‘ï¼‰ã€‚å¦‚æœæ€§èƒ½ä¸é‡è¦ï¼Œè¿™äº›å°†å˜å¾—æ²¡æœ‰æ„ä¹‰ã€‚ äº‹å®ä¸Šï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œäººä»¬è¿ç§»åˆ°æ›´åŠ é«˜çº§çš„è¯­è¨€ã€‚è¿™æ˜¯ä»¶å¥½äº‹ã€‚è¿™äº›è¯­è¨€é€šå¸¸ä»¥ç‰ºç‰²æ€§èƒ½æ¥æ¢å–ä¾¿åˆ©æ€§ã€å®‰å…¨æ€§æˆ–ç®€æ˜“æ€§ã€‚ è™½ç„¶åœ¨è¿‡å»çš„åäº”å¹´é‡Œï¼Œæµè§ˆå™¨ä¸­çš„JavaScriptæ€§èƒ½æé«˜äº†ä¸¤ä¸ªæ•°é‡çº§ã€‚ä½†æ˜¯ï¼Œåœ¨ä¸€äº›è¯„ä¼°ä¸­JavaScriptåªæœ‰C++çš„ååˆ†ä¹‹ä¸€æ€§èƒ½ã€‚ æˆ‘è®¤ä¸ºJavaScriptæµè¡Œçš„ä¸€ä¸ªé‡è¦åŸå› æ­£æ˜¯å…¶è‰¯å¥½çš„æ€§èƒ½ã€‚å¦‚æœJavaScriptåœ¨å¤§å¤šæ•°ä»»åŠ¡ä¸­ä»ç„¶æ¯”C++æ…¢1000å€ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å¯èƒ½åƒç°åœ¨è¿™æ ·çš„æµè¡Œã€‚ å»å¹´ï¼Œä¸€ä¸ªåŒäº‹é‡åˆ°ä¸€ä¸ªä»¿çœŸçš„æ€§èƒ½é—®é¢˜ï¼Œç¨‹åºä¸€ç›´åœ¨æ— å°½åœ°è¿è¡Œã€‚å½“æˆ‘é—®å¥¹æ˜¯ç”¨ä»€ä¹ˆç¼–ç¨‹è¯­è¨€æ—¶ï¼Œå¥¹æƒ­æ„§åœ°è¯´æ˜¯ç”¨Pythonå†™çš„ã€‚ä¹Ÿè®¸ä»¤å¥¹æƒŠè®¶çš„æ˜¯ï¼Œæˆ‘æ²¡æœ‰è¡¨ç¤ºå‡ºä»»ä½•ä¸å±‘ã€‚åœ¨20å¹´åï¼Œå¦‚æœæˆ‘ä»¬å¤§å¤šæ•°äººä»ç„¶ç”¨Cï¼ŒC++å’ŒJavaç¼–ç¨‹ï¼Œé‚£æˆ‘æ‰ä¼šæ²®ä¸§ã€‚ ä½ å€¼å¾—ä¸ºæ›´å¥½çš„æ€§èƒ½å’Œæ›´é«˜æ•ˆçš„ç”Ÿäº§åŠ›ä¹°å•ã€‚ è®¡ç®—æœºè¢«è¦æ±‚ç”¨æ›´å°‘çš„èµ„æºåšæ›´å¤šçš„äº‹æƒ…ï¼Œè€Œä¸”åœ¨æ€§èƒ½æ–¹é¢æ°¸è¿œæœ‰ç€æ— å°½çš„éœ€æ±‚ã€‚ è½¯ä»¶æ€§èƒ½ç»å¸¸è¢«è®¤ä¸ºæ˜¯æ— å…³ç´§è¦çš„ã€‚æ ¹æ®æ‘©å°”å®šå¾‹ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥ç†è§£çš„ï¼šå¤„ç†å™¨æ›´å¿«ï¼Œç£ç›˜æ›´å¿«â€¦â€¦ è°åœ¨ä¹è½¯ä»¶æ…¢ä¸æ…¢ï¼Ÿå®ƒè¿Ÿæ—©ä¼šè¿è¡Œå¾—æ›´å¿«çš„ã€‚è®©æˆ‘ä»¬ä¸“æ³¨åœ°ç”¨æ¼‚äº®çš„ç®—æ³•ç¼–å†™æ¼‚äº®çš„ä»£ç ï¼Œå‰©ä¸‹çš„éƒ½å¯ä»¥æ— è§†ã€‚ çš„ç¡®å¦‚æ­¤ï¼Œå¦‚æœä½ åœ¨ä¸€å°æœ€è¿‘è´­ä¹°çš„PCæœºä¸Šè¿è¡ŒWindows 3.1ï¼Œå®ƒä¼šå¿«å¾—ä¸å¯æ€è®®ã€‚äº‹å®ä¸Šï¼Œæˆ‘æ•¢æ‰“èµŒï¼Œä½ å¯ä»¥åœ¨ä½ æµè§ˆå™¨é‡Œè¿è¡ŒWindows 3.1ï¼Œè®©å®ƒæ›´å¿«ã€‚ çš„ç¡®æœ‰äº›ç¡¬ä»¶åœ¨ç”Ÿæˆé«˜æ•ˆçš„ä»£ç ä¸Šçš„å‹åŠ›è¶Šæ¥è¶Šå°ã€‚åœ¨1990å¹´ï¼Œä¸ºäº†å‡»è´¥æœ€å¼ºçš„å›½é™…è±¡æ£‹æ£‹æ‰‹ï¼Œå¯èƒ½ç”šè‡³éœ€è¦æœ‰äººä¸“é—¨å»è°ƒä¼˜æ±‡ç¼–ä»£ç ã€‚è€Œå¦‚ä»Šæˆ‘æ•¢ä¿è¯æˆ‘éšä¾¿ç”¨JavaScriptå†™ä¸€äº›é‚‹é¢çš„ä»£ç å°±èƒ½å¤Ÿå†™å‡ºä¸€ä¸ªè¶³ä»¥å‡»è´¥å¤§å¤šæ•°éå¤§å¸ˆçº§å›½é™…è±¡æ£‹æ£‹æ‰‹çš„è½¯ä»¶ã€‚ ä½†æ˜¯è®¡ç®—æœºè¢«è¦æ±‚ä½¿ç”¨æ›´å°‘çš„èµ„æºã€‚åœ¨1990å¹´å†™ä¸€ä¸ªå›½é™…è±¡æ£‹ç¨‹åºå‡»è´¥å›½é™…è±¡æ£‹å† å†›éå¸¸çš„äº†ä¸èµ·â€¦ä½†åœ¨ä»Šå¤©æ¥çœ‹ç®€å•å¾—æ ¹æœ¬ç®—ä¸ä¸Šä»€ä¹ˆä¼Ÿå¤§çš„äº‹æƒ…ã€‚ä½ éœ€è¦å»å†™ä¸€ä¸ªä¸‹å›´æ£‹çš„ç¨‹åºï¼Œé‚£ä¸ªæ‰æ˜¯ä»¶éš¾äº‹ã€‚ å½“ç„¶äº†ï¼Œæ‰‹æœºç¡¬ä»¶é€Ÿåº¦æ€»æ˜¯è¶Šæ¥è¶Šå¿«â€¦â€¦ ä½†æ˜¯æƒ³åœ¨ä½“ç§¯æ›´å°ã€æ›´å»‰ä»·çš„è®¾å¤‡ä¸Šè¿è¡ŒåŒä¸€æ¬¾è½¯ä»¶å‹åŠ›å°±å¤§äº†ï¼ˆä¾‹å¦‚æ™ºèƒ½æ‰‹è¡¨ï¼‰ã€‚åå‡ å¹´åé¼ æ ‡å’Œé”®ç›˜å˜æˆäº†å¥‡æ€ªçš„å¤è‘£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ›´æ˜‚è´µçš„äº¤äº’ï¼ˆå¦‚è¯­éŸ³ã€å¢å¼ºç°å®â€¦â€¦ï¼‰ã€‚ æ˜¯çš„ï¼Œå¾ˆå¿«æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªåƒæ™ºèƒ½æ‰‹è¡¨ä¸€æ ·å¤§å°çš„å…·å¤‡è‡ªä¸»é«˜çº§è‡ªä¸»äººå·¥æ™ºèƒ½çš„è®¾å¤‡ã€‚ä½ è§‰å¾—ä½ é‚£è‰ç‡æœªç»ä¼˜åŒ–çš„ä»£ç èƒ½å¤Ÿè·‘åœ¨ä¸Šé¢ï¼Ÿ æˆ‘ä»¬ç¡®å®å¸Œæœ›æˆ‘ä»¬çš„å¤„ç†å™¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ˜¯ç©ºé—²çŠ¶æ€ã€‚äº‹å®ä¸Šå¹¶ä¸æ˜¯è¯´æˆ‘ä»¬çš„ä»£ç å¯ä»¥æ›´æ¾æ•£(å¯èƒ½ç¿»è¯‘ä¸å‡†ç¡®ï¼ŒåŸæ–‡ï¼šThe fact that they are is not an indication that we could be sloppier)ã€‚ æˆ‘ä»¬çš„å¤„ç†å™¨å¤§å¤šæ—¶å€™æ˜¯ç©ºé—²çŠ¶æ€å—ï¼Ÿ æ˜¯çš„ï¼Œä½†æ˜¯è¿™å°±åƒé‚£ä¸ªæ¢—ï¼šä¹°ä¸€è¾†è·‘è½¦ï¼Œè€Œå®ƒå¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½æ˜¯åœåœ¨é‚£é‡Œï¼Œå¤šè ¢ã€‚ æˆ‘ä»¬æœ‰å·¨å¤§çš„è¿‡å‰©ç®—åŠ›ï¼Œè®¾è®¡å°±æ˜¯å¦‚æ­¤ã€‚å¦åˆ™é‚£åœºæ™¯å°±ä¼šåƒè¶…å¸‚é‡Œæ‰€æœ‰æ”¶é“¶å°ã€æ‰€æœ‰è´­ç‰©è½¦å…¨å¤©éƒ½æ»¡è´Ÿè·è¿ä½œã€‚ æˆ‘ä»¬éƒ½ç»å†è¿‡ç¬”è®°æœ¬ç”µè„‘CPUä½¿ç”¨ç‡ä¸º100ï¼…çš„æƒ…å†µã€‚ç¬”è®°æœ¬ç”µè„‘å˜å¾—è¿Ÿé’ï¼Œæ²¡æœ‰ååº”ã€‚ä½ çš„æ‰€æœ‰æ“ä½œè¯·æ±‚éƒ½è¦æ’é˜Ÿç­‰å€™ã€‚è¿™å¾ˆä¸çˆ½ã€‚ æœåŠ¡å™¨æ»¡è´Ÿè·è¿è¡Œçš„æƒ…å†µä¸‹ä¸å¾—ä¸ä¸¢å¼ƒè¯·æ±‚æˆ–è€…è®©ä½ ç­‰å¾…ã€‚æˆ‘ä»¬è®¨åŒè¿™ç§æƒ…å†µã€‚ ä¸€éƒ¨æ»¡è´Ÿè·è¿è¡Œçš„æ‰‹æœºå˜çƒ«ï¼Œç„¶åå¾ˆå¿«åœ°è€—å°½å®ƒçš„ç”µæ± ã€‚ æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„å¤„ç†å™¨æ˜¯å†·å´çš„ï¼Œå¹¶ä¸”ä¿æŒè¿™ç§å†·å´çŠ¶æ€ã€‚æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å‡å°‘å®ƒä»¬çš„ä½¿ç”¨ï¼Œå³ä½¿ä»–ä»¬å¤§éƒ¨åˆ†æ—¶é—´æ˜¯å†·å´ã€‚å¿«é€Ÿçš„ä»£ç å¯ä»¥æ›´å¿«åœ°è¿”å›ç»™ç”¨æˆ·å¹¶æ¶ˆè€—æ›´å°‘çš„èƒ½é‡ã€‚ æˆ‘æƒ³æœªæ¥å°†æ˜¯ç”±æš—ç¡…åˆ¶æˆçš„ã€‚æˆ‘ä»¬å°†æ‹¥æœ‰å¤§é‡çš„ç®—åŠ›ã€å¤§é‡çš„ç”µè·¯ï¼Œä½†å¤§å¤šæ•°éƒ½å¤„äºæ— åŠŸè€—çš„ã€‚å¦‚æœæˆ‘ä»¬å¾ˆå¿«å°±ä¼šæ ¹æ®è½¯ä»¶ä½¿ç”¨çš„åŠŸè€—æ¥è¯„ä¼°å®ƒï¼Œé‚£æˆ‘ä¸€ç‚¹ä¸ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚","categories":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"æ€§èƒ½","slug":"æ€§èƒ½","permalink":"https://unpluggedcoder.me/tags/%E6%80%A7%E8%83%BD/"}]},{"title":"Redisåˆ†å¸ƒå¼é”çš„Pythonå®ç°[python-redis-lock]","slug":"åˆ†å¸ƒå¼é”python-redis-lock","date":"2018-08-06T12:37:53.000Z","updated":"2022-09-15T15:51:05.352Z","comments":true,"path":"2018/08/06/åˆ†å¸ƒå¼é”python-redis-lock/","link":"","permalink":"https://unpluggedcoder.me/2018/08/06/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81python-redis-lock/","excerpt":"å…³äºåˆ†å¸ƒå¼é”æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œå¯ä»¥ç”¨æ•°æ®åº“é”æˆ–è€…ZooKeeperè¿™ç±»çš„ä¸“ä¸šçš„åˆ†å¸ƒå¼å¼€æºé¡¹ç›®ã€‚æœ¬æ–‡è®²çš„æ˜¯ç”¨Rediså®ç°çš„ä¸€ä¸ªåˆ†å¸ƒå¼é”åº“python-redis-lock. Rediså®˜æ–¹æœ‰æ¨èä¸€ä¸ªåˆ†å¸ƒå¼é”çš„ç®—æ³•Redlock(è¿™ä¸ªåº“å®ç°çš„å¹¶ä¸æ˜¯è¿™ä¸ªç®—æ³•), è¯¥ç®—æ³•è‡ªåŠ¨é‡Šæ”¾é”æ²¡æœ‰è€ƒè™‘åˆ°å®¢æˆ·ç«¯é•¿æœŸæŒæœ‰çš„æƒ…å†µï¼Œå› æ­¤ä¹Ÿæœ‰äººå¯¹è¿™ä¸ªç®—æ³•æå‡ºäº†è´¨ç–‘ã€‚ é‚£å›åˆ°æˆ‘ä»¬ä»Šå¤©è¦è®²çš„è¿™ä¸ªåº“python-redis-lockã€‚ä½œè€…: Ionel Cristian MÄƒrieÈ™, è¿™ä¸ªåº“æ•´ä½“çš„æ€è·¯ä½œè€…ä¹Ÿç”¨å¾ˆç›´è§‚çš„å›¾å±•ç°å‡ºæ¥äº†ï¼Œå¦‚ä¸‹ï¼š","text":"å…³äºåˆ†å¸ƒå¼é”æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œå¯ä»¥ç”¨æ•°æ®åº“é”æˆ–è€…ZooKeeperè¿™ç±»çš„ä¸“ä¸šçš„åˆ†å¸ƒå¼å¼€æºé¡¹ç›®ã€‚æœ¬æ–‡è®²çš„æ˜¯ç”¨Rediså®ç°çš„ä¸€ä¸ªåˆ†å¸ƒå¼é”åº“python-redis-lock. Rediså®˜æ–¹æœ‰æ¨èä¸€ä¸ªåˆ†å¸ƒå¼é”çš„ç®—æ³•Redlock(è¿™ä¸ªåº“å®ç°çš„å¹¶ä¸æ˜¯è¿™ä¸ªç®—æ³•), è¯¥ç®—æ³•è‡ªåŠ¨é‡Šæ”¾é”æ²¡æœ‰è€ƒè™‘åˆ°å®¢æˆ·ç«¯é•¿æœŸæŒæœ‰çš„æƒ…å†µï¼Œå› æ­¤ä¹Ÿæœ‰äººå¯¹è¿™ä¸ªç®—æ³•æå‡ºäº†è´¨ç–‘ã€‚ é‚£å›åˆ°æˆ‘ä»¬ä»Šå¤©è¦è®²çš„è¿™ä¸ªåº“python-redis-lockã€‚ä½œè€…: Ionel Cristian MÄƒrieÈ™, è¿™ä¸ªåº“æ•´ä½“çš„æ€è·¯ä½œè€…ä¹Ÿç”¨å¾ˆç›´è§‚çš„å›¾å±•ç°å‡ºæ¥äº†ï¼Œå¦‚ä¸‹ï¼š å¤§è‡´æ€è·¯ä»å›¾ä¸Šçœ‹å‡ºä½œè€…å’Œå…¶å®ƒå¤§å¤šæ•°ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ€è·¯ç±»ä¼¼(SET NX)ï¼Œä½†æ˜¯ä»–å¯¹æ¯ä¸ªé”å¤šç”¨äº†ä¸€ä¸ªlistç±»å‹é”®æ¥åšä¿¡å·æ§åˆ¶ï¼Œå¦‚æœå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å°è¯•è·å–é”å¤±è´¥ï¼Œå¯ä»¥é€‰æ‹©åœ¨signalåˆ—è¡¨ä¸Šé˜»å¡ä¸€ä¸ªtimeoutæ—¶é—´ç”¨æ¥æ¥æ”¶é”è¢«é‡Šæ”¾çš„é€šçŸ¥ï¼ŒRedisåˆ—è¡¨çš„è¿™ä¸ªç‰¹æ€§ä¿è¯äº†æ¯æ¬¡åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æ¥æ”¶åˆ°äº†é”é‡Šæ”¾çš„é€šçŸ¥ã€‚è€Œè·å–åˆ°é”çš„å®¢æˆ·ç«¯åœ¨ä½¿ç”¨å®Œåä¼šåœ¨å¯¹åº”çš„ä¿¡å·åˆ—è¡¨ä¸Šæ¨é€ä¸€ä¸ªé€šçŸ¥ã€‚å¦å¤–ï¼Œä½œè€…å¯¹é”è¶…æ—¶è¿˜å¢åŠ äº†ä¸€ä¸ªåˆ·æ–°çš„åŠŸèƒ½æ¥å»¶é•¿(Extend)å¯¹é”çš„å ç”¨ï¼Œå¯ä»¥ä¿è¯åœ¨æŒæœ‰é”çš„å®¢æˆ·ç«¯ä¸Šå®Œæˆæ‰€æœ‰æ“ä½œåæ‰é‡Šæ”¾é”ã€‚ä¸ªäººè®¤ä¸ºè¿™ç§è®¾è®¡çš„ä¼˜ç‚¹å’Œéœ€è¦æ³¨æ„çš„ç‚¹å¦‚ä¸‹ï¼š ä¼˜ç‚¹ ä¸€æ–¹é¢é¿å…å®¢æˆ·ç«¯åå¤è¯·æ±‚é”ï¼Œå¦ä¸€æ–¹é¢é€šè¿‡list signalæ¥è®©å®¢æˆ·ç«¯å†³å®šæ˜¯å¦è¦blockè‡ªå·±ï¼› å¦‚æœæœ‰è®¾ç½®è¶…æ—¶ï¼Œåˆ™ç­‰å¾…è¶…æ—¶åå®¢æˆ·ç«¯ä»ç„¶ä¼šå†å°è¯•è·å–ä¸€æ¬¡é”è€Œä¸æ˜¯ç›´æ¥å¤±è´¥ï¼› è¿™ä¸ªç®—æ³•ä¸ä¾èµ–å®¢æˆ·ç«¯æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ²¡æœ‰time drifté—®é¢˜ï¼› ç»“åˆLuaè„šæœ¬åšåŸå­æ“ä½œï¼Œå¦‚æœå†åŠ ä¸Šç»†ç²’åº¦é”ï¼Œä¸ªäººè®¤ä¸ºåŸºæœ¬å¯ä»¥æ»¡è¶³å„ç§é«˜éœ€æ±‚åœºæ™¯çš„åˆ†å¸ƒå¼é”è¦æ±‚ã€‚ âš ï¸Warning è‡ªåŠ¨åˆ·æ–°å¯èƒ½ä¼šé€ æˆé¥¥é¥¿é—®é¢˜ï¼Œå¦‚æœæŒæœ‰é”çš„å®¢æˆ·ç«¯å› ä¸ºæŸç§æœªçŸ¥åŸå› é˜»å¡ï¼Œå¹¶ä¸”å¼€å¯äº†è‡ªåŠ¨åˆ·æ–°é”ï¼Œé‚£å…¶å®ƒå®¢æˆ·ç«¯å°±è·ªäº†ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨è€…æ…ç”¨åˆ·æ–°æœºåˆ¶ï¼› å¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶ï¼Œä¸”æŒæœ‰é”çš„å®¢æˆ·ç«¯æ— å“åº”çš„æƒ…å†µä¸‹å°±ä¼šé€ æˆæ­»é”ï¼› æºç åˆ†æäº†è§£è¿‡å¤§ä½“æ€è·¯åï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ†è§£ä½œè€…çš„å®ç°ã€‚é¦–å…ˆè¿™ä¸ªåº“æºç åªæœ‰ä¸¤ä¸ªè„šæœ¬ï¼ˆä¸å«æµ‹è¯•å’Œç¤ºä¾‹ä»£ç ï¼‰, ç»“æ„å¾ˆç®€å•ã€‚ src&#x2F;redis_lockâ”œâ”€â”€ init.pyâ””â”€â”€ django_cache.py æ ¸å¿ƒä»£ç åœ¨__init__.pyä¸­ï¼Œdjango_cache.pyåˆ™æ˜¯ç»“åˆdjango-redisåšçš„ç¼“å­˜åç«¯ï¼Œæ¥é¿å…ç¼“å­˜å¤±æ•ˆæ—¶é‡ä¸Šæ‰€è°“çš„â€œç‹—å±æ•ˆåº”(dogpile effect, Googleç¿»è¯‘)â€ï¼Œè¿™é‡Œä¸å¯¹å®ƒè¿›è¡Œè§£æã€‚ è½½å…¥Luaè„šæœ¬123456789101112# Check if the id match. If not, return an error code.UNLOCK_SCRIPT = b&quot;&quot;&quot; if redis.call(&quot;get&quot;, KEYS[1]) ~= ARGV[1] then return 1 else redis.call(&quot;del&quot;, KEYS[2]) redis.call(&quot;lpush&quot;, KEYS[2], 1) redis.call(&quot;del&quot;, KEYS[1]) return 0 end&quot;&quot;&quot;UNLOCK_SCRIPT_HASH = sha1(UNLOCK_SCRIPT).hexdigest() ä½œè€…ç”¨ä¸Šé¢è¿™ç§æ–¹å¼å®šä¹‰äº†UNLOCK, EXTEND, RESETâ€¦ ç­‰5ä¸ªåŸå­æ“ä½œçš„Luaè„šæœ¬ï¼Œæ¯ä¸ªè„šæœ¬ä¹Ÿå®šä¹‰äº†å¯¹åº”çš„å“ˆå¸Œå€¼ã€‚å…³äºRedisçš„Luaè„šæœ¬æ”¯æŒå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ä¸‹é¢è¿™æ®µä»£ç ï¼Œå¯ä»¥è¯´æ˜¯å¾ˆPythonicäº†ï¼š 12345678910111213((UNLOCK, _, _, # noqa EXTEND, _, _, RESET, _, _, RESET_ALL, _, _, DELETE_ALL_SIGNAL_KEYS, _, _), SCRIPTS) = zip(*enumerate([ UNLOCK_SCRIPT_HASH, UNLOCK_SCRIPT, &#x27;UNLOCK_SCRIPT&#x27;, EXTEND_SCRIPT_HASH, EXTEND_SCRIPT, &#x27;EXTEND_SCRIPT&#x27;, RESET_SCRIPT_HASH, RESET_SCRIPT, &#x27;RESET_SCRIPT&#x27;, RESET_ALL_SCRIPT_HASH, RESET_ALL_SCRIPT, &#x27;RESET_ALL_SCRIPT&#x27;, DELETE_ALL_SIGNAL_KEYS_SCRIPT_HASH, DELETE_ALL_SIGNAL_KEYS_SCRIPT, &#x27;DELETE_ALL_SIGNAL_KEYS_SCRIPT&#x27;])) ä¸ºäº†æŠŠä½¿ç”¨æ—¶è¦æŒ‡å®šçš„è„šæœ¬IDä¸å…¶è„šæœ¬ã€å“ˆå¸Œå€¼å…³è”èµ·æ¥ï¼Œä½œè€…ç”¨äº†enumerateæ¥è‡ªåŠ¨ç”Ÿæˆç´¢å¼•ID, ç„¶ååˆç”¨*æ¥æ‹æ‰æ•´ä¸ªåˆ—è¡¨ï¼Œæœ€åå†ç”¨zipæŠŠç´¢å¼•æå–å‡ºæ¥ï¼ŒæŠŠå“ˆå¸Œå€¼å¯¹åº”çš„ç´¢å¼•IDç”¨å˜é‡åå­˜èµ·æ¥ï¼Œæ²¡ç”¨çš„ç´¢å¼•ç”¨_å¿½ç•¥ï¼Œå…¶ä½™å†…å®¹ä¾ç„¶åœ¨SCRIPTSå…ƒç»„ä¸­ã€‚è¿™æ ·ä¸€æ¥ç”¨ä¸‹é¢è¿™ä¸ªå‡½æ•°æ‰§è¡ŒRedisçš„Luaè„šæœ¬å°±å¾ˆèˆ’æœäº†ï¼š 123456789101112131415def _eval_script(redis, script_id, *keys, **kwargs): &quot;&quot;&quot;Tries to call ``EVALSHA`` with the `hash` and then, if it fails, calls regular ``EVAL`` with the `script`. &quot;&quot;&quot; # Luaè„šæœ¬çš„ KEYS å‚æ•°æ”¾åœ¨ *keys ä¸­ï¼Œ ARGV å‚æ•°åˆ™åœ¨ kwargs çš„ args å‘½åå‚æ•°ä¸­æå–å‡ºæ¥, å’Œ keys æ‹¼æ¥èµ·æ¥ä¼ ç»™ evalsha æˆ–è€… eval å‡½æ•° args = kwargs.pop(&#x27;args&#x27;, ()) if kwargs: raise TypeError(&quot;Unexpected keyword arguments %s&quot; % kwargs.keys()) try: # é¦–å…ˆå°è¯•è°ƒç”¨evalsha return redis.evalsha(SCRIPTS[script_id], len(keys), *keys + args) except NoScriptError: # å¦‚æœè„šæœ¬ä¸å­˜åœ¨åˆ™è°ƒç”¨evalè½½å…¥å¹¶æ‰§è¡Œè„šæœ¬ logger.warn(&quot;%s not cached.&quot;, SCRIPTS[script_id + 2]) return redis.eval(SCRIPTS[script_id + 1], len(keys), *keys + args) åˆ›å»ºé”ä¸»è¦ä»£ç éƒ½åœ¨Lockç±»ä¸­ï¼Œåˆ›å»ºé”å¯¹è±¡æ—¶å¤§éƒ¨åˆ†éƒ½æ˜¯å¸¸è§„æ“ä½œï¼Œä¿å­˜å®ä¾‹çš„ä¸€äº›è®¾å®šã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647class Lock(object): &quot;&quot;&quot; A Lock context manager implemented via redis SETNX/BLPOP. &quot;&quot;&quot; def __init__(self, redis_client, name, expire=None, id=None, auto_renewal=False, strict=True): &quot;&quot;&quot; :param redis_client: An instance of :class:`~StrictRedis`. :param name: The name (redis key) the lock should have. :param expire: The lock expiry time in seconds. If left at the default (None) the lock will not expire. :param id: The ID (redis value) the lock should have. A random value is generated when left at the default. Note that if you specify this then the lock is marked as &quot;held&quot;. Acquires won&#x27;t be possible. :param auto_renewal: If set to ``True``, Lock will automatically renew the lock so that it doesn&#x27;t expire for as long as the lock is held (acquire() called or running in a context manager). Implementation note: Renewal will happen using a daemon thread with an interval of ``expire*2/3``. If wishing to use a different renewal time, subclass Lock, call ``super().__init__()`` then set ``self._lock_renewal_interval`` to your desired interval. :param strict: If set ``True`` then the ``redis_client`` needs to be an instance of ``redis.StrictRedis``. &quot;&quot;&quot; # ... æ­¤å¤„çœç•¥å‚æ•°æ ¡éªŒä»£ç  self._client = redis_client self._expire = expire if expire is None else int(expire) if id is None: self._id = urandom(16) elif isinstance(id, bytes): self._id = id else: raise TypeError(&quot;Incorrect type for `id`. Must be bytes not %s.&quot; % type(id)) self._name = &#x27;lock:&#x27;+name self._signal = &#x27;lock-signal:&#x27;+name self._lock_renewal_interval = (float(expire)*2/3 if auto_renewal else None) self._lock_renewal_thread = None éœ€è¦æ³¨æ„çš„å‡ ä¸ªç‚¹ï¼š å¯ä»¥ç”¨idæ¥ç”³æ˜å¯¹é”æ‰€æœ‰æƒè¯†åˆ«ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯çš„ä¸»æœºåç§°æˆ–è€…è¿›ç¨‹å·ä»€ä¹ˆçš„ï¼Œé»˜è®¤æ˜¯16ä¸ªéšæœºå­—èŠ‚ã€‚ å¦‚æœæŒ‡å®šäº†é”è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£åˆ·æ–°é—´éš”ä¼šè®¾å®šåœ¨è¶…æ—¶çš„2&#x2F;3æ—¶é—´ã€‚ è·å–é”è·å–é”çš„ç›¸å…³ä»£ç å¦‚ä¸‹ï¼Œè¿˜æ˜¯é€‰æ‹©åœ¨ä»£ç æ³¨é‡Šä¸­è§£æä»£ç ä¼šæ¯”è¾ƒç›´è§‚ç‚¹ã€‚è¿™é‡Œå’Œä¸Šä¸€æ®µä»£ç ä¸€æ ·ï¼Œçœç•¥äº†å‚æ•°æ ¡éªŒï¼Œè¿™æ˜¯å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œä½†æ˜¯é™äºç¯‡å¹…è¿™é‡Œä¸åšä»‹ç»ã€‚ 1234567891011121314151617181920212223242526272829303132333435def acquire(self, blocking=True, timeout=None): &quot;&quot;&quot; :param blocking: Boolean value specifying whether lock should be blocking or not. :param timeout: An integer value specifying the maximum number of seconds to block. &quot;&quot;&quot; logger.debug(&quot;Getting %r ...&quot;, self._name) if self._held: # é”ä¸å¯é‡å…¥ raise AlreadyAcquired(&quot;Already acquired from this Lock instance.&quot;) # ... æ­¤å¤„çœç•¥å‚æ•°æ ¡éªŒä»£ç ï¼Œå¦‚timeoutä¸èƒ½å¤§äºé”çš„_expireç­‰å„ç§æ¡ä»¶ busy = True blpop_timeout = timeout or self._expire or 0 timed_out = False while busy: # å¦‚æœsetå¤±è´¥åˆ™ä»£è¡¨é”è¢«å ç”¨ï¼Œè¿”å›False busy = not self._client.set(self._name, self._id, nx=True, ex=self._expire) if busy: if timed_out: return False elif blocking: # å¦‚æœé˜»å¡åˆ™åœ¨signalåˆ—è¡¨ä¸Šç›‘å¬ # å¦‚æœblpopåœ¨blpop_timeoutæ—¶é—´å†…è·å–åˆ°ä¿¡å·é€šçŸ¥çš„è¯ï¼Œtimeoutä¼šè¢«è®¾ç½®ä¸ºFalse timed_out = not self._client.blpop(self._signal, blpop_timeout) and timeout else: logger.debug(&quot;Failed to get %r.&quot;, self._name) return False logger.debug(&quot;Got lock for %r.&quot;, self._name) if self._lock_renewal_interval is not None: # å¦‚æœéœ€è¦è‡ªåŠ¨åˆ·æ–°é”ï¼Œåˆ™å¼€å¯åˆ·æ–°çº¿ç¨‹ self._start_lock_renewer() return True è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨blpopæˆåŠŸè·å–åˆ°ä¿¡å·ï¼Œå¹¶ä¸ä»£è¡¨ä¸‹ä¸€æ¬¡whileå¾ªç¯å°è¯•è·å–å°±ä¸€å®šæˆåŠŸï¼Œå¦‚æœåœ¨æ­¤é—´éš™ä¸­è¢«å…¶å®ƒå®¢æˆ·ç«¯è·å¾—äº†é”ï¼Œé‚£è¯¥å®¢æˆ·ç«¯ä»ç„¶ä¼šè·å–å¤±è´¥ï¼Œå¹¶å»é˜»å¡ä¸€ä¸ªtimeoutæ—¶é—´ã€‚ä¹Ÿå°±æ˜¯è¯´å‡è®¾è¿™ä¸ªå®¢æˆ·ç«¯çš„ç½‘ç»œè´¨é‡å¾ˆå·®ï¼Œè€Œåˆæ°æ°æ˜¯ä¸€ä¸ªé«˜é¢‘è¯·æ±‚çš„é”ï¼Œé‚£å°±å¯èƒ½é€ æˆå®ƒè™½ç„¶è®¾ç½®äº†è¶…æ—¶ï¼Œä½†æœ€ç»ˆç»“æœå¯èƒ½ç­‰å¾…äº†ä¸æ­¢ä¸€ä¸ªtimeoutæ—¶é—´æ‰æ‹¿åˆ°ç»“æœï¼Œè€Œä¸”è¿˜å¯èƒ½ä¼šä¸€ç›´è·å–ä¸åˆ°é”ã€‚ è·å–é”çš„å¼€å¤´ç”¨ä¸€ä¸ª_heldå†…éƒ¨å±æ€§æ¥åˆ¤æ–­å½“å‰å®ä¾‹æ˜¯å¦å·²ç»æ‹¥æœ‰äº†é”ï¼Œè¿™é‡Œå°±æ˜¯ä¸Šä¸€æ­¥ä¸­çš„idå±æ€§çš„ç”¨å¤„ï¼Œæ¥åˆ¤æ–­é”çš„æ‹¥æœ‰è€…ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456def get_owner_id(self): return self._client.get(self._name)@propertydef _held(self): return self.id == self.get_owner_id() åˆ·æ–°é”åˆ·æ–°é”æ¯”è¾ƒç¹çï¼Œä½œè€…ç”¨äº†ä¸€ä¸ªçº¿ç¨‹åœ¨åå°å®šæ—¶åˆ·æ–°ï¼Œä¸è¿‡æˆ‘ä»¬å…ˆæ¥çœ‹åˆ·æ–°é”çš„å®é™…æ“ä½œï¼šextendæ–¹æ³•, è¿™ä¸ªå‡½æ•°æ²¡åŠ ä¸‹åˆ’çº¿å‰ç¼€ä¹Ÿå°±æ˜¯å…è®¸é”çš„æ‹¥æœ‰è€…è‡ªå·±æ‰‹åŠ¨åˆ·æ–°ã€‚ 1234567891011121314151617def extend(self, expire=None): &quot;&quot;&quot;Extends expiration time of the lock. :param expire: New expiration time. If ``None`` - `expire` provided during lock initialization will be taken. &quot;&quot;&quot; # ... æ­¤å¤„çœç•¥å‚æ•°æ ¡éªŒä»£ç  # è¿™é‡Œè°ƒç”¨ç¬¬ä¸€æ­¥æåˆ°çš„Luaè„šæœ¬ï¼Œç”¨ç´¢å¼•EXTENDæ¥æŒ‡å®šè„šæœ¬ï¼Œå¹¶å°†è¶…æ—¶æ—¶é—´`expire`å’Œè‡ªèº«è¯†åˆ« id ä¼ å…¥è„šæœ¬ã€‚ error = _eval_script(self._client, EXTEND, self._name, args=(expire, self._id)) if error == 1: raise NotAcquired(&quot;Lock %s is not acquired or it already expired.&quot; % self._name) elif error == 2: raise NotExpirable(&quot;Lock %s has no assigned expiration time&quot; % self._name) elif error: raise RuntimeError(&quot;Unsupported error code %s from EXTEND script&quot; % error) è¿™ä¸ªEXTENDæ“ä½œçš„ Lua è„šæœ¬å¦‚ä¸‹: 12345678910111213# Covers both cases when key doesn&#x27;t exist and doesn&#x27;t equal to lock&#x27;s id# åˆ·æ–°å‰åˆ¤æ–­é”æ˜¯å¦å±äºè¯¥æ‹¥æœ‰è€…ï¼Œåªå…è®¸æ‹¥æœ‰è€…å»¶é•¿é”çš„TTLEXTEND_SCRIPT = b&quot;&quot;&quot; if redis.call(&quot;get&quot;, KEYS[1]) ~= ARGV[2] then return 1 elseif redis.call(&quot;ttl&quot;, KEYS[1]) &lt; 0 then return 2 else redis.call(&quot;expire&quot;, KEYS[1], ARGV[1]) return 0 end&quot;&quot;&quot;EXTEND_SCRIPT_HASH = sha1(EXTEND_SCRIPT).hexdigest() åˆ·æ–°é”çš„çº¿ç¨‹ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051def _start_lock_renewer(self): &quot;&quot;&quot; Starts the lock refresher thread. &quot;&quot;&quot; if self._lock_renewal_thread is not None: raise AlreadyStarted(&quot;Lock refresh thread already started&quot;) # çº¿ç¨‹äº‹ä»¶ç”¨æ¥ç›‘å¬åˆ·æ–°æ˜¯å¦ç»“æŸ self._lock_renewal_stop = threading.Event() self._lock_renewal_thread = threading.Thread( group=None, target=self._lock_renewer, kwargs=&#123;&#x27;lockref&#x27;: weakref.ref(self), # å¯¹é”å®ä¾‹åšäº†ä¸€ä¸ªå¼±å¼•ç”¨ &#x27;interval&#x27;: self._lock_renewal_interval, &#x27;stop&#x27;: self._lock_renewal_stop&#125; ) self._lock_renewal_thread.setDaemon(True) self._lock_renewal_thread.start()@staticmethoddef _lock_renewer(lockref, interval, stop): &quot;&quot;&quot; Renew the lock key in redis every `interval` seconds for as long as `self._lock_renewal_thread.should_exit` is False. &quot;&quot;&quot; log = getLogger(&quot;%s.lock_refresher&quot; % __name__) # ç­‰å¾…ç»ˆæ­¢äº‹ä»¶åˆ°æ¥ï¼Œå¦åˆ™åœ¨æŒ‡å®šè¶…æ—¶åè¿”å›False while not stop.wait(timeout=interval): log.debug(&quot;Refreshing lock&quot;) lock = lockref() # è°ƒç”¨è¿™ä¸ªå¼±å¼•ç”¨æ¥è·å–å½“å‰é”å®ä¾‹ if lock is None: # å¦‚æœè¿™ä¸ªé”å·²ç»åœ¨å…¶å®ƒçº¿ç¨‹è¢«é”€æ¯åˆ™å¯¹åº”åˆ·æ–°çº¿ç¨‹ä¹Ÿåº”è¯¥å…³é—­ log.debug(&quot;The lock no longer exists, &quot; &quot;stopping lock refreshing&quot;) break lock.extend(expire=lock._expire) del lock # åˆ é™¤å¼±å¼•ç”¨ log.debug(&quot;Exit requested, stopping lock refreshing&quot;)def _stop_lock_renewer(self): &quot;&quot;&quot; Stop the lock renewer. This signals the renewal thread and waits for its exit. &quot;&quot;&quot; if self._lock_renewal_thread is None or not self._lock_renewal_thread.is_alive(): return logger.debug(&quot;Signalling the lock refresher to stop&quot;) self._lock_renewal_stop.set() # äº‹ä»¶é€šçŸ¥å­çº¿ç¨‹é€€å‡º self._lock_renewal_thread.join() self._lock_renewal_thread = None logger.debug(&quot;Lock refresher has stopped&quot;) è¿™é‡Œä¸»è¦æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨é—®é¢˜ã€‚ä¼ å…¥äº†Daemonå®ˆæŠ¤è¿›ç¨‹çš„å˜é‡è¦æ ¼å¤–å°å¿ƒï¼Œå¾ˆå®¹æ˜“é€ æˆå³ä½¿ä¸»çº¿ç¨‹å·²ç»ä¸å†å¼•ç”¨è¿™ä¸ªå˜é‡ï¼Œè€Œå®ˆæŠ¤è¿›ç¨‹ä¸ä¾èµ–è¯¥å˜é‡ï¼Œå´ä¸€ç›´å¼•ç”¨ç€ï¼Œå°±å¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾ã€‚ é‡Šæ”¾é”é‡Šæ”¾é”çš„å®é™…æ“ä½œå’Œåˆ·æ–°é”ä¸€æ ·ï¼Œå› ä¸ºéƒ½æ¶‰åŠå¤šä¸ª Redis å‘½ä»¤ï¼Œæ‰€ä»¥ä»–ä»¬éƒ½æ”¾åœ¨äº† Lua è„šæœ¬ä¸­ã€‚ 123456789101112131415161718192021222324def release(self): &quot;&quot;&quot;Releases the lock, that was acquired with the same object. .. note:: If you want to release a lock that you acquired in a different place you have two choices: * Use ``Lock(&quot;name&quot;, id=id_from_other_place).release()`` * Use ``Lock(&quot;name&quot;).reset()`` &quot;&quot;&quot; if self._lock_renewal_thread is not None: # å¦‚æœæœ‰åˆ·æ–°çº¿ç¨‹åˆ™åœæ­¢å®ƒ self._stop_lock_renewer() logger.debug(&quot;Releasing %r.&quot;, self._name) error = _eval_script(self._client, UNLOCK, self._name, self._signal, args=(self._id,)) if error == 1: raise NotAcquired(&quot;Lock %s is not acquired or it already expired.&quot; % self._name) elif error: raise RuntimeError(&quot;Unsupported error code %s from EXTEND script.&quot; % error) else: self._delete_signal()def _delete_signal(self): self._client.delete(self._signal) è‡³äºUNLOCKè„šæœ¬æ“ä½œåœ¨ç¬¬ä¸€æ­¥é‡Œå·²ç»å±•ç¤ºå‡ºæ¥ï¼Œå¦‚æœæŒæœ‰è¯¥é”åˆ™å…ˆåˆ é™¤signalåˆ—è¡¨ï¼Œå†pushä¸€ä¸ªé€šçŸ¥åˆ°signalåˆ—è¡¨ï¼Œæœ€ååˆ é™¤é”ã€‚è¿™äº›æ­¥éª¤éƒ½ä¼šåœ¨ä¸€ä¸ªLuaå‡½æ•°ä¸­æ‰§è¡Œä¿è¯åŸå­æ€§ã€‚ ä¸Šä¸‹æ–‡æ”¯æŒä½œè€…ä¹Ÿé‡è½½äº†__enter__å’Œ__exit__ä¸¤ä¸ªå‡½æ•°æ¥æ”¯æŒwithçš„ä¸Šä¸‹æ–‡è°ƒç”¨ï¼Œä¹Ÿå¾ˆç®€å•ï¼š 1234567def __enter__(self): acquired = self.acquire(blocking=True) assert acquired, &quot;Lock wasn&#x27;t acquired, but blocking=True&quot; return selfdef __exit__(self, exc_type=None, exc_value=None, traceback=None): self.release() ç¤ºä¾‹ä»£ç è¿™é‡Œæˆ‘å°±ç›´æ¥è´´ä¸Šä½œè€…çš„ç¤ºä¾‹ä»£ç ï¼š 12345678910conn = StrictRedis()with redis_lock.Lock(conn, &quot;name-of-the-lock&quot;): print(&quot;Got the lock. Doing some work ...&quot;) time.sleep(5)# Eg:lock = redis_lock.Lock(conn, &quot;name-of-the-lock&quot;)if lock.acquire(blocking=False): print(&quot;Got the lock.&quot;)else: print(&quot;Someone else has the lock.&quot;) æ€»ç»“è¿™ä¸ªåº“æä¾›çš„åˆ†å¸ƒå¼é”å¾ˆçµæ´»ï¼Œæ˜¯å¦éœ€è¦è¶…æ—¶ï¼Ÿæ˜¯å¦éœ€è¦è‡ªåŠ¨åˆ·æ–°ï¼Ÿæ˜¯å¦è¦é˜»å¡ï¼Ÿéƒ½æ˜¯å¯é€‰çš„ã€‚æ²¡æœ‰æœ€å¥½çš„ç®—æ³•ï¼Œåªæœ‰æœ€åˆé€‚çš„ç®—æ³•ï¼Œç”¨æˆ·åº”è¯¥æ ¹æ®è‡ªå·±æ˜¯åœºæ™¯è°¨æ…é€‰æ‹©ã€‚å–œæ¬¢çš„æœ‹å‹å¯ä»¥å»è¿™ä¸ªé¡¹ç›®çš„GitHubé¡µé¢ ç‚¹ä¸ªğŸŒŸã€‚ å¦å¤–ï¼ŒRedisè¿™ä¸ªä¸œè¥¿æ„Ÿè§‰å¯ä»¥åšå¾ˆå¤šäº‹ï¼Œè€Œä¸”å¯ä»¥åšå¾ˆå¤šé«˜æ€§èƒ½çš„äº‹ã€‚å°¤å…¶åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œé‡ç‚¹æ˜¯è¿˜æ”¯æŒå„ç§æœ‰æ„æ€çš„ç‰¹æ€§ã€‚ç”¨å®ƒæ¥å®ç°åˆ†å¸ƒå¼é”å°±æ˜¾å¾—å†åˆé€‚ä¸è¿‡äº†ã€‚ åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œè°¢è°¢å¤§å®¶ï¼","categories":[],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"åˆ†å¸ƒå¼é”","slug":"åˆ†å¸ƒå¼é”","permalink":"https://unpluggedcoder.me/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"},{"name":"Distribution Lock","slug":"Distribution-Lock","permalink":"https://unpluggedcoder.me/tags/Distribution-Lock/"},{"name":"Redis","slug":"Redis","permalink":"https://unpluggedcoder.me/tags/Redis/"}]},{"title":"asynchronous logging with Python","slug":"Asynchronous-logging-with-Python","date":"2018-05-02T17:17:02.000Z","updated":"2022-09-15T15:51:05.342Z","comments":true,"path":"2018/05/03/Asynchronous-logging-with-Python/","link":"","permalink":"https://unpluggedcoder.me/2018/05/03/Asynchronous-logging-with-Python/","excerpt":"","text":"é¡¹ç›®ä¸­é€šå¸¸ä¼šç”¨Python loggingæ¨¡å—åšå‘æŠ¥è­¦é‚®ä»¶ã€å‘æ—¥å¿—åˆ°logstashç­‰åŠŸèƒ½ï¼Œç”šè‡³å¯ä»¥å‘é€åˆ°slackã€telegramè¿™ç±»åº”ç”¨ã€‚å¯èƒ½æ˜¯loggingæ¨¡å—å¤ªå¥½äº†ï¼Œç”¨æ¥åšè¿™äº›notificationéƒ½è¶³å¤Ÿäº†ã€‚ä½†å¦‚æœæœ‰é¢‘ç¹çš„logè¯·æ±‚æˆ–è€…æ¯”è¾ƒé«˜çš„å“åº”è¦æ±‚ï¼Œå¯èƒ½å°±ä¼šæœ‰å¾ˆå¤šæ—¶é—´èŠ±åœ¨è¿™äº›ç½‘ç»œæ—¥å¿—çš„è¿æ¥ä¸æ–­å¼€ä¸Šï¼Œå› æ­¤æƒ³æƒ³å¤§Pythonåº”è¯¥æœ‰å¼‚æ­¥æ—¥å¿—ä¹‹ç±»çš„ç¬¬ä¸‰æ–¹æ¨¡å—å§ã€‚æ‰¾äº†åŠå¤©æ²¡æœ‰åˆé€‚çš„å¯ä»¥æ»¡è¶³æˆ‘è¿™ç±»é€šç”¨ç½‘ç»œæ—¥å¿—çš„æ¨¡å—ï¼Œé‚è‡ªå·±å†™äº†ä¸ªã€‚ ä¸»è¦ç”¨çš„æ˜¯threadingæ¨¡å—ï¼Œå½“ç„¶å¦‚æœè§‰å¾—ä¸åˆé€‚å¯ä»¥ç”¨Celeryã€‚æ€è·¯å¾ˆç®€å•ï¼Œé‡è½½logging.Handleræ¥å†™è‡ªå·±çš„æ—¥å¿—å¤„ç†ã€‚è€ƒè™‘åˆ°ç½‘ç»œæ—¥å¿—å¯èƒ½æœ‰å¦‚ä¸Šå„ç§åº”ç”¨ï¼Œå†åŠ ä¸Šå¦‚æœéœ€è¦ä½¿ç”¨Celeryçš„è¯handler functionéœ€è¦å¯åºåˆ—åŒ–ï¼Œå› æ­¤ä¼ ä¸ªå›è°ƒç»™handlerå®ä¾‹ï¼Œå¹¶åœ¨emitæ–¹æ³•ä¸­è°ƒç”¨ã€‚è¿™ä¸ªå›è°ƒé‡Œåšç½‘ç»œæ—¥å¿—çš„å„ç§æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°è¶³å¤Ÿçš„å¯å®šåˆ¶åŒ–ï¼Œè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç ã€‚ 123456789101112131415161718import loggingimport timefrom celery import shared_taskfrom asynclog import AsyncLogDispatcher# ä½¿ç”¨Celery@shared_taskdef write_task(msg): # Write log in Network IO print(msg)celery_handler = AsyncLogDispatcher(write_task, use_thread=False, use_celery=True)celery_handler.setLevel(logging.INFO)logger.addHandler(celery_handler)logger.info(&#x27;Test Log&#x27;) 1234567891011121314# ä½¿ç”¨threadingdef write_log(msg): # Do write stuff, such as write log msg into network. # ... time.sleep(0.5)logger = logging.getLogger()logger.setLevel(logging.INFO)handler = AsyncLogDispatcher(write_log)handler.setLevel(logging.INFO)logger.addHandler(handler)logger.info(&#x27;Test Log&#x27;) 1234567891011121314151617181920212223242526272829# ç»“åˆdictConfiglog_cfg = &#123; &#x27;version&#x27;: 1, &#x27;disable_existing_loggers&#x27;: False, &#x27;formatters&#x27;: &#123; &#x27;simple&#x27;: &#123; &#x27;format&#x27;: &#x27;%(asctime)s \\n %(levelname)s \\n %(message)s&#x27; &#125;, &#125;, &#x27;handlers&#x27;: &#123; &#x27;async_handler&#x27;: &#123; &#x27;level&#x27;: &#x27;INFO&#x27;, &#x27;formatter&#x27;: &#x27;simple&#x27;, &#x27;class&#x27;: &#x27;asynclog.AsyncLogDispatcher&#x27;, &#x27;func&#x27;: &#x27;write_log&#x27;, &#125; &#125;, &#x27;loggers&#x27;: &#123; &#x27;asynclogger&#x27;: &#123; &#x27;handlers&#x27;: [&#x27;async_handler&#x27;, ], &#x27;level&#x27;: &#x27;DEBUG&#x27;, &#x27;propagate&#x27;: False, &#125;, &#125;&#125;logging.config.dictConfig(log_cfg)logger = logging.getLogger(&#x27;asynclogger&#x27;)logger.info(&#x27;Test asynclog&#x27;) è€ƒè™‘åˆ°é‡è½½çš„ç±»å®é™…åªæ˜¯ç”¨loggingçš„æ–¹æ³•æ¥filterã€formatæ—¥å¿—ï¼ŒçœŸæ­£å¤„ç†çš„å…¶å®åœ¨å›è°ƒä¸­ï¼Œæ‰€ä»¥ç±»åä¹Ÿå°±ä¸æ•¢å«AsyncLogHandler, å°±å–åAsyncLogDispatcherã€‚ è¯¥æ¨¡å—å·²ä¸Šä¼ è‡³pypi.org, pip install asynclogå³å¯ï¼Œä»£ç æ‰˜ç®¡åœ¨æˆ‘çš„GitHub, æ¬¢è¿äº¤æµã€‚","categories":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/categories/Python/"}],"tags":[{"name":"asynchronous","slug":"asynchronous","permalink":"https://unpluggedcoder.me/tags/asynchronous/"},{"name":"logging","slug":"logging","permalink":"https://unpluggedcoder.me/tags/logging/"},{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"Celery","slug":"Celery","permalink":"https://unpluggedcoder.me/tags/Celery/"}]},{"title":"åˆ©ç”¨SSHè¿œç¨‹ç«¯å£è½¬å‘è§£å†³Resilio Syncæ— æ³•è¿æ¥é—®é¢˜","slug":"ssh-remote-forward-for-resilio-sync","date":"2017-11-05T14:11:24.000Z","updated":"2022-09-15T15:51:05.352Z","comments":true,"path":"2017/11/05/ssh-remote-forward-for-resilio-sync/","link":"","permalink":"https://unpluggedcoder.me/2017/11/05/ssh-remote-forward-for-resilio-sync/","excerpt":"","text":"å› ä¸ºä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œæ—©åœ¨å‡ ä¸ªæœˆå‰Resilio Syncå°±è·ªäº†ï¼ˆä¹Ÿå°±æ˜¯åœ¨æˆ‘åˆšè´­ä¹°åçš„å‡ ä¸ªæœˆğŸ¤£ï¼‰ï¼Œä¹‹åä¹Ÿå°è¯•äº†ä¸€äº›ç½‘ä¸Šçš„æ–¹æ³•ï¼Œå§‹ç»ˆéƒ½ä¸è¡Œã€‚åæ¥å¿™äºå·¥ä½œä¹Ÿæ²¡æœ‰å»æŠ˜è…¾äº†ï¼Œåªæ˜¯ç®€å•çš„ç”¨å®ƒPredefined hosts(é¢„å®šä¹‰ä¸»æœº)åŠŸèƒ½è®©æˆ‘è‡³å°‘åœ¨å±€åŸŸç½‘é‡Œå¯ä»¥å¤‡ä»½ç…§ç‰‡ã€‚ å‘¨æœ«å¿½ç„¶æƒ³åˆ°SSHä¸æ˜¯å¯ä»¥è¿œç¨‹ç«¯å£è½¬å‘ä¹ˆï¼Ÿå°†æˆ‘çš„Resilio SyncæœåŠ¡å™¨ï¼ˆæ ‘è“æ´¾2ï¼‰ç«¯å£æ˜ å°„åˆ°å…¬ç½‘ä¸»æœºå³å¯ï¼Œç„¶ååœ¨Resilio Syncå®¢æˆ·ç«¯é‡Œå¡«å†™å…¬ç½‘çš„ç«¯å£ä¸å°±OKäº†ä¹ˆï¼Œå¾ˆç®€å•çš„æ€è·¯ã€‚ è®¾å¤‡ç¯å¢ƒå‡è®¾è®¾å¤‡ç¯å¢ƒå¦‚ä¸‹ï¼š æœ¬åœ°å†…ç½‘Resilio SyncæœåŠ¡å™¨ å…¬ç½‘æœåŠ¡å™¨ï¼Œå‡è®¾IP: 223.23.23.23 é…ç½®å…¬ç½‘æœåŠ¡å™¨sshd ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/ssh/sshd_config, æ·»åŠ æˆ–å¼€å¯GatewayPortsé€‰é¡¹ 12# /etc/ssh/sshd_configGatewayPorts yes è¿™ä¸ªé€‰é¡¹å…è®¸è¿œç¨‹ç«¯å£ç›‘å¬æ‰€æœ‰åœ°å€å‘æ¥çš„è¯·æ±‚ã€‚ç„¶åé‡å¯sshdæœåŠ¡ã€‚ 1$ sudo service sshd restart è¿œç¨‹ç«¯å£è½¬å‘å…³äºè¿œç¨‹ç«¯å£è½¬å‘æœ‰å¾ˆå¤šæ–‡ç« ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒæ–‡ç« æœ«å°¾å‡ ä¸ªé“¾æ¥ã€‚ä»¥ä¸‹æ˜¯å¯¹å†…ç½‘æœºå™¨çš„é…ç½®ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š ä¿æŒsshé•¿è¿æ¥ $ vim ~/.ssh/config åŠ å…¥å¦‚ä¸‹é…ç½® 12Host * ServerAliveInterval 60 å¼€å¯sshç«¯å£è½¬å‘ åœ¨å†…ç½‘æœºå™¨ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1$ ssh -fCgN -R 0.0.0.0:8090:localhost:37879 user@223.23.23.23 8090æ˜¯è¿œç¨‹ä¸»æœºä¸Šå¼€æ”¾çš„ç«¯å£ï¼Œæ³¨æ„è¿œç¨‹ä¸»æœºçš„é˜²ç«å¢™ä»¥åŠVPCçš„é˜²ç«å¢™ä¸è¦é˜»æ­¢è¯¥ç«¯å£ã€‚37879æ˜¯Resilio Syncä¾¦å¬çš„ç«¯å£ï¼Œè¿™ä¸ªå¯ä»¥åœ¨Web UIä¸ŠæŸ¥æ‰¾åˆ°ã€‚ å…³äºå…¶å®ƒå‡ ä¸ªå‚æ•°çš„è§£é‡Šæˆ‘å°±è´´è¿‡æ¥ï¼š -C å‹ç¼©æ•°æ®ä¼ è¾“-f å°† ssh è½¬åˆ°åå°è¿è¡Œï¼Œå³è®¤è¯ä¹‹åï¼Œssh è‡ªåŠ¨ä»¥åå°è¿è¡Œã€‚ä¸åœ¨è¾“å‡ºä¿¡æ¯-N ä¸æ‰§è¡Œè„šæœ¬æˆ–å‘½ä»¤ï¼Œå³é€šçŸ¥ sshd ä¸è¿è¡Œè®¾å®šçš„ shell é€šå¸¸ä¸ -f è¿ç”¨ ç¨å¾®éœ€è¦å¼ºè°ƒä¸‹çš„å‚æ•°ï¼š -g Allows remote hosts to connect to local forwarded ports. If used on a multiplexed connection, then this option must be specified on the master process. -gé€‰é¡¹å…è®¸è¿œç¨‹ä¸»æœºå‘èµ·åˆ°æœ¬åœ°ä¸»æœºçš„ç«¯å£è¿æ¥ï¼Œè¿™ä¸ªå¿…é¡»è¦å¼€å¯ã€‚ -R [bind_address:]port:host:hostport â€¦â€‹ By default, the listening socket on the server will be bound to the loopback interface only. This may be overridden by specifying a bind_address. An empty bind_address, or the address â€˜*â€™, indicates that the remote socket should listen on all interfaces. Specifying a remote bind_address will only succeed if the serverâ€™s GatewayPorts option is enabled (see sshd_config(5)). åŒæ ·è¿™é‡Œå¯ä»¥çœ‹åˆ°æ–‡æ¡£ä¸­æŒ‡æ˜è¿œç¨‹ä¸»æœºçš„GatewayPortsé€‰é¡¹å¿…é¡»å¼€å¯ï¼Œè¿™ä¸ªåœ¨ä¸Šä¸€ç‚¹æˆ‘ä»¬å·²ç»é…ç½®è¿‡äº†ã€‚ å¯ä»¥æŠŠè¿™ä¸ªSSHå‘½ä»¤åŠ å…¥è‡ªå¯åŠ¨è„šæœ¬ã€‚åœ¨é…ç½®çš„è¿‡ç¨‹ä¸­å»ºè®®å…ˆæ’æŸ¥é˜²ç«å¢™é—®é¢˜ï¼Œé¿å…ç«¯å£è¢«é˜»æ­¢ã€‚å¯ä»¥å…ˆç”¨Pythonå®˜æ–¹æ–‡æ¡£çš„è„šæœ¬åšæ¨¡æ‹Ÿè¯·æ±‚æµ‹è¯•ï¼Œè½¬å‘æˆåŠŸåå†åˆ‡æ¢ä¸ºResilio Syncç«¯å£ã€‚ Resilio Syncå®¢æˆ·ç«¯é…ç½®æœ€åä¸€æ­¥å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥åœ¨å®¢æˆ·ç«¯å…±äº«æ–‡ä»¶å¤¹çš„Preferences(é¦–é€‰é¡¹)é‡Œæ·»åŠ Predefined hosts(é¢„å®šä¹‰ä¸»æœº)ã€‚ å¯¹äºæ‰‹æœºå®¢æˆ·ç«¯çš„ç›¸æœºå¤‡ä»½æ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œè¿™ç‚¹æ¯”è¾ƒè›‹ç–¼ï¼Œæš‚æ—¶æ— æ³•é€šè¿‡è¿™ä¸ªæ–¹æ³•äº†ã€‚ å®æµ‹æ•ˆæœç”¨æˆ·æ•°å†ä¹Ÿä¸ä¸º0äº†ï¼Œä¸Šä¼ é€Ÿåº¦100å¤šKB&#x2F;Sï¼Œä¸‹è½½é€Ÿåº¦1+MB&#x2F;Sï¼Œæ¯”è¾ƒç¬¦åˆæˆ‘çš„å…¬ç½‘ä¸»æœºå¸¦å®½ï¼ŒåŸºæœ¬è·‘æ»¡äº†ã€‚è‡³äºè¿™ä¸ªæµé‡æ˜¯å¦èµ°å…¬ç½‘ä¸»æœºæš‚ä¸”ä¸æ¸…æ¥šï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªé¢„å®šä¹‰ä¸»æœºåº”è¯¥åªæ˜¯åšä¸ºä¸€ä¸ªå‘ç°æœåŠ¡ï¼Œä½†å®é™…çš„é€Ÿåº¦æ˜¾ç¤ºå‡ºä¼¼ä¹å’Œè¿œç¨‹è½¬å‘çš„å…¬ç½‘ä¸»æœºæœ‰å…³ğŸ¤£. å‚è€ƒé“¾æ¥ SSHéš§é“ä¸ç«¯å£è½¬å‘åŠå†…ç½‘ç©¿é€ SSH è¿œç¨‹ç«¯å£è½¬å‘ Linuxä½¿ç”¨sshè¶…æ—¶æ–­å¼€è¿æ¥çš„çœŸæ­£åŸå› ","categories":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"SSH","slug":"SSH","permalink":"https://unpluggedcoder.me/tags/SSH/"},{"name":"Resilio Sync","slug":"Resilio-Sync","permalink":"https://unpluggedcoder.me/tags/Resilio-Sync/"},{"name":"BT Sync","slug":"BT-Sync","permalink":"https://unpluggedcoder.me/tags/BT-Sync/"}]},{"title":"Migrate to Hexo","slug":"Migrate-to-Hexo","date":"2017-10-29T15:05:33.000Z","updated":"2022-09-15T15:51:05.346Z","comments":true,"path":"2017/10/29/Migrate-to-Hexo/","link":"","permalink":"https://unpluggedcoder.me/2017/10/29/Migrate-to-Hexo/","excerpt":"","text":"ä»Šå¤©ç»ˆäºå°†ä¸»é¡µå®Œå…¨çš„ä»Wordpressåˆ‡æ¢åˆ°äº†Hexo, ç°åœ¨å¯ä»¥ç”¨markdownå†™ä½œäº†ï¼Œä¸ç”¨æ‹…å¿ƒæ ¼å¼é—®é¢˜ğŸ˜‰ã€‚ ä¹‹å‰å°è¯•äº†åŒ…æ‹¬jekyllå’ŒPelicanåœ¨å†…çš„å‡ ä¸ªé™æ€åšå®¢æ–¹æ¡ˆï¼Œå”¯ç‹¬Hexoèƒ½å¤Ÿå¾ˆå¥½çš„å°†æˆ‘ä¹‹å‰æ—§çš„Wordpressè½¬æ¢æˆmarkdownï¼Œè™½ç„¶ä¹ŸèŠ±äº†ä¸å°‘åŠŸå¤«æ‰‹åŠ¨ä¿®æ”¹æ—§çš„æ–‡ç« ï¼Œä½†å·¥ä½œé‡ç›¸æ¯”å…¶å®ƒæ¡†æ¶å°‘äº†å¾ˆå¤šï¼ŒåŠ ä¸Špages.github.comçš„æ”¯æŒå·²ç»å¾ˆå¥½çš„æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ã€‚ä½¿ç”¨çš„æ˜¯cactus-darkä¸»é¢˜ï¼Œæ„Ÿè°¢ä½œè€…ï¼ å†™æ–‡ç« çš„é¢‘ç‡è¿œä¸å¦‚ä»¥å‰äº†ï¼Œ4æœˆä»½çš„æ—¶å€™åˆ›å»ºäº†è°çš„Emailã€‚è¿™ä¸ªç½‘ç«™å…¶å®æ˜¯å‚ç…§äº†maildrop.ccçš„æºç ç”¨Python+Djangoé‡æ–°å®ç°äº†ï¼Œç®€åŒ–äº†åƒåœ¾é‚®ä»¶è¿‡æ»¤åœ¨å†…çš„å¾ˆå¤šåŠŸèƒ½ï¼Œä½†ä¹ŸåŸºæœ¬å¤Ÿç”¨ï¼Œç›®å‰é™¤äº†è‡ªå·±ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨æˆ·é‡ï¼Œç®—æ˜¯ä¸€ä¸ªå¤±è´¥çš„Side projectå§ã€‚åç»­ä¼šå°†è¿™ä¸ªæºç å…¬å¼€åˆ°GitHubä¸Šï¼Œå½“ç„¶äº†ï¼Œä»¥æˆ‘ä»¥å¾€çš„é£æ ¼ï¼Œpoåˆ°GitHubçš„é¡¹ç›®åŸºæœ¬å°±ä¸æ›´æ–°äº†ğŸ˜‚ã€‚ ä¸è¿‡è‡ªå·±ä¹Ÿå¾ˆå¿«åœ¨é…é…¿ä¸‹ä¸€ä¸ªSide projectäº†ã€‚ç”±äºè‡ªå·±æ˜¯åç«¯å‡ºèº«ï¼Œå¯¹å‰ç«¯çŸ¥è¯†éå¸¸æ¬ ç¼º, æ‰€ä»¥ç›®å‰ä¹Ÿåœ¨å­¦ä¹ ä¸€ä¸ªå‰ç«¯æ¡†æ¶Angular 2+, ä¸çŸ¥ä¸è§‰æ„Ÿè§‰åƒå…¨æ ˆäº†ã€‚Anyway, å°½æ—©å°†ä¸ªé¡¹ç›®å¸¦ç»™å¤§å®¶å§ã€‚","categories":[],"tags":[]},{"title":"åˆ›å»ºDjango Rest Frameworkçš„æ–¹æ³•åºåˆ—åŒ–è§†å›¾","slug":"åˆ›å»ºDjango-Rest-Frameworkçš„æ–¹æ³•åºåˆ—åŒ–è§†å›¾","date":"2017-09-14T03:53:53.000Z","updated":"2022-09-15T15:51:05.352Z","comments":true,"path":"2017/09/14/åˆ›å»ºDjango-Rest-Frameworkçš„æ–¹æ³•åºåˆ—åŒ–è§†å›¾/","link":"","permalink":"https://unpluggedcoder.me/2017/09/14/%E5%88%9B%E5%BB%BADjango-Rest-Framework%E7%9A%84%E6%96%B9%E6%B3%95%E5%BA%8F%E5%88%97%E5%8C%96%E8%A7%86%E5%9B%BE/","excerpt":"","text":"Django Rest Framework(DRF)æä¾›çš„æ¡†æ¶æå¤§çš„æ–¹ä¾¿äº†REST APIçš„å¼€å‘å·¥ä½œã€‚å…¶ä¸­çš„genericsæ¨¡å—æä¾›äº†å¾ˆå¤šé€šç”¨åœºæ™¯ä¸‹çš„è§†å›¾ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å‘ç°åœ¨æ¨¡å‹åºåˆ—åŒ–ModelSerializeræ–¹é¢æ€»æœ‰äº›ä¸ä¾¿ã€‚ ä¾‹å¦‚ä¸‹é¢çš„æƒ…å†µ: 1234567891011121314151617# models.pyimport uuidfrom django.db import modelsclass Organization(models.Model): org_uuid = models.UUIDField( primary_key=True, default=uuid.uuid4, editable=False) name = models.CharField(max_length=40)class User(AbstractBaseUser): user_uuid = models.UUIDField( primary_key=True, default=uuid.uuid4, editable=False) # ä¸ºäº†æ–¹ä¾¿ç®€æ´ï¼Œçœç•¥å…¶ä½™å­—æ®µï¼Œä¾‹å¦‚username... org = models.ForeignKey(&#x27;Organization&#x27;, on_delete=models.CASCADE,) é€šå¸¸åœ¨Modelä¸­éƒ½ä¼šé‡åˆ°å¤–é”®æˆ–è€…å…¶å®ƒå…³ç³»çš„å­—æ®µã€‚åœ¨åˆ›å»ºUserï¼ˆæ— é¡»è¿çº§åˆ›å»ºOrganizationï¼‰æˆ–è€…æ›´æ–°å…¶orgå­—æ®µæ—¶æˆ‘ä»¬å¸Œæœ›æä¾›å…¶æ‰€å±çš„Organizationä¸»é”®org_uuidå³å¯ï¼Œè€Œåœ¨è·å–ä¸€ä¸ªUseræ—¶ï¼Œä»…ä»…è¿”å›ä¸€ä¸ªorg_uuidå¹¶ä¸èƒ½å‘Šè¯‰è°ƒç”¨è€…ä»»ä½•æœ‰æ„ä¹‰çš„Organizationä¿¡æ¯ã€‚å› æ­¤ç”¨äºåˆ›å»ºå’Œè·å–Userçš„åºåˆ—åŒ–ç±»ä¹Ÿä¸å°½ç›¸åŒã€‚ äº‹å®ä¸Šæˆ‘æ›´å€¾å‘äºä»è¯·æ±‚çš„æ–¹æ³•Methodè§’åº¦æ¥å†³å®šä½¿ç”¨ä»€ä¹ˆæ ·çš„åºåˆ—åŒ–ç±»ã€‚æ ¹æ®ä¸Šé¢çš„æƒ…å†µï¼Œæˆ‘é€šå¸¸ä¼šè‡³å°‘åˆ›å»ºä¸¤ç§æ¨¡å‹åºåˆ—åŒ–ç±»ModelSerializerï¼š 1234567891011121314151617181920212223242526# serializers.pyfrom rest_framework import serializersfrom myapp import modelsclass OrganizationListViewSerializer(serializers.ModelSerializer): class Meta: model = models.Organization fields = &#x27;__all__&#x27;class UserListViewSerializer(serializers.ModelSerializer): org = OrganizationListViewSerializer() class Meta: model = models.User fields = &#x27;__all__&#x27;class UserCreateUpdateSerializer(serializers.ModelSerializer): org = serializers.PrimaryKeyRelatedField( queryset=models.Organization.objects.all()) class Meta: model = models.User fields = &#x27;__all__ åˆ©ç”¨åµŒå¥—çš„åºåˆ—åŒ–ç±»UserListViewSerializerèƒ½è‡ªåŠ¨æ‰©å±•Organizationçš„ä¿¡æ¯ã€‚è€Œåœ¨ä¿®æ”¹æˆ–è€…åˆ›å»ºUseræ—¶ï¼Œåªéœ€è¦æä¾›Organizationçš„ä¸»é”®å³å¯ã€‚ ç°åœ¨å›åˆ°genericsæ¨¡å—æä¾›çš„é€šç”¨è§†å›¾ä¸Šï¼Œæ ¹æ®RESTçš„åŸåˆ™ï¼Œé€šå¸¸ä½¿ç”¨çš„æ˜¯generics.ListCreateAPIViewå’Œgenerics.RetrieveUpdateAPIView, è¿™ä¹Ÿæ˜¯æ ¹æ®æ¥å£å’Œè¯·æ±‚æ–¹æ³•åŒºåˆ†å‡ºçš„é€šç”¨è§†å›¾ï¼Œåœ¨è§†å›¾è¿™ç‚¹ä¸Šæ¡†æ¶åšå¾—å¾ˆå¥½ã€‚ä½†æ˜¯é’ˆå¯¹åºåˆ—åŒ–ç±»è¿˜ä¸å¤Ÿçµæ´»ï¼Œé»˜è®¤ä¸€ä¸ªAPIViewåªèƒ½å®šä¹‰ä¸€ä¸ªserializer_classã€‚è€Œæˆ‘éœ€è¦çš„æ˜¯æ ¹æ®ä¸åŒè¯·æ±‚æ–¹æ³•åŒºåˆ†å‡ºä½¿ç”¨ä¸åŒçš„åºåˆ—åŒ–ç±»ã€‚å®ç°å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354# views.pyfrom rest_framework import exceptionsfrom rest_framework import genericsfrom myapp import modelsfrom myapp import serializers as serclass MethodSerializerView(object): &#x27;&#x27;&#x27; Utility class for get different serializer class by method. For example: method_serializer_classes = &#123; (&#x27;GET&#x27;): MyModelListViewSerializer, (&#x27;PUT&#x27;, &#x27;PATCH&#x27;): MyModelCreateUpdateSerializer &#125; &#x27;&#x27;&#x27; method_serializer_classes = None def get_serializer_class(self): assert self.method_serializer_classes is not None, ( &#x27;Expected view %s should contain method_serializer_classes &#x27; &#x27;to get right serializer class.&#x27; % (self.__class__.__name__, ) ) for methods, serializer_cls in self.method_serializer_classes.items(): if self.request.method in methods: return serializer_cls raise exceptions.MethodNotAllowed(self.request.method)class UsersListCreateView(MethodSerializerView, generics.ListCreateAPIView): &#x27;&#x27;&#x27; API: /users Method: GET/POST &#x27;&#x27;&#x27; queryset = models.User.objects.all() method_serializer_classes = &#123; (&#x27;GET&#x27;): ser.UserListViewSerializer, (&#x27;POST&#x27;): ser.UserCreateUpdateSerializer &#125;class UsersDetailView(MethodSerializerView, generics.RetrieveUpdateAPIView): &#x27;&#x27;&#x27; API: /user/:user_uuid Method: GET/PUT/PATCH &#x27;&#x27;&#x27; queryset = models.User.objects.all() method_serializer_classes = &#123; (&#x27;GET&#x27;): ser.UserListViewSerializer, (&#x27;PUT&#x27;, &#x27;PATCH&#x27;): ser.UserCreateUpdateSerializer &#125; æ³¨æ„æœ€åä¸¤ä¸ªViewçš„ç±»ç»§æ‰¿é¡ºåºï¼ŒMethodSerializerViewè¦åœ¨å‰ï¼Œæ‰èƒ½ä½¿å¾—å®ƒçš„get_serializer_classè¢«è°ƒç”¨ã€‚ å¦‚æ­¤ä¸€æ¥å¯ä»¥æ ¹æ®ä¸åŒçš„æ–¹æ³•é‡‡å–ä¸åŒåºåˆ—åŒ–ç­–ç•¥ï¼ŒğŸ˜‰","categories":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"Django","slug":"Django","permalink":"https://unpluggedcoder.me/tags/Django/"},{"name":"Django Rest Framework","slug":"Django-Rest-Framework","permalink":"https://unpluggedcoder.me/tags/Django-Rest-Framework/"}]},{"title":"å¿«é€Ÿæ•°æ®æŠ¥è¡¨ç¥å™¨ModeAnalytics","slug":"modeanalytics","date":"2016-11-04T05:06:03.000Z","updated":"2022-09-15T15:51:05.351Z","comments":true,"path":"2016/11/04/modeanalytics/","link":"","permalink":"https://unpluggedcoder.me/2016/11/04/modeanalytics/","excerpt":"","text":"æœ€è¿‘å‘ç°äº†ä¸€ä¸ªå¿«é€Ÿæ•°æ®æŠ¥è¡¨çš„ç¥å™¨ï¼ŒModeAnalytics. ç›®æ ‡ç”¨æˆ·ModeAnalytics(ä»¥ä¸‹ç®€ç§°Mode)ä¸»è¦é€‚åˆä½¿ç”¨Pythonå’ŒSQLçš„æ•°æ®æŠ¥è¡¨ç”Ÿæˆæ–¹å¼ï¼Œä¹Ÿæ˜¯ç›®å‰æˆ‘ä¸»è¦ç”¨çš„ä¸¤ç§è¯­è¨€ã€‚ å¯é€‚é…æ•°æ®æº ä»æä¾›çš„æ•°æ®æºæ¥çœ‹åŒ…æ‹¬äº†å‡ ä¹æ‰€æœ‰å¸¸è§çš„æ•°æ®æºã€‚åŒæ ·å¯ä»¥è¿æ¥é˜¿é‡Œäº‘çš„RDSï¼Œåªéœ€è¦å¼€å¯SSLéªŒè¯å³å¯ã€‚å¦‚æœä½ è¦è¿æ¥çš„æ•°æ®æºä½äºä¸€ä¸ªç§æœ‰ç½‘ç»œä¸­ï¼ˆä¾‹å¦‚é˜¿é‡Œäº‘ä¸»æœºå†…éƒ¨ç½‘ç»œï¼‰ï¼Œåˆ™éœ€è¦å€ŸåŠ©Mode Bridgeè¿™ä¸ªç”±Modeå¼€å‘çš„æ¡¥æ¥å·¥å…·ï¼Œå…·ä½“å®‰è£…æ–¹æ³•åœ¨è¿æ¥çš„æ­¥éª¤ä¸­éƒ½æœ‰æä¾›ã€‚ ä¼˜åŠ¿å®æ—¶SQLè®¡ç®—ä¸åŒäºTableauå’Œé˜¿é‡Œäº‘æ•°åŠ æŠ¥è¡¨ç­‰BIæœåŠ¡å‚å•†ï¼ŒModeéå¸¸é€‚åˆå¿«é€Ÿè¿­ä»£çš„æ•°æ®æŠ¥è¡¨ç”Ÿæˆã€‚å‰è€…ä¸å…·å¤‡åœ¨çº¿å®æ—¶è®¡ç®—ï¼ŒTableauåªèƒ½ä»ç°æœ‰çš„æ•°æ®ä¸­åšæŠ¥è¡¨åˆ†æï¼Œä½†æ˜¯å¯¹äºå¤æ‚çš„æŸ¥è¯¢è®¡ç®—æƒ³è¦å¿«é€Ÿå‡ºæŠ¥è¡¨å°±ä¸å¾—ä¸å°†ç»“æœå†™å…¥æ•°æ®åº“ä¸­ï¼Œå†ç”¨Tableauç­‰ç¬¬ä¸‰æ–¹å·¥å…·å‘ˆç°ã€‚è€ŒModeå¯ä»¥ç›´æ¥æå–SQLè®¡ç®—ç»“æœï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–çš„å­˜å‚¨ã€‚ è‡ªåŠ¨åŒ–æŠ¥è¡¨å‘ˆç°ä¸å®šåˆ¶Modeå¯ä»¥ä»SQLçš„ç»“æœä¸­è‡ªåŠ¨å‘ˆç°å›¾è¡¨(Chart) &amp;nbsp; è¿˜å¯ä»¥å°†å¤šä¸ªå›¾è¡¨æ•´åˆä¸ºä¸€ä»½æŠ¥è¡¨(Report)ã€‚å…³äºæŠ¥è¡¨ï¼Œè¿˜èƒ½é€šè¿‡HTMLè‡ªå®šä¹‰æŠ¥è¡¨çš„å¸ƒå±€ã€‚ å®˜æ–¹æä¾›äº†å¾ˆå¤šå®šåˆ¶æŠ¥è¡¨çš„ç¤ºä¾‹ã€‚ æ•´åˆPythonPyæ˜¯æ•°æ®åˆ†æçš„åˆ©å™¨ï¼Œå¯¹äºå¤æ‚çš„åˆ†æå’Œè®¡ç®—ï¼ŒModeä¹Ÿå¯ä»¥å€ŸåŠ©Pythonå®ç°ã€‚ Modeè‡ªå¸¦äº†ä¸€ä¸ªåœ¨çº¿çš„Python notebookç¼–è¾‘å™¨ï¼Œå¯ä»¥å¯¹SQLç»“æœè¿›è¡ŒäºŒæ¬¡åŠ å·¥ï¼ŒSQLçš„ç»“æœå­˜å‚¨åœ¨datasetsè¿™ä¸ªå˜é‡ä¸­ï¼Œç”¨æŸ¥è¯¢çš„åç§°åšç´¢å¼•å³å¯ã€‚ è€Œä¸”å®ƒçš„Pythonç¯å¢ƒåŒ…å«äº†è®¸å¤šå¸¸è§çš„è®¡ç®—åº“ï¼Œå¦‚pandasã€numpyã€‚ å€¼å¾—ä¸€æçš„æ˜¯ç”šè‡³åŒ…æ¶µäº†Plotlyè¿™ä¸ªå¼€æºå›¾å½¢åº“ï¼Œè€Œè¿™ä¸ªå¼€æºå›¾å½¢åº“æœ¬èº«ä¹Ÿæ˜¯æ”¯æŒPython notebookçš„ï¼Œæ‰€ä»¥å‘ç°Modeä¹Ÿæ”¯æŒå°†PlotåŠ å·¥å‡ºæ¥çš„å›¾è¡¨åŠ å…¥åˆ°æŠ¥è¡¨ä¸­å»ã€‚ åˆ†äº«ä¾¿æ·å¯ä»¥å°†æŠ¥è¡¨ç›´æ¥é€šè¿‡é‚®ä»¶çš„æ–¹å¼åˆ†äº«ç»™ä»–äººï¼Œæ¥æ”¶é‚®ä»¶è€…ä¸éœ€è¦æ³¨å†ŒModeå¸å·ã€‚é‚®ä»¶å†…å®¹åªèƒ½åŒ…å«Tableæ•°æ®ï¼Œä½†å¦‚æœåŒæ—¶å‹¾é€‰PDFé€‰é¡¹ï¼Œåˆ™æŠ¥è¡¨å°†ä»¥PDFé™„ä»¶çš„å½¢å¼ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°æŠ¥è¡¨å†…çš„å›¾è¡¨äº†ã€‚ è®¡åˆ’è¿è¡ŒæŠ¥è¡¨æœ€å¤§éœ€æ±‚æ˜¯èƒ½å¤Ÿè‡ªåŠ¨è®¡ç®—å’Œåˆ†äº«è®¢é˜…ã€‚ModeåŒæ ·å¯ä»¥åšåˆ°ã€‚å¯ä»¥åƒå®šåˆ¶Crontabä¸€æ ·è®¢åˆ¶æŠ¥è¡¨çš„è®¡åˆ’ä»»åŠ¡ã€‚åœ¨è®¡åˆ’ä»»åŠ¡æ—¶é—´åˆ°è¾¾æ—¶ä¼šè‡ªåŠ¨æ‰§è¡ŒæŠ¥è¡¨ä¸­çš„SQLè¯­å¥ï¼Œå¹¶å°†å¾—åˆ°æœ€æ–°çš„ç»“æœåˆ¶æˆæŠ¥è¡¨å‘é€æˆé‚®ä»¶è®¢é˜…ã€‚ Modeå¾ˆå¼ºå¤§ï¼Œç”¨èµ·æ¥å¾ˆçˆ½ï¼Œä¸»è¦æ˜¯æ²¡è¢«å¢™ï¼é€Ÿåº¦è¿˜ä¸é”™ï¼ å®¢æœå“åº”æ—¶é—´åœ¨ä¸€å¤©å†…ï¼Œ$19&#x2F;äºº&#x2F;æœˆçš„ä»·æ ¼ä¹Ÿæ˜¯ç›¸å¯¹å¾ˆä¾¿å®œã€‚ åŒä¸€ä¸ªé‚®ç®±åç¼€æ³¨å†Œçš„è´¦æˆ·ä¼šé»˜è®¤åŠ å…¥åˆ°åŒä¸€ä¸ªorganizationä¸­ã€‚","categories":[{"name":"æ•°æ®ç›¸å…³","slug":"æ•°æ®ç›¸å…³","permalink":"https://unpluggedcoder.me/categories/%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"Data Visualization","slug":"Data-Visualization","permalink":"https://unpluggedcoder.me/tags/Data-Visualization/"},{"name":"ModeAnalytics","slug":"ModeAnalytics","permalink":"https://unpluggedcoder.me/tags/ModeAnalytics/"},{"name":"RDS","slug":"RDS","permalink":"https://unpluggedcoder.me/tags/RDS/"},{"name":"SQL","slug":"SQL","permalink":"https://unpluggedcoder.me/tags/SQL/"}]},{"title":"é˜¿é‡Œäº‘RDSè¡¨æ•°æ®å¯¼å‡ºï¼ˆåŒæ­¥ï¼‰è‡³AWS RedShift","slug":"rds-to-redshift","date":"2016-11-04T03:55:49.000Z","updated":"2022-09-15T15:51:05.351Z","comments":true,"path":"2016/11/04/rds-to-redshift/","link":"","permalink":"https://unpluggedcoder.me/2016/11/04/rds-to-redshift/","excerpt":"","text":"åˆ©ç”¨DataPipeline(è‡ªåŠ¨) åœ¨AWSé¡µé¢ä¸ŠæŒ‰ç…§æŒ‡ç¤ºåˆ›å»ºä¸€ä¸ªDataPipelineä»»åŠ¡ï¼Œé€‰æ‹©æ¨¡æ¿ï¼šâ€Full copy of RDS MySQL table to RedShiftâ€ æˆ–è€… â€œIncremental copy of RDS MySQL table to RedShiftâ€ï¼ŒæŒ‰ç…§è¡¨æ ¼æç¤ºçš„å‚æ•°å¡«å†™å³å¯ã€‚ æ³¨æ„äº‹é¡¹ï¼š é˜¿é‡Œçš„RDSè¦å¡«å…¬ç½‘DNSåœ°å€ï¼Œå¹¶ä¸”å¼€æ”¾ç™½åå•ï¼› DataPipelineä¼šå°†RDSæ•°æ®å…ˆStageåˆ° S3ä¸Šï¼Œé€‰æ‹©çš„S3è¦å’ŒRedShiftåœ¨åŒä¸€ä¸ªåŒºåŸŸï¼› å¦‚æœé€‰æ‹©å¢é‡æ‹·è´ï¼Œéœ€è¦è¡¨åŒ…å«ä¸€ä¸ªLast Modified Columnå­—æ®µï¼› S3toRedShiftè¿™ä¸ªæµç¨‹éœ€è¦æ‰‹åŠ¨è®¾ç½®COPYçš„command optionï¼š * **CSV DELIMITER &#39;,&#39; COMPUPDATE OFF dateformat &#39;auto&#39; ACCEPTANYDATE IGNOREBLANKLINES** DataPipelineåœ¨æ‰§è¡Œæ—¶ä¼šå¯åŠ¨ä¸€ä¸ªEC2æ¥è·‘ä»»åŠ¡ï¼Œè·‘å®Œé»˜è®¤2å°æ—¶ä¹‹åè¿™ä¸ªEC2ä¼šè‡ªåŠ¨terminateï¼ŒæœŸé—´å¦‚æœæœ‰é”™è¯¯å¯ä»¥æ ¹æ®é”™è¯¯æç¤ºä¿®å¤ï¼Œå†ç«‹å³æ‰‹åŠ¨Rerunå‡ºé”™çš„æ­¥éª¤ï¼Œåç»­æ­¥éª¤ä¼šåœ¨å‡ºé”™æ­¥éª¤æˆåŠŸåæ»¡è¶³å…¶dependencyè‡ªåŠ¨æ‰§è¡Œï¼Œä¸éœ€è¦é‡å¼€ä¸€ä¸ªEC2ã€‚ åˆ©ç”¨AWS S3(æ‰‹åŠ¨) è¯¥æ–¹å¼ä½œä¸ºDataPipelineå¤±æ•ˆæ—¶ï¼ˆè·¨å›½çº¿è·¯æ•…éšœç­‰ç­‰â€¦ï¼‰çš„æ‰‹åŠ¨å¤‡ç”¨æ–¹æ¡ˆã€‚ ç”¨MySQLå®¢æˆ·ç«¯æˆ–ä»»æ„æ–¹å¼å°†æ•°æ®å¯¼å‡ºä¸ºCSVæ–‡ä»¶ï¼Œä¸å«headerï¼ŒCSVä¸­å­—æ®µé¡ºåºå¿…é¡»å’Œè¡¨å­—æ®µé¡ºåºä¸€è‡´ï¼ å°†CSVæ–‡ä»¶ä¸Šä¼ è‡³AWS S3; ç”¨psqlè¿æ¥RedShiftï¼Œè¿æ¥å‘½ä»¤æ ¼å¼ï¼š $ psql -h [Endpoint] -U [UserName] -d [DatabaseName] -p 5439_ ä¾‹å¦‚ï¼š_psql -h ****.****.us-west-2.redshift.amazonaws.com -U user -d database -p 5439_ ç”¨psqlè¿æ¥åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯:COPY [TableName] FROM &#39;s3://[BucketName]/path/to/data.csv&#39; CREDENTIALS &#39;aws_access_key_id=[S3_ACCESS_KEY];aws_secret_access_key=[S3_SECRET_KEY]&#39; CSV delimiter &#39;,&#39; dateformat &#39;auto&#39;;","categories":[{"name":"AWS","slug":"AWS","permalink":"https://unpluggedcoder.me/categories/AWS/"}],"tags":[{"name":"RDS","slug":"RDS","permalink":"https://unpluggedcoder.me/tags/RDS/"},{"name":"Aliyun","slug":"Aliyun","permalink":"https://unpluggedcoder.me/tags/Aliyun/"},{"name":"AWS","slug":"AWS","permalink":"https://unpluggedcoder.me/tags/AWS/"},{"name":"DataPipeline","slug":"DataPipeline","permalink":"https://unpluggedcoder.me/tags/DataPipeline/"},{"name":"RedShift","slug":"RedShift","permalink":"https://unpluggedcoder.me/tags/RedShift/"}]},{"title":"Macä¸‹æ­å»ºPythonå¼€å‘ç¯å¢ƒ","slug":"Macä¸‹æ­å»ºPythonå¼€å‘ç¯å¢ƒ","date":"2016-03-09T15:14:30.000Z","updated":"2022-09-15T15:51:05.345Z","comments":true,"path":"2016/03/09/Macä¸‹æ­å»ºPythonå¼€å‘ç¯å¢ƒ/","link":"","permalink":"https://unpluggedcoder.me/2016/03/09/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAPython%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/","excerpt":"","text":"è®°å½•ä¸‹ä¹‹å‰çš„å®‰è£…æµç¨‹ å®‰è£…Python å…ˆå®‰è£…homebrewã€‚ ç”¨homebrewå®‰è£…pythonï¼Œæ¨èpython3ã€‚ å¦‚æœå·²ç»ç”¨è‡ªå¸¦çš„&#x2F;usr&#x2F;bin&#x2F;pythonå®‰è£…äº†pipçš„è¯å¯ä»¥ç”¨pip uninstall pipæ¥åˆ é™¤è‡ªèº«ï¼Œé¿å…å’Œbrewçš„pipç›¸å†²çªã€‚ $ brew install python # Python 2.x $ brew install python3 å®‰è£…åä¼šåœ¨/usr/local/binä¸­å®‰è£…pythonæˆ–python3ï¼Œä¸ç³»ç»Ÿçš„/usr/bin/pythonç¯å¢ƒç‹¬ç«‹ã€‚ _&#x2F;usr&#x2F;local&#x2F;bin&#x2F;_ä¸­ä¹Ÿä¼šæœ‰å¯¹åº”çš„pipç‰ˆæœ¬å®‰è£…ï¼ˆpip2å’Œpip3ï¼‰ï¼Œä½¿ç”¨å¯¹åº”çš„pipå³å¯ã€‚ å¦‚æœæ˜¯ç”¨brew install pythonå®‰è£…äº†Python 2.xï¼Œé‚£ä¹ˆwhich -a pythonä¼šå‡ºç°ä¸¤ä¸ªpythonè·¯å¾„ã€‚ $ which -a python &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python &#x2F;usr&#x2F;bin&#x2F;python è¿™é‡Œæˆ‘ä¸æ¨èç”¨æ›¿æ¢ã€é“¾æ¥ç­‰æ–¹å¼æ¥æŒ‡å®šé»˜è®¤çš„pythonç‰ˆæœ¬ï¼Œå› ä¸ºæ‰€æœ‰çš„Pythoné¡¹ç›®éƒ½æ˜¯åœ¨virtualenvå†…éƒ¨ä¸­æ„å»ºï¼Œå¤–éƒ¨ç‰ˆæœ¬æ³¨æ„åŒºåˆ†å³å¯ã€‚ ä½¿ç”¨virtualenvwrapperéš”ç¦»é¡¹ç›®ç¯å¢ƒæ¯ä¸ªé¡¹ç›®åº”å½“ä½¿ç”¨è‡ªèº«çš„åŒ…ä¾èµ–ç¯å¢ƒï¼Œå¦‚æœå¤šä¸ªé¡¹ç›®å…±ç”¨ä¸€ä¸ªpipä¸‹çš„åŒ…ç¯å¢ƒä¼šé€ æˆå¾ˆå¤šæ··ä¹±ï¼ŒåŒæ ·ç»™éƒ¨ç½²å¸¦æ¥å›°éš¾ã€‚ å› æ­¤è¿™é‡Œå°±è¦ç”¨åˆ°virtualenvæ¥åˆ›å»ºè™šæ‹Ÿçš„pythonç¯å¢ƒï¼Œå®ƒçš„ä¸€ä¸ªæ›´å¥½å°è£…æ˜¯virtualenvwrapperã€‚ å®‰è£…virtualenvwrapper $ pip3 install virtualenvwrapper è®¾ç½®virtualenvwrapperç¯å¢ƒå˜é‡ï¼Œæ·»åŠ ä¸‹é¢å†…å®¹åˆ°~&#x2F;.bash_profile 12345678910111213# set where virutal environments will liveexport WORKON_HOME=$HOME/.virtualenvs# ensure all new environments are isolated from the site-packages directoryexport VIRTUALENVWRAPPER_VIRTUALENV_ARGS=&#x27;--no-site-packages&#x27;# use the same directory for virtualenvs as virtualenvwrapperexport PIP_VIRTUALENV_BASE=$WORKON_HOME# makes pip detect an active virtualenv and install to itexport PIP_RESPECT_VIRTUALENV=trueif [[ -r /usr/local/bin/virtualenvwrapper.sh ]]; thensource /usr/local/bin/virtualenvwrapper.shelseecho &quot;WARNING: Can&#x27;t find virtualenvwrapper.sh&quot;fi é‡æ–°æ‰“å¼€shellçª—å£ï¼Œæˆ–è€…source ~/.bash_profileï¼Œè¾“å…¥mkvirtualenv â€”helpæ²¡æœ‰æŠ¥é”™ä»£è¡¨å®‰è£…æˆåŠŸ åˆ©ç”¨mkvirtualenvåˆ›å»ºè™šæ‹Ÿçš„Pythonç¯å¢ƒ $ mkvirtualenv test_env é»˜è®¤é‡‡ç”¨$(which python)çš„ç‰ˆæœ¬åˆ›å»ºï¼Œé€šå¸¸æ˜¯Python 2.x, æˆ–è€…ç”¨-på‚æ•°æŒ‡å®šåŸºäºæŸä¸ªç‰ˆæœ¬pythonæ¥åˆ›å»ºå¯¹åº”ç‰ˆæœ¬çš„è™šæ‹Ÿç¯å¢ƒï¼Œéå¸¸çµæ´» $ mkvirtualenv -p &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3 py3_env è¿›å…¥è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…é¡¹ç›®ä¾èµ–åº“ $ workon py3_env (py3_env) $ python â€“version Python 3.5.1 (py3_env) $ pip â€“version pip 8.0.3 from &#x2F;Users&#x2F;Bing&#x2F;.virtualenvs&#x2F;dataflow_env&#x2F;lib&#x2F;python3.5&#x2F;site-packages (python 3.5) (py3_env) $ pip install -r requirements.txt é€€å‡ºè™šæ‹Ÿç¯å¢ƒ (py3_env) $ deactivate $","categories":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"Mac","slug":"Mac","permalink":"https://unpluggedcoder.me/tags/Mac/"},{"name":"pip","slug":"pip","permalink":"https://unpluggedcoder.me/tags/pip/"}]},{"title":"For å¸•å°”å“ˆæ","slug":"For å¸•å°”å“ˆæ","date":"2016-01-13T13:13:51.000Z","updated":"2022-09-20T15:52:15.854Z","comments":true,"path":"2016/01/13/For å¸•å°”å“ˆæ/","link":"","permalink":"https://unpluggedcoder.me/2016/01/13/For%20%E5%B8%95%E5%B0%94%E5%93%88%E6%8F%90/","excerpt":"My early years sketch.","text":"My early years sketch.","categories":[{"name":"æ¶‚é¸¦","slug":"æ¶‚é¸¦","permalink":"https://unpluggedcoder.me/categories/%E6%B6%82%E9%B8%A6/"}],"tags":[{"name":"ç´ æ","slug":"ç´ æ","permalink":"https://unpluggedcoder.me/tags/%E7%B4%A0%E6%8F%8F/"}]},{"title":"[è¯‘] WPF MVVM å¾ªåºæ¸è¿›(ä»åŸºç¡€åˆ°é«˜çº§)","slug":"[è¯‘] WPF MVVM å¾ªåºæ¸è¿›(ä»åŸºç¡€åˆ°é«˜çº§)","date":"2015-11-27T03:03:30.000Z","updated":"2022-09-15T15:51:05.350Z","comments":true,"path":"2015/11/27/[è¯‘] WPF MVVM å¾ªåºæ¸è¿›(ä»åŸºç¡€åˆ°é«˜çº§)/","link":"","permalink":"https://unpluggedcoder.me/2015/11/27/[%E8%AF%91]%20WPF%20MVVM%20%E5%BE%AA%E5%BA%8F%E6%B8%90%E8%BF%9B(%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E9%AB%98%E7%BA%A7)/","excerpt":"","text":"è¿™æ˜¯ä¸€å¹´å¤šå‰å‘è¡¨åœ¨CodeProjectä¸Šçš„ä¸€ç¯‡æ–‡ç« , è®²çš„æ˜¯WPFçš„MVVMæ¡†æ¶, ç°åœ¨æ¥çœ‹Windowsè‡ªå®¶çš„æ¡Œé¢æŠ€æœ¯å·²ç»æ²¡æœ‰å½“åˆçš„å…‰ç¯äº†, æˆ‘ä¹Ÿæ˜¯å› ä¸ºæœ€è¿‘å·¥ä½œéœ€è¦, å­¦ä¹ ç¿»é˜…äº†å¾ˆå¤šè¿™æ–¹é¢èµ„æ–™. è§‰å¾—MVVMæ¡†æ¶çš„ç¡®åœ¨ä¸€å®šç¨‹åº¦ä¸Šç®€åŒ–äº†UIçš„å¼€å‘, å¯¹è±¡,æ¨¡å‹å„å¸å…¶èŒ. è€Œè¿™ç¯‡æ–‡ç« ç®—æ˜¯æˆ‘çœ‹åˆ°çš„æ¯”è¾ƒå…¨é¢çš„MVVMå…¥é—¨æ•™ç¨‹, å…³äºä¸ºä»€ä¹ˆ, æ€ä¹ˆæ ·, å¦‚ä½•åšçš„é—®é¢˜éƒ½è¯´å¾—å¾ˆè¯¦ç»†. å½“ç„¶è¿™åªæ˜¯MVVMä»å…¥é—¨åˆ°é«˜çº§çš„æ–‡ç« , å…³äºæ›´å¤šçš„MVVMé«˜çº§çš„æŠ€å·§åœ¨æ–‡ç« æœ€åæœ‰å‡ ä¸ªå»¶ä¼¸é˜…è¯», æœ‰è¿™æ–¹é¢éœ€æ±‚çš„åŒå­¦å¯çœ‹çœ‹. æœ¬æ–‡ç¿»è¯‘è‡ªShivprasad koiralaåœ¨CodeProjectä¸Šçš„æ–‡ç« :WPF MVVM step by step (Basics to Advance Level) [TOC] ç®€ä»‹ä»æˆ‘ä»¬è¿˜æ˜¯å„¿ç«¥åˆ°å­¦ä¹ æˆé•¿ä¸ºæˆå¹´äººï¼Œ ç”Ÿå‘½ä¸€ç›´éƒ½åœ¨æ¼”å˜ã€‚ å¯¹äºè½¯ä»¶æ¶æ„ï¼Œ åŒæ ·é€‚ç”¨è¿™ä¸ªé“ç†ï¼Œ ä»ä¸€ä¸ªåŸºç¡€çš„æ¶æ„å¼€å§‹ï¼Œ éšç€æ¯ä¸ªéœ€æ±‚å’Œæƒ…å¢ƒåœ¨ä¸æ–­æ¼”åŒ–ã€‚ å¦‚æœä½ é—®ä»»ä½•ä¸€ä¸ª.NETå¼€å‘è€…ï¼Œ ä»€ä¹ˆæ˜¯æœ€å°çš„åŸºç¡€æ¶æ„ï¼Œ é¦–å…ˆæµ®ç°çš„å°±æ˜¯â€ä¸‰å±‚æ¶æ„â€ã€‚ åœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œ æˆ‘ä»¬æŠŠé¡¹ç›®åˆ†ä¸ºä¸‰ä¸ªé€»è¾‘å±‚æ¬¡: UIå±‚ï¼Œ ä¸šåŠ¡é€»è¾‘å±‚å’Œæ•°æ®è®¿é—®å±‚ï¼Œ æ¯ä¸€å±‚éƒ½è´Ÿè´£å„è‡ªå¯¹åº”çš„åŠŸèƒ½ã€‚ UIè´Ÿè´£æ˜¾ç¤ºåŠŸèƒ½ï¼Œ ä¸šåŠ¡é€»è¾‘å±‚è´Ÿè´£æ ¡éªŒï¼Œ æ•°æ®è®¿é—®å±‚è´Ÿè´£SQLè¯­å¥ã€‚ 3å±‚æ¶æ„æœ‰å¦‚ä¸‹çš„å¥½å¤„: åŒ…å®¹å˜åŒ–: æ¯ä¸€å±‚çš„å˜åŒ–ä¸ä¼šé‡å¤è·¨è¶Šåˆ°å…¶å®ƒå±‚æ¬¡ã€‚ é‡ç”¨æ€§: å¢å¼ºå¯é‡ç”¨æ€§ï¼Œ å› ä¸ºæ¯ä¸€å±‚éƒ½æ˜¯åˆ†ç¦»ï¼Œ è‡ªåŒ…å®¹çš„ç‹¬ç«‹å®ä½“MVVMæ˜¯ä¸‰å±‚æ¶æ„çš„ä¸€ä¸ªæ¼”åŒ–ã€‚ æˆ‘çŸ¥é“æˆ‘æ²¡æœ‰ä¸€ä¸ªå†å²å»è¯æ˜è¿™ç‚¹ï¼Œ ä½†æ˜¯æˆ‘ä¸ªäººå¯¹MVVMè¿›è¡Œäº†æ¼”åŒ–å’Œè§‚å¯Ÿã€‚ é‚£æˆ‘ä»¬å…ˆä»ä¸‰å±‚åŸºç¡€æ¶æ„å¼€å§‹ï¼Œ å»ç†è§£ä¸‰å±‚æ¶æ„å­˜åœ¨çš„é—®é¢˜ï¼Œ çœ‹MVVMæ¶æ„æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Œ ç„¶åå‡çº§åˆ°å»åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„MVVMæ¡†æ¶ä»£ç ã€‚ ä¸‹é¢æ˜¯æœ¬æ–‡æ¥ä¸‹æ¥çš„è·¯çº¿å›¾ã€‚ ç®€å•çš„ä¸‰å±‚æ¶æ„ç¤ºä¾‹å’ŒGLUE(èƒ¶æ°´)ä»£ç é—®é¢˜é¦–å…ˆï¼Œ è®©æˆ‘ä»¬æ¥ç†è§£ä¸‰å±‚æ¶æ„ä»¥åŠå®ƒå­˜åœ¨çš„é—®é¢˜ï¼Œ ç„¶åçœ‹MVVMå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ç›´è§‰å’Œç°å®æ˜¯ä¸¤ç§ä¸åŒçš„äº‹ç‰©ã€‚ å½“ä½ çœ‹åˆ°ä¸‰å±‚æ¶æ„çš„å›¾ï¼Œ ä½ é¦–å…ˆçš„ç›´è§‰æ˜¯æ¯ä¸ªåŠŸèƒ½å¯èƒ½éƒ½åˆ†å¸ƒåœ¨å„è‡ªå±‚æ¬¡ã€‚ ä½†æ˜¯å½“ä½ å®é™…ç¼–å†™ä»£ç æ—¶ï¼Œ æœ‰äº›å±‚æ¬¡è¢«å¼ºè¿«å»åšä¸€äº›å®ƒä»¬ä¸åº”è¯¥åšçš„é¢å¤–çš„å·¥ä½œ(ç ´åäº†SOLIDåŸåˆ™)ã€‚ å¦‚æœä½ å¯¹SOLIDåŸåˆ™è¿˜ä¸ç†Ÿæ‚‰å¯ä»¥å‚è€ƒè¿™ä¸ªè§†é¢‘: SOLID principle video(è¯‘è€…æ³¨: SOLIDæŒ‡Single responsibilityï¼Œ Open-closedï¼Œ Liskov substitutionï¼Œ Interface segregation and Dependency inversionï¼Œ å³å•ä¸€åŠŸèƒ½ã€å¼€é—­åŸåˆ™ã€é‡Œæ°æ›¿æ¢ã€æ¥å£éš”ç¦»ä»¥åŠä¾èµ–åè½¬)ã€‚ è¿™éƒ¨åˆ†é¢å¤–å·¥ä½œå°±åœ¨UIä¸Modelä¹‹é—´ï¼Œ ä»¥åŠModelä¸Data accessä¹‹é—´ã€‚ æˆ‘ä»¬æŠŠè¿™ç±»ä»£ç ç§°ä¸ºâ€GLUEâ€(èƒ¶æ°´ï¼Œ è¯‘è€…æ³¨:ç”±äºä½œè€…å…¨ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œ å› æ­¤åç»­å»¶ç”¨GLUE)ä»£ç ã€‚ â€œGLUEâ€ä»£ç ä¸»è¦æœ‰ä¸¤ç§é€»è¾‘ç±»å‹:é„™äººæµ…è§è–„è¯†ï¼Œ å¦‚æœä½ æœ‰æ›´å¤šçš„â€GLUEâ€ç±»å‹å®ä¾‹ï¼Œ è¯·åœ¨ç•™è¨€ä¸­æŒ‡å‡ºã€‚ æ˜ å°„é€»è¾‘(ç»‘å®šé€»è¾‘): æ¯ä¸€å±‚é€šè¿‡å±æ€§ã€æ–¹æ³•å’Œé›†åˆå’Œå…¶å®ƒå±‚é“¾æ¥ã€‚ä¾‹å¦‚ï¼Œ ä¸€ä¸ªåœ¨UIå±‚ä¸­åä¸ºâ€œtxtCustomerNameâ€çš„Textboxæ§ä»¶ï¼Œå°†å…¶æ˜ å°„åˆ°customerç±»çš„â€CustomerNameâ€å±æ€§ã€‚ 1txtCustomerName.text = custobj.CustomerName; // æ˜ å°„ä»£ç  ç°åœ¨è°åº”è¯¥æ‹¥æœ‰ä¸Šè¿°ç»‘å®šé€»è¾‘ä»£ç ï¼ŒUIè¿˜æ˜¯Modelï¼Ÿå¼€å‘è€…å¾€å¾€æŠŠè¿™ä¸ªä»£ç æ¨åˆ°UIå±‚æ¬¡ä¸­ã€‚ è½¬æ¢é€»è¾‘ï¼šæ¯ä¸ªå±‚æ¬¡ä½¿ç”¨çš„æ•°æ®æ ¼å¼éƒ½æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚ä¸€ä¸ªModelç±»â€Personâ€æœ‰ä¸€ä¸ªæ€§åˆ«å±æ€§ï¼Œå¯å–å€¼åˆ†åˆ«ä¸ºâ€Fâ€(Female)å’Œâ€Mâ€(Male)åˆ†åˆ«ä»£è¡¨å¥³æ€§å’Œç”·æ€§ã€‚ä½†æ˜¯åœ¨UIå±‚ä¸­ï¼Œå¸Œæœ›å°†è¿™ä¸ªå€¼å¯è§†åŒ–ä¸ºä¸€ä¸ªå¤é€‰æ¡†æ§ä»¶ï¼Œå‹¾é€‰åˆ™ä»£è¡¨ç”·æ€§ï¼Œä¸å‹¾é€‰åˆ™ä»£è¡¨å¥³æ€§ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè½¬æ¢ä»£ç ç¤ºä¾‹ã€‚ 12345678if (obj.Gender == â€œMâ€) // è½¬æ¢ä»£ç &#123; chkMale.IsChecked = true;&#125;else&#123; chkMale.IsChecked = false;&#125; å¤§å¤šæ•°å¼€å‘è€…æœ€ç»ˆä¼šå°†â€GLUEâ€ä»£ç å†™åˆ°UIå±‚ä¸­ã€‚é€šå¸¸å¯ä»¥åœ¨åå°ä»£ç ä¸­å®šä½åˆ°è¿™ç±»ä»£ç ï¼Œä¾‹å¦‚.csæ–‡ä»¶ã€‚å¦‚æœUIæ˜¯XAMLï¼Œåˆ™å¯¹åº”çš„XAML.csåŒ…å«GLUEä»£ç ï¼›å¦‚æœUIæ˜¯ASPXï¼Œåˆ™å¯¹åº”çš„ASPX.csåŒ…å«GLUEä»£ç ï¼Œä»¥æ­¤ç±»æ¨ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæ˜¯UIè´Ÿè´£è¿™ç±»GLUEä»£ç å—ï¼Ÿè®©æˆ‘ä»¬çœ‹ä¸‹WPFåº”ç”¨ä¸­çš„ä¸€ä¸ªç®€å•çš„ä¸‰å±‚ç»“æ„ä¾‹å­ï¼Œä»¥åŠæ›´è¯¦ç»†çš„GLUEä»£ç ç»†èŠ‚ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡å‹ç±»â€Customerâ€ï¼Œå®ƒæœ‰ä¸‰ä¸ªå±æ€§â€œCustomerNameâ€, â€œAmountâ€ å’Œâ€œMarriedâ€ ã€‚ ä½†æ˜¯ï¼Œå½“è¿™ä¸ªæ¨¡å‹æ˜¾ç¤ºåˆ°UIä¸Šæ—¶å®ƒåˆè¡¨ç°å¦‚ä¸‹ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥çœ‹å‡ºæ¥å®ƒåŒ…å«äº†è¯¥æ¨¡å‹çš„æ‰€æœ‰å±æ€§ï¼Œä»¥åŠä¸€äº›é¢å¤–çš„å…ƒç´ ï¼šé¢œè‰²æ ‡ç­¾å’ŒMarriedå¤é€‰æ¡†æ§ä»¶ã€‚ ä¸‹é¢æœ‰ä¸€å¼ ç®€å•çš„è¡¨ï¼Œå·¦è¾¹æ˜¯Modelï¼Œå³è¾¹æ˜¯UIï¼Œä¸­é—´æ˜¯è°ˆè¿‡çš„æ˜ å°„å’Œè½¬æ¢é€»è¾‘ã€‚ ä½ å¯ä»¥çœ‹åˆ°å‰ä¸¤è¡Œæ²¡æœ‰è½¬æ¢é€»è¾‘ï¼Œåªæœ‰æ˜ å°„é€»è¾‘ï¼Œå¦å¤–ä¸¤è¡Œåˆ™åŒæ—¶åŒ…å«è½¬æ¢é€»è¾‘å’Œæ˜ å°„é€»è¾‘ã€‚ Model GLUE CODE UI Customer Name No conversion needed only Mapping Customer Name Amount No conversion needed only Mapping Amount Amount Mapping + Conversion logic. &gt; 1500 &#x3D; BLUE, &lt; 1500 &#x3D; RED Married Mapping + Conversion logic. True â€“ Married, False - UnMarried è¿™äº›è½¬æ¢å’Œæ˜ å°„é€»è¾‘ä»£ç é€šå¸¸ä¼šåœ¨â€œxaml.csâ€æ–‡ä»¶ä¸­ã€‚ä¸‹é¢æ˜¯ä¸Šå›¾å¯¹åº”çš„åå°ä»£ç ï¼Œä½ å¯ä»¥çœ‹åˆ°æ˜ å°„ä»£ç å’Œé¢œè‰²åˆ¤å®šã€æ€§åˆ«æ ¼å¼è½¬æ¢ä»£ç ã€‚æˆ‘åœ¨ä»£ç ä¸­ç”¨æ³¨é‡Šæ ‡æ³¨å‡ºæ¥ï¼Œè¿™æ ·ä½ å¯ä»¥çœ‹åˆ°å“ªäº›æ˜¯æ˜ å°„ä»£ç ï¼Œå“ªäº›æ˜¯è½¬æ¢ä»£ç ã€‚ 123456789101112131415161718lblName.Content = o.CustomerName; // æ˜ å°„ä»£ç lblAmount.Content = o.Amount; // æ˜ å°„ä»£ç if (o.Amount &gt; 2000) // è½¬æ¢ä»£ç &#123; lblBuyingHabits.Background = new SolidColorBrush(Colors.Blue);&#125;else if (o.Amount &gt; 1500) // è½¬æ¢ä»£ç &#123; lblBuyingHabits.Background = new SolidColorBrush(Colors.Red);&#125;if (obj.Married == â€œMarriedâ€) // è½¬æ¢ä»£ç &#123; chkMarried.IsChecked = true;&#125;else&#123; chkMarried.IsChecked = false;&#125; ç°åœ¨è¿™äº›GLUEä»£ç å­˜åœ¨çš„é—®é¢˜ï¼š å•ä¸€è´£ä»»åŸåˆ™è¢«ç ´åï¼ˆSRPViolationï¼‰ï¼š æ˜¯UIè´Ÿè´£è¿™äº›GLUEä»£ç å—ï¼Ÿè¿™ç§æƒ…å†µä¸‹æ”¹å˜äº†Amountæ•°é‡ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä¿®æ”¹UIä»£ç ã€‚ç°åœ¨ï¼Œæ•°æ®çš„æ”¹å˜ä¸ºä»€ä¹ˆä¼šè®©æˆ‘å»ä¿®æ”¹UIçš„ä»£ç ï¼Ÿè¿™é‡Œå¯ä»¥é—»åˆ°åä»£ç çš„å‘³é“ã€‚UIåº”è¯¥åªåœ¨æˆ‘ä¿®æ”¹æ ·å¼ï¼Œé¢œè‰²å’Œå¸ƒå±€çš„æ—¶å€™æ‰æ”¹å˜ã€‚ é‡ç”¨æ€§ï¼š å¦‚æœæˆ‘æƒ³æŠŠåŒæ ·çš„é¢œè‰²é€»è¾‘å’Œæ€§åˆ«æ ¼å¼è½¬æ¢ç”¨åˆ°ä¸‹é¢çš„ç¼–è¾‘ç•Œé¢ï¼Œæˆ‘è¯¥æ€ä¹ˆåšï¼Ÿæ‹·è´ç²˜å¸–é‡å¤çš„ä»£ç ï¼Ÿ å¦‚æœæˆ‘æƒ³èµ°å¾—æ›´è¿œä¸€ç‚¹ï¼ŒæŠŠè¿™ä¸ªGLUEä»£ç ç”¨åœ¨ä¸åŒçš„UIæŠ€æœ¯ä½“ç³»ä¸Šï¼Œæ¯”å¦‚MVCã€Windows Formæˆ–è€…Mobileåº”ç”¨ä¸Šã€‚ ![Reusability](https://www.codeproject.com/KB/WPF/819294/7.png) ä½†æ˜¯è¿™é‡Œè·¨UIæŠ€æœ¯å¹³å°çš„é‡ç”¨å®é™…ä¸Šæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæ¯ä¸ªå¹³å°UIèƒŒåéƒ½å’Œå„è‡ªçš„UIæŠ€æœ¯ä½“ç³»è€¦åˆå¾—å¾ˆç´§å¯†ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢çš„åå°ä»£ç æ˜¯ç»§æ‰¿è‡ªâ€œWindowsâ€ç±»ï¼Œè€Œâ€œWindowsâ€ç±»æ˜¯é›†æˆåœ¨WPF UIä½“ç³»ä¸­ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨Webåº”ç”¨æˆ–è€…MVCä¸­åº”ç”¨è¿™äº›é€»è¾‘ï¼Œå´åˆæ— æ³•å»åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ç±»å¯¹è±¡æ¥ä½¿ç”¨ã€‚ 12345MainWindow : Window&#123; // Behind code is here&#125; é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆé‡ç”¨åå°ä»£ç ï¼Ÿæ€ä¹ˆéµå¾ªSRPåŸåˆ™ï¼Ÿ ç¬¬ä¸€æ­¥ï¼šæœ€ç®€å•çš„MVVMç¤ºä¾‹ - æŠŠåå°ä»£ç ç§»åˆ°ç±»ä¸­æˆ‘æƒ³å¤§éƒ¨åˆ†å¼€å‘è€…å·²ç»çŸ¥é“æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ¯«æ— ç–‘é—®åœ°æŠŠåå°ä»£ç ï¼ˆGLUEä»£ç ï¼‰ç§»åˆ°ä¸€ä¸ªç±»åº“ä¸­ã€‚è¿™ä¸ªç±»åº“ä»£è¡¨äº†æè¿°äº†UIçš„å±æ€§å’Œè¡Œä¸ºã€‚ä»»ä½•ç§»å…¥åˆ°è¿™ä¸ªç±»åº“çš„ä»£ç éƒ½å¯ä»¥ç¼–è¯‘æˆDLLï¼Œç„¶åè¢«æ‰€æœ‰.NETé¡¹ç›®ï¼ˆWindows, Webç­‰ç­‰ï¼‰æ‰€å¼•ç”¨ã€‚ å› æ­¤ï¼Œåœ¨è¿™ä¸€èŠ‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„MVVMç¤ºä¾‹ï¼Œç„¶ååœ¨åç»­çš„ç« èŠ‚ä¸­æˆ‘ä»¬å°†åŸºäºè¿™ä¸ªç¤ºä¾‹åˆ›å»ºæ›´é«˜çº§çš„MVVMç¤ºä¾‹ã€‚ æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªâ€œCustomerViewModelâ€ç±»æ¥åŒ…å«GLUEä»£ç ã€‚â€œCustomerViewModelâ€ç±»ä»£è¡¨äº†ä½ çš„UIï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³ä¿æŒå®ƒçš„å±æ€§å’ŒUIå‘½åçº¦å®šä¸€è‡´ã€‚ä½ å¯ä»¥ä»ä¸‹å›¾çœ‹å‡ºæ¥â€œCustomerViewModelâ€ç±»çš„å±æ€§æ˜¯å¦‚ä½•ä»ä¹‹å‰çš„CustomerModelç±»ä¸­æ˜ å°„è¿‡æ¥: â€œTxtCustomerNameâ€å¯¹åº”â€œCustomerNameâ€ï¼Œâ€œTxtAmountâ€å¯¹åº”â€œAmountâ€ç­‰ç­‰ã€‚ ä¸‹é¢æ˜¯å®é™…ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849 public class CustomerViewModel&#123; private Customer obj = new Customer(); public string TxtCustomerName &#123; get &#123; return obj.CustomerName; &#125; set &#123; obj.CustomerName = value; &#125; &#125; public string TxtAmount &#123; get &#123; return Convert.ToString(obj.Amount) ; &#125; set &#123; obj.Amount = Convert.ToDouble(value); &#125; &#125; public string LblAmountColor &#123; get &#123; if (obj.Amount &gt; 2000) &#123; return &quot;Blue&quot;; &#125; else if (obj.Amount &gt; 1500) &#123; return &quot;Red&quot;; &#125; return &quot;Yellow&quot;; &#125; &#125; public bool IsMarried &#123; get &#123; if (obj.Married == &quot;Married&quot;) &#123; return true; &#125; else &#123; return false; &#125; &#125; &#125;&#125; å…³äºâ€œCustomerViewModelâ€è¿™ä¸ªç±»æœ‰ä»¥ä¸‹å‡ ç‚¹æ³¨æ„ï¼š ç±»å±æ€§éƒ½ä»¥UIçš„å‘½åæ–¹å¼æ¥çº¦å®šï¼Œè¿™æ ·çœ‹ä¸Šå»ä¼šæ›´å½¢è±¡ä¸€äº›ï¼› è¿™ä¸ªç±»è´Ÿè´£äº†ç±»å‹è½¬æ¢çš„ä»£ç ï¼Œä½¿å¾—UIçœ‹ä¸Šå»æ›´è½»é‡çº§ã€‚ä¾‹å¦‚ä»£ç ä¸­çš„â€œTxtAmountâ€å±æ€§ã€‚åœ¨Modelç±»ä¸­çš„â€œAmountâ€å±æ€§æ˜¯æ•°å­—ï¼Œè€Œè½¬æ¢çš„è¿‡ç¨‹æ˜¯åœ¨ViewModelç±»ä¸­å®Œæˆã€‚æ¢å¥è¯è¯´è¿™ä¸ªç±»è´Ÿè´£äº†UIæ˜¾ç¤ºçš„æ‰€æœ‰èŒè´£ï¼ˆè¯‘è€…æ³¨ï¼šé€»è¾‘ä¸Šçš„ä¸šåŠ¡èŒè´£ï¼‰è®©UIåå°ä»£ç çœ‹ä¸Šå»æ›´ç®€æ´ï¼› æ‰€æœ‰è½¬æ¢é€»è¾‘çš„ä»£ç éƒ½åœ¨è¿™ä¸ªç±»ä¸­ï¼Œä¾‹å¦‚â€œLblAmountColorâ€å±æ€§å’Œâ€œIsMarriedâ€å±æ€§ï¼› æ‰€æœ‰çš„å±æ€§æ•°æ®éƒ½ä¿æŒäº†ç®€å•çš„å­—ç¬¦ç±»å‹ï¼Œè¿™æ ·å¯ä»¥åœ¨å¤§å¤šUIæŠ€æœ¯å¹³å°ä¸Šé€‚ç”¨ã€‚ä¾‹å¦‚ï¼Œâ€œLblAmountColorâ€å±æ€§æŠŠé¢œè‰²å€¼ç”¨å­—ç¬¦ä¸²æ¥ä¼ é€’ï¼Œè¿™æ ·å¯ä»¥åœ¨ä»»ä½•UIç±»å‹ä¸­é‡ç”¨ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿä¿æŒäº†æœ€å°çš„æ•°æ®å…±æ€§ã€‚ ç°åœ¨â€œCustomerViewModelâ€ç±»åŒ…å«äº†æ‰€æœ‰çš„åå°ä»£ç é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè¿™ä¸ªç±»çš„å¯¹è±¡å¹¶ç»‘å®šåˆ°UIå…ƒç´ ä¸Šã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢ä»£ç çœ‹åˆ°æˆ‘ä»¬åªå‰©ä¸‹äº†æ˜ å°„é€»è¾‘çš„ä»£ç éƒ¨åˆ†ï¼Œè€Œè½¬æ¢é€»è¾‘çš„â€GLUEâ€ä»£ç å·²ç»æ²¡æœ‰äº†ã€‚ 12345678private void DisplayUi(CustomerViewModel o)&#123; lblName.Content = o.TxtCustomerName; lblAmount.Content = o.TxtAmount; BrushConverter brushconv = new BrushConverter(); lblBuyingHabits.Background = brushconv.ConvertFromString(o.LblAmountColor) as SolidColorBrush; chkMarried.IsChecked = o.IsMarried;&#125; ç¬¬äºŒæ­¥ï¼šæ·»åŠ ç»‘å®š - æ¶ˆç­åå°ä»£ç ç¬¬ä¸€æ­¥çš„æ–¹æ³•å¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åå°ä»£ç ä»ç„¶è¿˜æœ‰é—®é¢˜ï¼Œåœ¨WPFä¸­æ¶ˆç­æ‰€æœ‰åå°ä»£ç æ˜¯å®Œå…¨å¯èƒ½çš„ã€‚æ¥ä¸‹æ¥WPFç»‘å®šå’Œå‘½ä»¤ç™»åœºäº†ã€‚ WPFä»¥å…¶ç»‘å®šï¼ˆBindingï¼‰ã€å‘½ä»¤ï¼ˆCommandsï¼‰å’Œå£°æ˜å¼ç¼–ç¨‹ï¼ˆDeclarative programmingï¼‰è€Œè‘—ç§°ã€‚å£°æ˜å¼ç¼–ç¨‹æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨XMALæ¥è¡¨è¾¾ä½ çš„C#ä»£ç ï¼Œè€Œä¸ç”¨ç¼–å†™å®Œæ•´çš„C#ä»£ç ã€‚ç»‘å®šåŠŸèƒ½å¸®åŠ©ä¸€ä¸ªWPFå¯¹è±¡è¿æ¥åˆ°å…¶å®ƒçš„WPFå¯¹è±¡ï¼Œä»è€Œä»–ä»¬å¯ä»¥å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚ å½“å‰çš„æ˜ å°„C#ä»£ç æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š å¯¼å…¥ï¼š æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯å¯¼å…¥â€œCustomerViewModelâ€åç§°ç©ºé—´ã€‚ åˆ›å»ºå¯¹è±¡ï¼š ä¸‹ä¸€æ­¥è¦åˆ›å»ºâ€œCustomerViewModelâ€ç±»çš„å¯¹è±¡ã€‚ ç»‘å®šä»£ç ï¼š æœ€åå°†WPF UIç»‘å®šåˆ°è¿™ä¸ªViewModelå¯¹è±¡ã€‚ ä¸‹é¢è¡¨æ ¼å±•ç¤ºäº†C#ä»£ç å’Œä¸å…¶å¯¹åº”ç›¸åŒçš„WPF XAMLä»£ç ã€‚ æ­¥éª¤ C#ä»£ç  XAMLä»£ç  å¯¼å…¥ using CustomerViewModel; xmlns:custns&#x3D;â€clr-namespace:CustomerViewModel;assembly&#x3D;CustomerViewModelâ€ åˆ›å»ºå¯¹è±¡ CustomerViewModelobj &#x3D; new CustomerViewModel(); obj.CustomerName &#x3D; â€œShivâ€; obj.Amount &#x3D; 2000; obj.Married &#x3D; â€œMarriedâ€; &lt; Window.Resources&gt; &lt; custns: CustomerViewModel x:Key&#x3D;â€custviewobjâ€ TxtCustomerName&#x3D;â€Shivâ€ TxtAmount&#x3D;â€1000â€ IsMarried&#x3D;â€trueâ€&#x2F;&gt; ç»‘å®šå¯¹è±¡ lblName.Content &#x3D; o.CustomerName; &lt; Label x:Name&#x3D;â€lblNameâ€ Content&#x3D;â€{Binding TxtCustomerName, Source&#x3D;{StaticResourcecustviewobj}}â€&#x2F;&gt; ä½ ä¸éœ€è¦å†™åå°çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ä¸­UIå…ƒç´ ï¼ŒæŒ‰F4ï¼Œå¦‚ä¸‹å›¾ä¸­é€‰æ‹©æŒ‡å®šç»‘å®šã€‚è¿™ä¸ªæ­¥éª¤ä¼šæŠŠç»‘å®šä»£ç æ’å…¥åˆ°XAMLä¸­ã€‚ é€‰æ‹©â€œStaticResourceâ€æ¥æŒ‡å®šæ˜ å°„ï¼Œç„¶ååœ¨UIå…ƒç´ å’ŒViewModelå¯¹è±¡ä¹‹é—´æŒ‡å®šç»‘å®šè·¯å¾„ã€‚ è¿™æ˜¯ä½ æŸ¥çœ‹XAML.CSæ–‡ä»¶ï¼Œå®ƒå·²ç»æ²¡æœ‰ä»»ä½•GLUEä»£ç ï¼ŒåŒæ ·ä¹Ÿæ²¡æœ‰è½¬æ¢å’Œæ˜ å°„ä»£ç ã€‚å”¯ä¸€çš„ä»£ç å°±æ˜¯æ ‡å‡†çš„WPF UIåˆå§‹åŒ–ä»£ç ã€‚ 12345public partial class MVVMWithBindings : Window&#123; public MVVMWithBindings() &#123;InitializeComponent();&#125;&#125; ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ æ‰§è¡ŒåŠ¨ä½œå’Œâ€œINotifyPropertyChangedâ€æ¥å£åº”ç”¨ç¨‹åºä¸ä»…ä»…åªæ˜¯æœ‰textboxs å’Œ labelsï¼Œ åŒæ ·è¿˜éœ€è¦æ‰§è¡ŒåŠ¨ä½œï¼Œæ¯”å¦‚æŒ‰é’®ï¼Œé¼ æ ‡äº‹ä»¶ç­‰ã€‚ å› æ­¤è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæŒ‰é’®æ¥çœ‹çœ‹å¦‚ä½•æŠŠMVVMç±»åº”ç”¨èµ·æ¥ã€‚ æˆ‘ä»¬åœ¨åŒæ ·çš„UIä¸Šæ·»åŠ äº†ä¸€ä¸ªâ€˜Calculate taxâ€™æŒ‰é’®ï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®ï¼Œå®ƒå°†æ ¹æ®â€œSales Amountâ€å€¼è®¡ç®—å‡ºç¨å€¼å¹¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šã€‚ å› æ­¤ä¸ºäº†åœ¨Modelç±»å®ç°ä¸Šé¢çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªâ€œCalculateTax()â€æ–¹æ³•ã€‚å½“è¿™ä¸ªæ–¹æ³•è¢«æ‰§è¡Œï¼Œå®ƒæ ¹æ®è–ªæ°´èŒƒå›´è®¡ç®—å‡ºç¨å€¼ï¼Œå¹¶å°†å€¼ä¿å­˜åœ¨â€œTaxâ€å±æ€§å€¼ä¸­ã€‚ 123456789101112131415161718192021222324252627public class Customer&#123; .... .... .... .... private double _Tax; public double Tax &#123; get &#123; return _Tax; &#125; &#125; public void CalculateTax() &#123; if (_Amount &gt; 2000) &#123; _Tax = 20; &#125; else if (_Amount &gt; 1000) &#123; _Tax = 10; &#125; else &#123; _Tax = 5; &#125; &#125;&#125; ç”±äºViewModelç±»æ˜¯Modelç±»çš„ä¸€ä¸ªå°è£…ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ViewModelç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•æ¥è°ƒç”¨Modelçš„â€œCalculateTaxâ€æ–¹æ³•ã€‚ 123456789101112public class CustomerViewModel&#123; private Customer obj = new Customer(); .... .... .... .... public void Calculate() &#123; obj.CalculateTax(); &#125;&#125; ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨XAMLçš„è§†å›¾ä¸­è°ƒç”¨è¿™ä¸ªâ€œCalculateâ€æ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨åå°ç¼–å†™ã€‚ä¸è¿‡ä½ ä¸èƒ½ç›´æ¥é€šè¿‡XAMLè°ƒç”¨â€œCalculateâ€æ–¹æ³•ï¼Œä½ éœ€è¦ç”¨WPFçš„commandç±»ã€‚ æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ç»‘å®šå±æ€§å°†æ•°æ®å‘é€ç»™ViewModelç±»ï¼Œè€Œå‘é€æ‰§è¡ŒåŠ¨ä½œç»™ViewModelç±»åˆ™éœ€è¦ä½¿ç”¨å‘½ä»¤ã€‚ æ‰€æœ‰ä»è§†å›¾å…ƒç´ äº§ç”Ÿçš„åŠ¨ä½œéƒ½å‘é€ç»™commandç±»ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªcommandç±»ã€‚ä¸ºäº†åˆ›å»ºè‡ªå®šä¹‰çš„commandç±»ï¼Œæˆ‘ä»¬éœ€è¦å®ç°â€ICommandâ€æ¥å£ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ â€œICommandâ€æ¥å£æœ‰ä¸¤ä¸ªå¿…é¡»è¦é‡è½½çš„æ–¹æ³•ï¼šâ€œCanExecuteâ€ å’Œ â€œExecuteâ€ã€‚åœ¨â€œExecuteâ€ä¸­æˆ‘ä»¬æ”¾çš„æ˜¯å¸Œæœ›åŠ¨ä½œå‘ç”Ÿæ—¶å®é™…æ‰§è¡Œçš„é€»è¾‘ä»£ç ï¼ˆæ¯”å¦‚æŒ‰é’®æŒ‰ä¸‹ï¼Œå³é”®æŒ‰ä¸‹ç­‰ï¼‰ã€‚åœ¨â€œCanExecuteâ€ä¸­æˆ‘ä»¬æ”¾çš„æ˜¯éªŒè¯é€»è¾‘æ¥å†³å®šâ€œExecuteâ€ä»£ç æ˜¯å¦åº”è¯¥æ‰§è¡Œã€‚ 12345678910111213141516public class ButtonCommand : ICommand&#123; public bool CanExecute(object parameter) &#123; // When to execute // Validation logic goes here &#125; public event EventHandler CanExecuteChanged; public void Execute(object parameter) &#123; // What to Execute // Execution logic goes here &#125;&#125; ç°åœ¨æ‰€æœ‰çš„åŠ¨ä½œè°ƒç”¨éƒ½å‘é€åˆ°commandç±»ï¼Œç„¶åè¢«è·¯ç”±åˆ°ViewModelç±»ã€‚æ¢å¥è¯è¯´ï¼Œcommandç±»éœ€è¦ç»„åˆViewModelç±»ï¼ˆè¯‘æ³¨ï¼šcommandç±»éœ€è¦ä¸€ä¸ªViewModelç±»çš„å¼•ç”¨ï¼‰ã€‚ ä¸‹é¢æ˜¯ç®€çŸ­çš„ä»£ç ç‰‡æ®µï¼Œæœ‰å››ç‚¹éœ€è¦æ³¨æ„ï¼š ViewModelå¯¹è±¡æ˜¯ä½œä¸ºä¸€ä¸ªç§æœ‰çš„æˆå‘˜å¯¹è±¡ã€‚ è¯¥ViewModelå¯¹è±¡å°†é€šè¿‡æ„é€ å‡½æ•°å‚æ•°çš„æ–¹å¼ä¼ é€’è¿›æ¥ã€‚ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨â€œCanExecuteâ€ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œå®ƒå§‹ç»ˆè¿”å›trueã€‚ åœ¨â€œExecuteâ€æ–¹æ³•ä¸­æˆ‘ä»¬è°ƒç”¨äº†ViewModelç±»çš„â€œCalculateâ€æ–¹æ³•ã€‚ 12345678910111213141516public class ButtonCommand : ICommand&#123; private CustomerViewModel obj; // Point 1 public ButtonCommand(CustomerViewModel _obj) // Point 2 &#123; obj = _obj; &#125; public bool CanExecute(object parameter) &#123; return true; // Point 3 &#125; public void Execute(object parameter) &#123; obj.Calculate(); // Point 4 &#125;&#125; ä¸Šé¢çš„commandä»£ç ä¸­ï¼ŒViewModelå¯¹è±¡æ˜¯é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’è¿›æ¥ã€‚æ‰€ä»¥ViewModelç±»éœ€è¦åˆ›å»ºä¸€ä¸ªcommandå¯¹è±¡æ¥æš´éœ²è¿™ä¸ªå¯¹è±¡çš„â€œICommandâ€æ¥å£ã€‚è¿™ä¸ªâ€œICommandâ€æ¥å£å°†è¢«WPF XAMLä½¿ç”¨å¹¶è°ƒç”¨ã€‚ä¸‹é¢æ˜¯ä¸€äº›å…³äºâ€œCustomerViewModelâ€ç±»ä½¿ç”¨commandç±»çš„è¦ç‚¹ï¼š commandç±»æ˜¯â€œCustomerViewModelâ€ç±»çš„ç§æœ‰æˆå‘˜ã€‚ åœ¨â€œCustomerViewModelâ€ç±»çš„æ„é€ å‡½æ•°ä¸­å°†å½“å‰å¯¹è±¡çš„å®ä¾‹ä¼ é€’ç»™commandç±»ã€‚åœ¨ä¹‹å‰è§£é‡Šcommandç±»çš„ä¸€èŠ‚ä¸­æˆ‘ä»¬è¯´äº†commandç±»æ„é€ å‡½æ•°è·å–ViewModelç±»çš„å®ä¾‹ã€‚å› æ­¤åœ¨è¿™ä¸€èŠ‚ä¸­æˆ‘ä»¬æ­£æ˜¯å°†å½“å‰å®ä¾‹ä¼ é€’ç»™commandç±»ã€‚ commandå¯¹è±¡æ˜¯é€šè¿‡ä»¥â€œICommandâ€æ¥å£çš„å½¢å¼æš´éœ²å‡ºæ¥ï¼Œè¿™æ ·æ‰å¯ä»¥è¢«XAMLæ‰€ä½¿ç”¨ã€‚ 123456789101112131415161718192021using System.ComponentModel;public class CustomerViewModel&#123; â€¦ â€¦ private ButtonCommand objCommand; // Point 1 public CustomerViewModel() &#123; objCommand = new ButtonCommand(this); // Point 2 &#125; public ICommand btnClick // Point 3 &#123; get &#123; return objCommand; &#125; &#125; â€¦ â€¦&#125; åœ¨ä½ çš„UIä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæŒ‰é’®çš„æ‰§è¡ŒåŠ¨ä½œè¿æ¥åˆ°æš´éœ²çš„â€œICommandâ€æ¥å£ã€‚ç°åœ¨æ‰“å¼€buttonçš„å±æ€§æ ï¼Œé€‰æ‹©commandå±æ€§ï¼Œå³å‡»åˆ›å»ºä¸€ä¸ªæ•°æ®ç»‘å®šã€‚ ç„¶åé€‰æ‹©é™æ€èµ„æºï¼ˆStatic Resourceï¼‰ï¼Œå¹¶å°†â€œButtonCommandâ€é™„åŠ åˆ°buttonä¸Šã€‚ å½“ä½ ç‚¹å‡»äº†Calculate TaxæŒ‰é’®ï¼Œå®ƒå°±æ‰§è¡Œäº†â€œCalculateTaxâ€æ–¹æ³•ã€‚å¹¶å°†ç¨å€¼ç»“æœå­˜åœ¨â€œ_taxâ€å˜é‡ä¸­ã€‚å…³äºâ€œCalculateTaxâ€æ–¹æ³•ä»£ç ï¼Œå¯ä»¥é˜…è¯»å‰é¢çš„å°èŠ‚â€œç¬¬ä¸‰æ­¥ï¼šæ·»åŠ æ‰§è¡ŒåŠ¨ä½œå’Œâ€œINotifyPropertyChangedâ€æ¥å£â€ã€‚ æ¢å¥è¯è¯´ï¼Œç¨å€¼è®¡ç®—è¿‡ç¨‹å¹¶ä¸ä¼šè‡ªåŠ¨é€šçŸ¥ç»™UIã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»å¯¹è±¡å‘é€æŸç§é€šçŸ¥ç»™UIï¼Œå‘Šè¯‰å®ƒç¨å€¼å·²ç»å˜åŒ–äº†ï¼ŒUIéœ€è¦é‡æ–°è½½å…¥ç»‘å®šå€¼ã€‚ å› æ­¤ï¼Œåœ¨ViewModelç±»ä¸­æˆ‘ä»¬éœ€è¦å‘é€INotifyäº‹ä»¶ç»™è§†å›¾ã€‚ ä¸ºäº†è®©ä½ çš„ViewModelç±»èƒ½å¤Ÿå®ç°é€šçŸ¥ï¼Œæˆ‘ä»¬å¿…é¡»åšä¸‰ä»¶äº‹æƒ…ã€‚è¿™ä¸‰ä»¶äº‹æƒ…éƒ½åœ¨ä¸‹é¢çš„ä»£ç æ³¨é‡Šä¸­æŒ‡å‡ºï¼Œä¾‹å¦‚Point1ï¼Œ Point2 å’Œ Point3ã€‚ Point1ï¼š å¦‚ä¸‹é¢ä»£ç é‚£æ ·å®ç°â€œINotifyPropertyChangedâ€æ¥å£ã€‚ä¸€æ—¦ä½ å®ç°äº†è¯¥æ¥å£ï¼Œå®ƒå°±åˆ›å»ºäº†å¯¹è±¡çš„â€œPropertyChangedEventHandlerâ€äº‹ä»¶ã€‚ Point2å’Œ3ï¼š åœ¨â€œCalculateâ€æ–¹æ³•ä¸­ç”¨â€œPropertyChangedâ€å¯¹è±¡å»è§¦å‘äº‹ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å®šäº†æŸä¸ªå±æ€§çš„é€šçŸ¥ã€‚åœ¨è¿™é‡Œæ˜¯â€œTaxâ€å±æ€§ã€‚å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿè¦æ£€æŸ¥â€œPropertyChangedâ€æ˜¯å¦ä¸ä¸ºç©ºã€‚ 12345678910111213141516public class CustomerViewModel : INotifyPropertyChanged // Point 1&#123; â€¦. â€¦. public void Calculate() &#123; obj.CalculateTax(); if (PropertyChanged != null) // Point 2 &#123; PropertyChanged(this,new PropertyChangedEventArgs(&quot;Tax&quot;)); // Point 3 &#125; &#125; public event PropertyChangedEventHandler PropertyChanged;&#125; å¦‚æœä½ è¿è¡Œç¨‹åºï¼Œä½ åº”è¯¥å¯ä»¥çœ‹è§å½“ç‚¹å‡»æŒ‰é’®åâ€œTaxâ€å€¼è¢«æ›´æ–°äº†ã€‚ ç¬¬å››æ­¥ï¼šåœ¨ViewModelä¸­è§£è€¦æ‰§è¡ŒåŠ¨ä½œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç”¨MVVMæ¡†æ¶åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ç•Œé¢ã€‚è¿™ä¸ªç•Œé¢åŒæ—¶åŒ…å«äº†å±æ€§å’Œå‘½ä»¤å®ç°ã€‚æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªè§†å›¾ï¼Œå®ƒçš„UIè¾“å…¥å…ƒç´ ï¼ˆä¾‹å¦‚textboxï¼‰é€šè¿‡ç»‘å®šå’ŒViewModelè¿æ¥èµ·æ¥ï¼Œå®ƒçš„ä»»ä½•æ‰§è¡ŒåŠ¨ä½œï¼ˆä¾‹å¦‚æŒ‰é’®ç‚¹å‡»ï¼‰é€šè¿‡å‘½ä»¤å’ŒViewModelè¿æ¥èµ·æ¥ã€‚ViewModelå’Œå†…éƒ¨çš„Modelé€šè®¯ã€‚ ä½†æ˜¯åœ¨ä¸Šé¢çš„ç»“æ„ä¸­è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šcommandç±»å’ŒViewModelç±»å­˜åœ¨ç€è¿‡åº¦è€¦åˆçš„æƒ…å†µã€‚å¦‚æœä½ è¿˜è®°å¾—commandç±»ä»£ç ï¼ˆæˆ‘åœ¨ä¸‹é¢è´´å‡ºæ¥äº†ï¼‰ä¸­çš„æ„é€ å‡½æ•°æ˜¯ä¼ é€’äº†ViewModelå¯¹è±¡ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªcommandç±»æ— æ³•è¢«å…¶å®ƒçš„ViewModelç±»æ‰€å¤ç”¨ã€‚ 1234567891011public class ButtonCommand : ICommand&#123; private CustomerViewModel obj; // Point 1 public ButtonCommand(CustomerViewModel _obj) // Point 2 &#123; obj = _obj; &#125; ...... ...... ......&#125; ä½†æ˜¯åœ¨è€ƒè™‘äº†æ‰€æœ‰æƒ…å†µä¹‹åï¼Œè®©æˆ‘ä»¬é€»è¾‘åœ°æ€è€ƒä¸‹â€œä»€ä¹ˆæ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Ÿâ€ã€‚å®ƒæ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå¯ä»¥ç”±ç”¨æˆ·ä»é¼ æ ‡ç‚¹å‡»ï¼ˆå·¦é”®æˆ–å³é”®ï¼‰ï¼ŒæŒ‰é’®ç‚¹å‡»ï¼Œèœå•ç‚¹å‡»ï¼ŒåŠŸèƒ½é”®æŒ‰ä¸‹ç­‰ã€‚æ‰€ä»¥åº”è¯¥æœ‰ä¸€ç§æ–¹å¼é€šç”¨åŒ–è¿™äº›åŠ¨ä½œï¼Œå¹¶ä¸”è®©å„ç§ViewModelæœ‰ä¸€ç§æ›´é€šç”¨çš„æ–¹æ³•å»ç»‘å®šå®ƒã€‚ é€»è¾‘ä¸Šè®²ï¼Œå¦‚æœä½ è®¤ä¸ºä»»åŠ¡åŠ¨ä½œæ˜¯ä¸€äº›æ–¹æ³•å’Œå‡½æ•°çš„å°è£…é€»è¾‘ã€‚é‚£æœ‰ä»€ä¹ˆæ˜¯â€œæ–¹æ³•â€å’Œâ€œå‡½æ•°â€çš„é€šç”¨è¡¨è¾¾æ–¹å¼å‘¢ï¼Ÿâ€¦â€¦åŠªåŠ›æƒ³æƒ³â€¦â€¦.å†æƒ³æƒ³â€¦â€¦.â€œå§”æ‰˜â€ï¼Œâ€œå§”æ‰˜â€ï¼Œæ²¡é”™ï¼Œè¿˜æ˜¯â€œå§”æ‰˜â€ã€‚ æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå§”æ‰˜ï¼Œä¸€ä¸ªç»™â€œCanExecuteâ€ï¼Œå¦ä¸€ä¸ªç»™â€œExecuteâ€ã€‚â€œCanExecuteâ€è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç”¨æ¥éªŒè¯ä»¥åŠæ ¹æ®éªŒè¯æ¥ä½¿èƒ½ï¼ˆEnableï¼‰æˆ–è€…ç¦ç”¨ï¼ˆDisableï¼‰ç”¨æˆ·ç•Œé¢ã€‚â€œExecuteâ€å§”æ‰˜åˆ™å°†åœ¨â€œCanExecuteâ€å§”æ‰˜è¿”å›trueæ—¶æ‰§è¡Œã€‚ 123456789public class ButtonCommand : ICommand&#123; public bool CanExecute(object parameter) // Validations &#123; &#125; public void Execute(object parameter) // Executions &#123; &#125;&#125; å› æ­¤ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå§”æ‰˜ï¼Œä¸€ä¸ªè¿”å›å¸ƒå°”å€¼ï¼Œå¦ä¸€ä¸ªæ‰§è¡ŒåŠ¨ä½œå¹¶è¿”å›ç©ºã€‚æ‰€ä»¥ï¼Œåˆ›å»ºä¸€ä¸ªâ€œFuncâ€å’Œä¸€ä¸ªâ€œActionâ€å¦‚ä½•ï¼Ÿâ€œFuncâ€å’Œâ€œActionâ€éƒ½å¯ä»¥ç”¨æ¥åˆ›å»ºå§”æ‰˜ã€‚ å¦‚æœä½ è¿˜ä¸ç†Ÿæ‚‰Funcå’ŒActionï¼Œå¯ä»¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªè§†é¢‘ã€‚ï¼ˆè¯‘æ³¨ï¼šä½œè€…åœ¨è¿™é‡Œæä¾›äº†ä¸€ä¸ªYouTubeçš„è§†é¢‘é“¾æ¥ï¼Œå¤§æ¦‚è¯´çš„å°±æ˜¯C#ä¸­Func&lt;&gt;å’ŒAction&lt;&gt;è¿™ä¸¤ä¸ªå§”æ‰˜çš„åŒºåˆ«ï¼Œå‰è€…Func&lt;&gt;æ¨¡ç‰ˆå‚æ•°åŒ…å«è¿”å›å€¼ç±»å‹ï¼Œè€ŒAction&lt;&gt;è¡¨ç¤ºæ— è¿”å›å€¼çš„æ³›å‹å§”æ‰˜ï¼Œå‚è§è¿™é‡Œï¼‰ é€šè¿‡ä½¿ç”¨å§”æ‰˜çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¯•ç€åˆ›å»ºä¸€ä¸ªé€šç”¨çš„commandç±»ã€‚æˆ‘ä»¬å¯¹commandç±»åšäº†ä¸‰ä¸ªä¿®æ”¹ï¼ˆä»£ç å‚è§ä¸‹é¢ï¼‰ï¼ŒåŒæ—¶æˆ‘ä¹Ÿæ ‡æ³¨äº†ä¸‰ç‚¹Point 1ï¼Œ2å’Œ3ã€‚ Point1ï¼š æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­ç§»é™¤äº†ViewModelå¯¹è±¡ï¼Œæ”¹ä¸ºæ¥å—ä¸¤ä¸ªå§”æ‰˜ï¼Œä¸€ä¸ªæ˜¯â€œFuncâ€ï¼Œå¦ä¸€ä¸ªæ˜¯â€œActionâ€ã€‚â€œFuncâ€å§”æ‰˜ç”¨ä½œéªŒè¯ï¼ˆä¾‹å¦‚éªŒè¯ä½•æ—¶åŠ¨ä½œå°†è¢«æ‰§è¡Œï¼‰ï¼Œè€Œâ€œActionâ€å§”æ‰˜ç”¨æ¥æ‰§è¡ŒåŠ¨ä½œã€‚ä¸¤ä¸ªå§”æ‰˜éƒ½æ˜¯é€šè¿‡æ„é€ å‡½æ•°å‚æ•°ä¼ é€’è¿›æ¥ï¼Œå¹¶èµ‹å€¼ç»™ç±»å†…éƒ¨çš„å¯¹åº”ç§æœ‰æˆå‘˜å˜é‡ã€‚ Point2å’Œ3ï¼š Func&lt;&gt;å§”æ‰˜ï¼ˆWhentoExecuteï¼‰è¢«â€œCanExecuteâ€è°ƒç”¨ï¼Œæ‰§è¡ŒåŠ¨ä½œçš„å§”æ‰˜Whattoexecuteåˆ™æ˜¯åœ¨â€œExecuteâ€ä¸­è¢«è°ƒç”¨ã€‚ 123456789101112131415161718public class ButtonCommand : ICommand&#123; private Action WhattoExecute; private Func&lt;bool&gt; WhentoExecute; public ButtonCommand(Action What , Func&lt;bool&gt; When) // Point 1 &#123; WhattoExecute = What; WhentoExecute = When; &#125; public bool CanExecute(object parameter) &#123; return WhentoExecute(); // Point 2 &#125; public void Execute(object parameter) &#123; WhattoExecute(); // Point 3 &#125;&#125; æˆ‘ä»¬å·²ç»çŸ¥é“è¦æ‰§è¡Œä»€ä¹ˆäº†ï¼ˆä¾‹å¦‚â€œCalculateTaxâ€ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿåˆ›å»ºä¸€ä¸ªç®€å•çš„å‡½æ•°â€œIsValidâ€æ¥éªŒè¯â€œCustomerâ€ç±»æ˜¯å¦æœ‰æ•ˆã€‚ 123456789101112131415161718192021222324252627282930public class Customer&#123; public void CalculateTax() &#123; if (_Amount &gt; 2000) &#123; _Tax = 20; &#125; else if (_Amount &gt; 1000) &#123; _Tax = 10; &#125; else &#123; _Tax = 5; &#125; &#125; public bool IsValid() &#123; if (_Amount == 0) &#123; return false; &#125; else &#123; return true; &#125; &#125;&#125; åœ¨ViewModelç±»ä¸­æˆ‘ä»¬åŒæ—¶ä¼ é€’å‡½æ•°å’Œæ–¹æ³•ç»™commandç±»çš„æ„é€ å‡½æ•°ï¼Œä¸€ä¸ªç»™â€œFuncâ€ï¼Œä¸€ä¸ªç»™â€œActionâ€ã€‚ 12345678910public class CustomerViewModel : INotifyPropertyChanged&#123;private Customer obj = new Customer();privateButtonCommandobjCommand;publicCustomerViewModel() &#123;objCommand = new ButtonCommand(obj.CalculateTax,obj.IsValid); &#125;&#125; è¿™æ ·ä½¿å¾—æ¡†æ¶æ›´å¥½ï¼Œæ›´è§£è€¦ï¼Œ ä½¿å¾—è¿™ä¸ªcommandç±»å¯ä»¥ä»¥ä¸€ä¸ªé€šç”¨çš„æ–¹å¼è¢«å…¶å®ƒViewModelå¼•ç”¨ã€‚ä¸‹é¢æ˜¯æ”¹å–„åçš„æ¶æ„ï¼Œ éœ€è¦æ³¨æ„ViewModelå¦‚ä½•é€šè¿‡å§”æ‰˜ï¼ˆFuncå’ŒActionï¼‰å’Œcommandç±»äº¤äº’ã€‚ ç¬¬äº”æ­¥ï¼šåˆ©ç”¨PRISMæœ€åå¦‚æœæœ‰ä¸€ä¸ªæ¡†æ¶èƒ½å¸®åŠ©å®ç°æˆ‘ä»¬çš„MVVMä»£ç é‚£å°±æ›´å¥½äº†ã€‚PRISMå°±æ˜¯å…¶ä¸­ä¸€ä¸ªå¯å¤ç”¨çš„æ¡†æ¶ã€‚PRISMçš„ä¸»è¦ç”¨é€”æ˜¯ä¸ºäº†æä¾›æ¨¡å—åŒ–å¼€å‘ï¼Œä½†æ˜¯å®ƒæä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„â€œDelegateCommandâ€ç±»æ‹¿æ¥ä»£æ›¿æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„commandç±»ã€‚ æ‰€ä»¥ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯ä»è¿™é‡Œä¸‹è½½PRISMï¼Œç¼–è¯‘è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ·»åŠ â€œMicrosoft.Practices.Prism.Mvvm.dllâ€å’Œâ€œMicrosoft.Practices.Prism.SharedInterfaces.dllâ€è¿™ä¸¤ä¸ªDLLåº“çš„å¼•ç”¨ã€‚ ä½ å¯ä»¥å»æ‰è‡ªå®šä¹‰çš„commandç±»ï¼Œå¯¼å…¥â€œMicrosoft.Practices.Prism.Commandsâ€åç§°ç©ºé—´ï¼Œ ç„¶åä»¥ä¸‹é¢ä»£ç çš„æ–¹å¼ä½¿ç”¨DelegateCommandã€‚ 12345678910111213public class CustomerViewModel : INotifyPropertyChanged&#123; private Customer obj = new Customer(); private DelegateCommand objCommand; public CustomerViewModel() &#123; objCommand = new DelegateCommand(obj.CalculateTax, obj.IsValid); &#125; ... ... ... ...&#125; WPF MVVMçš„è§†é¢‘æ¼”ç¤ºæˆ‘åŒæ—¶ä¹Ÿåœ¨ä¸‹é¢çš„è§†é¢‘ä¸­ä»å¤´æ¼”ç¤ºäº†å¦‚ä½•å®ç°WPF MVVMï¼ˆè¯‘æ³¨ï¼šä¸€ä¸ªYouTubeé“¾æ¥â€¦ï¼‰ã€‚ å»¶ä¼¸é˜…è¯» WPF&#x2F;MVVM Quick Start Tutorial Simplifying the WPF TreeView by Using the ViewModel Pattern MVVM åº”ç”¨ç¨‹åºä¸­çš„å¤šçº¿ç¨‹ä¸è°ƒåº¦ é’ˆå¯¹å¼‚æ­¥ MVVM åº”ç”¨ç¨‹åºçš„æ¨¡å¼ï¼šæ•°æ®ç»‘å®š é’ˆå¯¹å¼‚æ­¥ MVVM åº”ç”¨ç¨‹åºçš„æ¨¡å¼ï¼šå‘½ä»¤ Using behaviours to bind to read-only properties in MVVM Cascading ComboBoxes in WPF using MVVM WPF&#x2F;MVVM: Binding the IsChecked Property of a CheckBox to Several Other CheckBoxes","categories":[{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/categories/Windows/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/tags/Windows/"},{"name":"c#","slug":"c","permalink":"https://unpluggedcoder.me/tags/c/"},{"name":"MVVM","slug":"MVVM","permalink":"https://unpluggedcoder.me/tags/MVVM/"},{"name":"WPF","slug":"WPF","permalink":"https://unpluggedcoder.me/tags/WPF/"}]},{"title":"Python3ä¸‹Djangoç¯å¢ƒæ­å»ºä¸æ·»åŠ MySQLæ”¯æŒ","slug":"Python3ä¸‹Djangoç¯å¢ƒæ­å»ºä¸æ·»åŠ MySQLæ”¯æŒ","date":"2015-10-01T14:30:00.000Z","updated":"2022-09-15T15:51:05.346Z","comments":true,"path":"2015/10/01/Python3ä¸‹Djangoç¯å¢ƒæ­å»ºä¸æ·»åŠ MySQLæ”¯æŒ/","link":"","permalink":"https://unpluggedcoder.me/2015/10/01/Python3%E4%B8%8BDjango%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E6%B7%BB%E5%8A%A0MySQL%E6%94%AF%E6%8C%81/","excerpt":"","text":"ä¸€èˆ¬Linuxå‘è¡Œç‰ˆéƒ½æ˜¯é»˜è®¤Python2.7.*ç¯å¢ƒ, éœ€è¦æ‰‹åŠ¨å®‰è£…Python3, æˆ‘æ˜¯ç”¨CentOS7, ç”¨yum install python34å®‰è£…, å†å®‰è£…æˆ–å‡çº§pipï¼Œéœ€è¦ä¸‹è½½ get-pip.py, è¿™é‡Œæˆ‘ç”¨é»˜è®¤çš„python2.7å®‰è£…çš„pip, æ¥ä¸‹æ¥æ˜¯virtualenvç¯å¢ƒæ­å»º: 1234$mkvirtualenv -p /usr/bin/python34 django_env$workon django_env(django_env)$pip install django(django_env)$django-admin startproject myproject å®‰è£…MysSQL backend 1(django_env)$pip install PyMySQL ç„¶ååœ¨Djangoç«™ç‚¹çš„__init__.pyæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œ: 12import pymysqlpymysql.install_as_MySQLdb() ç¡®è®¤åœ¨Python shellä¸­import MySQLdbæ— è¯¯å³å¯æ­£å¸¸ä½¿ç”¨django.db.backends.mysql 12345678910#settings.py DATABASES = &#123; &#x27;default&#x27;: &#123; &#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;, #æ•°æ®åº“å¼•æ“ &#x27;NAME&#x27;: &#x27;test&#x27;, #æ•°æ®åº“å &#x27;USER&#x27;: &#x27;root&#x27;, #ç”¨æˆ·å &#x27;PASSWORD&#x27;: &#x27;root&#x27;, #å¯†ç  &#x27;HOST&#x27;: &#x27;&#x27;, #æ•°æ®åº“ä¸»æœºï¼Œé»˜è®¤ä¸ºlocalhost &#x27;PORT&#x27;: &#x27;&#x27;, #æ•°æ®åº“ç«¯å£ï¼ŒMySQLé»˜è®¤ä¸º3306 &#125;","categories":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"Django","slug":"Django","permalink":"https://unpluggedcoder.me/tags/Django/"}]},{"title":"Pythonä»MySQLå’Œcsvè¯»å–å¤§é‡æ•°æ®","slug":"Pythonä»MySQLå’Œcsvè¯»å–å¤§é‡æ•°æ®","date":"2015-07-27T03:12:50.000Z","updated":"2022-09-15T15:51:05.346Z","comments":true,"path":"2015/07/27/Pythonä»MySQLå’Œcsvè¯»å–å¤§é‡æ•°æ®/","link":"","permalink":"https://unpluggedcoder.me/2015/07/27/Python%E4%BB%8EMySQL%E5%92%8Ccsv%E8%AF%BB%E5%8F%96%E5%A4%A7%E9%87%8F%E6%95%B0%E6%8D%AE/","excerpt":"","text":"ä»MySQLdbæ¥å£è¯»å–ç™¾ä¸‡æ¡ä»¥ä¸Šè®°å½•çš„è¡¨æ ¼, ä¸»è¦æ˜¯è¦æŒ‡å®šæ¸¸æ ‡çš„ç§ç±», æ‰ä¸ä¼šé€ æˆç¨‹åºåœç•™åœ¨æ‰§è¡Œsqlè¯­å¥çš„ç­‰å¾…è¿”å›è¿‡ç¨‹ä¸­. æœ‰å››ç§Cursor: Cursor SSCursor DictCursor SSDictCursor å‰ä¸¤ç§è¿”å›tupleç»“æ„, åä¸¤ç§è¿”å›å­—å…¸ç»“æ„. å¦å¤–,å¸¦æœ‰SSå‰ç¼€çš„Cursoræ˜¯æœªå¸¦ç¼“å­˜çš„æ¸¸æ ‡(Unbuffered Cursor),å®ƒæ‰§è¡Œå‘½ä»¤åç»“æœä¸ä¼šä»MySQL serverä¸Šå–ä¸‹æ¥, è€Œæ˜¯è€Œæ˜¯ç«‹å³è¿”å›, å› æ­¤ä½¿ç”¨è¯¥SSCursoræœ‰ä¸¤ç‚¹è¦æ³¨æ„: ç”¨fetchone() è·å–æ¯ä¸€è¡Œç»“æœè¿›è¡Œå¤„ç† ä¸è¦ä½¿ç”¨fetchall(), å¦åˆ™å°†ä¼šä»serverä¸Šå–ä¸‹æ‰€æœ‰æ•°æ®, åŒæ ·ä¼šé€ æˆç¨‹åºå¡ä½. ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§: â€‹ a. åœ¨MySQLdb.connectionåˆå§‹åŒ–é“¾æ¥æ—¶æŒ‡å®š: 123456import MySQLdbimport MySQLdb.cursorsdb = MySQLdb.Connection(host=db_host, user=db_username, passwd=db_password,charset=&quot;utf8&quot;, init_command=&quot;set names utf8&quot;,cursorclass=MySQLdb.cursors.SSDictCursor) â€‹ b. åœ¨Cursoræ„é€ æ—¶æŒ‡å®š: 12345import MySQLdbfrom MySQLdb.cursors import SSCursordb = MySQLdb.connect(...)cursor = SSCursor(db) ä»csvæ–‡ä»¶è¯»å–å¤§é‡æ•°æ®, è¿™é‡Œè¦é‡Œç”¨pandasåº“ ä»¥ä¸‹é¢çš„æ•°æ®ä¸ºä¾‹ipnum,isp,isp_id16777216,,16777472,ç”µä¿¡,10001716777728,ç”µä¿¡,10001716777984,ç”µä¿¡,100017 123456import pandas as pdfor df in pd.read_csv(&#x27;isp.txt&#x27;, chunksize=50000, iterator=True, encoding=&#x27;utf-8&#x27;, na_values=&#x27;&#x27;): mod_df = df.fillna(&#x27;Unknown&#x27;) # å¡«å……ç©ºå­—æ®µ,å¡«å……åçš„ç»“æœä¼šè¿”å› for index, row in mod_df.iterrows(): print row[&#x27;ipnum&#x27;], row[&#x27;isp&#x27;], row[&#x27;isp_id&#x27;] chunksizeæŒ‡å®šäº†æ¯æ¬¡è¯»å–çš„å—å¤§å°, dfæ˜¯è¿­ä»£çš„DataFrame.æ³¨æ„df.fillna( )å¹¶ä¸ä¼šä¿®æ”¹df,è€Œæ˜¯æŠŠä¿®æ”¹åçš„è¿”å›.iterrows( )æ–¹æ³•å¯ä»¥è¿”å›è¿­ä»£çš„index å’Œ å­—å…¸å½¢å¼çš„ç»“æœ.","categories":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"MySQLdb","slug":"MySQLdb","permalink":"https://unpluggedcoder.me/tags/MySQLdb/"}]},{"title":"è®¾ç½®XFSæ–‡ä»¶ç³»ç»ŸQuota","slug":"è®¾ç½®XFSæ–‡ä»¶ç³»ç»ŸQuota","date":"2015-07-08T02:19:22.000Z","updated":"2022-09-15T15:51:05.354Z","comments":true,"path":"2015/07/08/è®¾ç½®XFSæ–‡ä»¶ç³»ç»ŸQuota/","link":"","permalink":"https://unpluggedcoder.me/2015/07/08/%E8%AE%BE%E7%BD%AEXFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FQuota/","excerpt":"","text":"CentOS7å¼€å§‹é»˜è®¤XFSæ–‡ä»¶ç³»ç»Ÿ, æ‰€ä»¥ä¹‹å‰çš„æ—§ä»£ç éœ€è¦ä¸€äº›æ›´æ”¹. æŸ¥è¯¢XFSæ–‡ä»¶ç³»ç»ŸQuotaçš„å‡ ä¸ªå‘½ä»¤ 1234567# xfs_quota -x -c &#x27;report -h&#x27; /home# xfs_quota -x -c report /home# xfs_quota -c &#x27;df -h&#x27; /PATH/TO/QUOTA# xfs_quota -c &#x27;df -ih&#x27; /PATH/TO/QUOTA // èŠ‚ç‚¹inode éœ€è¦å®‰è£…xfsçš„å¤´æ–‡ä»¶: yum install xfsprogs-devel Sample Code: 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;sys/types.h&gt;#include &lt;sys/quota.h&gt;#include &lt;sys/statfs.h&gt;#include &lt;linux/quota.h&gt;#include &lt;linux/magic.h&gt;#include &lt;xfs/xqm.h&gt;void set_xfs_quota (int u_id, int limit)&#123; fs_disk_quota_t xfsquota; if (quotactl(QCMD(Q_XGETQUOTA, USRQUOTA), &quot;/dev/mapper/centos-home&quot;, u_id, (caddr_t)&amp;xfsquota) != 0) &#123; string errStr(strerror(errno)); cout &lt;&lt; &quot; errno(&quot;&lt;&lt; errno &lt;&lt; &quot;):&quot; &lt;&lt; errStr &lt;&lt; endl; &#125; // è®¾ç½®limit MBçš„Quota xfsquota.d_fieldmask = FS_DQ_LIMIT_MASK; xfsquota.d_blk_hardlimit = limit * 1024 * 2; // è¦ä¹˜ä»¥2 xfsquota.d_blk_softlimit = limit * 1024 * 2; if (quotactl(QCMD(Q_XSETQLIM, USRQUOTA), &quot;/dev/mapper/centos-home&quot;, u_id, (caddr_t)(&amp;xfsquota)) != 0) &#123; string errStr(strerror(errno)); cout &lt;&lt; &quot; errno(&quot;&lt;&lt; errno &lt;&lt; &quot;):&quot; &lt;&lt; errStr &lt;&lt; endl; &#125;&#125;","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://unpluggedcoder.me/tags/Linux/"},{"name":"quota","slug":"quota","permalink":"https://unpluggedcoder.me/tags/quota/"}]},{"title":"PythonæŠ“å–æ·˜å®IPåœ°å€æ•°æ®","slug":"PythonæŠ“å–æ·˜å®IPåœ°å€æ•°æ®","date":"2015-04-22T09:04:27.000Z","updated":"2022-09-15T15:51:05.346Z","comments":true,"path":"2015/04/22/PythonæŠ“å–æ·˜å®IPåœ°å€æ•°æ®/","link":"","permalink":"https://unpluggedcoder.me/2015/04/22/Python%E6%8A%93%E5%8F%96%E6%B7%98%E5%AE%9DIP%E5%9C%B0%E5%9D%80%E6%95%B0%E6%8D%AE/","excerpt":"","text":"ä»https://ip.taobao.comä¸ŠæŠ“å–IPåœ°å€åº“ä¿¡æ¯. ç½‘ä¸Šæœ‰å¾ˆå¤šè¿™æ ·çš„ä¾‹å­,ä½†å®Œæ•´çš„ä»£ç ä¸å¤š, è¿™é‡Œåˆ†äº«ä¸‹æˆ‘å†™çš„ç‰ˆæœ¬. å› ä¸ºæ·˜å®æœ‰é™åˆ¶æ¯ç§’10æ¬¡çš„è¯·æ±‚, ä¸çŸ¥é“æ˜¯æœºå™¨æ€§èƒ½è¿˜æ˜¯pythonæ€§èƒ½äº¦æˆ–æ˜¯æˆ‘ä»£ç é—®é¢˜, æ”¾å¼€é™åˆ¶æœ€å¤šä¹Ÿå°±å¹³å‡æ¯ç§’10æ¬¡è®¿é—®.å¯èƒ½æ˜¯ç”±äºæˆ‘ç”¨çš„æ˜¯urllibåŒæ­¥æŠ“å–,æ”¹æˆå¼‚æ­¥ä¹Ÿå¾ˆç®€å•.å…·ä½“è¿è¡Œæˆªå›¾å¦‚ä¸‹: ä¸‰ä¸ªçº¿ç¨‹:workerçº¿ç¨‹æŠ“å–å¹¶è§£ææ•°æ® 1234567891011121314151617def worker(ratelimit, jobs, results, progress): global cancel while not cancel: try: ratelimit.ratecontrol() ip = jobs.get(timeout=2) # Wait 2 seconds ok, result = fetch(ip) if not ok: logging.error(&quot;Fetch information failed, ip:&#123;&#125;&quot;.format(ip)) progress.put(&quot;&quot;) # Notify the progress even it failed elif result is not None: results.put(&quot; &quot;.join(result)) jobs.task_done() # Notify one item except Queue.Empty: pass except: logging.exception(&quot;Unknown Error!&quot;) 1234567891011121314151617181920212223242526def fetch(ip): url = &#x27;https://ip.taobao.com/service/getIpInfo.php?ip=&#x27; + ip result = [] try: response = urllib.urlopen(url).read() jsondata = json.loads(response) if jsondata[u&#x27;code&#x27;] == 0: result.append(jsondata[u&#x27;data&#x27;][u&#x27;ip&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;country&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;country_id&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;area&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;area_id&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;region&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;region_id&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;city&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;city_id&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;county&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;county_id&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;isp&#x27;].encode(&#x27;utf-8&#x27;)) result.append(jsondata[u&#x27;data&#x27;][u&#x27;isp_id&#x27;].encode(&#x27;utf-8&#x27;)) else: return 0, result except: logging.exception(&quot;Url open failed:&quot; + url) return 0, result return 1, result processçº¿ç¨‹è¾“å‡ºç»“æœåˆ°output 1234567891011def process(target, results, progress): global cancel while not cancel: try: line = results.get(timeout=5) except Queue.Empty: pass else: print &amp;gt;&amp;gt;target, line progress.put(&quot;&quot;) results.task_done() progprocçº¿ç¨‹è®°å½•è¿›åº¦,æˆ‘ç”¨äº†pipåº“é‡Œprogressbar2è¿™ä¸ªåŒ…, å®ƒé»˜è®¤è¾“å‡ºåˆ°stderr,ä¸å½±å“é»˜è®¤çš„stdoutç»“æœè¾“å‡º.ä½†æ˜¯ProgressBarç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,æ‰€ä»¥å°±å¼€äº†è¿™ä¸ªçº¿ç¨‹. 123456789101112131415def progproc(progressbar, count, progress): &quot;&quot;&quot; Since ProgressBar is not a thread-safe class, we use a Queue to do the counting job, like two other threads. Use this thread do the printing of progress bar. By the way, it will print to stderr, which does not conflict with the default result output(stdout). &quot;&quot;&quot; idx = 1 while True: try: progress.get(timeout=5) except Queue.Empty: pass else: progressbar.update(idx) idx += 1 ç”¨æ³•å¾ˆç®€å•: 123456789101112usage: main.py [-h][-o OUTPUT] iprangepositional arguments:iprange The string of IP range, such as:&quot;192.168.1.0-192.168.1.255&quot; : beginning-end&quot;192.168.1.0/24&quot; : CIDR&quot;192.168.1.*&quot; : wildcardoptional arguments:-h, --help show this help message and exit-o OUTPUT, --output OUTPUTThe output destination of result, default is stdout æ”¯æŒä¸‰ç§ipèŒƒå›´çš„è¡¨è¾¾å¼,è¶³å¤ŸæŠ“å–å„ç±»ç½‘æ®µIPäº†,ä¾‹å¦‚:Cç±»ç½‘æ®µ: 192.168.*.1çš„å‚æ•°ä¹Ÿæ˜¯æ¥å—çš„. å·²ç»ä¸Šä¼ åˆ°Githubä¸Šäº†: taobaoip","categories":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://unpluggedcoder.me/tags/%E7%88%AC%E8%99%AB/"}]},{"title":"åœ¨Linux(CentOS)ä¸Šå¼€å¯å°åº¦WIFIæ— çº¿APæ¨¡å¼","slug":"åœ¨Linux(CentOS)ä¸Šå¼€å¯å°åº¦WIFIæ— çº¿APæ¨¡å¼","date":"2015-01-29T03:31:35.000Z","updated":"2022-09-15T15:51:05.353Z","comments":true,"path":"2015/01/29/åœ¨Linux(CentOS)ä¸Šå¼€å¯å°åº¦WIFIæ— çº¿APæ¨¡å¼/","link":"","permalink":"https://unpluggedcoder.me/2015/01/29/%E5%9C%A8Linux(CentOS)%E4%B8%8A%E5%BC%80%E5%90%AF%E5%B0%8F%E5%BA%A6WIFI%E6%97%A0%E7%BA%BFAP%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"ä»è¿™ä¸ªåšå®¢https://evilbinary.org/blog/article/6/ ä¸‹è½½DPA_MT7601U_LinuxAP_ANDROID_20121211è¿™ä¸ªæ–‡ä»¶ è§£å‹åä¿®æ”¹å‡ ä¸ªæ–‡ä»¶: ç›®å½•ä¸‹çš„Makefile 12345678# Linux 2.6#LINUX_SRC = /lib/modules/$(shell uname -r)/build è¿™é‡Œæ”¹æˆè‡ªå·±çš„è·¯å¾„LINUX_SRC = /lib/modules/3.10.0-123.4.2.el7.x86_64/build# Linux 2.4 Change to your local setting#LINUX_SRC = /usr/src/linux-2.4LINUX_SRC_MODULE = /lib/modules/$(shell uname -r)/kernel/drivers/net/wireless/CROSS_COMPILE =endif os&#x2F;linux&#x2F;rt_linux.cè¿™ä¸ªæ–‡ä»¶é‡Œ918è¡Œçš„å®è¦æ”¹æˆ(2.6ä»¥ä¸Šå†…æ ¸): 12345678#if LINUX_VERSION_CODE &amp;lt; KERNEL_VERSION(2,6,29)pOSFSInfo-&amp;gt;fsuid = current-&amp;gt;fsuid;pOSFSInfo-&amp;gt;fsgid = current-&amp;gt;fsgid;current-&amp;gt;fsuid = current-&amp;gt;fsgid = 0;//#else æ³¨é‡Šè¿™é‡Œ// pOSFSInfo-&amp;gt;fsuid = current_fsuid() ;// pOSFSInfo-&amp;gt;fsgid = current_fsgid() ;#endif ç„¶åmake, make install, å¿½ç•¥lzmaçš„å‹ç¼©å‘½ä»¤æœªæ‰¾åˆ° modprobe mt7601Uap ç„¶ålsmod | grep mt7601å¯ä»¥çœ‹åˆ°mt7601Uapä»£è¡¨æˆåŠŸ, ç„¶åé‡å¯ æ¥ä¸‹æ¥å‚è€ƒè¿™é‡Œ https://blog.csdn.net/sumang_87&#x2F;article&#x2F;details&#x2F;38168877 yum install dhcp -y ç¼–è¾‘ sudo vim /etc/dhcp/dhcpd.conf åŠ ä¸Šäº†ä¸‹é¢ä¸€æ®µã€‚ã€‚(æœç´¢ This is ï¼›å¦å¤–æ³¨æ„DNSï¼ˆdomain-name-serversï¼‰ï¼Œä½ ä»¬è‡ªå·±é€‰æ‹©åˆé€‚ä½ ä»¬çš„) 12345678subnet 192.168.208.0 netmask 255.255.255.0 &#123; range 192.168.208.10 192.168.208.20; option routers 192.168.208.1; option domain-name-servers 114.114.114.114;&#125; æŠŠä¸‹é¢çš„ä¿å­˜æˆStartupWIFI.sh, å¼€æœºå¯åŠ¨å³å¯â€¦. æˆ‘çš„å°åº¦WIFIæ˜¯ra0, ä»¥å¤ªç½‘æ˜¯ens33, å¯¹å·å…¥åº§ä¿®æ”¹æˆè‡ªå·±çš„, å†…ç½‘IPè¦å’Œä¸Šé¢çš„dhcpd.confä¸€è‡´ 1234567ifconfig ra0 upifconfig ra0 192.168.208.1echo 1 | sudo tee /proc/sys/net/ipv4/ip_forwardiptables -t filter -Fiptables -t nat -Fiptables -t nat -A POSTROUTING -o ens33 -j MASQUERADEdhcpd ra0","categories":[{"name":"Unix/Linux","slug":"Unix-Linux","permalink":"https://unpluggedcoder.me/categories/Unix-Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://unpluggedcoder.me/tags/Linux/"},{"name":"å°åº¦WIFI","slug":"å°åº¦WIFI","permalink":"https://unpluggedcoder.me/tags/%E5%B0%8F%E5%BA%A6WIFI/"}]},{"title":"ATLæ¡†æ¶ä¸‹ç¼–å†™WindowsæœåŠ¡","slug":"ATLæ¡†æ¶ä¸‹ç¼–å†™WindowsæœåŠ¡","date":"2015-01-27T02:46:13.000Z","updated":"2022-09-15T15:51:05.342Z","comments":true,"path":"2015/01/27/ATLæ¡†æ¶ä¸‹ç¼–å†™WindowsæœåŠ¡/","link":"","permalink":"https://unpluggedcoder.me/2015/01/27/ATL%E6%A1%86%E6%9E%B6%E4%B8%8B%E7%BC%96%E5%86%99Windows%E6%9C%8D%E5%8A%A1/","excerpt":"å‰æ®µæ—¶é—´æœ‰ä¸ªå¼€å‘ä¸€ä¸ªWindowsæœåŠ¡çš„éœ€æ±‚,ä¸”ä¸èƒ½ä½¿ç”¨.NET, ä¹‹ååœ¨å¯¹æ¯”äº†Win32 å’Œ ATLä¸¤ç§ç¼–å†™WindowsæœåŠ¡çš„é€”å¾„, è¿˜æ˜¯é€‰æ‹©äº†åè€…. Markå‡ ä¸ªåœ°æ–¹ é‡è½½InitializeSecurity()å‡½æ•° 12345678910HRESULT InitializeSecurity() throw()&#123; // TODO : è°ƒç”¨ CoInitializeSecurity å¹¶ä¸ºæœåŠ¡æä¾›é€‚å½“çš„ // å®‰å…¨è®¾ç½® // å»ºè®® - PKT çº§åˆ«çš„èº«ä»½éªŒè¯ã€ // RPC_C_IMP_LEVEL_IDENTIFY çš„æ¨¡æ‹Ÿçº§åˆ« // ä»¥åŠé€‚å½“çš„é NULL å®‰å…¨è¯´æ˜ç¬¦ã€‚ return CoInitializeSecurity( NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_NONE,RPC_C_IMP_LEVEL_IDENTIFY, NULL, EOAC_NONE, NULL );&#125;","text":"å‰æ®µæ—¶é—´æœ‰ä¸ªå¼€å‘ä¸€ä¸ªWindowsæœåŠ¡çš„éœ€æ±‚,ä¸”ä¸èƒ½ä½¿ç”¨.NET, ä¹‹ååœ¨å¯¹æ¯”äº†Win32 å’Œ ATLä¸¤ç§ç¼–å†™WindowsæœåŠ¡çš„é€”å¾„, è¿˜æ˜¯é€‰æ‹©äº†åè€…. Markå‡ ä¸ªåœ°æ–¹ é‡è½½InitializeSecurity()å‡½æ•° 12345678910HRESULT InitializeSecurity() throw()&#123; // TODO : è°ƒç”¨ CoInitializeSecurity å¹¶ä¸ºæœåŠ¡æä¾›é€‚å½“çš„ // å®‰å…¨è®¾ç½® // å»ºè®® - PKT çº§åˆ«çš„èº«ä»½éªŒè¯ã€ // RPC_C_IMP_LEVEL_IDENTIFY çš„æ¨¡æ‹Ÿçº§åˆ« // ä»¥åŠé€‚å½“çš„é NULL å®‰å…¨è¯´æ˜ç¬¦ã€‚ return CoInitializeSecurity( NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_NONE,RPC_C_IMP_LEVEL_IDENTIFY, NULL, EOAC_NONE, NULL );&#125; é‡è½½RegisterAppIdå‡½æ•°,æ³¨å†ŒæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ 123456789101112131415161718192021222324252627282930313233343536HRESULT CXXXXXServiceModule::RegisterAppId(bool bService = false) throw()&#123; HRESULT hr = S_OK; BOOL res = __super::RegisterAppId(bService); if (bService) &#123; if (IsInstalled()) &#123; SC_HANDLE hSCM = ::OpenSCManagerW(NULL, NULL, SC_MANAGER_ALL_ACCESS); SC_HANDLE hService = NULL; if (hSCM == NULL) hr = AtlHresultFromLastError(); else &#123; hService = ::OpenService(hSCM, m_szServiceName, SERVICE_ALL_ACCESS); if (hService != NULL) &#123; ::ChangeServiceConfig(hService, SERVICE_NO_CHANGE, SERVICE_AUTO_START, // æœåŠ¡è‡ªå¯åŠ¨ NULL, NULL, NULL, NULL, NULL, NULL, NULL, m_szServiceName); // é€šè¿‡ä¿®æ”¹èµ„æºIDS_SERVICENAME ä¿®æ”¹æœåŠ¡çš„æ˜¾ç¤ºåå­— SERVICE_DESCRIPTION Description; TCHAR szDescription[1024]; ZeroMemory(szDescription, 1024); ZeroMemory(&amp;amp;Description, sizeof(SERVICE_DESCRIPTION)); lstrcpy(szDescription, _T(&quot;è¿™é‡Œæ·»åŠ æœåŠ¡çš„æè¿°å†…å®¹&quot;)); Description.lpDescription = szDescription; ::ChangeServiceConfig2(hService, SERVICE_CONFIG_DESCRIPTION, &amp;amp;Description); ::CloseServiceHandle(hService); &#125; else hr = AtlHresultFromLastError(); ::CloseServiceHandle(hSCM); &#125; &#125; &#125; return hr;&#125; é‡è½½run( )å‡½æ•°, ç½‘ä¸Šæœ‰çš„è¯´é‡è½½PreMessageLoop( )å‡½æ•°æ·»åŠ è‡ªå®šä¹‰ä»£ç ,å…¶å®çœ‹atlå¤´æ–‡ä»¶, é‡è½½runæ¯”è¾ƒâ€æ­£å®—â€. 12345HRESULT CXXXXXServiceModule::Run(int nShowCmd) throw()&#123; // æ·»åŠ æœåŠ¡å¯åŠ¨çš„è‡ªå®šä¹‰ä»£ç  return __super::Run(nShowCmd);&#125; é‡è½½stop( )å‡½æ•°, æ·»åŠ æœåŠ¡åœæ­¢çš„ç›¸å…³ä»£ç . 12345void CXXXXXServiceModule::OnStop() throw()&#123; // é‡Šæ”¾æ‰€æœ‰èµ„æº __super::OnStop();&#125; ä»¥ä¸Šè¿™äº›å‡½æ•°éƒ½ä¸èƒ½æŠ›å‡ºå¼‚å¸¸,è¿™ç‚¹å¾ˆé‡è¦, æœ€å¥½éƒ½ç”¨try&#123; &#125; catch()&#123;&#125;å—æ•è·, å¦‚æœæœ‰å¼‚å¸¸çš„è¯æœåŠ¡çš„æ“ä½œå°±ä¼šå¤±è´¥é€ æˆæœåŠ¡çš„æ— å“åº”.åŒæ—¶ä¸ºäº†ä¸è®©æœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢è¶…æ—¶, æœ€å¥½å¼€å¯åˆ«çš„çº¿ç¨‹å»å®Œæˆä»»åŠ¡. æ³¨å†ŒæœåŠ¡: MyService.exe &#x2F;Serviceå¸è½½æœåŠ¡: MyService.exe &#x2F;UnRegServer è°ƒè¯•&#x2F;æµ‹è¯•æœåŠ¡çš„æ—¶å€™éš¾å…ä¼šå¯¼è‡´æœåŠ¡è¿›ç¨‹çš„å´©æºƒ, æœåŠ¡åˆ—è¡¨ä¸Šæ— æ³•æ“ä½œ, è¿™æ—¶å€™æ£€æŸ¥ä¸‹é¢å‡ ç‚¹å»æ¸…é™¤&#x2F;å¸è½½æœåŠ¡: å¦‚æœæœ‰å®‰è£…ç¨‹åº, åœ¨æ·»åŠ &#x2F;åˆ é™¤ç¨‹åºé‡Œå¸è½½æœåŠ¡çš„ç¨‹åº, å‰ææ¡ä»¶æ˜¯æœåŠ¡æœ‰å“åº”, å¹¶ä¸”å¸è½½æœåŠ¡çš„å‘½ä»¤ä¸èƒ½æœ‰å¼‚å¸¸å’Œå¤±è´¥; åœ¨æ³¨å†Œè¡¨è·¯å¾„[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services]ä¸­æ‰¾åˆ°è‡ªå·±çš„æœåŠ¡,åˆ é™¤; åœ¨æ³¨å†Œè¡¨é‡Œæœç´¢è‡ªå·±çš„æœåŠ¡å, åˆ é™¤æ‰€æœ‰çš„é”®å€¼; ä»»åŠ¡ç®¡ç†å™¨é‡Œç»“æŸæœåŠ¡è¿›ç¨‹.","categories":[{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/categories/Windows/"}],"tags":[{"name":"ATL","slug":"ATL","permalink":"https://unpluggedcoder.me/tags/ATL/"},{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/tags/Windows/"},{"name":"C#","slug":"C","permalink":"https://unpluggedcoder.me/tags/C/"}]},{"title":"Jabberd2 æ·»åŠ åŠ¨æ€åŸŸåç®¡ç†åŠŸèƒ½ (ä¸‹)","slug":"Jabberd2 æ·»åŠ åŠ¨æ€åŸŸåç®¡ç†åŠŸèƒ½ (ä¸‹)","date":"2014-11-21T03:12:25.000Z","updated":"2022-09-15T15:51:05.345Z","comments":true,"path":"2014/11/21/Jabberd2 æ·»åŠ åŠ¨æ€åŸŸåç®¡ç†åŠŸèƒ½ (ä¸‹)/","link":"","permalink":"https://unpluggedcoder.me/2014/11/21/Jabberd2%20%E6%B7%BB%E5%8A%A0%E5%8A%A8%E6%80%81%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%20(%E4%B8%8B)/","excerpt":"","text":"æ—¶éš”å‡ ä¸ªæœˆæ‰å‘è¿™ç¯‡ä¸‹æ–‡æ˜¯å› ä¸ºæœŸé—´æ¯”è¾ƒå¿™, å…¶æ¬¡åˆèŠ±äº†ä¸€ä¸ªæœˆçš„æ—¶é—´åœ¨å¯¹å®Œæˆçš„ç¬¬ä¸€ä»½Jabberd2sååšäº†éå¸¸å¤§çš„æ”¹åŠ¨.ä½†æ˜¯ä¸ºäº†èƒ½è¡”æ¥Jabberd2 æ·»åŠ åŠ¨æ€åŸŸåç®¡ç†åŠŸèƒ½ (ä¸Š) å†…å®¹, æœ¬æ–‡è¿˜æ˜¯æ¥ç€å®ƒçš„æ–¹æ³•æŠŠå¯¹c2sçš„æ›´æ”¹postå‡ºæ¥, å…¶å®ä¹Ÿéå¸¸ç®€å•, æœ‰çœ‹è¿‡ä»£ç çš„åº”è¯¥å°±å¾ˆäº†è§£äº†. æœ€å, å¯¹ç°åœ¨Jabberd2sçš„ä¿®æ”¹ç°çŠ¶åšäº†ç‚¹ç®€å•æè¿°. æœ€å¤æ‚çš„sméƒ¨åˆ†åœ¨ä¸Šç¯‡å·²ç»è®²è¿‡äº†, å’Œsmä¸€æ ·, c2sä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªhostsçš„åˆ—è¡¨(å…¶å®å¦ä¸€ä¸ªhostsåˆ—è¡¨c2s-&gt;sm_avail åœ¨ä¸Šä¸€èŠ‚å·²ç»ç”±smç»´æŠ¤äº†)ä»£è¡¨å¯ç”¨çš„æœåŠ¡åŸŸå, åœ¨å¯¹XMLé…ç½®æ–‡ä»¶ä¿®æ”¹ååŒæ ·è¦ä½¿å…¶ç”Ÿæ•ˆä¹Ÿæ˜¯åœ¨c2s&#x2F;main.cé‡Œé‡æ–°åŠ è½½é…ç½®, åŠ è½½é…ç½®çš„å‡½æ•°å¤§éƒ¨åˆ†å·²ç»æœ‰äº†. é¦–å…ˆç”¨åŒæ ·çš„æ–¹æ³•è§¦å‘ReConfig: 123456789101112131415161718// reload configurationsif(c2s_reconf) &#123; log_write(c2s-&gt;log, LOG_NOTICE, &quot;reloading some configuration items ...&quot;); config_t conf; conf = config_new(); if (conf &amp;&amp; config_load(conf, config_file) == 0) &#123; // expand with new configuration _c2s_hosts_expand_with_config(c2s, conf); config_free(conf); log_write(c2s-&gt;log, LOG_NOTICE, &quot;reconfig hosts mapping ...&quot;); &#125;else &#123; log_write(c2s-&gt;log, LOG_WARNING, &quot;couldn&#x27;t reload config (%s)&quot;, config_file); if (conf) config_free(conf); &#125; c2s_reconf = 0;&#125; _c2s_hosts_expand_with_configæ˜¯æ–°å¢çš„å‡½æ•°, å…¶å…³é”®ä»£ç : 12345678910111213141516171819202122232425262728293031323334353637/* Reconfig with sepecified configuration */static void _c2s_hosts_expand_with_config(c2s_t c2s, config_t conf)&#123; ... // ä»config_tè¯»å–å¹¶å¡«å……åˆ°newhosts newhosts = xhash_new(1021); for(i = 0; i &lt; elem-&gt;nvalues; i++) &#123; host_t host = (host_t) pmalloco(xhash_pool(newhosts), sizeof(struct host_st)); ... //æ­¤å¤„çš„sx_ssl_server_addcertæœ‰ç‚¹ç¼ºé™· &#125; // ä»¥ä¸Šå†…å®¹å’Œ _c2s_hosts_expandå‡ ä¹ä¸€æ ·. // update host pointer in sessions if(xhash_iter_first(c2s-&gt;sessions)) do &#123; xhv.sess_val = &amp;sess; xhash_iter_get(c2s-&gt;sessions, NULL, NULL, xhv.val); if(sess-&gt;resources != NULL) &#123; host_t currhost = xhash_get(newhosts, sess-&gt;resources-&gt;jid-&gt;domain); if(currhost!= NULL)&#123; // Update to new host pointer sess-&gt;host = currhost; &#125;else&#123; /* domain has been removed, close it`s session*/ sess-&gt;active = 0; if(sess-&gt;s) sx_close(sess-&gt;s); &#125; &#125; &#125; while(xhash_iter_next(c2s-&gt;sessions)); // replace current hosts table xhash_free(c2s-&gt;hosts); c2s-&gt;hosts = newhosts;&#125; è¿™æ ·å°±æ›´æ–°äº†c2s-&gt;hosts, æœ€ä¸»è¦çš„æ˜¯è¦æ›´æ–°c2s-&gt;sessionsé‡Œçš„hostæŒ‡é’ˆå€¼, å‰©ä¸‹çš„c2séƒ½ä¼šè‡ªå·±å¤„ç†. ä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹, åœ¨sx_ssl_server_addcertæ·»åŠ SSLè¯ä¹¦ä¿¡æ¯ä¸­,å¦‚æœå¯¹é‡å¤å³å·²å­˜åœ¨çš„è¯ä¹¦ä¿¡æ¯ä¼šåˆ é™¤åŸæœ‰å¹¶æ›¿æ¢: 1234567891011121314/** args: name, pemfile, cachain, mode */int sx_ssl_server_addcert (...)&#123; ... /* remove an existing context with the same name before replacing it */ tmp = xhash_get(contexts, name); if(tmp != NULL) SSL_CTX_free((SSL_CTX *) tmp); xhash_put(contexts, name, ctx); return 0;&#125; è¿™å¯ä»¥è‡ªåŠ¨æ›´æ–°è¯ä¹¦, ä½†æ˜¯å¯¹å·²ç»ç§»é™¤çš„domainè¯ä¹¦å´æ²¡æœ‰åˆ é™¤, è¦å®ç°è¿™ä¸ªå¹¶ä¸éš¾, åæœŸä¼šä¿®å¤è¿™ä¸ªbug. â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ ç›®å‰å¯¹Jabberd2så·²ç»æœ‰äº†å¾ˆå¤§çš„ä¿®æ”¹, å·²ç»ä¸å†ä»XMLé…ç½®æ–‡ä»¶é‡Œè¯»å–hostsçš„é…ç½®ä¿¡æ¯, å–è€Œä»£ä¹‹åœ¨æ•°æ®åº“é‡Œæ·»åŠ äº†ä¸€å¼ hostè¡¨, æœ‰æ›´å¼ºçš„å¯æ§æ€§, ä¸è¿‡ç›®å‰åªæœ‰å¯¹mysqlæ”¯æŒ, æ²¡æœ‰ç…§é¡¾å…¶å®ƒçš„æ•°æ®åº“(æ²¡æœ‰æ›´æ–°åˆ°GitHubçš„åŸå› ä¹‹ä¸€). 1234567891011121314151617MariaDB [jabberd2]&gt; desc host;+------------------+------------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+------------------+------------+------+-----+---------+----------------+| domain | text | NO | PRI | NULL | || realm | tinytext | NO | MUL | NULL | || object-sequence | bigint(20) | NO | MUL | NULL | auto_increment || pemfile | text | YES | | NULL | || verify-mode | tinyint(4) | YES | | 0 | || cachain | text | YES | | NULL | || require-starttls | tinyint(4) | YES | | 0 | || register-enable | tinyint(4) | YES | | 0 | || register-oob | text | YES | | NULL | || instructions | mediumtext | YES | | NULL | || password-change | tinyint(4) | YES | | 0 | || status | tinytext | YES | | NULL | |+------------------+------------+------+-----+---------+----------------+ små’Œc2séƒ½ä¼šè¯»å–è¯¥è¡¨, ä½†è¯¥è¡¨ç”±c2sç»´æŠ¤è´Ÿè´£åˆ æ”¹,æœ€åä¸€ä¸ªå­—æ®µè¡¨æ˜çŠ¶æ€, å¯ä»¥æœ‰normal, add, mod, offline, delete. æ­£å¸¸æ˜¯normal, åˆ‡æ¢çŠ¶æ€å¯ä»¥ç›´æ¥ä¿®æ”¹å…¶statuså€¼, ç„¶åå‘é€SIGUSR1ä¿¡å·è§¦å‘ReConfig. ç”±äºrouterçš„æœºåˆ¶ç¼˜æ•…, æ— æ³•ä»offlineçŠ¶æ€åˆ‡æ¢åˆ°delete, è¦åˆ é™¤çš„è¯å¾—å…ˆåˆ‡æ¢åˆ°normalçŠ¶æ€, ç„¶åå†delete. æˆ‘ä¹Ÿåœ¨æƒ³æˆ–è®¸ä¸éœ€è¦deleteçŠ¶æ€, ç›´æ¥ä»è¡¨åˆ é™¤æ¡ç›®ä¹Ÿæ˜¯å¯ä»¥æ›´æ–°çš„(æ²¡æœ‰æ›´æ–°åˆ°GitHubçš„åŸå› ä¹‹äºŒ), æˆ–è®¸å¾…æ›´å®Œå–„æˆ–è€…æœ‰ç©ºäº†ä¼šæ›´æ–°åˆ°gitä¸Š.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"}]},{"title":"64ä½Linuxä¸‹ç¼–è¯‘x86ç‰ˆæœ¬Booståº“ (åŠç›¸å…³åº“çš„ç¼–è¯‘)","slug":"64ä½Linuxä¸‹ç¼–è¯‘x86ç‰ˆæœ¬Booståº“ (åŠç›¸å…³åº“çš„ç¼–è¯‘)","date":"2014-11-09T04:43:59.000Z","updated":"2022-09-15T15:51:05.342Z","comments":true,"path":"2014/11/09/64ä½Linuxä¸‹ç¼–è¯‘x86ç‰ˆæœ¬Booståº“ (åŠç›¸å…³åº“çš„ç¼–è¯‘)/","link":"","permalink":"https://unpluggedcoder.me/2014/11/09/64%E4%BD%8DLinux%E4%B8%8B%E7%BC%96%E8%AF%91x86%E7%89%88%E6%9C%ACBoost%E5%BA%93%20(%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%BA%93%E7%9A%84%E7%BC%96%E8%AF%91)/","excerpt":"","text":"ç”¨çš„æ˜¯boost 1.55.0,æ­£å¸¸ç¼–è¯‘çš„è¯ä¸‹é¢å‘½ä»¤åŠå‚æ•°å°±å¯ä»¥äº†: 1./bjam --without-python --without-test --without-graph_parallel --without-graph --without-wave toolset=gcc cxxflags=&quot;-std=c++11&quot; install å¦‚æœè¦ç¼–è¯‘32ä½ç‰ˆæœ¬çš„è¯éœ€è¦å…ˆå®‰è£…boostéœ€è¦çš„å‡ ä¸ªåº“çš„x86ç‰ˆæœ¬ 12yum install libicu-devel.i686yum install bzip2-devel-1.0.5-7.el6_0.i686 å¦‚æœæ˜¯ç”¨ICUåº“ç¼–è¯‘boost.localeåº“, é‚£å°±éœ€è¦ç¬¬ä¸€è¡Œ,å¦‚æœç”¨libiconvåº“å»ç¼–è¯‘boost.localeåº“çš„è¯éœ€è¦æ‰‹åŠ¨ç¼–è¯‘å®‰è£…libiconvåº“,ä¸‹è½½libiconvåº“,ç”¨ä¸‹é¢çš„å‚æ•°configure: 1./configure --prefix=/usr CFLAGS=&quot;-m32&quot; LDFLAGS=&quot;-m32&quot; --enable-static --enable-shared --build=x86_64-pc-linux-gnu --host=i686-pc-linux-gnu æ¥ä¸‹æ¥ç¼–è¯‘boost: 1./bjam --prefix=/usr --without-python --without-test --without-graph_parallel --without-graph --without-wave toolset=gcc address-model=32 architecture=x86 install æœ€åä¸€ä¸ªå‚æ•°å¾ˆé‡è¦, å¦‚æœåªæ˜¯æŒ‡å®šäº†address-model&#x3D;32,ä¼šç¼–è¯‘å‡ºå¤§éƒ¨åˆ†çš„booståº“çš„x86ç‰ˆæœ¬, ä½†æ˜¯ä¼šæç¤ºæœ‰å‡ ä¸ªtarget failed,åº“ä¸å®Œæ•´, å°¤å…¶æ˜¯boost.localeåº“,ä¼šæç¤º: - iconv (libc) : no - iconv (separate) : no - icu : no - icu (lib64) : no Boost.Locale needs either iconv or ICU library to be built`. Boost.Locale needs either iconv or ICU library to be built.` Boost.Locale needs either iconv or ICU library to be built. è€Œäº‹å®ä¸Šå·²ç»å®‰è£…äº†icuæˆ–è€…libiconvçš„æ­£ç¡®ç‰ˆæœ¬,ä½†æ˜¯boostæ— æ³•è¯†åˆ«, éœ€è¦æŒ‡å®šarchitecture&#x3D;x86 åæ‰ä¼šè¯†åˆ«åˆ°,å¹¶æ­£ç¡®å®‰è£….","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"Poco","slug":"Poco","permalink":"https://unpluggedcoder.me/tags/Poco/"},{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"GCC","slug":"GCC","permalink":"https://unpluggedcoder.me/tags/GCC/"}]},{"title":"64ä½Linuxä¸‹ç¼–è¯‘x86ç‰ˆæœ¬POCOåº“","slug":"64ä½Linuxä¸‹ç¼–è¯‘x86ç‰ˆæœ¬POCOåº“","date":"2014-11-09T04:30:07.000Z","updated":"2022-09-15T15:51:05.342Z","comments":true,"path":"2014/11/09/64ä½Linuxä¸‹ç¼–è¯‘x86ç‰ˆæœ¬POCOåº“/","link":"","permalink":"https://unpluggedcoder.me/2014/11/09/64%E4%BD%8DLinux%E4%B8%8B%E7%BC%96%E8%AF%91x86%E7%89%88%E6%9C%ACPOCO%E5%BA%93/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ, å¾ˆè¯¦ç»†. ä»”ç»†çœ‹æ¥ä¸‹, ç”±äºPOCOä¸ºäº†èƒ½å¤Ÿè·¨å¹³å°ç”¨åœ¨Windowsä¸‹ç¼–è¯‘, ç”¨çš„æ˜¯å®ƒè‡ªå·±çš„ä¸€å¥—Build system, è€Œä¸æ˜¯æ ‡å‡†çš„AutoConf, automakeé‚£ä¸€å¥—. æ­£å¸¸çš„ç¼–è¯‘é…ç½®æ˜¯: 1./configure --omit=Data/ODBC,Data/SQLite --prefix=/usr --cflags=-fPIC --cflags=-std=c++11 --static --shared --no-tests --no-samples --cflags=-std=c++11é€‰é¡¹è¦æ±‚GCCç‰ˆæœ¬æ”¯æŒC++11,è¿™æ ·æ­£å¸¸ç¼–è¯‘åmake installä¼šå°†POCOé™æ€åº“å’ŒåŠ¨æ€åº“å®‰è£…åœ¨: prefix&#x2F;lib64ç›®å½•ä¸‹. åæ¥ä¸ºäº†ç¼–è¯‘32ä½ç‰ˆæœ¬, ç®€å•çš„åŠ äº†ä¸ªå‚æ•°--cflags=-m32, ç»“æœè¿™æ ·åªèƒ½ç¼–è¯‘å‡ºç›®æ ‡æ–‡ä»¶, å› ä¸ºæ˜¯å¼ºåˆ¶åœ¨CFLAGSä¸ŠåŠ çš„-m32, åŠ äº†LDFLAGS=&quot;-m32&quot;ä¹Ÿæ— æ•ˆ,åæ¥æ‰çœ‹äº†ä¸‹å®ƒçš„configure, æ ¹æœ¬ä¹Ÿä¸æ”¯æŒLDFLAGSå‚æ•°,ä¸æ˜¯autoconfç”Ÿæˆçš„, åªæ˜¯ä¸€ä¸ªshell. æ¥ä¸‹æ¥æ‰å›åˆ°ä¸Šé¢çš„å®˜æ–¹æ–‡æ¡£å»æŸ¥è¯¢, æ‰¾åˆ°äº†POCO_BASE&#x2F;build&#x2F;rules&#x2F;ç›®å½•ä¸‹çš„å‡ ä¸ªé…ç½®æ–‡ä»¶,æ‰äº†è§£å®ƒéœ€è¦çš„é…ç½®å‚æ•°(æˆ–è€…è¯´æ˜¯ç¯å¢ƒå˜é‡),è¿™ä¸ªç›®å½•ä¸‹çš„globalæ–‡ä»¶æ˜¯ä¸»è¦çš„é…ç½®,å…³é”®å‡ è¡Œåœ¨ä¸‹é¢: 12345678910111213141516171819202122232425262728## Check if a 64bit build is requested#ifndef OSARCH_64BITSOSARCH_64BITS = 0endififeq ($(OSARCH_64BITS),1)OSARCH_POSTFIX = 64elseOSARCH_POSTFIX =endif...ifeq ($(OSARCH_64BITS),1)CFLAGS += $(CFLAGS64)CXXFLAGS += $(CXXFLAGS64)SHLIBFLAGS += $(SHLIBFLAGS64)DYLIBFLAGS += $(DYLIBFLAGS64)LINKFLAGS += $(LINKFLAGS64)elseCFLAGS += $(CFLAGS32)CXXFLAGS += $(CXXFLAGS32)SHLIBFLAGS += $(SHLIBFLAGS32)DYLIBFLAGS += $(DYLIBFLAGS32)LINKFLAGS += $(LINKFLAGS32)endif å—¯, å°±éœ€è¦è¿™å‡ ä¸ªç¯å¢ƒå˜é‡, è¿˜æ˜¯ç”¨ä¸Šé¢çš„configureå‘½ä»¤çš„è¯, å°±è¿˜éœ€è¦è®¾ç½®ä¸‹é¢å‡ ä¸ªç¯å¢ƒå˜é‡: 12345export DYLIBFLAGS=&quot;-m32&quot;export SHLIBFLAGS=&quot;-m32&quot;export OSARCH_64BITS=0export POCO_TARGET_OSARCH=i686./configure --omit=Data/ODBC,Data/SQLite --prefix=/usr --cflags=-fPIC --static --shared --no-tests --no-samples --cflags=-m32 è¿™æ ·å°±å¯ä»¥äº†.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"Poco","slug":"Poco","permalink":"https://unpluggedcoder.me/tags/Poco/"},{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"GCC","slug":"GCC","permalink":"https://unpluggedcoder.me/tags/GCC/"}]},{"title":"åœ¨Linux x64ç¯å¢ƒä¸‹gccç¼–è¯‘32ä½ç¨‹åºåŠLibrary","slug":"åœ¨Linux x64ç¯å¢ƒä¸‹gccç¼–è¯‘32ä½ç¨‹åºåŠLibrary","date":"2014-11-07T09:36:00.000Z","updated":"2022-09-15T15:51:05.353Z","comments":true,"path":"2014/11/07/åœ¨Linux x64ç¯å¢ƒä¸‹gccç¼–è¯‘32ä½ç¨‹åºåŠLibrary/","link":"","permalink":"https://unpluggedcoder.me/2014/11/07/%E5%9C%A8Linux%20x64%E7%8E%AF%E5%A2%83%E4%B8%8Bgcc%E7%BC%96%E8%AF%9132%E4%BD%8D%E7%A8%8B%E5%BA%8F%E5%8F%8ALibrary/","excerpt":"","text":"ä¸€ç›´éƒ½åœ¨x64æœåŠ¡å™¨ä¸Šå¼€å‘å’Œéƒ¨ç½², å¶å°”é‡åˆ°äº†å‡ å°x86æœåŠ¡å™¨, èŠ±äº†ä¸€å¤©çš„æ—¶é—´å»ç¼–è¯‘å‡ºå„ç§x86ç‰ˆæœ¬çš„åº“, åœ¨ç½‘ä¸Šæœäº†ä¸‹å¤§å¤šæ•°å›å¤éƒ½å¾ˆç®€å•, ä½†æ˜¯å®é™…ä¸Šå¯¹äºä¸€ä¸ªå¼•ç”¨åº“æ¯”è¾ƒå¤šçš„ç¨‹åºå°±éº»çƒ¦å¤šäº†, è¿™é‡Œè®°å½•ä¸‹æˆ‘çš„è¿‡ç¨‹, ç”¨çš„æ˜¯gcc. é¦–å…ˆ, ç¨‹åºçš„ç¼–è¯‘è¦åŠ -m32é€‰é¡¹, å…·ä½“æ€ä¹ˆåŠ , åŠ åœ¨å“ªé‡Œæ ¹æ®é¡¹ç›®è‡ªèº«è€Œå®š.è¦æ³¨æ„çš„æ˜¯, ä¸ä»…CXXFLAGS (or CFLAGS)è¦åŠ , æœ€ä¸»è¦çš„æ˜¯é“¾æ¥é€‰é¡¹ä¹Ÿè¦æœ‰,å¦åˆ™g++ â€“WL ä¹‹ç±»çš„é“¾æ¥å‘½ä»¤åœ¨æ²¡æœ‰-m32ä¸‹ä¼šå¯¹æ‰¾åˆ°çš„32ä½Libæç¤º:â€Skip incompatible file type â€¦.â€. æˆ‘ç”¨çš„æ˜¯CMAKE, å› æ­¤è¦åœ¨ä¸‹é¢çš„ç¯å¢ƒå˜é‡é‡ŒåŠ ä¸Šè¯¥é€‰é¡¹: 12SET(CMAKE_CXX_FLAGS &quot;$ENV&#123;CXXFLAGS&#125; -O0 -m32&quot;)SET(CMAKE_EXE_LINKER_FLAGS &quot;$&#123;CMAKE_EXE_LINKER_FLAGS&#125; -lrt -m32&quot;) ä¸Šä¸€æ­¥ä»…ä»…æ˜¯è®¾å®šäº†è‡ªå·±ç¨‹åºçš„ç¼–è¯‘é€‰é¡¹, è¿™ä¹ˆä¸€æ¥, æ‰€æœ‰è¦æ±‚å¼•ç”¨çš„åº“éƒ½è¦æ±‚ç”¨ELF 32ç‰ˆæœ¬, å¾ˆç®€å•fileå‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹åº“çš„ç‰ˆæœ¬: 12[root@localhost ~]# file /usr/lib/libboost_system.so.1.55.0 /usr/lib/libboost_system.so.1.55.0: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, not stripped &amp;nbsp; å¯¹äºC&#x2F;C++çš„æ ‡å‡†åº“è€Œè¨€å¾ˆç®€å•,å®‰è£…å¯¹åº”çš„åŒ…å³å¯, æˆ‘çš„æ˜¯CentOS6.x,å¯¹åº”ä¸‹é¢: 12yum install glibc-devel.i686yum install libstdc++-devel.i686 &amp;nbsp; å¯¹äºå…¶å®ƒåº“ä¹Ÿå¯ä»¥ç”¨ç›¸åŒçš„æ–¹æ³•, ä¾‹å¦‚ä¸‹è½½å®‰è£…mysql-libs.x86_64å¯¹åº”çš„mysql-libs.i686å³å¯è§£å†³libmysqlclient.soä¹‹ç±»çš„åº“å¼•ç”¨é—®é¢˜. ä½†æ˜¯å¯¹äºä¸å­˜åœ¨äºåŒ…ç®¡ç†å†…çš„ç¬¬ä¸‰æ–¹åº“å°±æ²¡é‚£ä¹ˆå¹¸è¿äº†, å¯¹äºBoost C++ library å’ŒPOCO C++ library ,å¯ä»¥åˆ†åˆ«å‚ç…§å³å°†å‘çš„ä¸¤ç¯‡æ–‡ç« .","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"GCC","slug":"GCC","permalink":"https://unpluggedcoder.me/tags/GCC/"},{"name":"Linux","slug":"Linux","permalink":"https://unpluggedcoder.me/tags/Linux/"}]},{"title":"Maroon 5 - Won`t go home without you - Drum Cover","slug":"maroon-5-wont-go-home-without-you-drum-cover","date":"2014-09-28T01:23:38.000Z","updated":"2022-09-15T15:51:05.351Z","comments":true,"path":"2014/09/28/maroon-5-wont-go-home-without-you-drum-cover/","link":"","permalink":"https://unpluggedcoder.me/2014/09/28/maroon-5-wont-go-home-without-you-drum-cover/","excerpt":"","text":"","categories":[{"name":"DrumCover","slug":"DrumCover","permalink":"https://unpluggedcoder.me/categories/DrumCover/"}],"tags":[{"name":"Drum","slug":"Drum","permalink":"https://unpluggedcoder.me/tags/Drum/"}]},{"title":"C#é™æ€ç±» å’Œ C++é™æ€å®ä¾‹ çš„æ„é€ åŒºåˆ«","slug":"C#é™æ€ç±» å’Œ C++é™æ€å®ä¾‹ çš„æ„é€ åŒºåˆ«","date":"2014-08-29T08:20:54.000Z","updated":"2022-09-15T15:51:05.343Z","comments":true,"path":"2014/08/29/C#é™æ€ç±» å’Œ C++é™æ€å®ä¾‹ çš„æ„é€ åŒºåˆ«/","link":"","permalink":"https://unpluggedcoder.me/2014/08/29/C#%E9%9D%99%E6%80%81%E7%B1%BB%20%E5%92%8C%20C++%E9%9D%99%E6%80%81%E5%AE%9E%E4%BE%8B%20%E7%9A%84%E6%9E%84%E9%80%A0%E5%8C%BA%E5%88%AB/","excerpt":"","text":"1234567891011121314151617181920/// ç£ç›˜é…é¢è®¾ç½®ç±»static class DiskQuota&#123; static DiskQuotaControlClass _diskQuotaControl; const string FILESHAREVOLUME = @&quot;\\\\127.0.0.1\\d$\\&quot;; const int MBTOBYTES = 1048576; static DiskQuota() &#123; _diskQuotaControl = new DiskQuotaControlClass(); // å¦‚æœè·¯å¾„æ— æ³•è®¿é—®, è¿™é‡Œå°†å‡ºç°å¼‚å¸¸ _diskQuotaControl.Initialize(FILESHAREVOLUME, true); &#125; static public void Print() &#123; Console.WriteLine(&quot;I`m alive&quot;); &#125;&#125; åœ¨è°ƒç”¨DiskQuotaæ—¶é‡åˆ°äº†å¼‚å¸¸: &quot;****.DiskQuotaâ€çš„ç±»å‹åˆå§‹å€¼è®¾å®šé¡¹å¼•å‘å¼‚å¸¸ã€‚ è¿™è®©æˆ‘å»ä»”ç»†çœ‹äº†ä¸‹MSDNä¸ŠC#çš„é™æ€ç±»çš„è§£é‡Š, æœ‰è¿™ä¹ˆä¸€å¥: â€œâ€¦ However, it is guaranteed to be loaded and to have its fields initialized and its static constructor called before the class is referenced for the first time in your program. â€¦â€ åŸæ¥C#çš„é™æ€ç±»åªä¿è¯åœ¨é¦–æ¬¡è°ƒç”¨å‰åˆå§‹åŒ–, è¿™é‡Œçš„åˆå§‹åŒ–åŒ…æ‹¬é™æ€æˆå‘˜èµ‹å€¼ä»¥åŠè°ƒç”¨é™æ€æ„é€ å‡½æ•°.è¿™æ ·ç¨‹åºå°±å¿…é¡»ä¿è¯åœ¨é¦–æ¬¡è°ƒç”¨å‰æ•è·å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸,è€Œä¸”å¦‚æœé¦–æ¬¡åˆå§‹åŒ–å‘ç”Ÿå¼‚å¸¸,é‚£ä¹ˆåç»­çš„å’Œè¯¥é™æ€ç±»æœ‰å…³çš„æˆå‘˜ä»¥åŠæˆå‘˜å‡½æ•°è°ƒç”¨éƒ½ä¼šæœ‰å¼‚å¸¸: 123456789101112131415161718192021222324252627282930313233343536try &#123;// é™æ€æ„é€ å‡½æ•°å‘ç”Ÿå¼‚å¸¸, Printæ ¹æœ¬ä¸ä¼šè¢«è°ƒç”¨ DiskQuota.Print(); &#125; catch (Exception ex) &#123; Console.WriteLine(ex.Message); &#125; // é™¤éé¦–æ¬¡é™æ€æ„é€ æˆåŠŸ,å¦åˆ™ä»ç„¶ä¼šè°ƒç”¨é™æ€æ„é€ å‡½æ•°,Printä¹Ÿä¸ä¼šè¢«è°ƒç”¨ DiskQuota.Print();&lt;/pre&gt;è¿™æ ·å¦‚æœä¸€ä¸ªé™æ€ç±»åœ¨åˆå§‹æ„é€ å‡½æ•°ä¸­æœ‰å¼‚å¸¸,é‚£æ‰€æœ‰çš„æœ‰å…³è°ƒç”¨éƒ½è¦æ•è·å¼‚å¸¸?å²‚ä¸æ˜¯éº»çƒ¦äº†...å†æ¥çœ‹çœ‹C++æ˜¯æ€ä¹ˆåšçš„, C++æ²¡æœ‰é™æ€ç±»ä¸€è¯´, ä½†æ˜¯æœ‰é™æ€å®ä¾‹,å› æ­¤ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰é™æ€ç±»å®ä¾‹æ¥è¾¾åˆ°é™æ€å¯¹è±¡çš„åˆå§‹åŒ–.```cppclass BadClass&#123;public: BadClass()&#123; throw runtime_error(&quot;Exception in constructor!&quot;); &#125; void print()&#123; cout &lt;&lt; &quot;I`m alive: &quot; &lt;&lt; typeid(this).name() &lt;&lt; endl; &#125;&#125;;class AClass&#123;public: static BadClass _badobj;&#125;;BadClass AClass::_badobj;static BadClass badobject; ä¸¤ç§å½¢å¼çš„é™æ€å®ä¾‹éƒ½ä¼šåœ¨mainå‡½æ•°ä¹‹å‰æŠ›å‡ºå¼‚å¸¸, è€Œä¸”è¿™ä¸ªå¼‚å¸¸æ— æ³•æ•è·, åªèƒ½åœ¨å¼‚å¸¸è§¦å‘åæ•è·åˆ°SIGABRT, åœ¨mainå‡½æ•°å‰æ•è·è¿™ä¸ªä¿¡å·å¯ä»¥è¿™æ ·åš: 12345678void SigABRTHandler(int signal)&#123; cout &lt;&lt; &quot;Receive SIG_ABT: &quot; &lt;&lt; signal &lt;&lt; endl;&#125;typedef void(*sighandler_t)(int);// ç”¨é™æ€å˜é‡ç‰¹æ€§ä½¿å…¶åœ¨mainå‡½æ•°å‰è®¾ç½®ä¿¡å·å›è°ƒå‡½æ•°static sighandler_t g_handler = signal(SIGABRT, SigABRTHandler); Linuxä¸‹å¯èƒ½çœ‹åˆ°è¿™æ ·çš„è¾“å‡º: 123terminate called after throwing an instance of &#x27;std::runtime_error&#x27; what(): Exception in constructor!Receive SIG_ABT: 6 è¿™æ ·ä¹Ÿåªæ˜¯æ•è·åˆ°ä¿¡å·,ä»…æ­¤è€Œå·²,æ— æ³•å¤„ç†å¼‚å¸¸,å› æ­¤C++è¦æ±‚æ›´ä¸¥æ ¼,å­˜åœ¨å¼‚å¸¸çš„é™æ€å®ä¾‹æ„é€ çš„ç¨‹åºè¿å¯åŠ¨éƒ½è°ˆä¸ä¸Š. å¯è§å„æœ‰å„çš„å¥½å¤„: C#å®ç°äº†ä¸€ä¸ªçº¯é™æ€çš„å•ä»¶æ¨¡å¼,è€Œä¸”å…è®¸æ•è·å…¶å¼‚å¸¸(å¦‚æœéœ€è¦å®ç°éé™æ€çš„å•ä»¶å®ä¾‹å¯ä»¥å‚è€ƒè¿™é‡Œ); C++è¦æ±‚æ›´å®‰å…¨é™æ€åˆå§‹åŒ–è¿‡ç¨‹,åŒæ ·ä¹Ÿå¯ä»¥ç”¨äºå•ä»¶æ¨¡å¼.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"},{"name":"æ‚é¡¹","slug":"C-C/æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/C-C/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C#","slug":"C","permalink":"https://unpluggedcoder.me/tags/C/"}]},{"title":"Jabberd2 æ·»åŠ åŠ¨æ€åŸŸåç®¡ç†åŠŸèƒ½ (ä¸Š)","slug":"Jabberd2 æ·»åŠ åŠ¨æ€åŸŸåç®¡ç†åŠŸèƒ½ (ä¸Š)","date":"2014-08-28T10:08:03.000Z","updated":"2022-09-15T15:51:05.345Z","comments":true,"path":"2014/08/28/Jabberd2 æ·»åŠ åŠ¨æ€åŸŸåç®¡ç†åŠŸèƒ½ (ä¸Š)/","link":"","permalink":"https://unpluggedcoder.me/2014/08/28/Jabberd2%20%E6%B7%BB%E5%8A%A0%E5%8A%A8%E6%80%81%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%20(%E4%B8%8A)/","excerpt":"","text":"æœ¬é¡¹ç›®æºç å·²æ‰˜ç®¡åœ¨Githubä¸Š, é¡¹ç›®åç§°: Jabberd2s ç”±æ¥ç”±äºä¸šåŠ¡éœ€æ±‚éœ€è¦å¯¹Jabberd2è¿›è¡Œäº†äº›ä¿®æ”¹, ä¸»è¦æ˜¯å®ç°åŠ¨æ€åŸŸåç®¡ç†çš„åŠŸèƒ½. Jabberd2 æœ¬èº«å¯ä»¥æ”¯æŒå¤šåŸŸåçš„XMPPæœåŠ¡å™¨(ä¾‹å¦‚: xmpp.server1.domain, xmpp.server2.domain, ç­‰ç­‰â€¦)åŒæ—¶è¿è¡Œ,ä½†æ˜¯æ‰€æœ‰XMPPåŸŸåæœåŠ¡é…ç½®(ä½äºc2s.xmlå’Œsm.xmlä¸­çš„é…ç½®)å¿…é¡»åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å…¨éƒ¨åˆå§‹åŒ–å®Œæˆ.åˆå§‹åŒ–åå¯¹åŸŸåä¸‹XMPPæœåŠ¡å™¨å°±æ— æ³•åšæ›´å¤šçš„æ§åˆ¶.å› æ­¤,ä¿®æ”¹Jabberd2ä»¥æ”¯æŒå®æ—¶æ§åˆ¶åŸŸåæœåŠ¡å™¨çš„ç¦»çº¿å’Œä¸Šçº¿ä»¥åŠæœåŠ¡å™¨é…ç½®å®æ—¶ä¿®æ”¹.è¿™äº›ä¿®æ”¹ä¸»è¦é’ˆå¯¹å¤šåŸŸåä¸»æœºçš„ç®¡ç†,æ‰€ä»¥Githubçš„é¡¹ç›®åç§°ä¸ºJabberd2s. å®ç°ç»†èŠ‚[ å…ˆçœ‹è¿™ä¸ªç®€å•çš„å›¾ç¤º,ç»¿è‰²éƒ¨åˆ†æ˜¯åˆå§‹åŒ–å†…å®¹, ç²‰è‰²éƒ¨åˆ†æ˜¯æ·»åŠ çš„åŠŸèƒ½. æºç è‡ªèº«åˆå§‹åŒ–è¿‡ç¨‹ä¸­småœ¨å»ºç«‹å’Œrouterçš„è¿æ¥åè§¦å‘event_OPENäº‹ä»¶, ä»£ç 1: 1234567891011121314151617181920212223242526// sm/sm.cint sm_sx_callback(sx_t s, sx_event_t e, void *data, void *arg) &#123; ... case event_OPEN: log_write(sm-&gt;log, LOG_NOTICE, &quot;connection to router established&quot;); ... if(xhash_iter_first(sm-&gt;hosts)) do &#123; xhash_iter_get(sm-&gt;hosts, (void *) &amp;domain, &amp;len, NULL); /* skip already requested SM id */ if (strlen(sm-&gt;id) == len &amp;&amp; strncmp(sm-&gt;id, domain, len) == 0) continue; nad = nad_new(); ns = nad_add_namespace(nad, uri_COMPONENT, NULL); elem = nad_append_elem(nad, ns, &quot;bind&quot;, 0); nad_set_attr(nad, elem, -1, &quot;name&quot;, domain, len); nad_append_attr(nad, -1, &quot;multi&quot;, &quot;to&quot;); log_debug(ZONE, &quot;requesting domain bind for &#x27;%.*s&#x27;&quot;, len, domain); sx_nad_write(sm-&gt;router, nad); &#125; while(xhash_iter_next(sm-&gt;hosts)); break; ...&#125; små‘ç»™router &lt;bind/&gt;èŠ‚å£°æ˜æ–°å¢çš„ç»‘å®šåŸŸå: 1&lt;bind xmlns=&#x27;https://jabberd.jabberstudio.org/ns/component/1.0&#x27; multi=&#x27;to&#x27; name=&#x27;xmpp.server1.domain&#x27;/&gt; routerå¹¿æ’­&lt;presence/&gt;ç»™c2så’Œs2s, å¤„ç†bindå’Œunbindçš„åˆ†åˆ«æ˜¯_router_process_bindå’Œ_router_process_unbind, è¿™ä¸¤ä¸ªå‡½æ•°éƒ½å¾ˆé•¿,å…³é”®ä»£ç å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334// router/router.cstatic void _router_process_bind(component_t comp, nad_t nad)&#123; ... /* advertise name */ // å¹¿æ’­åŸŸåä¿¡æ¯ç»™æ¯æ¡è·¯ç”± // æœ€åä¸€ä¸ªå‚æ•°å†³å®šæ˜¯å¦unavailable _router_advertise(comp-&gt;r, name-&gt;domain, comp, 0); /* tell the new component about everyone else */ // ä¸»åŠ¨åå‘åº”ç­”ç»™sm, &lt;presence .. from=&#x27;c2s&#x27;/&gt; xhash_walk(comp-&gt;r-&gt;routes, _router_advertise_reverse, (void *) comp); ...&#125;static void _router_process_unbind(component_t comp, nad_t nad)&#123; ... /* deadvertise name */ if(xhash_get(comp-&gt;r-&gt;routes, name-&gt;domain) == NULL) _router_advertise(comp-&gt;r, name-&gt;domain, comp, 1); // æœ€åä¸€ä¸ªå‚æ•°ä¸º1, å°†å‘é€type=&quot;unavailable&quot;å±æ€§ ...&#125; çœŸæ­£å‘é€&lt;presence/&gt;èŠ‚çš„åœ¨_router_advertiseå‡½æ•°é‡Œ: 123456789101112131415161718192021222324// router/router.c/** domain advertisement */static void _router_advertise(router_t r, const char *domain, component_t src, int unavail)&#123; struct broadcast_st bc; int ns; log_debug(ZONE, &quot;advertising %s to all routes (unavail=%d)&quot;, domain, unavail); bc.r = r; bc.src = src; /* create a new packet */ bc.nad = nad_new(); ns = nad_add_namespace(bc.nad, uri_COMPONENT, NULL); nad_append_elem(bc.nad, ns, &quot;presence&quot;, 0); nad_append_attr(bc.nad, -1, &quot;from&quot;, domain); // æœ€åä¸€ä¸ªå‚æ•°ä¸º1, å°†å‘é€type=&quot;unavailable&quot;å±æ€§ if(unavail) nad_append_attr(bc.nad, -1, &quot;type&quot;, &quot;unavailable&quot;); xhash_walk(r-&gt;routes, _router_broadcast, (void *) &amp;bc); nad_free(bc.nad);&#125; å¯¹äº&lt;bind/&gt;èŠ‚routerå‘é€å†…å®¹: 1&lt;presence xmlns=&#x27;https://jabberd.jabberstudio.org/ns/component/1.0&#x27; from=&#x27;xmpp.server1.domain&#x27;/&gt; å¯¹äº&lt;unbind/&gt;èŠ‚routerå‘é€å†…å®¹: 1&lt;presence xmlns=&#x27;https://jabberd.jabberstudio.org/ns/component/1.0&#x27; type=&#x27;unavailable&#x27; from=&#x27;xmpp.server1.domain&#x27;/&gt; å†çœ‹c2sæ”¶åˆ°&lt;presence /&gt;åæ‰€åšçš„åæ˜ : 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// c2s/c2s.cstatic void _c2s_component_presence(c2s_t c2s, nad_t nad)&#123; int attr; char from[1024]; sess_t sess; union xhashv xhv; if((attr = nad_find_attr(nad, 0, -1, &quot;from&quot;, NULL)) &lt; 0) &#123; nad_free(nad); return; &#125; strncpy(from, NAD_AVAL(nad, attr), NAD_AVAL_L(nad, attr)); from[NAD_AVAL_L(nad, attr)] = &#x27;\\0&#x27;; if(nad_find_attr(nad, 0, -1, &quot;type&quot;, NULL) &lt; 0) &#123; log_debug(ZONE, &quot;component available from &#x27;%s&#x27;&quot;, from); log_debug(ZONE, &quot;sm for serviced domain &#x27;%s&#x27; online&quot;, from); // æ²¡æœ‰typeå±æ€§, åˆ™æ·»åŠ åˆ°c2s-&gt;sm_availå“ˆå¸Œå­—å…¸ä¸­ xhash_put(c2s-&gt;sm_avail, pstrdup(xhash_pool(c2s-&gt;sm_avail), from), (void *) 1); nad_free(nad); return; &#125; if(nad_find_attr(nad, 0, -1, &quot;type&quot;, &quot;unavailable&quot;) &lt; 0) &#123; nad_free(nad); return; &#125; // æœ‰typeå±æ€§, è€Œä¸”å±æ€§å€¼æ˜¯unavailable log_debug(ZONE, &quot;component unavailable from &#x27;%s&#x27;&quot;, from); if(xhash_get(c2s-&gt;sm_avail, from) != NULL) &#123; log_debug(ZONE, &quot;sm for serviced domain &#x27;%s&#x27; offline&quot;, from); if(xhash_iter_first(c2s-&gt;sessions)) do &#123; xhv.sess_val = &amp;sess; xhash_iter_get(c2s-&gt;sessions, NULL, NULL, xhv.val); if(sess-&gt;resources != NULL &amp;&amp; strcmp(sess-&gt;resources-&gt;jid-&gt;domain, from) == 0) &#123; log_debug(ZONE, &quot;killing session %s&quot;, jid_user(sess-&gt;resources-&gt;jid)); // å…³é—­è¯¥åŸŸä¸‹çš„æ‰€æœ‰ä¼šè¯ sess-&gt;active = 0; if(sess-&gt;s) sx_close(sess-&gt;s); &#125; &#125; while(xhash_iter_next(c2s-&gt;sessions)); xhash_zap(c2s-&gt;sm_avail, from); &#125;&#125; å› æ­¤,ä»smçš„è§’åº¦çœ‹æ‰€æœ‰çš„åŸŸåæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªä¼šè¯ç«¯ç‚¹,åªéœ€è¦åˆ é™¤è¿™ä¸ªhostå¹¶å‘é€&lt;unbind/&gt;é€šçŸ¥ç»™routerå³å¯ä½¿å…¶ç¦»çº¿: 1&lt;unbind xmlns=&#x27;https://jabberd.jabberstudio.org/ns/component/1.0&#x27; multi=&#x27;to&#x27; name=&#x27;xmpp.server1.domain&#x27;/&gt; æ–°å¢å‡½æ•°_sm_hosts_reconfigå’Œä¿¡å·é‡å€¼sm_reconf, ä¿®æ”¹äº†SIGUSR1ä¿¡å·è§¦å‘çš„é€»è¾‘, åŸæœ¬SIGUSR1å…³é—­è°ƒè¯•, SIGUSR2å¼€å¯è°ƒè¯•, ç°åœ¨æ”¹ä¸ºSIGUSR2åˆ‡æ¢DebugçŠ¶æ€, SIGUSR1è§¦å‘_sm_hosts_reconfig. 12345678910111213141516/* Use SIGUSR1 to reconfig hosts map */static void _sm_signal_usr1(int signum)&#123; // Original line //set_debug_flag(0); sm_reconf = 1;&#125;/* Use SIGUSR2 to switch debug flag */static void _sm_signal_usr2(int signum)&#123; //set_debug_flag(1); if(get_debug_flag()) set_debug_flag(0); else set_debug_flag(1);&#125; ä»£ç 2: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859// sm/main.c/* reconfig hosts with configurations and broadcast it */static void _sm_hosts_reconfig(sm_t sm, config_t conf)&#123; config_elem_t elem; char id[1024]; int len, i, ns, nelem; xht domains; char *host; nad_t nad; elem = config_get(conf, &quot;local.id&quot;); /* We only care about host reconfiguration at here, don`t set sm-&gt;id to hosts*/ if(!elem)return; domains = xhash_new(1021); for(i = 0; i &lt; elem-&gt;nvalues; i++) &#123; /* stringprep ids (domain names) so that they are in canonical form */ strncpy(id, elem-&gt;values[i], 1024); id[1023] = &#x27;\\0&#x27;; if (stringprep_nameprep(id, 1024) != 0) &#123; log_write(sm-&gt;log, LOG_ERR, &quot;cannot stringprep id %s, aborting&quot;, id); exit(1); &#125; if(xhash_get(sm-&gt;hosts, id) == NULL) &#123; // new host added, send bind information, æ–°å¢ä¸»æœºåŸŸå nad = nad_new(); ns = nad_add_namespace(nad, uri_COMPONENT, NULL); nelem = nad_append_elem(nad, ns, &quot;bind&quot;, 0); nad_set_attr(nad, nelem, -1, &quot;name&quot;, id, strlen(id)); nad_append_attr(nad, -1, &quot;multi&quot;, &quot;to&quot;); log_debug(ZONE, &quot;requesting domain bind for &#x27;%.*s&#x27;&quot;, strlen(id), id); sx_nad_write(sm-&gt;router, nad); &#125; else &#123; xhash_zap(sm-&gt;hosts, id); // eliminated host will stand at last &#125; xhash_put(domains, pstrdup(xhash_pool(domains), id), sm); &#125; // å‰©ä¸‹çš„éƒ½æ˜¯è¢«ç§»é™¤äº†çš„ä¸»æœºåŸŸå,å‘é€unbind // send unbind information for eliminated hosts if(xhash_iter_first(sm-&gt;hosts)) &#123; do &#123; xhash_iter_get(sm-&gt;hosts, (void *) &amp;host, &amp;len, NULL); nad = nad_new(); ns = nad_add_namespace(nad, uri_COMPONENT, NULL); nelem = nad_append_elem(nad, ns, &quot;unbind&quot;, 0); nad_set_attr(nad, nelem, -1, &quot;name&quot;, host, len); nad_append_attr(nad, -1, &quot;multi&quot;, &quot;to&quot;); log_debug(ZONE, &quot;requesting domain bind for &#x27;%.*s&#x27;&quot;, len, host); sx_nad_write(sm-&gt;router, nad); &#125;while(xhash_iter_next(sm-&gt;hosts)); &#125; // å› ä¸ºsm-&gt;hostsè¿™ä¸ªå“ˆå¸Œå­—å…¸åœ¨smä¸­åªç”¨æ¥æŸ¥è¯¢,æ²¡æœ‰æŠ›å‡ºå…¶å†…éƒ¨æŒ‡é’ˆ, // æ‰€ä»¥ä¸ç”¨è€ƒè™‘åŸæœ‰çš„hostsæŒ‡é’ˆå¤±æ•ˆ, ç›´æ¥freeæ‰æ•´ä¸ªæ—§hosts,æ›¿æ¢æ–°çš„ // replace sm-&gt;hosts xhash_free(sm-&gt;hosts); sm-&gt;hosts = domains;&#125; æœ€ååœ¨mainå‡½æ•°çš„whileå¾ªç¯é‡ŒåŠ ä¸Šsm_reconfè§¦å‘: 1234567891011121314151617181920212223242526while(!sm_shutdown)&#123; mio_run(sm-&gt;mio, 5); // ... // reload configurations if(sm_reconf) &#123; log_write(sm-&gt;log, LOG_NOTICE, &quot;SIGUSR1: reloading some configuration items ...&quot;); sleep(20); config_t conf; conf = config_new(); if (conf &amp;&amp; config_load(conf, config_file) == 0) &#123; _sm_hosts_reconfig(sm, conf); config_free(conf); log_write(sm-&gt;log, LOG_NOTICE, &quot;reloading finished&quot;); &#125; else &#123; log_write(sm-&gt;log, LOG_WARNING, &quot;couldn&#x27;t reload config (%s)&quot;, config_file); if (conf) config_free(conf); &#125; sm_reconf = 0; &#125;&#125; åˆ°æ­¤ä¸ºæ­¢, å·²ç»å¯ä»¥æ§åˆ¶å·²æœ‰æœåŠ¡å™¨çš„ç¦»çº¿å’Œä¸Šçº¿,åŸå› æ˜¯ç”±äºå®Œæ•´çš„æœåŠ¡å™¨é…ç½®ç”±c2sç®¡ç†,å› æ­¤è¿˜éœ€è¦å¯¹c2sä¿®æ”¹,ä½¿å…¶é‡æ–°è½½å…¥æ–°çš„c2s.xmlé…ç½®. æœ¬é¡¹ç›®æºç å·²æ‰˜ç®¡åœ¨Githubä¸Š, é¡¹ç›®åç§°: Jabberd2s","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"}]},{"title":"Jabberd2 é€šä¿¡æ¡†æ¶(mio)æ¨¡å‹ (ä¸‹)","slug":"Jabberd2 é€šä¿¡æ¡†æ¶(mio)æ¨¡å‹ (ä¸‹)","date":"2014-08-14T04:42:40.000Z","updated":"2022-09-15T15:51:05.345Z","comments":true,"path":"2014/08/14/Jabberd2 é€šä¿¡æ¡†æ¶(mio)æ¨¡å‹ (ä¸‹)/","link":"","permalink":"https://unpluggedcoder.me/2014/08/14/Jabberd2%20%E9%80%9A%E4%BF%A1%E6%A1%86%E6%9E%B6(mio)%E6%A8%A1%E5%9E%8B%20(%E4%B8%8B)/","excerpt":"","text":"ä¹‹å‰çš„æ–‡ç« ä»‹ç»äº†mioçš„æ•°æ®ç»“æ„æ¨¡å‹,ä½†æ˜¯å®ƒåªæ˜¯å®šä¹‰äº†I&#x2F;Oå¤ç”¨çš„æ¨¡å‹,ä¸»è¦æ˜¯è´Ÿè´£I&#x2F;Oç«¯å£ä¸Šçš„è¯»å†™äº‹ä»¶ç›‘å¬,ä½†çœŸæ­£çš„è¯»(recv)å’Œå†™(send)å¹¶ä¸æ˜¯ç”±mioå®Œæˆ,è¯»å†™çš„åˆ†æé€»è¾‘æ¶‰åŠåˆ°åè®®,å› æ­¤jabberd2ä¸­è¿™é¡¹ä»»åŠ¡äº¤ç»™äº†sxæ¨¡å—å®Œæˆ,æºç ä¸­æ²¡æœ‰çœ‹åˆ°å¯¹sxè¿™ä¸¤ä¸ªå­—æ¯åšå‡ºçš„è§£é‡Š,å…‰çœ‹æºç çš„sxç›®å½•å¾ˆéš¾çœ‹å‡ºè¿™ä¸ªæ¨¡å—åˆ°åº•å…·ä½“çš„èŒè´£,å…³äºå®ƒæ—¥åå†è¯´.å¯¹äºmioæ¥è¯´, å¯ä»¥æŠŠsxçœ‹æˆæ˜¯è¯»å†™çš„æ‰§è¡Œä½“, è¯»å–åˆ°xmlç‰‡æ®µæ€ä¹ˆåˆ†æ, è¦å†™ä»€ä¹ˆå†…å®¹æ¥å›å¤,éƒ½ç”±sxå®Œæˆ. å…³äºå¦‚ä½•è°ƒè¯•jabberd2å·²ç»è®²è¿‡, jabberd2å°†æ•´ä¸ªæœåŠ¡å™¨äº¤ç»™äº†4ä¸ªè¿›ç¨‹æ¨¡å—æ¥æ‰§è¡Œ,æˆ–è®¸è¿™ä¸ªåŸå› , ä½œè€…åœ¨æ¨¡å—ä¸­æ²¡æœ‰ç”¨å¤šçº¿ç¨‹,é ä¸€ä¸ªä¸»çº¿ç¨‹å®Œæˆå…¨éƒ¨å·¥ä½œ.æ‰€ä»¥æ•´ä¸ªæ¶æ„é‡Œå……æ»¡äº†å‡½æ•°å›è°ƒ,è€Œä¸€ä¸ªå›è°ƒå‡½æ•°å¯èƒ½åœ¨å„ç§ä¸åŒçš„æƒ…å†µä¸‹è¢«è°ƒç”¨,å› æ­¤ä»£ç çš„ä¿®æ”¹ä¸Šå¿…é¡»å°å¿ƒç¿¼ç¿¼,è¿™æˆ–è®¸åˆä½¿å…¶æ‰©å±•æ€§å—åˆ°äº†æå¤§åœ°çº¦æŸ,çœ‹è¿™ç±»ä»£ç éå¸¸è´¹åŠ².æ¯«æ— ä¾‹å¤–åœ°, mioå’Œsxçš„é…åˆè¿‡ç¨‹ä¹Ÿæ˜¯é å›è°ƒå®Œæˆ. å…¶å®ä»callbackå‡½æ•°çš„å‘½åä¸Šå¯ä»¥çœ‹å‡ºå®ƒçš„ç”±æ¥,ç¬¬ä¸€ä¸ªå•è¯(c2s)æŒ‡æ˜äº†æ‰€å±çš„è¿›ç¨‹æ¨¡å—,ç¬¬äºŒä¸ªå•è¯(router)è¡¨ç¤ºè¿™ä¸ªå‡½æ•°æ‰¿è½½çš„é€šä¿¡å¯¹è±¡,ç¬¬ä¸‰ä¸ªå•è¯(mio)è¡¨ç¤ºäº†è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°çš„è§¦å‘è€…,æœ€åä¸€ä¸ªcallbacké¡¾åæ€ä¹‰äº†.å› æ­¤c2s_router_mio_callbackè¡¨æ˜çš„æ˜¯c2sæ¨¡å—é‡Œå’Œrouteräº¤äº’çš„mioæ¨¡å‹å›è°ƒå‡½æ•°,åœ¨jabberd2æ¶æ„é‡Œè¿™ç±»å›è°ƒå‡½æ•°é€šå¸¸éƒ½æ˜¯æ³¨å†Œåœ¨ç¬¬ä¸‰ä¸ªå•è¯(è¿™é‡Œå³mio)çš„å®ä½“ä¸­,ç”±å…¶è§¦å‘.ä¸€ä¸ªmio_callbackå¯ä»¥ç®¡ç†ä¸€ç±»å¯¹è±¡çš„é€šä¿¡,é’ˆå¯¹routerçš„äº¤äº’æ³¨å†Œçš„æ˜¯c2s_router_sx_callback,é’ˆå¯¹å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚æ³¨å†Œçš„æ˜¯_c2s_client_mio_callback,è¿™äº›å‡½æ•°éƒ½åœ¨c2s.cä¸­. å‰é¢è¯´åˆ°,mioä¸è´Ÿè´£å…·ä½“çš„è¯»å†™æ“ä½œ,å› æ­¤è¿™é‡Œåˆå¼•å…¥äº†sxæ¨¡å—çš„å›è°ƒ,é’ˆå¯¹æ¯ä¸€ä¸ª(æ–‡ä»¶æè¿°ç¬¦FD)è¿æ¥é€šä¿¡,mio_callbackéƒ½ä¼šè°ƒç”¨ä¸å…¶å¯¹åº”çš„sx_callback.c2s_router_sx_callbackå¯¹åº”äºc2s_router_mio_callback,åè€…(mio)çš„è¯»å–è¯·æ±‚æ“ä½œéƒ½å‘ç»™å‰è€…(sx),ç”±äºrouterå’Œc2sæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»,æ‰€ä»¥è¿›å…¥è¿™ä¸¤ä¸ªå›è°ƒçš„è¿æ¥å¥æŸ„FDéƒ½æ˜¯åŒä¸€ä¸ª,å› æ­¤ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“è°ƒè¯•å’Œç†è§£,ä¸‹å›¾ä¹Ÿä»¥æ­¤ä¸ºä¾‹è§£é‡Š.è€Œä¸€ä¸ªc2så»ºç«‹çš„æœåŠ¡ç«¯å¯¹åº”Nä¸ªå®¢æˆ·ç«¯,æ‰€ä»¥client_mio_callbackä¼šé’ˆå¯¹ä¸åŒè¿æ¥åšå‡ºä¸åŒclient_sx_callbackè°ƒç”¨è¯·æ±‚.ä¸‹å›¾æ˜¯ä»¥c2så’Œrouterå»ºç«‹è¿æ¥çš„è¿‡ç¨‹æ¥è¡¨ç¤º. åœ¨è¿›å…¥whileå¾ªç¯å‰é¦–å…ˆè¦å»ºç«‹èµ·ä¸routerçš„è¿æ¥(_c2s_router_connect),whileå¾ªç¯é mio_runæ¥é©±åŠ¨.åœ¨è¿›å…¥å¾ªç¯å‰,FD(m,fd)-&gt;typeå·²è¢«è®¾æˆtype_CONNECT_WRITE,è¡¨ç¤ºé¦–æ¬¡å»ºç«‹è¿æ¥å¹¶å¸Œæœ›å†™å…¥æ•°æ®.è¿™é‡Œè¦æŒ‡å‡ºä¸€ç‚¹, ä»_mio_readå’Œ_mio_writeçš„åŒºåˆ«å¯ä»¥çœ‹å‡ºæ¥ç”±äºé‡‡ç”¨çš„æ˜¯Reactoræ¨¡å¼, _mio_readå®é™…ä¸Šæ˜¯å»¶æ—¶è¯»,_mio_writeæ˜¯å³æ—¶å†™. 123456789101112131415161718192021222324252627282930313233343536/** start processing read events */static void _mio_read(mio_t m, mio_fd_t fd)&#123; if(m == NULL || fd == NULL) return; /* if connecting, do this later */ if(FD(m,fd)-&gt;type &amp; type_CONNECT) &#123; FD(m,fd)-&gt;type |= type_CONNECT_READ; return; &#125; MIO_SET_READ(m, FD(m,fd));&#125;/** try writing to the socket via the app */static void _mio_write(mio_t m, mio_fd_t fd)&#123; if(m == NULL || fd == NULL) return; /* if connecting, do this later */ if(FD(m,fd)-&gt;type &amp; type_CONNECT) &#123; FD(m,fd)-&gt;type |= type_CONNECT_WRITE; return; &#125; if(FD(m,fd)-&gt;type != type_NORMAL) return; // è°ƒç”¨c2s_router_mio_callback if(ACT(m, fd, action_WRITE, NULL) == 0) return; /* not all written, do more l8r */ MIO_SET_WRITE(m, FD(m,fd));&#125; å®é™…çš„è¯»æ“ä½œè¦ç­‰å¾…åˆ°ä¸‹ä¸€è½®FDè½®è¯¢æ—¶æ‰ä¼šæ‰§è¡Œ,æ‰€ä»¥è¿™é‡Œä»¥_mio__connectæ¥è¯´æ˜,æ­¤æ—¶å¸Œæœ›å†™å…¥: 1234567891011121314/** internally change a connecting socket to a normal one */static void _mio__connect(mio_t m, mio_fd_t fd)&#123; mio_type_t type = FD(m,fd)-&gt;type; mio_debug(ZONE, &quot;connect processing for fd #%d&quot;, fd-&gt;fd); /* reset type and clear the &quot;write&quot; event that flags connect() is done */ FD(m,fd)-&gt;type = type_NORMAL; MIO_UNSET_WRITE(m,FD(m,fd)); /* if the app had asked to do anything in the meantime, do those now */ if(type &amp; type_CONNECT_READ) mio_read(m,fd); if(type &amp; type_CONNECT_WRITE) mio_write(m,fd);&#125; æ¥ä¸‹æ¥å…¶å®å°±æ˜¯å‡½æ•°å›è°ƒäº†, æ²¡ä»€ä¹ˆç‰¹æ®Šçš„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051int c2s_router_mio_callback(mio_t m, mio_action_t a, mio_fd_t fd, void *data, void *arg) &#123; c2s_t c2s = (c2s_t) arg; int nbytes; ... switch(a) &#123; ... case action_WRITE: log_debug(ZONE, &quot;write action on fd %d&quot;, fd-&gt;fd); return sx_can_write(c2s-&gt;router); ...&#125;int sx_can_write(sx_t s) &#123; /* æ•´ä¸ªå‡½æ•°æœ‰å¥½å‡ ç§è§¦å‘_sx_eventçš„æƒ…å†µ, event_WRITE æ˜¯å®ƒçš„ä¸»è¦ç›®çš„ */ sx_buf_t out; int ret, written; ... /* get the callback to do the write */ _sx_debug(ZONE, &quot;handing app %d bytes to write&quot;, out-&gt;len); written = _sx_event(s, event_WRITE, (void *) out); ...&#125;int __sx_event(const char *file, int line, sx_t s, sx_event_t e, void *data) &#123; int ret; _sx_debug(file, line, &quot;tag %d event %d data 0x%x&quot;, s-&gt;tag, e, data); s-&gt;reentry++; // è°ƒç”¨c2s_router_sx_callback ret = (s-&gt;cb)(s, e, data, s-&gt;cb_arg); s-&gt;reentry--; return ret;&#125;int c2s_router_sx_callback(sx_t s, sx_event_t e, void *data, void *arg) &#123; c2s_t c2s = (c2s_t) arg; sx_buf_t buf = (sx_buf_t) data; ... switch(e) &#123; ... case event_WRITE: log_debug(ZONE, &quot;writing to %d&quot;, c2s-&gt;fd-&gt;fd); len = send(c2s-&gt;fd-&gt;fd, buf-&gt;data, buf-&gt;len, 0); if(len &gt;= 0) &#123; log_debug(ZONE, &quot;%d bytes written&quot;, len); return len; &#125; ...&#125; è·Ÿè¸ªå®ƒä»£ç åå‘ç°,ä¸routerå»ºç«‹è¿æ¥åæ‰å»ºç«‹èµ·ç›‘å¬æœåŠ¡ç«¯,è€Œä¸”è¿˜ä¼šå†ç›‘å¬ä¸€ä¸ªFIFOæ–‡ä»¶ç®¡é“,ä»£ç åœ¨c2s/pbx.c å’Œc2s/pbx_commands.cé‡Œ, çœ‹ä¸Šå»æ˜¯ç”¨æ¥æ§åˆ¶jidè´¦æˆ·çš„å°trick, åŒæ ·ä¹Ÿæœ‰mioå›è°ƒ. æ€»ç»“, å›è°ƒå¾ˆå¤š, å¾ˆéš¾ä¸€æ—¶é—´å°±çœ‹å‡ºæ¥ä½œè€…çš„å›è°ƒåˆ†æ”¯é‡Œçš„ç§ç§æ„å›¾, ç»§ç»­å­¦ä¹ .","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"}]},{"title":"æœ‰æ„Ÿäºã€Šä½æ™ºå•†ç¤¾ä¼šã€‹","slug":"æœ‰æ„Ÿäºã€Šä½æ™ºå•†ç¤¾ä¼šã€‹","date":"2014-08-07T15:23:27.000Z","updated":"2022-09-15T15:51:05.353Z","comments":true,"path":"2014/08/07/æœ‰æ„Ÿäºã€Šä½æ™ºå•†ç¤¾ä¼šã€‹/","link":"","permalink":"https://unpluggedcoder.me/2014/08/07/%E6%9C%89%E6%84%9F%E4%BA%8E%E3%80%8A%E4%BD%8E%E6%99%BA%E5%95%86%E7%A4%BE%E4%BC%9A%E3%80%8B/","excerpt":"","text":"ä¹‹å‰ä»ä¸€åˆ™å¾®åšä¸Šçœ‹åˆ°ä¸€æ®µè®½åˆºä¸­å›½ç¤¾ä¼šçš„è¯ï¼ŒåŸæ–‡è®°ä¸å¾—äº†ï¼Œä½†è½æ¬¾ç½²åå‡ºè‡ªæ—¥æœ¬ç»æµå­¦å®¶å¤§å‰ç ”ä¸€çš„ã€Šä½æ™ºå•†ç¤¾ä¼šã€‹ä¸€ä¹¦ï¼Œé‚å°†å…¶è¯»é€šè¯»äº†ä¸€éã€‚ ä¸ä»…æ²¡æœ‰åœ¨ä¹¦ä¸­çœ‹åˆ°ä½œè€…ç›´è¨€è®½åˆºä¸­å›½ä¹‹å¤„ï¼Œç›¸åä½œè€…æŠ¨å‡»çš„æ˜¯æ—¥æœ¬ç¤¾ä¼šï¼Œå¹¶å¯¹ä¸­å›½è¿‘å¹´æ¥çš„å‘å±•è¡¨ç¤ºäº†ä¸€å®šç¨‹åº¦ä¸Šçš„è‚¯å®šï¼Œè®¤ä¸ºå¦‚æœæ—¥æœ¬ä¸éœ€æ±‚è½¬å˜å¿…ç„¶å°†è¢«ä¸­å›½ï¼Œå°åº¦ç­‰å…¶ä»–å›½å®¶è¶…è¶Šã€‚å¯è§å¾®åšæœ‰å¤šé»‘äº†ï¼Œéšä¾¿æ‹¿ä¸€æ®µè¯æ¥æ–­ç« å–ä¹‰ï¼Œè¯¯å¯¼å¤§ä¼—ã€‚ä½†æ˜¯åœ¨ç½‘ç»œä¸Šè¿˜æ˜¯æœ‰å¾ˆå¤šä¹¦è¯„æ–‡ç« å–œæ¬¢æŠŠä¹¦é‡Œæè¿°çš„ç°è±¡æ‹¿æ¥å’Œä¸­å›½å¯¹æ¯”ï¼Œå…¶å®è¯»è¿‡æ­¤ä¹¦å°±ä¼šå‘ç°è¿™æ˜¯ç›¸å½“ç‰‡é¢çš„çœ‹æ³•ã€‚ ä»å°æ—¥æœ¬å†™çš„ã€ŠDebug Hacksã€‹å¯ä»¥çœ‹å‡ºæ—¥æœ¬äººå†™ä¹¦çš„ä¸¥å¯†çš„æ¡ç†å’Œé€»è¾‘æ€ç»´ã€‚æœ¬ä¹¦ä¹Ÿä¸ä¾‹å¤–ï¼Œä¸€æœ¬å¥½ä¹¦ï¼Œå¿…å®šè¦è®²æ¸…æ¥šä¸‰ç‚¹ï¼šæ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆã€æ€ä¹ˆæ ·ï¼Œä¹Ÿå°±æ˜¯What, Why, Howã€‚ä½œè€…å¤§å‰ç ”ä¸€è®½åˆºæ—¥æœ¬å¸‚é¢ä¸Šçš„æ„šäººä¹¦ç±å¤§å¤šåªè¯´å‰ä¸¤ç‚¹ï¼ŒçœŸæ­£æŒ‡å‡ºå°–é”çŸ›ç›¾çš„é—®é¢˜æ‰€åœ¨å¹¶æå‡ºè§£å†³æ–¹æ¡ˆçš„ä¹¦ç±å¯¥å¯¥æ— å‡ ã€‚æ—¥æœ¬çš„ä¹¦ç±æ˜¯ä¸æ˜¯çœŸå¦‚ä½œè€…æ‰€è¯´ï¼Œæœ¬äººä¹Ÿæ²¡æœ‰å»è€ƒç©¶ï¼Œä½†æ˜¯ä½œè€…åœ¨æœ¬ä¹¦çš„æœ€åçš„ç¡®æå‡ºäº†è¯¸å¦‚ç¨åˆ¶æ”¹é©ä¹‹ç±»çš„å‡ æ¡å»ºè®®ã€‚å…¶å®ï¼Œåè§‚ä½œè€…åœ¨ä¹¦ä¸­çš„è®¸å¤šåœ°æ–¹éƒ½å¼ºçƒˆçš„æŠ¨å‡»äº†æ—¥æœ¬æ”¿åºœçš„æ— è„‘è¡Œä¸ºï¼Œç›´è¨€ä¸è®³ï¼Œç›¸æ¯”ä¹¦çš„æœ«å°¾æå‡ºçš„ç¨åˆ¶æ”¹é©å»ºè®®ï¼Œæˆ–è®¸ä½œè€…æš—ç¤ºçœŸæ­£éœ€è¦æ”¹é©çš„æ˜¯å‰è€…ã€‚æ‰€ä»¥å®Œå…¨å°†ä¹¦ä¸­çš„æ—¥æœ¬ä¸ä¸­å›½å¯¹æ¯”æ˜¯æ¬ å¦¥çš„ï¼Œå› ä¸ºåœ¨èµ·ä¸»å¯¼ä½œç”¨çš„æ”¿åºœè¡Œä¸ºæˆ–è€…è¯´æ‰§æ”¿å…šçš„å¤§å±€è§‚ä¸Šä¸¤è€…å®Œå…¨ä¸åŒçš„ï¼Œä¹¦ä¸­è®¤ä¸ºæ—¥æœ¬æ”¿åºœæ­£è¶Šæ¥è¶Šèµ°å‘å°é—­ï¼ˆæˆ–è®¸æ˜¯å› ä¸ºæŸäº›åŸå› ï¼‰ï¼Œè€Œä¸­å›½ä¸æ˜¯ã€‚ å‰”é™¤æ”¿æ²»å› ç´ ã€ç¤¾ä¼šåˆ¶åº¦åï¼Œæœ€èƒ½ä»£è¡¨ç¤¾ä¼šç°çŠ¶çš„ä¸€ä¸ªå› ç´ åº”è¯¥å°±æ˜¯ç¾¤ä½“äº†ã€‚å…³äºç¾¤ä½“çš„æè¿°ï¼Œæˆ‘è§‰å¾—æ­¤ä¹¦å®Œå…¨æ˜¯ã€Šä¹Œåˆä¹‹ä¼—ã€‹ï¼ˆ(æ³•)å¤æ–¯å¡”å¤«.å‹’åºï¼‰çš„ç°å®ä¾‹è¯ã€‚æ—¥æœ¬ç¾¤ä¼—çš„ç›²ç›®è·Ÿéšå’Œä¸å‡æ€ç´¢çš„è¡Œä¸ºä¸æ˜¯ä¸€å¤©ä¸¤å¤©å½¢æˆçš„ã€‚ä»èº«è¾¹æ¥çœ‹ï¼Œå¾ˆæ˜æ˜¾çš„ä¸¤ç‚¹è¡¨ç°å°±æ˜¯æ— è„‘çš„å¨±ä¹ç»¼è‰ºèŠ‚ç›®æ³›æ»¥å’Œæ—¥å’Œå¼ä½ä¿—æ¼«ç”»å…´èµ·ï¼Œå®Œå…¨æ— æ³•æƒ³è±¡è¿™ä¸¤ç§æ–‡åŒ–åœ¨æ—¥æœ¬è¿™æ ·ä¸€ä¸ªå‘è¾¾å›½å®¶ä¸­ä¼šå¤§å—æ¬¢è¿ã€‚ä¸ºä»€ä¹ˆè¿™ç§ä½ä¿—é€æ¸åœ¨ä¼ æ’­åˆ°ä¸­å›½ï¼Œè€Œä¸”è¿˜è¢«å¹¿å¤§æ°‘ä¼—æ‰€æ´¥æ´¥ä¹é“ï¼Ÿç›¸ååœ¨æ¬§ç¾ç­‰å‘è¾¾å›½å®¶æˆ‘ä»¬å‡ ä¹çœ‹ä¸åˆ°è¿™ç±»æ–‡åŒ–çš„è¸ªå½±ã€‚å–è€Œä»£ä¹‹çš„æ˜¯è„±å£ç§€ä¸Šæ¿€çƒˆçš„è¾©è®ºå’Œè®½åˆºï¼Œä»¥åŠå¤§å—æ¬¢è¿çš„é«˜è´¨é‡å‰§ä½œå’Œçºªå½•ç‰‡ã€‚å› æ­¤åª’ä½“è¦è‚©è´Ÿå¾ˆå¤§çš„è´£ä»»ï¼Œæ— è®ºæ˜¯é˜´è°‹è®ºè¿˜æ˜¯å…¶å®ƒåŸå› ï¼Œä¸€ç‚¹ç‚¹æ”¹å˜ï¼ˆæ“çºµï¼‰ç¾¤ä½“æ™ºå•†çš„åæœå¿…å°†ç›´æ¥å½±å“åˆ°å›½å®¶çš„å…´è¡°ï¼ˆä¸å¸Œæœ›çœ‹åˆ°ä¸‹ä¸€ä»£äººä¸€è°ˆåˆ°æ¢¦æƒ³å°±æ˜¯ï¼šå”±æ­Œâ€¦ï¼‰ã€‚ å›åˆ°è‡ªå·±çš„è¡Œä¸šé‡Œæ¥çœ‹ï¼ŒITè¡Œä¸šä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¤§å¤šæ•°çš„ç å†œç¾¤ä½“å¹¶æ²¡æœ‰å› ä¸ºèº«åœ¨é«˜ç§‘æŠ€è¡Œä¸šè€Œèµ‹äºˆé«˜æ™ºå•†çš„è¡¨ç°ï¼Œé«˜æ™ºå•†ç²¾è‹±åœ¨ITè¡Œä¸šé‡Œçš„æ¯”ä¾‹è¿äºŒå…«åŸåˆ™éƒ½è°ˆä¸ä¸Šï¼Œè®°å¾—å½“åˆæ¯”å°”ç›–èŒ¨è¯´åªè¦è®©ä»–å¸¦èµ°å¾®è½¯å‰20ä¸ªé¡¶å°–äººæ‰ï¼Œé‚£å¾®è½¯å°†å˜å¾—ä¸è¶³è½»é‡ï¼Œå¯è§çœŸæ­£åœ¨åˆ›é€ æ ¸å¿ƒæŠ€æœ¯çš„äººæˆ–è®¸è¿ä¸‡åˆ†ä¹‹ä¸€éƒ½ä¸åˆ°ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå¤§å‰ç ”ä¸€åœ¨ä¹¦ä¸­çš„ä¸€ä¸ªè§‚ç‚¹æ˜¯ç¾¤ä¼—ç¼ºä¹è‡ªä¸»æ€è€ƒçš„è¡Œä¸ºèƒ½åŠ›ã€‚æ²¡é”™ï¼Œç²¾è‹±ç å†œå’Œæ™®é€šç å†œæœ€æ˜¾è‘—çš„åŒºåˆ«å°±åœ¨äºè‡ªä¸»æ€è€ƒçš„èƒ½åŠ›ï¼Œå‰è€…å…·æœ‰æå¼ºçš„ä¸»è§‚æ€è€ƒèƒ½åŠ›ï¼Œè¿™æ‰æ˜¯é«˜æ™ºå•†çš„åŸºç¡€ã€‚åœ¨ä¸­å›½ç å†œåœˆé‡Œç»å¤§å¤šæ•°ç å†œæ˜¯ä¸ºäº†è§£å†³å·¥ä½œä»»åŠ¡è€Œåœ¨è¿›è¡Œç”Ÿäº§æ´»åŠ¨ï¼Œå’Œç Œç –å·¥æ²¡æœ‰å¤šå¤§çš„æœ¬è´¨åŒºåˆ«ï¼Œç…§æ¬å›½å¤–çš„åº”ç”¨æ¡†æ¶ï¼Œå‚è€ƒæŸæŸå¹³å°å¼€å‘APIï¼Œç”¨ç€ä¸æ–­æ›´æ–°çš„é«˜å¤§ä¸ŠæŠ€æœ¯ã€‚å…¶å®ç¨å¾®æƒ³æƒ³å°±å¾ˆå®¹æ˜“åŒå€¦äº†è¿™æ ·çš„å·¥ä½œèŠ‚å¥ï¼Œä¸€ä¸ªç å†œä¹Ÿä¸å¯èƒ½å®Œå…¨è·Ÿå¾—ä¸ŠæŠ€æœ¯çš„è¿­ä»£æ›´æ–°èŠ‚å¥ã€‚è¦æ€ä¹ˆåšï¼Ÿæœ¯ä¸šæœ‰ä¸“æ”»ï¼Œé€‰æ‹©ä¸€ä¸ªæ–¹å‘ï¼Œæ·±å…¥ç†è§£å…¶å®ç°ç»†èŠ‚ï¼Œå¤šè¯»æºç ï¼Œåœ¨è¯»æºç å‰ä¸»åŠ¨æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæ˜¯æˆ‘è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¼šé‡‡ç”¨ä»€ä¹ˆæ‰‹æ³•ï¼Œè€Œåå†çœ‹çœ‹æºç ä½œè€…æ˜¯å¦‚ä½•å®ç°ï¼Œå¯¹æ¯”ä¸è¶³ä¸ä¼˜åŠ¿ï¼Œè¿™æ ·æ‰æœ‰æ”¶è·å’Œè¿›æ­¥ï¼Œæ›´é‡è¦çš„æ˜¯è®©è‡ªå·±çš„ä¸»åŠ¨æ€è€ƒèƒ½åŠ›ä¸€æ­¥æ­¥é€¼è¿‘é¡¶çº§æ°´å‡†ï¼å®ç°æ›´æœ‰åˆ›é€ åŠ›çš„äº§å“ï¼ æ‘†è„±ä½æ™ºå•†ç¤¾ä¼šä»è‡ªèº«åšèµ·ã€‚","categories":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"ä½æ™ºå•†ç¤¾ä¼š","slug":"ä½æ™ºå•†ç¤¾ä¼š","permalink":"https://unpluggedcoder.me/tags/%E4%BD%8E%E6%99%BA%E5%95%86%E7%A4%BE%E4%BC%9A/"}]},{"title":"Jabberd2 é€šä¿¡æ¡†æ¶(mio)æ¨¡å‹(ä¸Š)","slug":"Jabberd2 é€šä¿¡æ¡†æ¶(mio)æ¨¡å‹(ä¸Š)","date":"2014-08-06T03:28:44.000Z","updated":"2022-09-15T15:51:05.345Z","comments":true,"path":"2014/08/06/Jabberd2 é€šä¿¡æ¡†æ¶(mio)æ¨¡å‹(ä¸Š)/","link":"","permalink":"https://unpluggedcoder.me/2014/08/06/Jabberd2%20%E9%80%9A%E4%BF%A1%E6%A1%86%E6%9E%B6(mio)%E6%A8%A1%E5%9E%8B(%E4%B8%8A)/","excerpt":"","text":"è¿™éƒ¨åˆ†æ˜¯jabberdçš„æ ¸å¿ƒé€šä¿¡æ¡†æ¶,æœ‰ç‚¹å¤æ‚,æ‰€è¿°ä¹‹å¤„å¦‚æœ‰ç–æ¼é”™è¯¯,è¿˜æœ›æŒ‡æ­£. ä»æ•°æ®ç»“æ„å…¥æ‰‹æœ€å®¹æ˜“çœ‹æ¸…ä»£ç ä½œè€…çš„æ€è·¯,è¿™é‡Œæœ‰4ä¸ªä¸»è¦çš„ç»“æ„ä½“æ¥æ‰¿æ‹…I&#x2F;Oæ•°æ®,å¹¶åˆ†åˆ«åˆ†å¸ƒåœ¨mio.hå’Œmio_impl.hä¸­.é¡¾åæ€ä¹‰,implæ˜¯I&#x2F;Oçš„æµç¨‹å®ç°,å„ä¸ªé™æ€å‡½æ•°éƒ½ç›´æ¥åœ¨å¤´æ–‡ä»¶ä¸­å†™å®Œ.ä½œè€…çš„æ„å›¾å°±æ˜¯è®©mio.hçš„æ•°æ®å’Œå‡½æ•°(å…¶å®è¿™ä¸¤ä¸ªç»„åˆèµ·æ¥å°±å’Œå¯¹è±¡æ²¡å¤šå¤§åŒºåˆ«äº†,å› æ­¤ä¸ºäº†æ–¹ä¾¿ç†è§£ç´¢æ€§å°±ç”¨UMLç±»å›¾è¡¨ç¤º)æš´éœ²ç»™c2s,routerå’Œsmå„ä¸ªæ¨¡å—,è¿™äº›æ¨¡å—å¯¹äºmioæ¥è¯´ä¸éœ€è¦å…³å¿ƒå®ç°ç»†èŠ‚. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950typedef struct mio_fd_st&#123; int fd;&#125; *mio_fd_t;typedef struct mio_priv_fd_st&#123; struct mio_fd_st mio_fd; mio_type_t type; /* app event handler and data */ mio_handler_t app; void *arg; MIO_FD_VARS&#125; *mio_priv_fd_t;typedef struct mio_st&#123; void (*mio_free)(struct mio_st **m); struct mio_fd_st *(*mio_listen)(struct mio_st **m, int port, const char *sourceip, mio_handler_t app, void *arg); struct mio_fd_st *(*mio_connect)(struct mio_st **m, int port, const char *hostip, const char *srcip, mio_handler_t app, void *arg); struct mio_fd_st *(*mio_register)(struct mio_st **m, int fd, mio_handler_t app, void *arg); void (*mio_app)(struct mio_st **m, struct mio_fd_st *fd, mio_handler_t app, void *arg); void (*mio_close)(struct mio_st **m, struct mio_fd_st *fd); void (*mio_write)(struct mio_st **m, struct mio_fd_st *fd); void (*mio_read)(struct mio_st **m, struct mio_fd_st *fd); void (*mio_run)(struct mio_st **m, int timeout);&#125; **mio_t;/** now define our master data type */typedef struct mio_priv_st&#123; struct mio_st *mio; int maxfd; MIO_VARS&#125; *mio_priv_t; å¸¦æœ‰_fd_åç§°çš„ç»“æ„ä½“ä»£è¡¨æ¯ä¸€ä¸ªI&#x2F;Oå®ä½“è¿æ¥,è€Œmio_st(æˆ–è€…è¯´mio_priv_st, Manager I&#x2F;O)æ˜¯ç®¡ç†æ•´ä¸ªç¨‹åºçš„I&#x2F;Oè½½ä½“,åœ¨ç¨‹åºç»“æŸå‰éƒ½å§‹ç»ˆå­˜åœ¨,æœ‰æ•ˆ.è¿™ä¸¤è€…åœ¨ä»£ç ä¸­çš„ä½“ç°å³æ˜¯ä¸‹é¢è¿™ä¸¤ä¸ªå®, å› æ­¤æ–‡ç« ä¹ŸæŒ‰æºç çš„æè¿°ç”¨FD å’Œ MIOæ¥åˆ†åˆ«æŒ‡ä»£äºŒè€…: 123/* lazy factor */#define MIO(m) ((mio_priv_t) m)#define FD(m,f) ((mio_priv_fd_t) f) MIOå…¶å®å¯¹mioæ¨¡å—çš„ä½¿ç”¨è€…æ¥è¯´æ˜¯é€æ˜çš„,å› ä¸ºmio.hæš´éœ²ç»™å¤–éƒ¨çš„å®é™…ä¸Šå°±æ˜¯FDå’Œä¸€ä¸ªåŒ…å«è‹¥å¹²æ¥å£çš„å®ä¾‹(å³MIO),ä½œè€…å°†å®å‘æŒ¥åˆ°æè‡´,ç”šè‡³è¿æ‰€æœ‰çš„æ¥å£ä¹Ÿå°è£…æˆå®,ä¸‹é¢å°±è¯´è¯´ä½œè€…å¦‚ä½•åˆ©ç”¨è¿™ä¸¤å¤§ç»“æ„ä½“æ¥å®Œæˆæ¡†æ¶çš„è€¦åˆä¸è§£è€¦. æºç çš„ä½œè€…åˆ©ç”¨äº†ä¸¤ä¸ªå°æŠ€å·§æ¥å®ç°ä¸åº•å±‚I&#x2F;Oæ¨¡å‹æ— å…³çš„é€šç”¨é€šä¿¡æ¡†æ¶: åˆ©ç”¨structå†…å­˜å¸ƒå±€æ¨¡æ‹Ÿç»§æ‰¿å…³ç³»åˆå§‹åŒ–çš„_mio_newå‡½æ•°å¯ä»¥çœ‹å‡ºä½œè€…æŠ›å‡ºçš„æ˜¯**mio_st,ä½†æ˜¯åº•å±‚çš„å…·ä½“å®ç°éœ€è¦ç”±mio_priv_stå®Œæˆ,å› æ­¤å¯¹äºä¸åŒçš„å®ç°éœ€è¦æœ‰ä¸åŒçš„å˜é‡å¸ƒå±€åœ¨mio_priv_stä¸­. 12345678910111213141516171819202122232425262728static mio_t _mio_new(int maxfd)&#123; static struct mio_st mio_impl = &#123; _mio_free, _mio_listen, _mio_connect, _mio_setup_fd, _mio_app, _mio_close, _mio_write, _mio_read, _mio_run &#125;; mio_t m; ... /* allocate and zero out main memory */ if((m = calloc(1, sizeof(struct mio_priv_st))) == NULL) &#123; fprintf(stderr,&quot;Cannot allocate MIO memory! Exiting.\\n&quot;); exit(EXIT_FAILURE); &#125; /* set up our internal vars */ *m = &amp;amp;mio_impl; MIO(m)-&amp;gt;maxfd = maxfd; MIO_INIT_VARS(m); return m;&#125; åˆ©ç”¨å®æ‰©å±•æŠ½è±¡å‡ºé€šç”¨I&#x2F;Oæ¨¡å‹é€šè¿‡å®å®šä¹‰åœ¨ç¼–è¯‘æ—¶æœŸç¡®å®šä½¿ç”¨çš„åº•å±‚I&#x2F;Oå¤ç”¨æ¨¡å‹.ä¸å¾—ä¸ä½©æœä½œè€…èƒ½å°†å„ç§æ¨¡å‹çš„é€šç”¨I&#x2F;Oæç‚¼å‡ºæ¥,è¿‘ä¹å®ç°äº†ä¸€ä¸ªå°å‹çš„libeventåº“.åœ¨mio.cä¸­é€šè¿‡é¢„å®šä¹‰çš„å®æ¥ç¡®å®šè°ƒç”¨å“ªç§å®ç°.å¯¹åº”ä¸Šä¸€ç‚¹,MIOä¸­çš„MIO_INIT_VARSå®å°±å¿…é¡»æ‰©å±•ä¸ºå¯¹åº”I&#x2F;Oçš„å˜é‡,epollä¸­å°±éœ€è¦åŒ…å«epollçš„æ–‡ä»¶æè¿°ç¬¦å’Œepoll_eventé›†åˆ, è€ŒFDä¸­çš„MIO_FD_VARSå®åˆ™æ‰©å±•ä¸ºåœ¨epollçš„äº‹ä»¶ç±»å‹æ©ç .ç„¶ååœ¨_mio_newçš„æœ€åä¹Ÿè¦æ±‚æ‰©å±•I&#x2F;Oåˆå§‹åŒ–çš„å®MIO_INIT_VARS,ä»¥å®Œæˆåˆå§‹åŒ–åŠ¨ä½œ,ä¾‹å¦‚epoll_create.è¿™äº›å®æ‰©å±•éƒ½åŒ…å«åœ¨å¯¹åº”çš„mio_***.hä¸­. 1234567#define MIO_FD_VARS \\ uint32_t events;#define MIO_VARS \\ int defer_free; \\ int epoll_fd; \\ struct epoll_event res_event[32]; é™¤æ­¤ä¹‹å¤–è¿˜è¦æ±‚å®å®ç°å¯¹FDçš„é‡Šæ”¾å’Œè®¾è¯»å†™ä½çš„ä¸€äº›å…¶å®ƒæ“ä½œ. åˆ°ç›®å‰ä¸ºæ­¢è§‰å¾—mioæ¨¡å—è¿˜æ˜¯å¾ˆæ¸…æ™°æ˜æœ—çš„,å¯¹åº•å±‚å’Œå¤–éƒ¨çš„è§£è€¦åšå¾—å¾ˆå¥½.ä½†æ˜¯ä¸ªäººæ„Ÿè§‰å®é™…æ“ä½œèµ·æ¥å´å’Œå¦ä¸€ä¸ªXMPPåè®®ç›¸å…³æ¨¡å—(sx)çš„äº¤äº’å¾ˆç¹ç(ç½‘ä¸Šè¯„è®ºè¯´jabberd2çš„æ‰©å±•æ€§å·®æ˜¯ä¸æ˜¯å°±åœ¨è¿™é‡Œ?). mioçš„æ•°æ®ç»“æ„å°±æ˜¯è¿™ä¹ˆå¤š,å…¶è¿è¡Œæœºåˆ¶ä¸‹ç¯‡å†ç»§ç»­post.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"}]},{"title":"Jabberd2 å®‰è£…é…ç½®åŠè°ƒè¯•","slug":"Jabberd2 å®‰è£…é…ç½®åŠè°ƒè¯•","date":"2014-08-05T09:33:30.000Z","updated":"2022-09-15T15:51:05.345Z","comments":true,"path":"2014/08/05/Jabberd2 å®‰è£…é…ç½®åŠè°ƒè¯•/","link":"","permalink":"https://unpluggedcoder.me/2014/08/05/Jabberd2%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%B0%83%E8%AF%95/","excerpt":"","text":"ä»å®˜ç½‘ä¸Šä¸‹è½½æºç åè§£å‹, æ­£å¸¸å®‰è£…ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤å°±OK: 123456789101112$ ./configure --prefix=/path/to/prefix$ make; make install``ç¼ºå°‘ä»€ä¹ˆåº“å°±ä¾æ¬¡å®‰è£…,å°è±¡ä¸­æ˜¯éœ€è¦libz, pcre, sasl å’Œ sslåº“.å¦‚æœä½œä¸ºäºŒæ¬¡å¼€å‘éœ€è¦å¼€å¯è°ƒè¯•åŠŸèƒ½å°±éœ€è¦åœ¨ç¼–è¯‘æ—¶æœŸæŒ‡å®šäº›å‚æ•°:```bash$ export CFLAGS+=&quot;-g -O0 -Wall&quot; // é»˜è®¤åº”è¯¥æ˜¯-O2, ä½†æ˜¯ä¼˜åŒ–è¿‡åå¾ˆä¸æ–¹ä¾¿è°ƒè¯•, æ‰€ä»¥å…³é—­ä¼˜åŒ–$ ./configure --prefix=/usr/local --enable-mio=epoll --enable-debug --enable-mio-debug$ make; make install â€“enable-mioå‚æ•°æŒ‡å®šä½¿ç”¨çš„I&#x2F;Oå¤ç”¨æ¨¡å‹. â€“enable-debugå‚æ•°å¼€å¯è°ƒè¯•,å¯ç”¨è¿™ä¸ªå‚æ•°åè¿˜éœ€è¦ä¿®æ”¹å¯¹åº”çš„xmlé…ç½®æ–‡ä»¶,å¼€å¯XMLçš„log.debugä½ç½®æ¥æŒ‡å®šè°ƒè¯•ä¿¡æ¯è¾“å‡º,ä»¥ä¸‹æ˜¯æˆ‘çš„é…ç½® 1234567891011121314151617&lt;!-- Log configuration - type is &quot;syslog&quot;, &quot;file&quot; or &quot;stdout&quot; --&gt;&lt;log type=&#x27;file&#x27;&gt;&lt;!-- If logging to syslog, this is the log ident --&gt;&lt;ident&gt;jabberd/c2s&lt;/ident&gt;&lt;!-- If logging to syslog, this is the log facility(local0 - local7) [default: local3] --&gt;&lt;facility&gt;local3&lt;/facility&gt;&lt;!-- If logging to file, this is the filename of the logfile --&gt;&lt;file&gt;/usr/local/var/jabberd/log/c2s.log&lt;/file&gt;&lt;!-- Filename of the debug logfile --&gt;&lt;debug&gt;/usr/local/var/jabberd/log/debug-$&#123;id&#125;.log&lt;/debug&gt;&lt;/log&gt; â€“enable-mio-debugå‚æ•°å¼€å¯mioè°ƒè¯•,mioä¿¡æ¯ä¼šè¾“å‡ºåˆ°stderr ç›®å‰éœ€è¦çš„å°±æ˜¯è¿™ä¹ˆå¤š. å¦‚æœæ˜¯ç›´æ¥ç”¨Netbeans IDEè½½å…¥æºç åœ¨è¿œç¨‹ä¸»æœºä¸Šç¼–è¯‘çš„è¯ä¼šå¤±è´¥, å»ºè®®é€šè¿‡æ–‡ä»¶å…±äº«æˆ–è€…æ˜¯å°†æ•´ä¸ªæºç è§£å‹åˆ°Netbeansåœ¨è¿œç¨‹æœºå™¨çš„å¯¹åº”ç›®å½•ä¸‹è¦†ç›–,ç„¶åconfigureä¸‹,è¿™æ ·Netbeanså°±å¯ä»¥ç¼–è¯‘äº†,è€Œä¸”å¯ä»¥è¿œç¨‹æŸ¥çœ‹ä»£ç å¹¶è°ƒè¯•. è°ƒè¯•å‰éœ€è¦é…ç½®Jabberd2çš„æœåŠ¡å™¨è®¾ç½®,å…·ä½“å¦‚ä½•é…ç½®å®˜ç½‘ä¸Šæœ‰å¾ˆè¯¦ç»†çš„è¯´æ˜,è¿™é‡Œç»™å‡ºé“¾æ¥,å°±ä¸å¤šåºŸè¯äº†. Jabberd2å®‰è£…é…ç½®(ä¸­æ–‡) Jabberd2å®‰è£…é…ç½®(è‹±æ–‡) è°ƒè¯• æ—¢ç„¶Netbeanså¯ä»¥èƒœä»»è°ƒè¯•,å½“ç„¶å°±ä¸ä¼šæ‰‹åŠ¨å»ç”¨GDBäº†. ç¼–è¯‘å®Œæˆåå¯ä»¥ç›´æ¥ç”¨make install,ä¹Ÿå¯ä»¥å•ç‹¬å°†è¦è°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶æ›¿æ¢åˆ°å¯¹åº”çš„å®‰è£…ç›®å½•ä¸‹. ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨jabberd2æœåŠ¡å™¨. $ jabberd â€“D â€“B &amp; å®é™…ä¸Šè¿™æ˜¯ä¸ªperlè„šæœ¬,ä¸è¿‡æˆ‘ä»¬å…³å¿ƒçš„æ˜¯å¯åŠ¨çš„è¿›ç¨‹,è„šæœ¬é‡Œå¯åŠ¨äº†router,sm,c2så’Œs2så››ä¸ªè¿›ç¨‹.åœ¨Netbeansèœå•é€‰æ‹©â€è°ƒè¯•â€-â€œè¿æ¥è°ƒè¯•å™¨â€, åœ¨è¿æ¥å¯¹è¯æ¡†é‡Œé€‰æ‹©è¿œç¨‹ä¸»æœº. ä»¥c2sè¿›ç¨‹ä¸ºä¾‹,åœ¨è¿‡æ»¤å™¨é‡Œè¾“å…¥c2så°±å¯ä»¥çœ‹åˆ°å®ƒçš„è¿›ç¨‹, å®ƒçš„å®é™…æ‰§è¡Œå‚æ•°æ˜¯: $ &#x2F;usr&#x2F;local&#x2F;bin&#x2F;c2s -c &#x2F;usr&#x2F;local&#x2F;etc&#x2F;c2s.xml â€“D æœ€åè¦è®°å¾—åœ¨â€é¡¹ç›®â€ä¸€æ æŒ‡å®šä½ çš„æºç é¡¹ç›®. ç¡®å®šåå°±å¯ä»¥å¼€å§‹è°ƒè¯•. å¯¹äºè¿™ç±»æœåŠ¡ç«¯ç¨‹åºå¦‚æœè¦è°ƒè¯•å…¥å£å¤„åˆå§‹åŒ–ä¹‹ç±»çš„å‡½æ•°,å°±åœ¨mainå‡½æ•°é‡Œå†™ä¸ªsleep,sleepåå‡ ç§’,å¥½è®©ä½ æœ‰æ—¶é—´ç”¨Netbeans attachåˆ°è¿›ç¨‹ä¸Š. åˆ›å»ºç”¨æˆ· åˆ›å»ºç”¨æˆ·å¯ä»¥é€šè¿‡ä¸€äº›XMPPå®¢æˆ·ç«¯æ¥å®ç°,ä¹Ÿå¯ä»¥ç”¨telnetå‘½ä»¤: telnet your.server.domain 5222 ç„¶åè¾“å…¥: 123456789101112131415&lt;stream:stream to=&#x27;**your.server.domain**&#x27; xmlns=&#x27;jabber:client&#x27; xmlns:stream=&#x27;https://etherx.jabber.org/streams&#x27;&gt;&lt;iq id=&#x27;reg1&#x27; type=&#x27;set&#x27;&gt; &lt;query xmlns=&#x27;jabber:iq:register&#x27;&gt; &lt;username&gt;**admin**&lt;/username&gt; &lt;password&gt;**123qwe**&lt;/password&gt; &lt;name&gt;**admin**&lt;/name&gt; &lt;email&gt;&lt;/email&gt; &lt;/query&gt;&lt;/iq&gt;&lt;/stream:stream&gt; è¿™æ ·å°±æ­å»ºå¥½äº†Jabberd2çš„å¼€å‘ç¯å¢ƒ.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"}]},{"title":"é¢å‘å¯¹è±¡ä¹‹æƒ‘â€”â€”ç¼–ç¨‹æ‚è°ˆ","slug":"é¢å‘å¯¹è±¡ä¹‹æƒ‘â€”â€”ç¼–ç¨‹æ‚è°ˆ","date":"2014-07-28T12:39:38.000Z","updated":"2022-09-15T15:51:05.354Z","comments":true,"path":"2014/07/28/é¢å‘å¯¹è±¡ä¹‹æƒ‘â€”â€”ç¼–ç¨‹æ‚è°ˆ/","link":"","permalink":"https://unpluggedcoder.me/2014/07/28/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E4%B9%8B%E6%83%91%E2%80%94%E2%80%94%E7%BC%96%E7%A8%8B%E6%9D%82%E8%B0%88/","excerpt":"","text":"æœ€è¿‘å‡ ä¸ªæœˆçœ‹äº†ä¸å°‘æºç ï¼Œä½œä¸ºä¸€ç›´ä¸»è¦ä½¿ç”¨C++çš„äºŒä»£ç¨‹åºçŒ¿ï¼Œåœ¨é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰çš„è¯­è¨€å±‚é¢ä¸Šæ„Ÿè§‰åˆ°äº†ä¸€äº›å›°æƒ‘ã€‚ æˆ‘æ‰€çœ‹çš„Linuxä¸Šçš„å‡ ä¸ªä¼˜ç§€å¼€æºé¡¹ç›®ä»£ç å‡ ä¹éƒ½æ˜¯Cè¯­è¨€å†™æˆï¼Œæ‰çŸ¥é“åŸæ¥å¹¶ä¸æ˜¯ä»»ä½•æ“ä½œéƒ½éœ€è¦ç”±ä¸€ä¸ªå¯¹è±¡å®Œæˆã€‚æ²¡æœ‰æ¨¡æ¿ï¼Œæ²¡æœ‰ç»§æ‰¿ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯çŸ­å°ç²¾æ‚çš„å‡½æ•°å¼Routineï¼Œç»“æ„ä½“åŠ ä¸Šè¿™äº›å‡½æ•°ä¹Ÿå¯ä»¥å¾ˆä¼˜é›…åœ°å®Œæˆè®¸å¤šåŠŸèƒ½ã€‚ä¸€ç§åŠŸèƒ½åœ¨ä¸åŒå¼€æºé¡¹ç›®ä¸­éƒ½æœ‰å„è‡ªçš„å®ç°ï¼Œæˆ–è®¸æœ€åˆé€‚è‡ªèº«é¡¹ç›®çš„å®ç°æ‰æ˜¯æœ€å¥½çš„åŠŸèƒ½å®ç°ã€‚é™¤äº†æ€§èƒ½ä¸Šçš„è€ƒè™‘ï¼Œæˆ‘åªèƒ½æƒ³åˆ°è¿™ç§è§£é‡Šäº†ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨C++ï¼Œä¸ç”¨OOPï¼Ÿ å¯èƒ½è¿™ä¸ªé—®é¢˜ä¸å‡†ç¡®ï¼Œç»“æ„ä½“çš„å®ä¾‹ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºâ€œå¯¹è±¡â€ï¼Œä¸è¿‡æˆ‘çš„æ„æ€æ˜¯ä¸ºä»€ä¹ˆä¸ç”¨OOPçš„ä¸€äº›æ€æƒ³ï¼Ÿæ¯”å¦‚å¤šæ€ï¼Œæ³›å‹ã€‚å¯èƒ½æœ‰ä¸€ç§ç­”æ¡ˆæ˜¯ï¼šâ€œLinuxæ ¹æœ¬ä¸éœ€è¦OOPâ€ã€‚æˆ–è®¸æ˜¯å› ä¸ºå—åˆ°Scott Meyersçš„å½±å“ï¼Œåœ¨è€ƒè™‘ä¸€ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘æ€»ä¼šç¬¬ä¸€ä¸ªæƒ³åˆ°æ˜¯ä»€ä¹ˆï¼Œå®Œæˆä»€ä¹ˆåŠŸèƒ½ï¼Œæœ€å®¹æ˜“é˜…è¯»å’Œç®€ç»ƒçš„è¡¨è¾¾åº”è¯¥æ˜¯æ€æ ·ï¼Ÿç„¶åå†åè¿‡æ¥æƒ³å¦‚ä½•ç”¨C++çš„å„ç§ç‰¹æ€§ä¼˜é›…åœ°å®ç°å®ƒã€‚ æ¯”å¦‚ï¼Œä¸€ä¸ªç®€å•çš„TCPServerï¼Œæˆ‘åªæƒ³è¦ï¼š 12TCPServer server;server.start(); å½“ç„¶ï¼Œè¿˜è¦æœ‰C++ç¨‹åºçŒ¿éƒ½å¿…é¡»è€ƒè™‘çš„é—®é¢˜ï¼Œå®é™…ä»£ç å¯èƒ½æ˜¯è¿™æ ·ï¼š 12345678910111213141516try&#123; shared_ptr&lt;Poco::Net::TCPServer&gt;; server; server= shared_ptr&lt;Poco::Net::TCPServer&gt;( new TCPServer(â€¦) ); server-&gt;start();&#125;catch(Poco::Exception &amp;amp; ex)&#123; â€¦&#125;catch(â€¦)&#123; â€¦&#125; è¿™æ ·ä¸ä¹Ÿæ˜¯å¾ˆå®¹æ˜“ç†è§£ä¹ˆï¼Ÿä½†æ˜¯å¦‚æœç”¨Cæ¥è¡¨è¾¾ï¼Œå¯èƒ½å°±å®Œå…¨æ˜¯ç›¸åçš„æ€ç»´è¿‡ç¨‹äº†ã€‚ é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹é£æ ¼è¦æ±‚ä½ è¦ä¸€æ­¥æ­¥æŠŠä¸€å¤§å †æ‰å †å¼çš„ä»£ç æ‘†ä¸Šå°é¢ï¼Œåˆå§‹åŒ–å¥—æ¥å­—ï¼Œç»‘å®šç«¯å£ï¼Œç›‘å¬ï¼Œå¾ªç¯â€¦â€¦ï¼Œç»™äººçš„æ„Ÿè§‰å¦‚æœè¦å®ç°æŸæ ·åŠŸèƒ½ï¼Œå°±å¿…é¡»æŒ‰ç…§è¿™ä¸ªå¥—è·¯å‡ºç‰Œï¼Œç¨‹åºç»“æ„ä¸Šæ²¡æœ‰å¤ªå¤šç¾æ„Ÿï¼Œæˆ‘æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ã€‚å› ä¸ºæˆ‘è§‰å¾—Cä»£ç çš„å¯é˜…è¯»æ€§è¿œä¸å¦‚C++ï¼Œè€ŒC++ä»£ç çš„å¯é˜…è¯»æ€§åˆè¿œä¸å¦‚é‚£äº›åŠ¨æ€è¯­è¨€ã€‚æœ‰æœ‹å‹è¯´C++è¿™é—¨è¯­è¨€ç”¨çš„äººä¼šå¾€ç²¾è‹±åŒ–æ–¹å‘å‘å±•ï¼Œçš„ç¡®ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ç§å¯èƒ½æ€§æ˜¯é€‰æ‹©å‘æ–°çš„æŠ€æœ¯ï¼ˆè¯­è¨€ï¼‰é æ‹¢ã€‚ ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹ä¸­è®¤ä¸ºç¼–ç¨‹è¯­è¨€çš„å‘å±•è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼Œå¯é˜…è¯»æ€§è¶Šæ¥è¶Šé«˜ï¼Œè¶Šæ¥è¶Šèƒ½è¢«æ™®é€šäººç†è§£ã€‚æˆ‘ä¹ŸèµåŒè¿™æ ·çš„æƒ³æ³•ã€‚è¿™è¿›åŒ–çš„èƒŒåæ˜¯æ€æƒ³åœ¨è¿›è¡Œæ€æ ·çš„å˜åŒ–ï¼Ÿæˆ‘ä¸æ’æ–¥è¿™æ ·çš„è¿›åŒ–ï¼Œå› ä¸ºæˆ‘çŸ¥é“è‡ªèº«å¤„åœ¨è¿™æ ·çš„å¤§æŠ€æœ¯é©å‘½æµªæ½®ä¸­ï¼Œä»»ä½•æ—¶å€™éƒ½è¦å‡†å¤‡å¥½æ¥è§¦æ–°äº‹ç‰©ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯è¦æ˜ç™½æŠ€æœ¯çš„å†å²ï¼Œå»ç†è§£ä¸ºä»€ä¹ˆè¦è¿™æ ·è¿›åŒ–,è¿›åŒ–çš„ä¸»å¹²ç‰ˆæœ¬åœ¨å“ªé‡Œã€‚ å—¯ï¼Œåæ§½å°±è¿™äº›~ PS.æœ‰ä¸€ç‚¹æˆ‘å¯ä»¥éå¸¸è‚¯å®šçš„æ˜¯ï¼šç¼–ç¨‹è¯­è¨€æ€»æ˜¯ç¨‹åºå‘˜ä»¬çƒ­çˆ±è®¨è®ºçš„é—®é¢˜ã€‚","categories":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"Unix/Linux","slug":"Unix-Linux","permalink":"https://unpluggedcoder.me/tags/Unix-Linux/"}]},{"title":"Jabberd 2 å“ˆå¸Œè¡¨è®¾è®¡(xhashæºç )","slug":"Jabberd 2 å“ˆå¸Œè¡¨è®¾è®¡(xhashæºç )","date":"2014-07-25T09:09:15.000Z","updated":"2022-09-15T15:51:05.344Z","comments":true,"path":"2014/07/25/Jabberd 2 å“ˆå¸Œè¡¨è®¾è®¡(xhashæºç )/","link":"","permalink":"https://unpluggedcoder.me/2014/07/25/Jabberd%202%20%E5%93%88%E5%B8%8C%E8%A1%A8%E8%AE%BE%E8%AE%A1(xhash%E6%BA%90%E7%A0%81)/","excerpt":"","text":"æ ¹æ®Andrew Binstock, â€œHashing Rehashed,â€ Dr. Dobbâ€™s Journal, April 1996. è¿™ä½è®ºæ–‡çš„ç®—æ³•ç”Ÿæˆä¸€ä¸ªå“ˆå¸Œå€¼, ä»¥è¯¥å€¼æ¥ç´¢å¼•å…¶åœ¨ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®.å› ä¸ºæ˜¯å®šé•¿å¹¶ä¸”é‡‡ç”¨é“¾åœ°å€æ³•å¤„ç†æ•£åˆ—å†²çª, æ‰€ä»¥å®ƒçš„å“ˆå¸Œè¡¨ç”¨æ•°ç»„çš„å½¢å¼è¡¨ç¤º(zen[â€¦]), æ¯ä¸ªæ•°ç»„å…ƒç´ åˆ†åˆ«ä»£è¡¨ä¸€ä¸ªå“ˆå¸Œæ¡¶çš„headèŠ‚ç‚¹(æ•´ä¸ªæ¡¶æ˜¯ç”±_xhnèŠ‚ç‚¹ç»„æˆçš„åŒå‘é“¾è¡¨æ„æˆ). ä¸»è¦çš„ä¸¤ä¸ªç»“æ„ä½“: 123456789101112131415161718192021typedef struct xhn_struct&#123; struct xhn_struct *next; struct xhn_struct *prev; const char *key; int keylen; void *val;&#125; *xhn, _xhn;typedef struct xht_struct&#123; pool_t p; int prime; int dirty; int count; struct xhn_struct *zen; struct xhn_struct *free_list; // list of zaped elements to be reused. int iter_bucket; xhn iter_node; int *stat;&#125; *xht, _xht; å‡ ä¸ªä¸»è¦çš„å‡½æ•°: 123456789101112131415161718static int _xhasher(const char *s, int len) // ç”Ÿæˆhashå€¼&#123; /* ELF hash uses unsigned chars and unsigned arithmetic for portability */ const unsigned char *name = (const unsigned char *)s; unsigned long h = 0, g; int i; for(i=0;i&lt;len;i++) &#123; /* do some fancy bitwanking on the string */ h = (h &lt;&lt; 4) + (unsigned long)(name[i]); if ((g = (h &amp; 0xF0000000UL))!=0) h ^= (g &gt;&gt; 24); h &amp;= ~g; &#125; return (int)h;&#125; static xhn _xhash_node_new(xht h, int index); è¿™ä¸ªå‡½æ•°è¿”å›åœ¨indexæŒ‡å®šçš„æ¡¶ä¸­è¦é™„åŠ ä¸€ä¸ªèŠ‚ç‚¹çš„ç¡®åˆ‡ä½ç½®.å¦‚æœä½äºzenæ•°ç»„çš„æ¡¶çš„é¦–èŠ‚ç‚¹ä¸ºç©º,åˆ™ç›´æ¥è¿”å›zen[index% h-&gt;prime];å¦åˆ™ä»free_listä¸­çœ‹æœ‰æ²¡æœ‰è¢«åˆ é™¤è¿‡çš„å¯ç”¨èŠ‚ç‚¹.æœ‰åˆ™ç›´æ¥å–å‡ºæ”¹ç‚¹,å¦åˆ™ä»å†…å­˜æ± é‡Œåˆ†é…ä¸€ä¸ª.ç„¶åå°†è¯¥èŠ‚ç‚¹æ”¾åœ¨æ¡¶çš„é¦–èŠ‚ç‚¹åé¢.ä»£ç æ³¨é‡Šä¸Šæœ‰è¯¯,è¯´æ˜¯æ¡¶çš„é¦–èŠ‚ç‚¹. 12345678910111213141516171819202122232425262728293031323334static xhn _xhash_node_new(xht h, int index)&#123; xhn n; int i = index % h-&gt;prime; /* track total */ h-&gt;count++;#ifdef XHASH_DEBUG h-&gt;stat[i]++;#endif // if the zen[i] is empty, reuse it, else get a new one. n = &amp;h-&gt;zen[i]; if( n-&gt;key != NULL ) &#123; if( h-&gt;free_list ) &#123; n = h-&gt;free_list; h-&gt;free_list = h-&gt;free_list-&gt;next; &#125;else n = pmalloco(h-&gt;p, sizeof(_xhn)); //add it to the bucket list head. n-&gt;prev = &amp;h-&gt;zen[i]; n-&gt;next = h-&gt;zen[i].next; if( n-&gt;next ) n-&gt;next-&gt;prev = n; h-&gt;zen[i].next = n; &#125; return n;&#125; static xhn _xhash_node_get(xht h, const char *key, int len, int index); è¿”å›ä¸€ä¸ªå®Œå…¨å»åˆçš„å“ˆå¸ŒèŠ‚ç‚¹. 123456789static xhn _xhash_node_get(xht h, const char *key, int len, int index)&#123; xhn n; int i = index % h-&gt;prime; for(n = &amp;h-&gt;zen[i]; n != NULL; n = n-&gt;next) if(n-&gt;key != NULL &amp;&amp; (n-&gt;keylen==len) &amp;&amp; (strncmp(key, n-&gt;key, len) == 0)) return n; return NULL;&#125; xht xhash_new(int prime); æ–°å»ºä¸€ä¸ªé¢„è®¾é•¿åº¦å“ˆå¸Œè¡¨ç»“æ„(_xht),ä¸»è¦çš„åˆ›å»ºå‡½æ•°. å…ˆåˆ›å»ºå†…å­˜æ± , ç”±è¯¥å†…å­˜æ± ç®¡ç†æ•´ä¸ªå“ˆå¸Œå¯¹è±¡. 1234567891011121314151617181920212223242526272829303132xht xhash_new(int prime)&#123; xht xnew; pool_t p;/* log_debug(ZONE,&quot;creating new hash table of size %d&quot;,prime); */ /** * NOTE: * all xhash&#x27;s memory should be allocated from the pool by using pmalloco()/pmallocx(), * so that the xhash_free() can just call pool_free() simply. */ p = pool_heap(sizeof(_xhn)*prime + sizeof(_xht)); xnew = pmalloco(p, sizeof(_xht)); xnew-&gt;prime = prime; xnew-&gt;p = p; xnew-&gt;zen = pmalloco(p, sizeof(_xhn)*prime); /* array of xhn size of prime */ xnew-&gt;free_list = NULL; xnew-&gt;iter_bucket = -1; xnew-&gt;iter_node = NULL;#ifdef XHASH_DEBUG xnew-&gt;stat = pmalloco(p, sizeof(int)*prime );#else xnew-&gt;stat = NULL;#endif return xnew;&#125; void xhash_put(xht h, const char *key, void *val);void xhash_putx(xht h, const char *key, int len, void *val); æ ¹æ®å…³é”®å­—keyçš„hashå€¼æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹.å¦‚æœkeyå·²å­˜åœ¨åˆ™ç›´æ¥å¤å†™. å¦‚æœä¸å­˜åœ¨åˆ™ç”¨ä¸Šé¢çš„**_xhash_node_new**è¿”å›èŠ‚ç‚¹ä½ç½®åå†™å…¥. 1234567891011121314151617181920212223242526272829303132333435363738void xhash_putx(xht h, const char *key, int len, void *val)&#123; int index; xhn n; if(h == NULL || key == NULL) return; index = _xhasher(key,len); /* dirty the xht */ h-&gt;dirty++; /* if existing key, replace it */ if((n = _xhash_node_get(h, key, len, index)) != NULL) &#123;/* log_debug(ZONE,&quot;replacing %s with new val %X&quot;,key,val); */ n-&gt;key = key; n-&gt;keylen = len; n-&gt;val = val; return; &#125;/* log_debug(ZONE,&quot;saving %s val %X&quot;,key,val); */ /* new node */ n = _xhash_node_new(h, index); n-&gt;key = key; n-&gt;keylen = len; n-&gt;val = val;&#125;void xhash_put(xht h, const char *key, void *val)&#123; if(h == NULL || key == NULL) return; xhash_putx(h,key,strlen(key),val);&#125; void xhash_zap_inner( xht h, xhn n, int index); å‰”é™¤ä¸€ä¸ªèŠ‚ç‚¹. å¦‚æœèŠ‚ç‚¹ä½äºzenæ•°ç»„çš„æ¡¶é¦–èŠ‚ç‚¹æˆ–è€…æ˜¯å½“å‰è¿­ä»£ä½ç½®èŠ‚ç‚¹åˆ™ç›´æ¥å†™NULLæ¥ä»£è¡¨åˆ é™¤, å¦åˆ™åŠ å…¥free_listçš„å¤´éƒ¨, æ¡¶é¦–èŠ‚ç‚¹ä¸èƒ½åŠ å…¥free_list. çœ‹å‡ºåœ¨è¿™ç‚¹åˆ é™¤ä¸Šæ˜¯å¯ä»¥å¿«é€Ÿåˆ é™¤çš„, è€Œä¸”, ç¬¬ä¸€æ¬¡æ’å…¥ä¹Ÿä¸éœ€è¦é‡æ–°åˆ†é…å†…å­˜, éå¸¸é«˜æ•ˆ. 12345678910111213141516171819202122232425262728void xhash_zap_inner( xht h, xhn n, int index)&#123; int i = index % h-&gt;prime; // if element:n is in bucket list and it&#x27;s not the current iter if( &amp;h-&gt;zen[i] != n &amp;&amp; h-&gt;iter_node != n ) &#123; if(n-&gt;prev) n-&gt;prev-&gt;next = n-&gt;next; if(n-&gt;next) n-&gt;next-&gt;prev = n-&gt;prev; // add it to the free_list head. n-&gt;prev = NULL; n-&gt;next = h-&gt;free_list; h-&gt;free_list = n; &#125; //empty the value. n-&gt;key = NULL; n-&gt;val = NULL; /* dirty the xht and track the total */ h-&gt;dirty++; h-&gt;count--;#ifdef XHASH_DEBUG h-&gt;stat[i]--;#endif&#125; void xhash_walk(xht h, xhash_walker w, void *arg); éå†æ‰€æœ‰æ¡¶çš„æ‰€æœ‰èŠ‚ç‚¹,å¹¶è°ƒç”¨å›è°ƒå‡½æ•°. 123456789101112131415void xhash_walk(xht h, xhash_walker w, void *arg)&#123; int i; xhn n; if(h == NULL || w == NULL) return;/* log_debug(ZONE,&quot;walking %X&quot;,h); */ for(i = 0; i &lt; h-&gt;prime; i++) for(n = &amp;h-&gt;zen[i]; n != NULL; n = n-&gt;next) if(n-&gt;key != NULL &amp;&amp; n-&gt;val != NULL) (*w)(n-&gt;key, n-&gt;keylen, n-&gt;val, arg);&#125; int xhash_iter_first(xht h); æŠŠè¿­ä»£ä½ç½®è®¾-1å,è°ƒç”¨ä¸€æ¬¡xhash_iter_next, æ¥è®©è¿­ä»£ä½ç½®resetåˆ°é¦–ä½. 123456789/** iteration */int xhash_iter_first(xht h) &#123; if(h == NULL) return 0; h-&gt;iter_bucket = -1; h-&gt;iter_node = NULL; return xhash_iter_next(h);&#125; int xhash_iter_next(xht h); è¿™ä¸ªå‡½æ•°ç›¸å¯¹æ¯”è¾ƒå¤æ‚,è®©è¿­ä»£å™¨æŒ‡å‘å½“å‰ä½ç½®ä¸‹ä¸€ä¸ªä¸ä¸ºç©ºçš„èŠ‚ç‚¹. 123456789101112131415161718192021222324252627282930313233//é¦–å…ˆåœ¨iter_nodeå½“å‰çš„æ¡¶é‡Œéå†, /* next in this bucket */ h-&gt;iter_node = h-&gt;iter_node ? h-&gt;iter_node-&gt;next : NULL; while(h-&gt;iter_node != NULL) &#123; xhn n = h-&gt;iter_node; if(n-&gt;key != NULL &amp;&amp; n-&gt;val != NULL) return 1; h-&gt;iter_node = n-&gt;next;// xhash_zap_inneré‡Œæœ‰è¯´åˆ°å¦‚æœæ˜¯å½“å‰è¿­ä»£å™¨ä½ç½®åˆ™ç›´æ¥ç½®keyä¸ºNULL,è€Œä¸åŠ å…¥free_list//è¿™ä¸ªnextå‡½æ•°å¦‚æœé‡åˆ°è¿™æ ·çš„èŠ‚ç‚¹ä¼šå°†å…¶åŠ å…¥free_listé‡Œ,ç›¸å½“äºæ¸…ç†æ¡¶çš„ä½œç”¨. if (n != &amp;h-&gt;zen[h-&gt;iter_bucket]) &#123; if(n-&gt;prev) n-&gt;prev-&gt;next = n-&gt;next; if(n-&gt;next) n-&gt;next-&gt;prev = n-&gt;prev; // add it to the free_list head. n-&gt;prev = NULL; n-&gt;next = h-&gt;free_list; h-&gt;free_list = n; &#125; &#125;//å¦‚æœéƒ½æ²¡æœ‰æ‰¾åˆ°,ä»åç»­çš„æ¡¶é‡Œé€ä¸ªè¿­ä»£ /* next bucket */ for(h-&gt;iter_bucket++; h-&gt;iter_bucket &lt; h-&gt;prime; h-&gt;iter_bucket++) &#123; h-&gt;iter_node = &amp;h-&gt;zen[h-&gt;iter_bucket]; while(h-&gt;iter_node != NULL) &#123; if(h-&gt;iter_node-&gt;key != NULL &amp;&amp; h-&gt;iter_node-&gt;val != NULL) return 1; h-&gt;iter_node = h-&gt;iter_node-&gt;next; // åœ¨åˆ«çš„æ¡¶é‡Œå°±æ²¡æœ‰æ¸…ç† &#125; &#125; å…¶å®ƒå‡½æ•°éƒ½ç®€å•æ˜“æ‡‚, ä¸è¿‡æœ‰ä¸ªdirtyå˜é‡, ç›®æµ‹æ˜¯ç”¨æ¥ç»Ÿè®¡å¯¹hashè¡¨çš„è®¿é—®(æ·»åŠ &#x2F;åˆ é™¤&#x2F;ä¿®æ”¹)æ¬¡æ•°. ä½¿ç”¨èŒƒä¾‹: 123// ä½¿ç”¨æ—¶keyå’Œvaléƒ½å¯ä»¥åœ¨poolä¸­åˆ†é….elem = pmalloco(xhash_pool(c-&gt;hash), sizeof(struct config_elem_st));xhash_put(c-&gt;hash, pstrdup(xhash_pool(c-&gt;hash), &quot;id&quot;), elem); æ€»ç»“: ä¼˜ç‚¹:æ•£åˆ—å€¼è®¡ç®—æ—¶é—´å¤æ‚åº¦O(n), æ¯ä¸ªä½ç½®çš„é¦–æ¬¡æ•£åˆ—é€Ÿåº¦å¿«, å†…å­˜çš„å¤ç”¨éƒ½å¾ˆç®€å•é«˜æ•ˆ.é“¾åœ°å€æ³•å¤„ç†æ•£åˆ—å†²çª, é€‚ç”¨äºå¤§å¤šç¨‹åº. å¦‚æœè¦è¯´ç¼ºç‚¹:æ•£åˆ—è¡¨é•¿å›ºå®š, æ•£åˆ—çš„æ€§èƒ½å–å†³äºåˆå§‹åŒ–è®¾å®šçš„è¡¨é•¿.å¦‚æœæœ‰ä¸¥æ ¼çš„æ€§èƒ½è¦æ±‚å¯ä»¥è€ƒè™‘ç”¨åŠ¨æ€hashè¡¨æ›¿æ¢.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"}]},{"title":"jabberd 2 å†…å­˜æ± æ¨¡å‹","slug":"jabberd 2 å†…å­˜æ± æ¨¡å‹","date":"2014-07-18T07:18:45.000Z","updated":"2022-09-15T15:51:05.351Z","comments":true,"path":"2014/07/18/jabberd 2 å†…å­˜æ± æ¨¡å‹/","link":"","permalink":"https://unpluggedcoder.me/2014/07/18/jabberd%202%20%E5%86%85%E5%AD%98%E6%B1%A0%E6%A8%A1%E5%9E%8B/","excerpt":"","text":"poolç»“æ„ä¸­çš„cleanupæŒ‡å‘pfreeé“¾è¡¨å¤´,cleanup_tailé¡¾åæ€ä¹‰æŒ‡å‘é“¾è¡¨æœ«å°¾. pool-&gt;sizeæ˜¯æ‰€æœ‰heapçš„sizeçš„æ€»å’Œ. pool-&gt;heapæŒ‡å‘å½“å‰çš„å †pheap pfreeæ˜¯ä¸€ä¸ªç”¨æ¥è¿½è¸ª(Tracker)æˆ–è€…è¯´ç´¢å¼•æ‰€æœ‰å·²åˆ†é…heapçš„é“¾è¡¨èŠ‚ç‚¹, pfreeä¸­åŒ…å«çš„å›è°ƒå‡½æ•°æŒ‡é’ˆè´Ÿè´£æ‰€æŒ‡heapçš„å®é™…é‡Šæ”¾. pheapåŒ…å«å·²åˆ†é…å†…å­˜å®ä½“ä¿¡æ¯. åˆ†é…è¿‡ç¨‹ **void *pmalloc(pool_t p, int size)**: å¦‚æœå½“å‰heapä¸ºåˆå§‹åŒ–æˆ–è€…(è¯·æ±‚åˆ†é…çš„size &gt; å½“å‰heap-&gt;size&#x2F;2), åˆ™ç›´æ¥é€šè¿‡_pool_freeåˆ›å»ºä¸€å—åŸå§‹å†…å­˜åŒºåŸŸ,ç”¨pfreeè®°å½•ä¸‹æ¥,å°±ç›´æ¥è¿”å›. å¦åˆ™: å…ˆè¿›è¡Œå†…å­˜å¯¹é½, ç„¶ååˆ¤æ–­å½“å‰heapé‡Œæ˜¯å¦æœ‰è¶³å¤Ÿçš„å‰©ä½™ç©ºé—´,æ²¡æœ‰åˆ™æ–°å»ºä¸€å—heapç„¶åæŒ‰å®é™…æŒ‡é’ˆä½ç½®è¿”å›å¯ç”¨å†…å­˜åŒºåŸŸ. é‡Šæ”¾è¿‡ç¨‹ void pool_free(pool_t p) éå†cleanupåˆ—è¡¨,é€ä¸ªé‡Šæ”¾pfree-&gt;pheapå’Œpfreeè‡ªèº«.æœ€åé‡Šæ”¾poolè‡ªèº«. å‡ ä¹ä¸ç”¨å†…å­˜æ± , åªçœ‹å‡ºè¿™äº›, è¯„ä»·:æ— ","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"}]},{"title":"ç”Ÿæˆå¯è°ƒè¯•çš„Releaseç‰ˆæœ¬äºŒè¿›åˆ¶æ–‡ä»¶--è°ƒè¯•ç¬¦å·ä¿¡æ¯æå–å’Œé™„åŠ è°ƒè¯•é“¾æ¥section","slug":"ç”Ÿæˆå¯è°ƒè¯•çš„Releaseç‰ˆæœ¬äºŒè¿›åˆ¶æ–‡ä»¶--è°ƒè¯•ç¬¦å·ä¿¡æ¯æå–å’Œé™„åŠ è°ƒè¯•é“¾æ¥section","date":"2014-04-24T06:05:03.000Z","updated":"2022-09-15T15:51:05.354Z","comments":true,"path":"2014/04/24/ç”Ÿæˆå¯è°ƒè¯•çš„Releaseç‰ˆæœ¬äºŒè¿›åˆ¶æ–‡ä»¶--è°ƒè¯•ç¬¦å·ä¿¡æ¯æå–å’Œé™„åŠ è°ƒè¯•é“¾æ¥section/","link":"","permalink":"https://unpluggedcoder.me/2014/04/24/%E7%94%9F%E6%88%90%E5%8F%AF%E8%B0%83%E8%AF%95%E7%9A%84Release%E7%89%88%E6%9C%AC%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6--%E8%B0%83%E8%AF%95%E7%AC%A6%E5%8F%B7%E4%BF%A1%E6%81%AF%E6%8F%90%E5%8F%96%E5%92%8C%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%95%E9%93%BE%E6%8E%A5section/","excerpt":"","text":"æœ¬æ–‡è®²çš„æ˜¯ä¸ç¼–è¯‘å®Œå…¨releaseçš„å¯æ‰§è¡Œæ–‡ä»¶,è€Œæ˜¯ä½¿ç”¨cmakeçš„RelWithDebugInfo(é™„åŠ è°ƒè¯•ä¿¡æ¯çš„ç¼–è¯‘,å®ƒçš„æ•ˆæœä¸‹é¢ä¼šè¯´æ˜)æˆ–è€…Debugç¼–è¯‘ä¹Ÿå¯ä»¥ç”Ÿæˆreleaseç‰ˆæœ¬çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œè°ƒè¯•. è¯¦ç»†çš„ cmake ä½¿ç”¨ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« é‡Œè®². è¿™é‡Œå…ˆè®°ä¸‹Debug, Release å’Œ RelWithDebugInfoçš„åŒºåˆ«(å¯¹æ¯”æˆ‘æ‰‹ä¸Šçš„gcc 4.8.2ç¼–è¯‘å‡ºçš„ä¸åŒç‰ˆæœ¬å¾—å‡ºçš„ç»“è®º) Debug ç­‰åŒäº -O0 -g ç¼–è¯‘é€‰é¡¹, ä¸ä¼˜åŒ–ä»£ç , é™„åŠ è°ƒè¯•ä¿¡æ¯ Release ç­‰åŒäº -O3 ç¼–è¯‘é€‰é¡¹, æœ€å¤§åŒ–ä¼˜åŒ–ä»£ç , ä½†ä¸åŒ…å«è°ƒè¯•ä¿¡æ¯ RelWithDebugInfo ç­‰åŒäº -O2 -g ç¼–è¯‘é€‰é¡¹, ä¸­ç­‰ç¨‹åº¦ä¼˜åŒ–ä»£ç , å¹¶ä¸”åŒ…å«è°ƒè¯•ä¿¡æ¯. å¯ä»¥è‡ªå®šä¹‰ä½¿ç”¨-O3 -g çš„ç¼–è¯‘é€‰é¡¹,æ¥ç”Ÿæˆæœ€æ¥è¿‘Releaseçš„ä»£ç (è‡³äº-ggdbçš„é€‰é¡¹,åŠ äº†ä»¥åäºŒè¿›åˆ¶åªå¤§äº†8ä¸ªå­—èŠ‚,ç›®æµ‹æ— æ‰€è°“) ä¸‹é¢çš„æ–¹æ³•åªå¯¹-gç¼–è¯‘æœ‰æ•ˆ,æ–¹æ³•æœ‰ä¸¤ç§. manæ‰‹å†Œé‡Œæ¨èçš„æ–¹æ³• objcopy â€“only-keep-debug foo foo.dbg æŠŠè°ƒè¯•ä¿¡æ¯(å³debug section)dumpåˆ°å•ç‹¬çš„æ–‡ä»¶é‡Œ. objcopy â€“strip-debug foo è¿™é‡Œåªå‰”é™¤è°ƒè¯•ä¿¡æ¯,ç¬¦å·ä¿¡æ¯ä»ä¿ç•™(ç”¨æˆ·ä¾ç„¶å¯ä»¥ç”¨nmæŸ¥çœ‹åˆ°å„ç§å‡½æ•°ç¬¦å·,æˆ‘æ¨èç”¨â€“strip-all,è¿åŒç¬¦å·ä¿¡æ¯ä¸€èµ·åˆ é™¤,ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ›´å°,ä¸å½±å“è°ƒè¯•) objcopy â€“add-gnu-debuglink&#x3D;foo.dbg foo ä¸ºfooæ·»åŠ .gnu-debuglink section, è¿™ä¸ªä¼šè®©äºŒè¿›åˆ¶å¢åŠ è¿‘100å­—èŠ‚çš„æ ·å­.è¿™æ ·åˆ†ç¦»äº†Debug Sectionå,å°±å¯ä»¥å•ç‹¬åˆ†å‘releaseç‰ˆæœ¬çš„foo,è°ƒè¯•æ—¶åªéœ€è®²foo.dbgæ”¾åœ¨å’ŒfooåŒä¸€ç›®å½•ä¸‹å³å¯ç›´æ¥gdb fooè¿›è¡Œè°ƒè¯•. å¦‚æœä¸å¸Œæœ›Releaseçš„æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«.gnu-debuglinkæ®µ,é‚£ä¹ˆå¯ä»¥ç›´æ¥çœç•¥ç¬¬ä¸‰æ­¥,ä¸”å½“æˆå¦ä¸€ç§æ–¹æ³•,æ–¹ä¾¿å™è¿°. åŒä¸€ strip foo è¿™ä¸ªæ•ˆæœç­‰åŒäºobjcopy â€“strip-all foo,å‰”é™¤æ‰€æœ‰ç¬¦å·å’Œè°ƒè¯•ä¿¡æ¯, å³ä¸ºreleaseç‰ˆæœ¬. æ–¹æ³•äºŒæ‰€ä¸åŒçš„è°ƒè¯•æ–¹æ³•æ˜¯éœ€å…ˆåŠ è½½dbgæ–‡ä»¶, gdb foo.dbg, ç„¶åattach(æˆ–è€…exec)åˆ°fooè¿›ç¨‹,è¿™æ ·ä¸è¦æ±‚.dbgå’Œæ‰§è¡Œç¨‹åºåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹,å¹¶ä¸”é€‚åˆè°ƒè¯•å·²ç»å¯åŠ¨çš„è¿›ç¨‹,ä¾‹å¦‚æœåŠ¡å™¨.","categories":[{"name":"Unix/Linux","slug":"Unix-Linux","permalink":"https://unpluggedcoder.me/categories/Unix-Linux/"}],"tags":[{"name":"GCC","slug":"GCC","permalink":"https://unpluggedcoder.me/tags/GCC/"}]},{"title":"C# ç”¨ä¿¡å·é‡é™åˆ¶(å­è¿›ç¨‹)å¹¶å‘æ‰§è¡Œæ•°é‡","slug":"C# ç”¨ä¿¡å·é‡é™åˆ¶(å­è¿›ç¨‹)å¹¶å‘æ‰§è¡Œæ•°é‡'","date":"2014-04-11T01:11:10.000Z","updated":"2022-09-15T15:51:05.342Z","comments":true,"path":"2014/04/11/C# ç”¨ä¿¡å·é‡é™åˆ¶(å­è¿›ç¨‹)å¹¶å‘æ‰§è¡Œæ•°é‡'/","link":"","permalink":"https://unpluggedcoder.me/2014/04/11/C#%20%E7%94%A8%E4%BF%A1%E5%8F%B7%E9%87%8F%E9%99%90%E5%88%B6(%E5%AD%90%E8%BF%9B%E7%A8%8B)%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C%E6%95%B0%E9%87%8F'/","excerpt":"","text":"ç®€å•çš„åˆ©ç”¨ä¿¡å·é‡æ¥æ§åˆ¶å­è¿›ç¨‹ä¸ªæ•°, åŒæ—¶åˆ©ç”¨Process.ExitCodeæ¥è®°å½•é”™è¯¯ä¿¡æ¯ ä»¥ä¸‹æ˜¯ class ProcHandler çš„å†…å®¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586private Queue _cmdQueue = new Queue (200);private Semaphore _semProc;private ProcessStartInfo _startInfo = new ProcessStartInfo (&quot;****.exe&quot;);public ProcHandler (int max)&#123; _semProc = new Semaphore( max, max ); _startInfo.CreateNoWindow = true; _startInfo.UseShellExecute = false; _startInfo.RedirectStandardError = true;&#125;public void AddTask( string cmd )&#123; _cmdQueue.Enqueue (cmd); // è¾“å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ— ++ _sum;&#125;public void ThreadProc()&#123; while (_cmdQueue .Count &amp;gt; 0) &#123; if (_semProc .WaitOne(2000)) // æœ€å¤§ç­‰å¾…2ç§’ &#123; string cmd = (string) _cmdQueue.Dequeue (); Console.WriteLine (cmd); ExecuteCmd(cmd); &#125; &#125;&#125;private void ExecuteCmd( string cmd )&#123; _startInfo.Arguments = cmd; Process copyProc = new Process(); copyProc.StartInfo = _startInfo; copyProc.EnableRaisingEvents = true; // å¿…é¡»è®¾true,æ‰ä¼šæœ‰Exitedäº‹ä»¶å“åº” copyProc.Exited += new EventHandler(OnExitProc ); copyProc .Start()&#125;/// è®°å½•å¤±è´¥çš„ä»»åŠ¡æ•°é‡å’Œä¿¡æ¯ ,å¢åŠ ä¿¡å·é‡private void OnExitProc( object sender , System. EventArgs e )&#123; Process proc = (Process) sender; if (proc .ExitCode != 0) &#123; string log = string. Format(&quot;[FAILED]--&#123;0&#125;\\n--------&#123;1&#125;&quot; , proc.StartInfo .Arguments, proc.StandardError .ReadToEnd()); Logger.Log (log); &#125; _semProc.Release ();&#125; å¤–éƒ¨è°ƒç”¨: 123456foreach( .... in ****) prochandler -&amp;gt;AddTask(strcmd);Thread Workthread = new Thread(new ThreadStart(procHandler.ThreadProc));Workthread.Start();","categories":[{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/categories/Windows/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://unpluggedcoder.me/tags/C/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://unpluggedcoder.me/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"Minions from Despicable Me","slug":"minions-from-despicable-me","date":"2013-11-18T08:56:38.000Z","updated":"2022-09-15T15:51:05.351Z","comments":true,"path":"2013/11/18/minions-from-despicable-me/","link":"","permalink":"https://unpluggedcoder.me/2013/11/18/minions-from-despicable-me/","excerpt":"","text":"","categories":[{"name":"æ¶‚é¸¦","slug":"æ¶‚é¸¦","permalink":"https://unpluggedcoder.me/categories/%E6%B6%82%E9%B8%A6/"}],"tags":[{"name":"ç´ æ","slug":"ç´ æ","permalink":"https://unpluggedcoder.me/tags/%E7%B4%A0%E6%8F%8F/"}]},{"title":"Finished a painting of lion","slug":"finished-a-painting-of-lion","date":"2013-11-01T14:03:57.000Z","updated":"2022-09-20T15:52:08.880Z","comments":true,"path":"2013/11/01/finished-a-painting-of-lion/","link":"","permalink":"https://unpluggedcoder.me/2013/11/01/finished-a-painting-of-lion/","excerpt":"Just finish this paint, still learning details paint skill.","text":"Just finish this paint, still learning details paint skill.","categories":[{"name":"æ¶‚é¸¦","slug":"æ¶‚é¸¦","permalink":"https://unpluggedcoder.me/categories/%E6%B6%82%E9%B8%A6/"}],"tags":[{"name":"ç´ æ","slug":"ç´ æ","permalink":"https://unpluggedcoder.me/tags/%E7%B4%A0%E6%8F%8F/"}]},{"title":"æ¨±æœ¨èŠ±é“ - Sakuragi Hanamichi","slug":"sakuragi-hanamichi","date":"2013-09-18T02:22:28.000Z","updated":"2022-09-15T15:51:05.351Z","comments":true,"path":"2013/09/18/sakuragi-hanamichi/","link":"","permalink":"https://unpluggedcoder.me/2013/09/18/sakuragi-hanamichi/","excerpt":"","text":"","categories":[{"name":"æ¶‚é¸¦","slug":"æ¶‚é¸¦","permalink":"https://unpluggedcoder.me/categories/%E6%B6%82%E9%B8%A6/"}],"tags":[{"name":"ç´ æ","slug":"ç´ æ","permalink":"https://unpluggedcoder.me/tags/%E7%B4%A0%E6%8F%8F/"}]},{"title":"ç¬¬ä¸€æ¬¡å°è¯•","slug":"ç¬¬ä¸€æ¬¡å°è¯•","date":"2013-09-02T09:07:36.000Z","updated":"2022-09-20T15:52:38.875Z","comments":true,"path":"2013/09/02/ç¬¬ä¸€æ¬¡å°è¯•/","link":"","permalink":"https://unpluggedcoder.me/2013/09/02/%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/","excerpt":"","text":"æ¢ä¸ªè§’åº¦çœ‹å°±å˜å½¢äº†â€¦","categories":[{"name":"æ¶‚é¸¦","slug":"æ¶‚é¸¦","permalink":"https://unpluggedcoder.me/categories/%E6%B6%82%E9%B8%A6/"}],"tags":[{"name":"ç´ æ","slug":"ç´ æ","permalink":"https://unpluggedcoder.me/tags/%E7%B4%A0%E6%8F%8F/"}]},{"title":"ä»ä¸€åæ™®é€šå¼€å‘è€…è§’åº¦çœ‹ï¼šä¸ºä»€ä¹ˆSurface RT/Proä¼šå¤±è´¥ï¼Ÿ","slug":"ä»ä¸€åæ™®é€šå¼€å‘è€…è§’åº¦çœ‹ï¼šä¸ºä»€ä¹ˆSurface RT:Proä¼šå¤±è´¥ï¼Ÿ","date":"2013-07-22T16:08:18.000Z","updated":"2022-09-15T15:51:05.352Z","comments":true,"path":"2013/07/23/ä»ä¸€åæ™®é€šå¼€å‘è€…è§’åº¦çœ‹ï¼šä¸ºä»€ä¹ˆSurface RT:Proä¼šå¤±è´¥ï¼Ÿ/","link":"","permalink":"https://unpluggedcoder.me/2013/07/23/%E4%BB%8E%E4%B8%80%E5%90%8D%E6%99%AE%E9%80%9A%E5%BC%80%E5%8F%91%E8%80%85%E8%A7%92%E5%BA%A6%E7%9C%8B%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88Surface%20RT:Pro%E4%BC%9A%E5%A4%B1%E8%B4%A5%EF%BC%9F/","excerpt":"","text":"æœ€è¿‘å¾ˆå¤šITèµ„è®¯è®ºå›éƒ½æœ‰å‘è¡¨å¯¹å¾®è½¯çš„Windows 8çš„Surface RT&#x2F;Proç³»åˆ—äº§å“å¤±è´¥åˆ†æçš„æ–‡ç« ã€‚è€Œæœ¬æ–‡åˆ™æ˜¯ä»ä¸€åæ™®é€šå¼€å‘è€…çš„è§’åº¦çœ‹å¾®è½¯Surfaceäº§å“çº¿æºƒè´¥çš„åŸå› ã€‚ ç¬”è€…è‡ªèº«æ›¾ç»åªæ˜¯ä¸€åæ™®é€šçš„Windows 8å¼€å‘è€…ï¼Œæ‰€æ¶‰åŠçš„å†…å®¹å¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ã€‚ çœ‹åˆ°å¾ˆå¤šè®ºå›éƒ½æŠŠSurfaceç³»åˆ—äº§å“å¤±è´¥çš„åŸå› å½’å’äºå…¶é”™è¯¯çš„äº§å“å®šä½ï¼Œå…¶å®å›é¡¾ä¸‹Windows 8å‘å¸ƒå‰çš„ä¸€äº›æ–‡ç« æŠ¥é“å…¶å®å¤§éƒ¨åˆ†éƒ½æ˜¯æ­£é¢çš„æ€åº¦ã€‚ä»Windows 8 Developer Previewåˆ°Release Previewæœ‰å¾ˆå¤šæ–°é¢–çš„ç‰¹æ€§ï¼Œå…¶ä¸­å°±åŒ…æ‹¬Metroé£æ ¼ç•Œé¢ï¼Œé‚£æ—¶å€™éƒ½åŒ…æ‹¬æˆ‘åœ¨å†…çš„å¾ˆå¤šå¼€å‘è€…éƒ½å¾ˆçœ‹å¥½Windows 8ã€‚è€Œæˆ‘ä»¬æ°æ°å°±æ˜¯é‚£â€å¤§éƒ¨åˆ†â€äººï¼Œå¯¹äº§å“çœ‹ä¸åˆ°æ›´è¿œã€‚åœ¨å¼€å‘æ—¶ï¼Œä½œä¸ºå¼€å‘è€…å¾ˆæ—©å°±å¯ä»¥æ‹¿åˆ°å¾®è½¯çš„äº§å“åŸå‹ï¼Œç¬¬ä¸€æ¬¡æŠŠWindows 8 Proå¹³æ¿æ‹¿åœ¨æ‰‹é‡Œï¼Œå°±è§‰å¾—å¾ˆä¸å¯æ€è®®ï¼Œè§‰å¾—è¿™ä¼šæ˜¯ä¸ªé¢ è¦†æ€§çš„äº§å“ï¼Œå› ä¸ºåœ¨å°å°çš„å¹³æ¿ä¸Šæœ‰ç€å’ŒPCä¸€æ ·çš„æ¡Œé¢ç¯å¢ƒï¼Œæƒ³è±¡PCä¸Šæœ‰é‚£ä¹ˆå¤šç»™åŠ›çš„æ¸¸æˆï¼Œè¦æ˜¯èƒ½éšæ—¶éšåœ°åœ¨å¹³æ¿ä¸Šç©èµ·æ¥å²‚ä¸â€¦â€¦ä½†æ˜¯å½“æˆ‘åœ¨å¹³æ¿ä¸Šæ‰“å¼€ä¸€ä¸ªæ¡Œé¢æ¸¸æˆæ—¶ï¼Œæˆ‘æ„Ÿè§‰åˆ°äº†ä»€ä¹ˆï¼Œæ²¡æœ‰é”®ç›˜ã€é¼ æ ‡â€¦â€¦é‚£æ—¶å¹¶æ²¡æœ‰æƒ³åˆ°è¿™ç«Ÿæˆä¸ºWindows 8æœ€å¤±è´¥çš„äº§å“å®šä½ï¼šPCå¹³æ¿ã€‚ç”¨æˆ·ä½¿ç”¨å¹³æ¿æ—¶æ ¹æœ¬ä¸åº”è¯¥è€ƒè™‘å»æ‰¾ä¸ªé”®ç›˜é¼ æ ‡æ¥æ­é…ã€‚æ‰€ä»¥å‘¢ï¼Œç»“æœå°±å¯¼è‡´äº†å¾®è½¯Surfaceå¹¿å‘Šä¸ŠæåŠ›æ¨å´‡çš„é‚£ä¸ªé”®ç›˜ã€‚ä½†ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘è®¤ä¸ºWindows 8å¦‚æœä½œä¸ºä¸€ä¸ªæ–°çš„æ¡Œé¢æ“ä½œç³»ç»Ÿçš„ç¡®è¿˜æ˜¯å¾ˆä¼˜ç§€çš„ï¼Œæ¯”Windows 7å¥½äº†å¾ˆå¤šã€‚è‡³äºå¾ˆå¤šäººæŠ±æ€¨çš„å¼€å§‹èœå•ï¼Œæˆ‘æ— æ‰€è°“ã€‚ä»·æ ¼æ–¹é¢ï¼Œå¾®è½¯æœ¬èº«å°±æ˜¯ç§»åŠ¨å¹³å°çš„æ–°å…¥é—¨ç©å®¶ï¼Œè„šè·Ÿéƒ½æ²¡ç«™ç¨³ï¼Œå°±æƒ³ç€èµšé’±ï¼Œå¤§éƒ¨åˆ†å›½å†…å‚å•†çš„æ–¹æ³•æ˜¯é€‰æ‹©ç”¨ä½å»‰çš„ä»·æ ¼æ¥è®©ç”¨æˆ·ç†Ÿæ‚‰ä½ çš„äº§å“ï¼Œå› ä¸ºç”¨æˆ·ä¸ä¼šä¸ºä¸€ä¸ªä»–ä»¬å¹¶ä¸æ¸…æ¥šæœ‰ä»»ä½•å®é™…ä¼˜ç‚¹çš„ä¸œè¥¿æ”¯ä»˜é«˜æ˜‚çš„ä»·æ ¼ï¼Œè¯ºåŸºäºšä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä»Lumia 920ä¸Šå¸‚çš„4500å”®ä»·åˆ°ç›®å‰è¿‘ä¹æ–©è…°çš„ä»·æ ¼å°±å¾ˆæ˜æ˜¾äº†ã€‚ &amp;nbsp; é™¤äº†äº§å“å®šä½ï¼Œåœ¨æˆ‘çœ‹æ¥æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å› ç´ æ˜¯å¾®è½¯çš„æŠ€æœ¯æ–‡åŒ–ï¼Œ APIå¼å­¦ä¹ å’Œâ€å‡¡äº‹çš†æœ‰æˆ‘çš„è§„åˆ™ï¼ˆMicrosoft&#96;s rulesï¼‰â€œã€‚ä»æ“ä½œç³»ç»Ÿåˆ°Officeï¼Œå¾®è½¯æœ‰å¾ˆå¤šè‡ªå®¶çš„ä¸œè¥¿ï¼Œç”¨è‡ªå·±çš„æ ¸å¿ƒæŠ€æœ¯æ­å»ºèµ·æ¥äº†è‡ªå·±çš„è½¯ä»¶ç‹å›½ã€‚å‡å¦‚ä¸€ç§æŠ€æœ¯è¯ç”Ÿäºå¼€æºç¤¾åŒºï¼Œè€Œåœ¨å¾®è½¯çš„è¯å…¸ä¸­æ‰¾ä¸åˆ°çš„è¯ï¼Œå¾®è½¯ä¼šç«‹åˆ»å­¦ä¹ ï¼Œå¹¶ä¸”ç»“åˆè‡ªèº«çš„æŠ€æœ¯ç§¯æ·€åˆ›é€ å‡ºä¸€ä¸ªå…¨æ–°çš„æ ‡å‡†ï¼ˆè¿™ç‚¹å’Œå›½å†…çš„ä¼é¹…æ˜¯å®Œå…¨ä¸åŒçš„ï¼‰ï¼Œæä¾›æ›´ç®€å•çš„APIå’Œæ¥å£ï¼Œè®©å¼€å‘è€…æ›´å®¹æ˜“å­¦ä¼šå’Œä½¿ç”¨ã€‚ä½†ä¹Ÿæ­£æ˜¯è¿™æ ·è‡ªæˆ‘çš„è½¯ä»¶ç‹å›½æˆ–è®¸ä¼šæ¯äº†å¾®è½¯ï¼Œå› ä¸ºä¸–ç•Œä¸Šå¤§éƒ¨åˆ†Coderä¸å–œæ¬¢è¿™æ ·APIå¼å­¦ä¹ ï¼ˆä¾‹å¦‚å¼€æºç¤¾åŒºï¼‰ã€‚åœ¨Windows 8ä¸­å¾®è½¯é™¤äº†æ”¯æŒè‡ªå·±çš„å„¿å­C#å¤–è¿˜æ¨å‡ºäº†æ–°çš„å¹²å„¿å­è¯­è¨€çš„C++&#x2F;CXï¼Œåè€…æ˜¯ç»§C++&#x2F;CLIåçš„åˆä¸€ä¸ªC++æ‰©å±•ï¼Œæˆ–è€…å¯ä»¥ç†è§£ä¸ºC++å˜ç§ï¼Œæ²¡é”™ï¼Œè¿™ç§å˜ç§è¯­è¨€ç”±æ ‡å‡†C++æ‰©å±•è€Œæ¥ï¼Œåªèƒ½é å¾®è½¯æ”¯æŒå¹¶åœ¨Windows 8æ–°ç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œå­¦äº†å®ƒä»¥åä½ ä¸ä¼šå†æ„Ÿè§‰åˆ°è‡ªå·±æ†”æ‚´äº†ï¼Œç›¸åä¼šè§‰å¾—è‡ªå·±æ›´å¹´è½»ï¼Œæ›´åƒbabyäº†ï¼ˆå› ä¸ºæ›´ç®€å•äº†ï¼‰ï¼Œè€Œä¸”ä½ å¿ƒé‡Œå¾ˆæ¸…æ¥šï¼Œè‡ªå·±çš„ä¸‹ä¸€ä»½å·¥ä½œå…«æˆè¿˜ä¼šå’Œå¾®è½¯æ‰“äº¤é“ã€‚åœ¨æ–°çš„C++&#x2F;CXè¯­æ³•å­¦ä¹ ä¸­ï¼ŒæŒ‰ç…§MSDNæ•²å‡ºäº†ä»£ç ï¼Œæ©ï¼Œå¾ˆå¥½ï¼Œè¿è¡Œèµ·æ¥äº†ï¼Œç•Œé¢å¾ˆæ¼‚äº®ï¼Œå¾ˆå¤§çš„æˆå°±æ„Ÿï¼Œçªç„¶é—´ç¨‹åºæŒ‚æ‰ï¼Œè¿™æ—¶å€™ä½ æœ‰ä¸‰ç§é€‰æ‹©ï¼šä¸€ã€åˆ°MSDNè®ºå›æˆ–è€…å…¶å®ƒå¼€å‘è€…ç¤¾åŒºè®¨è®ºï¼Œä»–ä»¬ç»™å‡ºçš„å›ç­”é€šå¸¸ç±»ä¼¼äºï¼šä½ ç…§ç€ä¸‹é¢çš„ä»£ç æ•²è¯•è¯•ï¼Ÿçœ‹çœ‹MSDNä½ å°±çŸ¥é“äº†ï¼ é€šå¸¸ç¬¬ä¸€ç§é€‰æ‹©çš„ç»“æœä¼šç›´æ¥å¯¼è‡´ç¬¬äºŒç§é€‰æ‹©ï¼šçœ‹æ›´å¤šçš„MSDNæ–‡æ¡£æ¥å¯»æ‰¾è§£å†³æ–¹æ³•ã€‚æˆ‘é€‰æ‹©äº†ç¬¬ä¸‰ç§ï¼šæ”¾å¼ƒè¿™æ ·çš„å­¦ä¹ ã€‚å¯¹å¼€å‘è€…è€Œè¨€è¿™ç§APIå¼å­¦ä¹ çš„èƒŒåæ˜¯å·¨å¤§çš„å­¦ä¹ æˆæœ¬ï¼Œæ¯•ç«Ÿä¸æ˜¯æ‰€æœ‰å¼€å‘è€…éƒ½æ˜¯å¾®è½¯MVPï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šäººä¼šç†è§£è¿™äº›APIèƒŒåçš„æ ¸å¿ƒæŠ€æœ¯ï¼ŒWindows 8çš„å¼€å‘è€…åœ¨å…¥é—¨æ—¶åšå¾—æœ€å¤šçš„ä¸€ä»¶äº‹åº”è¯¥å°±æ˜¯åœ¨ç”¨æœ‰é™çš„ç²¾åŠ›æµè§ˆæ— é™çš„MSDNæ–‡æ¡£ï¼Œå½“å¾®è½¯æ›´æ¢äº†èŠ‚å¥ï¼ˆè¢«æ›¿ä»£çš„C++&#x2F;CLIä¾¿æ˜¯å¦‚æ­¤ï¼‰ä½ åªæœ‰ä»å¤´æ¥è¿‡ã€‚è€Œä»è½¯ä»¶å…¬å¸çš„è§’åº¦æ¥è¯´ï¼Œè¿™æ ·çš„API Coderæ²¡æœ‰å¤šå¤§ä»·å€¼ï¼Œä»–ä»¬éœ€è¦çš„ä»…ä»…æ˜¯æœ‰ä¸ªäººæŒ‰ç…§MSDNæ–‡æ¡£ä¸Šçš„æ¥å£æ¥æŠŠä»£ç ç»„è£…èµ·æ¥ï¼Œä½ ä¸å¹²ï¼Œæ€»ä¼šæ‰¾å¾—åˆ°äººæ¥åšã€‚ä½œä¸ºä¸€ä¸ªæœ‰ä»·å€¼çš„Programmerï¼Œæƒ³æŒæ¡æ’åºæŸ¥æ‰¾åŠ å¯†ç®—æ³•ã€èµ„æºè°ƒåº¦ã€APIè®¾è®¡ï¼ŸæŠ±æ­‰ï¼ŒMSDNæ–‡æ¡£é‡Œæ²¡æœ‰ã€‚ &amp;nbsp; APIå’Œæ¥å£å­¦ä¹ çš„èƒŒåæ˜¯å¾®è½¯çš„æ¸¸æˆè§„åˆ™ï¼Œå¾®è½¯çš„ç¡®åœ¨æŠŠå¤æ‚çš„æŠ€æœ¯ç®€å•åŒ–ï¼Œä¹Ÿæ›¾ç»åˆ›é€ å‡ºäº†å¾ˆå¤šç»å…¸çš„æŠ€æœ¯æ¦‚å¿µï¼ˆæ¯”å¦‚MFCçš„RTTIåˆ©ç”¨å’Œæ¶ˆæ¯å¾ªç¯ã€COMï¼‰ã€‚ä½†æ˜¯è¶Šæ¥è¶Šå¤šçš„è§„åˆ™å¼€å§‹æš´éœ²äº†ä¸€ä¸ªç›®çš„ï¼šå·©å›ºè‡ªå·±çš„ç‹å›½ã€‚æ¸æ¸åœ°å¼€å§‹æŠŠæŠ€æœ¯ç»†èŠ‚éšè—ï¼Œé™ä½å¯¹å¼€å‘è€…çš„æ™ºå•†è¦æ±‚ï¼Œä»è€Œå¸å¼•åˆ°æ›´å¤šçš„å¼€å‘è€…ï¼ˆå½“æˆ‘çœ‹åˆ°æŠ€æœ¯ç¾¤é‡Œè¶Šæ¥è¶Šå¤šçš„å¤§å­¦ç”Ÿç”šè‡³æ˜¯ä¸­å­¦ç”Ÿåœ¨å­¦ä¹ è¿™ä¸ªï¼Œå¿ƒé‡Œéƒ½è§‰å¾—å¯æƒœäº†ï¼Œè‡ªèº«å…´è¶£çˆ±å¥½ä¹Ÿç½¢ï¼Œå±…ç„¶æœ‰é«˜æ ¡æŠŠå¼€å‘Win 8 Appä½œä¸ºè®ºæ–‡è¾¾æ ‡æ ‡å‡†ï¼‰ã€‚ç¬”è€…è‡ªèº«åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å°±å¾—æ— æ—¶æ— åˆ»å¹¶ä¸”æ— æ•°æ¬¡åœ°éµå¾ªç€å¾®è½¯çš„æ¸¸æˆè§„åˆ™ã€‚Windows 8 çš„Metro APIä¸­é™åˆ¶ä½¿ç”¨Win32 Native APIï¼ˆå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥ç†è§£ï¼Œå¬è¯´å¾®è½¯æ­£åœ¨æ…¢æ…¢å¼€æ”¾ä¸€éƒ¨åˆ†Native APIï¼‰ï¼Œä¹‹å‰çš„Windowså¼€å‘ç»éªŒå…¨éƒ¨æŠ¥åºŸï¼Œå…¬å¸ç§¯ç´¯çš„ä»£ç å¤§éƒ¨åˆ†éƒ½è¦é‡å†™ã€‚ç®—äº†ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å§ï¼Œç»“æœåº”ç”¨å•†åº—æäº¤æ—¶æ£€æµ‹åˆ°ä½ çš„ä»£ç ä¸­åŒ…å«â€å¼‚ç±»â€çš„APIï¼Œä¸ç»™äºˆé€šè¿‡ã€‚è¡Œï¼ŒæŒ‰ç…§ç¤ºä¾‹ä»£ç å®ç°äº†éƒ¨åˆ†åŠŸèƒ½ï¼Œç„¶è€Œæƒ³å®ç°è¿›ä¸€æ­¥åŠŸèƒ½æ—¶å‚è€ƒäº†å…¶å®ƒç¤ºä¾‹ä»£ç ï¼ˆåˆ«è¯´ä½ åˆå­¦çš„æ—¶å€™ä¸æ˜¯è¿™æ ·çš„ï¼‰ï¼Œç»“æœæ‹¼æ¥åœ¨ä¸€èµ·è¿è¡Œï¼Œå¥½äº†ï¼ŒæŒ‚äº†ï¼Œç¨‹åºçš„å †æ ˆæ˜¾ç¤ºä¸­æ–­åœ¨Nä¸ªè«åå…¶å¦™çš„dllä¸­ï¼Œé™¤äº†å°‘æ•°å‡ ç§å¼‚å¸¸Bugå¯ä»¥æ•æ‰ï¼ˆå¤§å¤šæ•°å¼€å‘è€…é‚£æ—¶å€™å¹¶ä¸çŸ¥é“è¿™äº›æ–¹æ³•ï¼Œå› ä¸ºä¸åœ¨MSDNä¸­ï¼‰å¤–ä½ åªèƒ½å¹²çªçœ¼ï¼Œå¿ƒé‡Œé»˜é»˜åœ°å¿µä¸€å¥â€è‰¹â€ï¼Œç„¶ååœ¨å…¶å®ƒçš„ç¤ºä¾‹ä»£ç ä¸­å¯»æ‰¾å¯æ›¿ä»£çš„æ–¹æ¡ˆï¼Œæ— è®ºæœ€ç»ˆçš„æ–¹æ¡ˆè¿è¡Œæ•ˆç‡å¦‚ä½•ï¼Œæ­¤æ—¶æ­¤åˆ»ä½ å¿ƒé‡Œæƒ³è¦çš„åªæ˜¯å¯ä»¥è¿è¡Œèµ·æ¥çš„ä»£ç ï¼Œæ ¹æœ¬ä¸ä¼šè€ƒè™‘åˆ«çš„é—®é¢˜ã€‚ç„¶è€Œä½ è¿˜æ²¡æœ‰è€ƒè™‘ç”¨æˆ·å®é™…æ“ä½œä¸‹çš„å¯èƒ½è¡Œä¸ºï¼ˆå¾®è½¯æå‡ºåå°æŒ‚èµ·æ¦‚å¿µå…¶å®ä¹Ÿå¹¶ä¸æ–°é²œï¼Œä½†æ˜¯é¥±å—è¯Ÿç—…ï¼Œå½“æ—¶æˆ‘éšæ„ä»åº”ç”¨å•†åº—ä¸‹è½½äº†å‡ ä¸ªAppï¼Œéšæ„åœ°å¤æ‚æ“ä½œå‡ ä¸‹ï¼Œæ¯ä¸ªå¿…é—ªé€€ã€‚å†çœ‹çœ‹Windowsåº”ç”¨å•†åº—é‡ŒWin 8 ç‰ˆQQçš„è¯„è®ºå°±çŸ¥é“äº†ï¼Œè¿è…¾è®¯è¿™æ ·çš„å¤§å…¬å¸å†™äº†å‡ ä¸ªç‰ˆæœ¬çš„Win 8 QQéƒ½æ— æ³•æ”¹å˜å®ƒçš„å¼‚å¸¸é—ªé€€ï¼Œæ›´ä½•å†µä¸ºè¿™äº›é—®é¢˜æŒ£æ‰çš„ä½ ï¼‰ã€‚å¥½äº†ï¼Œæ­¤æ—¶æ­¤åˆ»ç¬”è€…å·²ç»æ”¹å®Œäº†æ‰€æœ‰çš„Bugï¼Œåœ¨ä½ æœ¬æœºä¸Šè¿è¡Œä¸€åˆ‡æ­£å¸¸ï¼Œåœ¨å¹³æ¿æ ·æœºä¸Šä¹ŸOKäº†ï¼Œæäº¤åˆ°åº”ç”¨å•†åº—ï¼Œç»“æœè¢«æ‹’ç»äº†ï¼Œç†ç”±æ˜¯åº”ç”¨åŠ è½½æ—¶é—´å–å†³ä¸å½“å‰çš„ç½‘ç»œç¯å¢ƒï¼Œæ±—ï¼ŒWindows Storeå•†åº—åº”ç”¨è‡ªèº«å¯åŠ¨æ—¶é—´ç”šè‡³æ¯”æˆ‘çš„åº”ç”¨è¿˜æ…¢ï¼Œè€Œä¸”ç»å¸¸æ— æ³•åŠ è½½ä¹Ÿæ˜¯å…¬è®¤çš„ã€‚æœ€åï¼Œå½»åº•æ”¾å¼ƒäº†ã€‚æ°´å¹³æœ‰é™ï¼Œæ— æ³•é¢†æ‚ŸMSDNçš„å¼ºå¤§ã€‚ &amp;nbsp; é”™è¯¯çš„äº§å“å®šä½ã€é«˜æ˜‚çš„APIå­¦ä¹ æˆæœ¬ã€å„ç§APIé™åˆ¶äºä¸€èº«ã€æ•´ä¸ªå¼€å‘è¿‡ç¨‹å‡ ä¹æ˜¯å…¨æ–°å¼€å‘ï¼Œæ²¡æœ‰å¤šå°‘é‡ç”¨çš„æ¦‚å¿µï¼ˆè¿™ç‚¹è¿˜æ˜¯å¯ä»¥ç†è§£ï¼Œæ¯•ç«Ÿæ˜¯ä¸€ä¸ªæ–°çš„å¹³å°ï¼‰ã€æ— å˜å¤´çš„å¼‚å¸¸å’Œé—ªé€€ï¼ˆå¦‚æœè¯´Win8ä¹‹çˆ¶å²è’‚å¤« è¾›è¯ºå¤«æ–¯åŸºå› ä¸ºæ˜¯åå¹³åŒ–UIè®¾è®¡è€Œè¢«ç‚’é±¿é±¼çš„è¯ï¼Œé‚£ä¹ˆé€ æˆAppå¼‚å¸¸é—ªé€€çš„æ¶æ„å¸ˆå°±åº”è¯¥å€’æ‰£å·¥èµ„äº†ï¼‰è¿™äº›å› ç´ æ— è®ºå®ƒä»¬å„å å¤šå°‘è½»é‡ï¼Œæ€»ä¹‹åŠ èµ·æ¥å°±æ˜¯Surfaceç³»åˆ—äº§å“å¤±è´¥çš„å…¨éƒ¨ï¼Œè‡³å°‘ä½œä¸ºä¸€ä¸ªæ™®é€šçš„å¼€å‘è€…ï¼Œæˆ‘æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ã€‚","categories":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/tags/Windows/"}]},{"title":"å¼‚å¸¸å®‰å…¨ä¸å¼‚å¸¸ç‹¬ç«‹","slug":"å¼‚å¸¸å®‰å…¨ä¸å¼‚å¸¸ç‹¬ç«‹","date":"2013-07-18T07:21:58.000Z","updated":"2022-09-15T15:51:05.353Z","comments":true,"path":"2013/07/18/å¼‚å¸¸å®‰å…¨ä¸å¼‚å¸¸ç‹¬ç«‹/","link":"","permalink":"https://unpluggedcoder.me/2013/07/18/%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E4%B8%8E%E5%BC%82%E5%B8%B8%E7%8B%AC%E7%AB%8B/","excerpt":"","text":"ã€ŠExceptional C++ã€‹é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªæ¦‚å¿µï¼Œå¼‚å¸¸å®‰å…¨å’Œå¼‚å¸¸ç‹¬ç«‹ã€‚ å¼‚å¸¸å®‰å…¨æ˜¯æŒ‡åœ¨å‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹èƒ½å¤Ÿæ•æ‰å¹¶å¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”å¼‚å¸¸å‰åå¯¹è±¡æˆ–ä¸Šä¸‹æ–‡çŠ¶æ€ä¸€è‡´ã€æ­£ç¡®ã€‚å¼‚å¸¸ç‹¬ç«‹æ˜¯æŒ‡å…è®¸æœ‰å‘ç”Ÿå¼‚å¸¸çš„å¯èƒ½ï¼Œä½†è‡ªèº«ä¸å¤„ç†ï¼Œå°†è¿™ä¸ªå¼‚å¸¸è§†ä¸ºä¸å¯å¿½è§†çš„é—®é¢˜ä»è€Œä¼ é€’ç»™è°ƒç”¨æ–¹ã€‚è¿™é‡Œä»å†…å­˜ï¼ˆæˆ–èµ„æºï¼‰åˆ†é…çš„è§’åº¦æ¥çœ‹ä»€ä¹ˆæ ·çš„ä»£ç è‡³å°‘æ˜¯å¼‚å¸¸å®‰å…¨å’Œå¼‚å¸¸ç‹¬ç«‹çš„ã€‚å‡è®¾æŸä¸ªå®¹å™¨ç±»çš„ä¸€ä¸ªæ‹·è´å‡½æ•°ï¼š 123456789101112131415template&lt;class T&gt;T* NewCopy( const T* src, size_t srcsize, size_t destsize)&#123; assert( destsize &gt;= srcsize ); T* dest = new T[destsize]; // å¼‚å¸¸ç‹¬ç«‹ try&#123; copy(src, src+srcsize, dest); // stl ç®—æ³• &#125; catch(...) &#123; delete [] dest; // å¼‚å¸¸å®‰å…¨å¤„ç† throw; // é‡æ–°æŠ›å‡ºï¼Œå¼‚å¸¸ç‹¬ç«‹ &#125; return dest;&#125; ä¹‹æ‰€ä»¥new T[destsize]è¯­å¥æ²¡æœ‰æ”¾åœ¨tryå—ä¸­å¤„ç†æ˜¯å› ä¸ºå¦‚æœnew []()åŠ¨ä½œå¤±è´¥ï¼Œå†…å­˜è¿˜æ²¡æœ‰åˆ†é…ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å†…å­˜æ³„éœ²ï¼Œç›´æ¥å‘ä¸ŠæŠ›å‡ºbad_allocå¼‚å¸¸ã€‚ä½†æ˜¯å¦‚æœTçš„æ„é€ å‡½æ•°å‘ç”Ÿå¼‚å¸¸ï¼Œæ‰€æœ‰å·²æ„é€ çš„Tä¼šè¢«è‡ªåŠ¨é”€æ¯ï¼Œdelete[ ]()ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚å› æ­¤newè¿™å¥å±äºå¼‚å¸¸ç‹¬ç«‹ã€‚ç›´åˆ°newè¯­å¥å®Œå…¨æ‰§è¡Œå®Œæ¯•åï¼Œæ‰æ‹…è´Ÿèµ·é‡Šæ”¾å†…å­˜çš„è´£ä»»ï¼Œå› æ­¤ï¼Œå¦‚æœæ­¤æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œä¸ºäº†å¼‚å¸¸å®‰å…¨å¿…é¡»åœ¨æ•æ‰åˆ°å¼‚å¸¸åé‡Šæ”¾å†…å­˜æˆ–èµ„æºï¼Œä½¿å…¶å›åˆ°å‡½æ•°è°ƒç”¨å‰çš„æ­£ç¡®çŠ¶æ€ã€‚ç„¶åè½¬ä¸ºå¼‚å¸¸ç‹¬ç«‹çš„è€ƒè™‘ã€‚å‡å¦‚Tçš„operator&#x3D;å‘ç”Ÿå¼‚å¸¸ï¼Œå¯¼è‡´copyæ— æ³•æ‰§è¡Œï¼Œé‚£è¿™ä¸ªæ— æ³•é¿å…çš„å¼‚å¸¸å¯¼è‡´äº†éé¢„æœŸçš„ç»“æœï¼Œå°±å¿…é¡»å†é‡æ–°æŠ›å‡ºå¼‚å¸¸ã€‚ æ¢æˆauto_ptræˆ–è€…unique_pträ¹‹ç±»çš„æ™ºèƒ½æŒ‡é’ˆé‚£é—®é¢˜å°±è½»æ¾å¤šäº†ï¼Œè¿tryå—éƒ½å¯ä»¥å»æ‰ã€‚ä½†æ˜¯ä¸¾è¿™ä¸ªä¾‹å­çš„ç›®çš„æ˜¯æ€»ç»“å¼‚å¸¸å®‰å…¨å’Œå¼‚å¸¸ç‹¬ç«‹çš„ä¸¤ç§è§’åº¦è€ƒè™‘ã€‚å¦‚æœè¯´ä¾‹å­ä¸­ä¸æ˜¯æ•°æ®æ‹·è´ï¼Œè€Œæ˜¯å°†æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æœ‰åŒæ ·çš„è€ƒè™‘ã€‚ ä¸ªäººè®¤ä¸ºï¼šå¯¹èµ„æºåˆ†é…å‰ï¼ˆor æ­£åœ¨åˆ†é…ï¼‰æˆ–è€…äº‹åŠ¡å¼€å§‹å‰çš„é¢„å¤„ç†åŠ¨ä½œä¸­é‡åˆ°çš„å¼‚å¸¸åº”è¯¥æŒ‰ç…§å¼‚å¸¸ç‹¬ç«‹æ¥å¤„ç†ï¼Œå› ä¸ºé€šå¸¸æ­¤ç±»å¼‚å¸¸æ˜¯æ— æ³•é¿å…çš„ã€å¤–éƒ¨å¯¼è‡´çš„ä¸¥é‡å¼‚å¸¸ã€‚åº”å½“ä¸å¤„ç†ï¼Œé€‰æ‹©ç›´æ¥è‡ªåŠ¨æŠ›å‡ºã€‚ å¯¹èµ„æºå·²ç»åˆ†é…æˆ–è€…äº‹åŠ¡å·²ç»å¼€å§‹å¤„ç†ï¼ˆå¼€å§‹å†™å…¥æ–‡ä»¶ or æ•°æ®å·²è¢«ä¿®æ”¹ï¼‰åˆ°æœ€åå®ŒæˆçŠ¶æ€ä¸­å‘ç”Ÿçš„å¼‚å¸¸å¿…é¡»è¦æŒ‰ç…§å¼‚å¸¸å®‰å…¨æ¥å¤„ç†ï¼Œä½¿å…¶å›åˆ°æ­£ç¡®çš„çŠ¶æ€ï¼ˆç”¨æ•°æ®åº“é‡Œçš„æœ¯è¯­å«å›æ»šï¼Œrollbackï¼‰ã€‚å¦‚æœæ˜¯å¯ä»¥Holdä½çš„å¯é¢„è§å¼‚å¸¸ï¼Œé‚£ä¹ˆç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œï¼›å¦‚æœæ˜¯ä¸å¯é¢„è§çš„å¼‚å¸¸ï¼ˆä¸Šä¾‹ä¸­çš„æ¨¡æ¿å‚æ•°ç±»å‹Tï¼‰ï¼Œé‚£å¿…é¡»é‡æ–°æŠ›å‡ºã€‚","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"exception","slug":"exception","permalink":"https://unpluggedcoder.me/tags/exception/"}]},{"title":"Pocoç±»ç»§æ‰¿ä½“ç³»ç»“æ„ç‰¹æ€§åˆ†æ","slug":"Pocoç±»ç»§æ‰¿ä½“ç³»ç»“æ„ç‰¹æ€§åˆ†æ","date":"2013-07-10T18:10:30.000Z","updated":"2022-09-15T15:51:05.346Z","comments":true,"path":"2013/07/11/Pocoç±»ç»§æ‰¿ä½“ç³»ç»“æ„ç‰¹æ€§åˆ†æ/","link":"","permalink":"https://unpluggedcoder.me/2013/07/11/Poco%E7%B1%BB%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E7%89%B9%E6%80%A7%E5%88%86%E6%9E%90/","excerpt":"","text":"æœ€è¿‘åœ¨å­¦ä¹ æ¥å£ç±»çš„å‡ ç§è®¾è®¡æ–¹å¼æ—¶ï¼Œæƒ³èµ·äº†Pocoåº“ï¼Œçœ‹çœ‹Poco C++åº“æºç æ˜¯å¦‚ä½•å®ç°æ¥å£ç±»ã€‚è¿™é‡Œæ‰€è¯´çš„æ¥å£ç±»åœ¨ä¸€èˆ¬æ¦‚å¿µä¸Šè®²æˆ‘ä¼šè®¤ä¸ºæ˜¯åªå…·æœ‰çº¯è™šæ¥å£å‡½æ•°å£°æ˜çš„ç±»ï¼Œä½†æ˜¯çœ‹å®ŒPocoçš„ä¸€éƒ¨åˆ†æºç åï¼Œæˆ‘è§‰å¾—â€œæ¥å£ç±»â€çš„æ¦‚å¿µä¸ä»…å±€é™äºæ­¤ï¼Œçœ‹æ¥æˆ‘å­¦è¯†å°šæµ…ã€‚æ‰€å¹¸RPæ¯”è¾ƒç»™åŠ›ï¼Œè®©æˆ‘æ­£å¥½åœ¨çœ‹ã€ŠC++ä»£ç è®¾è®¡ä¸é‡ç”¨ã€‹ä¸€ä¹¦ä¸­çœ‹åˆ°äº†è¿™ä¸¤ç§æ‰‹æ³•ã€‚ ç»§æ‰¿åŸºç±»çš„æ¥å£å…ˆè¯´è¯´ä¸€èˆ¬çš„æ¥å£ç±»ï¼Œé€šå¸¸æƒ…å†µä¸‹å®ƒæ˜¯ä¸ªè™šåŸºç±»ï¼Œåªå®šä¹‰äº†è™šå‡½æ•°æ¥å£ï¼Œè¿™æ ·çš„ä¼˜ç‚¹å¾ˆå¤šï¼š å‘ä½¿ç”¨è€…éšè—äº†æ¥å£å®ç°çš„å…·ä½“ç»†èŠ‚ ä½¿ç”¨è€…æ— éœ€çŸ¥æ™“æ¥å£å„ä¸ªå­ç±»çš„ç»§æ‰¿ä½“ç³» æœ€å¤§çš„ä¼˜ç‚¹åº”è¯¥æ˜¯å…¶è¯­è¨€å¤šæ€æ€§è·¨è¶Šäº†äºŒè¿›åˆ¶ç»Ÿä¸€æ¥å£çš„éšœç¢ æˆ‘ä»¥æ¯”è¾ƒæ™®éçš„è·¨å¹³å°æ¥å£ç±»è®¾è®¡ä¸ºä¾‹ï¼Œå…·ä½“ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š 1234567891011121314class InterfaceBase&#123;public: virtual void InterfaceMethod()=0;&#125;;class InterfaceImpl : public InterfaceBase&#123;public: virtual void InterfaceMethod() &#123;// Win32 Implementation ... &#125;&#125;; UMLç±»å›¾å¦‚ä¸‹ï¼š ç»§æ‰¿åŸºç±»çš„å®ç°ï¼ˆåå‘æ¥å£å®ç°ç»§æ‰¿ï¼‰ç°åœ¨è¯´è¯´Poco C++åº“ä¸­éƒ¨åˆ†ç±»çš„ç»§æ‰¿ä½“ç³»ç»“æ„ã€‚ å…¶ä¸­è®¸å¤šç±»é‡‡ç”¨äº†ä¸€ç§ç›¸åçš„æ¥å£ç±»ç»§æ‰¿ä½“ç³»ï¼Œç›¸æ¯”äºä¹¦ä¸­çš„â€œç»§æ‰¿åŸºç±»çš„å®ç°â€ï¼Œæˆ‘æ›´ä¹æ„ç§°ä¹‹ä¸ºåå‘æ¥å£å®ç°ç»§æ‰¿ç»“æ„ã€‚ä¹Ÿå°±æ˜¯è¯´å‰é¢æ‰€æè¿°çš„æ¥å£ç±»ä¸­ï¼Œå„ç§å¯èƒ½çš„å­ç±»å®ç°æ–¹æ³•è¢«æ”¾åˆ°äº†ç»§æ‰¿ä½“ç³»çš„ä¸Šå±‚ï¼Œå³ä½œä¸ºåŸºç±»ã€‚ä»¥Pocoçš„ä¾‹å­æ¥è¯´å°±æ˜¯å„ä¸ªå¹³å°ç›¸å…³çš„ä»£ç ä¸æ˜¯ç»§æ‰¿äºæŸä¸ªæè¿°æ¥å£çš„è™šåŸºç±»ï¼Œè€Œæ˜¯è¢«â€œæ¥å£â€ç±»ç»§æ‰¿ã€‚ Pocoçš„çº¿ç¨‹ç±»Thread.hå¦‚ä¸‹,ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘å»æ‰äº†ä¸€äº›ä»£ç ï¼š 123456789101112131415161718// Thread.hâ€¦#if defined(POCO_OS_FAMILY_WINDOWS)#if defined(_WIN32_WCE)#include &quot;Poco/Thread_WINCE.h&quot;#else#include &quot;Poco/Thread_WIN32.h&quot;#endif#elif defined(POCO_VXWORKS)#include &quot;Poco/Thread_VX.h&quot;#else#include &quot;Poco/Thread_POSIX.h&quot;#endifâ€¦class Thread: private ThreadImpl&#123;â€¦&#125;; ä»è¿™æ®µä»£ç ä¸­åº”è¯¥çœ‹åˆ°ä¸¤ç‚¹ï¼š ThreadImplåœ¨ä¸åŒå¹³å°çš„å¤´æ–‡ä»¶ä¸­è¢«å£°æ˜ï¼Œå¹¶ç”±å®å®šä¹‰æ§åˆ¶åœ¨ç¼–è¯‘å‰å°±åŒºåˆ†å„å¹³å°ã€‚ å…³äºç»§æ‰¿ä¸€ä¸ªç±»çš„å®ç°ï¼Œè€Œä¸æ”¹å˜å…¶è‡ªèº«å®ç°ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯privateç»§æ‰¿æ–¹å¼ï¼Œè¡¨æ˜å­ç±»å®Œå…¨åˆ©ç”¨åŸºç±»çš„å‡½æ•°å®ç°è€Œä¸æš´éœ²ç»™å¯¹è±¡å¤–éƒ¨ã€‚ï¼ˆå…¶å®è¿™é‡Œä½¿ç”¨ç»§æ‰¿çš„æ–¹æ³•è¿˜æœ‰äº›å†…å®¹ï¼Œæˆ‘ç•™åœ¨æ–‡ç« æœ€åè¯´è¯´ï¼‰å› æ­¤ï¼Œæ‰€æœ‰çš„å®ç°ä»£ç åœ¨åŸºç±»ä¸­è¢«åŒºåˆ†ï¼Œä¸åŒçš„å¹³å°æ“ä½œåœ¨å­ç±»çœ‹æ¥éƒ½æ˜¯ç»Ÿä¸€çš„æ¥å£å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å·²ç»ç”±åŸºç±»å£°æ˜å¹¶å®šä¹‰äº†ï¼Œå­ç±»ç»§æ‰¿è€Œæ¥ã€‚ æ¥çœ‹Pocoåº“çš„Thread.cppä¸­å­ç±»æ˜¯å¦‚ä½•è°ƒç”¨åŸºç±»çš„å„ä¸ªå®ç°å‡½æ•°ï¼š 12345678910111213141516171819202122232425262728// Thread.cppâ€¦void Thread::start(Runnable&amp;amp; target)&#123; startImpl(target);&#125;void Thread::start(Callable target, void* pData)&#123; startImpl(target, pData);&#125;void Thread::join()&#123; joinImpl();&#125;void Thread::join(long milliseconds)&#123; if (!joinImpl(milliseconds)) throw TimeoutException();&#125;bool Thread::tryJoin(long milliseconds)&#123; return joinImpl(milliseconds);&#125;â€¦ æ‰€çœ‹åˆ°çš„***Implå‡½æ•°å°±æ˜¯åœ¨åŸºç±»ThreadImplä¸­å·²ç»è¢«å®ç°äº†çš„å‡½æ•°ï¼Œå­ç±»æ— éœ€å…³å¿ƒå„ä¸ªå¹³å°çš„æ ¸å¿ƒä»£ç å¦‚ä½•å®ç°ï¼Œåªéœ€è¦çŸ¥é“è¦åšå‡ºå“ªäº›ç»Ÿä¸€ç®€å•çš„è°ƒç”¨åŠ¨ä½œã€‚å°±å¥½æ¯”å‘å°„å«æ˜Ÿï¼Œæ¯ä¸ªå›½å®¶éƒ½æœ‰ä¸åŒè¿è½½æ–¹å¼å°†å«æ˜Ÿé€å…¥è½¨é“ï¼Œä½†æ˜¯åœ¨å¤–ç•Œçœ‹æ¥ä»–ä»¬éƒ½åªéœ€è¦å‘å‡ºä¸€ä¸ªâ€œå‘å°„â€å‘½ä»¤å³å¯ã€‚ UMLå›¾å¦‚ä¸‹ï¼š ä¸ªäººæ€»ç»“ä¸‹è¿™ä¸¤ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ï¼š é¦–å…ˆï¼Œæ— ç–‘å‰è€…æœ€å¤§çš„ä¼˜åŠ¿æ˜¯è·¨è¶Šäº†ABIï¼ˆåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼‰ç•Œé™ï¼Œè€Œåè€…å¾€å¾€åœ¨åŸºç±»çš„ä¸­åŒ…å«äº†å„ç§å¹³å°ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œæ— æ³•è¢«å„ç§ç¼–è¯‘å™¨æ‰€ç›¸å®¹ã€‚ å…¶æ¬¡ï¼Œå‰è€…åœ¨ä»£ç åˆ†å‘ä¸ŠåŒæ ·å…·æœ‰ä¼˜åŠ¿ï¼Œå®ƒåªéœ€å‘å¸ƒä¸€ä¸ªç®€å•çš„æ¥å£ç±»å£°æ˜çš„å¤´æ–‡ä»¶å³å¯å‘å¤–éƒ¨å‘Šä¹‹è‡ªèº«çš„åŠŸèƒ½ã€‚è€Œåè€…ç”±äºè¿åŒå¹³å°å®ç°çš„å…·ä½“ç±»å£°æ˜å¤´æ–‡ä»¶ä¹Ÿè¢«includeäº†ï¼Œé‚£æ— ç–‘ä¼šå¢åŠ å„ä¸ªç»„ä»¶ä¹‹é—´çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”æš´éœ²äº†å¹³å°ç›¸å…³çš„å®ç°ç»†èŠ‚ã€‚ ä½†æ˜¯ï¼ŒPocoæ˜¯å¼€æºçš„ï¼Œæå€¡ä½¿ç”¨è€…æŠŠPocoä»£ç åµŒå…¥åˆ°ä»–ä»¬çš„ä»£ç ä¸­ã€‚å¦‚æœéœ€è¦åˆ†å‘ç»„ä»¶æ¥å£ï¼Œå¤§å¯ä»¥ä½¿ç”¨åŒ…æ‹¬ç¬¬ä¸€ç§æ–¹æ³•åœ¨å†…çš„è®¸å¤šç§æ–¹å¼ã€‚ä¸ªäººè®¤ä¸ºç¬¬äºŒç§åšæ³•ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ä¹Ÿå°±åœ¨äºï¼šç±»åœ¨æ¨¡å—ï¼ˆæˆ–ç»„ä»¶ï¼‰çš„å†…éƒ¨æ¥å£å…±äº«ã€‚è¿™ç§æ–¹æ³•ä¸æå€¡åœ¨æ¨¡å—ï¼ˆæˆ–ç»„ä»¶ï¼‰é—´æ»¥ç”¨ã€‚ä¸ªäººè§‰å¾—éœ€è¦è¿™è¿˜æ˜¯éœ€è¦ç¨‹åºå‘˜è‡ªèº«çš„è§‰æ‚Ÿæ¥æ§åˆ¶ä»£ç å¤æ‚åº¦ï¼Œè¿™åº”è¯¥Pocoçš„ç†å¿µæ˜¯ä¸€è‡´çš„ï¼šéµå®ˆä»£ç ä¹‹é—´çš„çº¦å®šã€‚åè¿‡æ¥æƒ³æƒ³ï¼Œçš„ç¡®ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¾ˆå¤šæ—¶å€™å¾ˆå¤šä»£ç å¤„æˆ‘ä»…ä»…åªéœ€è¦çš„æ˜¯ä¸€å¥ç®€å•çš„ï¼š 1Thread myThread; è€Œç¬¬ä¸€ç§ç»§æ‰¿åŸºç±»çš„æ¥å£æ–¹æ³•å¸¸åšçš„äº‹æƒ…å°±æ˜¯ï¼š 1234ISomeInterface* pInterface;switch(***)case ****:pInterface= new ISomeInterfaceImpl; å¥½äº†ï¼Œå†æ¥è¯´è¯´ç¬¬äºŒç§æ–¹å¼ç»§æ‰¿æ¥å£çš„å®ç°ä¸­çš„ç»§æ‰¿ã€‚ å¥½çš„ç»§æ‰¿æˆ‘ä»¬æ€»æ˜¯å¯ä»¥æŠŠå®ƒç”¨is-açš„è¯­ä¹‰æ¥è§£é‡Šæ¸…æ¥šï¼Œä½†æ˜¯è¿™é‡Œçš„Threadå¹¶ä¸æ˜¯ThreadImplçš„ä¸€ç§ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æ—¶æœŸï¼ŒThreadå’ŒThreadImplæ˜¯ä¸¤ä¸ªå¹³è¡Œçš„æ¦‚å¿µã€‚æ‰€ä»¥æœ‰äº›æºç ä¸­ï¼ˆåŒ…æ‹¬Pocoè‡ªèº«ï¼‰ä¼šä»¥ç»„åˆçš„æ–¹å¼å‡ºç°ï¼Œæ¯”å¦‚Poco Netåº“ä¸­çš„NetworkInterface.hï¼š 123456789101112131415161718192021222324252627// NetworkInterface.hclass NetworkInterfaceImpl; //å‰ç½®å£°æ˜class NetworkInterface&#123;â€¦private: NetworkInterfaceImpl* _pImpl; // ç»„åˆä»£æ›¿ç»§æ‰¿&#125;;&lt;/pre&gt;NetworkInterface.cppä¸­åŒæ ·å¯ä»¥è‡ªç”±çš„è°ƒç”¨æ¥å£ã€‚&lt;pre class=&quot;brush:cpp&quot;&gt;// NetworkInterface.cppâ€¦int NetworkInterface::index() const&#123; return _pImpl-&amp;gt;index();&#125;const std::string&amp;amp; NetworkInterface::name() const&#123; return _pImpl-&amp;gt;name();&#125;const std::string&amp;amp; NetworkInterface::displayName() const&#123; return _pImpl-&amp;gt;displayName();&#125;â€¦ UMLå›¾å°±ä¸ç”»äº†ï¼Œå¤œæ·±äº†â€¦â€¦","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"Poco C++","slug":"Poco-C","permalink":"https://unpluggedcoder.me/tags/Poco-C/"}]},{"title":"C++11å­¦ä¹ ç¬”è®°ä¹‹6â€”â€”æ™ºèƒ½æŒ‡é’ˆ","slug":"C++11å­¦ä¹ ç¬”è®°ä¹‹6â€”â€”æ™ºèƒ½æŒ‡é’ˆ","date":"2013-06-28T15:41:28.000Z","updated":"2022-09-15T15:51:05.344Z","comments":true,"path":"2013/06/28/C++11å­¦ä¹ ç¬”è®°ä¹‹6â€”â€”æ™ºèƒ½æŒ‡é’ˆ/","link":"","permalink":"https://unpluggedcoder.me/2013/06/28/C++11%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B6%E2%80%94%E2%80%94%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/","excerpt":"","text":"auto_ptrauto_ptræ˜¯åŸºäºcopyè¯­ä¹‰çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒå®ç°äº†operator&#x3D;è¿ç®—ï¼Œè¿™æ ·éšæ™¦çš„æ‹¥æœ‰æƒè½¬ç§»ä¹Ÿå¯¼è‡´äº†å®ƒè¢«C++11é—å¼ƒã€‚è€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š 12345auto_ptr&lt;int&gt; smartPtr1( new int);&#123; auto_ptr&lt;int&gt; smartPtr2= smartPtr1;&#125;int *ptr = smartPtr1.get(); // get NULL pointer here åŸæœ‰çš„smartPtr1å·²ç»å°†æ‰€æœ‰æƒä»¥è¿™ç§éšå¼copyè¯­ä¹‰ä¼ é€’å‡ºå»ï¼Œè€Œå¯¹ç¨‹åºçŒ¿æ¥è¯´è¿™æ ·å¾ˆå®¹æ˜“å¼•èµ·è¯¯æ“ä½œã€‚ unique_ptrunique_ptræ˜¯ç”¨æ¥æ›¿ä»£auto_ptrçš„æ–°çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒä½¿ç”¨çš„æ˜¯moveè¯­ä¹‰ï¼Œå¿…é¡»ç”±ç¨‹åºçŒ¿æ˜ç¡®åœ°ä½¿ç”¨std::moveæ¥æŒ‡å®šæŒ‡é’ˆæ‰€æœ‰æƒçš„è½¬ç§»ã€‚unique_pträ¸­æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—éƒ½è¢«å£°æ˜ä¸ºprivateï¼š 123private: unique_ptr(const _Myt&amp;amp;); // not defined operator=(const _Myt&amp;amp;); // not defined ç»´åŸºç™¾ç§‘ä¸Šçš„ä¾‹å­å¾ˆç®€å•ï¼Œæ‹¿æ¥ 123456std::unique_ptr&lt;int&gt; p1(new int(5));std::unique_ptr&lt;int&gt; p2 = p1; // ç¼–è¯‘ä¼šå‡ºé”™std::unique_ptr&lt;int&gt; p3 = std::move(p1); // è½¬ç§»æ‰€æœ‰æƒ, ç°åœ¨é‚£å—å†…å­˜å½’p3æ‰€æœ‰, p1æˆä¸ºæ— æ•ˆçš„æŒ‡é’ˆ.p3.reset(); //é‡Šæ”¾å†…å­˜.p1.reset(); //å®é™…ä¸Šä»€ä¹ˆéƒ½æ²¡åš. è¦ä½¿ç”¨æ–°çš„unique_pträ¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ç”±æŸ¥æ‰¾&#x2F;æ›¿æ¢æ‰€æœ‰çš„auto_ptrå³å¯ã€‚ shared_ptr and weak_ptrshard_pträ½¿ç”¨å¼•ç”¨è®¡æ•°ï¼Œå¤šä¸ªshared_ptrå¯ä»¥å…±äº«ä¸€ä¸ªæŒ‡é’ˆï¼Œåªæœ‰æœ€åä¸€ä¸ªshared_ptré”€æ¯æ—¶æ‰é‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯åˆæœ‰å¾ªç¯è®¡æ•°çš„é—®é¢˜å‡ºç°ï¼Œå› æ­¤å¼•å…¥weak_ptrï¼Œåªå¼•ç”¨ï¼Œä¸è®¡æ•°ï¼Œå¦‚æœä¸€å—å†…å­˜è¢«shared_ptrå’Œweak_ptråŒæ—¶å¼•ç”¨, å½“æ‰€æœ‰shared_ptrææ„äº†ä¹‹å,ä¸ç®¡è¿˜æœ‰æ²¡æœ‰weak_ptrå¼•ç”¨è¯¥å†…å­˜, å†…å­˜ä¹Ÿä¼šè¢«é‡Šæ”¾. æ‰€ä»¥weak_pträ¸ä¿è¯å®ƒæŒ‡å‘çš„å†…å­˜ä¸€å®šæ˜¯æœ‰æ•ˆçš„, åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦æ£€æŸ¥.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"},{"name":"auto_ptr","slug":"auto-ptr","permalink":"https://unpluggedcoder.me/tags/auto-ptr/"},{"name":"shared_ptr","slug":"shared-ptr","permalink":"https://unpluggedcoder.me/tags/shared-ptr/"},{"name":"SmartPointer","slug":"SmartPointer","permalink":"https://unpluggedcoder.me/tags/SmartPointer/"},{"name":"unique_ptr","slug":"unique-ptr","permalink":"https://unpluggedcoder.me/tags/unique-ptr/"},{"name":"weak_ptr","slug":"weak-ptr","permalink":"https://unpluggedcoder.me/tags/weak-ptr/"}]},{"title":"C++äº‹ä»¶å§”æ‰˜â€”â€”åœ¨Poco C++ Librariesä¸­çš„å®ç°ï¼ˆé—²ç€æ— èŠï¼Œè§£æä¸‹æºç ï¼‰","slug":"C++äº‹ä»¶å§”æ‰˜â€”â€”åœ¨Poco C++ Librariesä¸­çš„å®ç°ï¼ˆé—²ç€æ— èŠï¼Œè§£æä¸‹æºç ï¼‰","date":"2013-01-17T09:08:16.000Z","updated":"2022-09-15T15:51:05.344Z","comments":true,"path":"2013/01/17/C++äº‹ä»¶å§”æ‰˜â€”â€”åœ¨Poco C++ Librariesä¸­çš„å®ç°ï¼ˆé—²ç€æ— èŠï¼Œè§£æä¸‹æºç ï¼‰/","link":"","permalink":"https://unpluggedcoder.me/2013/01/17/C++%E4%BA%8B%E4%BB%B6%E5%A7%94%E6%89%98%E2%80%94%E2%80%94%E5%9C%A8Poco%20C++%20Libraries%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%88%E9%97%B2%E7%9D%80%E6%97%A0%E8%81%8A%EF%BC%8C%E8%A7%A3%E6%9E%90%E4%B8%8B%E6%BA%90%E7%A0%81%EF%BC%89/","excerpt":"","text":"å…ˆåšä¸€æ®µç¿»è¯‘å§ï¼Œæ¯•ç«Ÿè¿™ä¸ªåº“ç›®å‰ç”¨çš„äººè¿˜ä¸å¤šï¼Œä½†æ˜¯çš„ç¡®æ˜¯ä¸€ä¸ªä¼˜ç§€çš„è·¨å¹³å°C++ librariesã€‚ Poco C++åº“æ˜¯ç”±ä¸€ç³»åˆ—å¼€æºçš„C++ç±»åº“ç»„æˆï¼Œå¯ä»¥éå¸¸ç®€å•é«˜æ•ˆåœ°å¼€å‘å‡ºå¯ç§»æ¤çš„è·¨å¹³å°C++ç¨‹åºï¼ˆåŒ…å«è·¨å¹³å°çš„ç½‘ç»œç±»åº“ç­‰ï¼‰ã€‚å¯ä»¥åœ¨è¿™é‡Œè·å¾—ï¼šhttps://pocoproject.org/index.html Poco C++åº“ä¸ä»…å®Œå…¨å…¼å®¹C++æ ‡å‡†åº“ï¼Œæ›´å¼¥è¡¥äº†å¾ˆå¤šæ ‡å‡†åº“çš„ä¸è¶³ï¼ˆC++11åŒæ ·ä¹Ÿè¡¥å……äº†å¾ˆå¤šæ–°æ ‡å‡†ï¼Œä½†æ˜¯ç›®å‰å¸‚åœºä¸Šæ²¡æœ‰ä¸€ä¸ªç¼–è¯‘å™¨èƒ½å¤Ÿå®Œå…¨æ”¯æŒï¼‰ã€‚ä¸ªäººè®¤ä¸ºç›¸æ¯”äºå…¶å®ƒC++ç¨‹åºåº“ï¼ˆä¾‹å¦‚boost C++ï¼‰ï¼ŒPocoå¯ä»¥è¯´æ˜¯éå¸¸çŸ­å°ç²¾æ‚ã€‚è€Œä¸”é«˜åº¦çš„æ¨¡å—åŒ–å’Œé«˜æ•ˆçš„è®¾è®¡ä¸å®ç°è®©Pocoéå¸¸é€‚åˆåµŒå…¥å¼åº”ç”¨ã€‚Pocoå……åˆ†åˆ©ç”¨äº†C++çš„ç‰¹æ€§ï¼šé¢å‘åº•å±‚çš„æŒæ§ï¼ˆè®¾å¤‡ I&#x2F;Oç­‰ç­‰ï¼‰å’Œé«˜å±‚çš„é¢å‘å¯¹è±¡å¼€å‘ã€‚è¿™ä¹Ÿæ˜¯ä¼˜ç§€çš„C++ç¨‹åºåº“åº”è¯¥å…·å¤‡çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆC++å§‹ç»ˆåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å¦‚æ­¤å¼ºå¤§çš„åŸå› äº†ã€‚C++åœ¨åº•å±‚æ“æ§å’Œé«˜å±‚é€»è¾‘å¤„ç†ä¸Šæ‰®æ¼”äº†å¾ˆå…³é”®çš„ä¸­é—´è§’è‰²ï¼Œä¸€æ—¦èƒ½å°†å„å¹³å°ç›¸å…³çš„APIåˆ©ç”¨C++ç‰¹æ€§æŠ½è±¡æˆé«˜çº§çš„ç»Ÿä¸€çš„é¢å‘å¯¹è±¡æè¿°ï¼Œé‚£ä¹ˆè¿™ä¸ªC++åº“æ‰æ˜¯ä¸€ä¸ªä¼˜ç§€çš„â€è½®å­â€ï¼Œè¿™æ ·ä½œä¸ºåº“çš„ä½¿ç”¨è€…ï¼ˆå³åº”ç”¨å¼€å‘è€…ï¼‰å°±èƒ½å¤Ÿé›†ä¸­å…³æ³¨äºåº”ç”¨è‡ªèº«ã€‚ åºŸè¯äº†è¿™ä¹ˆå¤šï¼Œè™½ç„¶ä¸ç”¨é‡æ–°é€ â€è½®å­â€ï¼Œä½†æ˜¯äº†è§£â€è½®å­â€æ„é€ æ‰æ˜¯æœ¬æ–‡çš„ä¸»é¢˜ã€‚ å…ˆæ¥çœ‹çœ‹Poco C++åº“å’ŒBoost C++åº“çš„ç›´è§‚å¯¹æ¯”ï¼š Boost C++ Libraries Poco C++ Libraries å¾ˆæ˜æ˜¾ï¼ŒBoost C++ä¸­å……æ–¥ç€æ ¼å¼å„æ ·çš„å®å®šä¹‰ï¼Œæˆ–è®¸è¿™åœ¨Cå‡½æ•°åº“é‡Œå¾ˆå¸¸è§ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å¯ä»¥ä¸è¿™ä¹ˆå¤æ‚ï¼Œç»™æ–°æ‰‹å­¦ä¹ æˆæœ¬å¾ˆå¤§ã€‚åè§‚Poco C++åº“ï¼Œæ²¡æœ‰è‡ƒè‚¿çš„å®å®šä¹‰ï¼Œæ²¡æœ‰é•¿ä¸²çš„åç§°ç©ºé—´ï¼Œå¤§éƒ¨åˆ†å‡½æ•°éƒ½è¿”å›voidå’Œboolï¼Œå‡½æ•°ä½“éƒ½ä¸å¤§ã€‚ å—¯ï¼ŒåˆåºŸè¯äº†äº›ï¼Œç›´å…¥ä¸»é¢˜ï¼ŒC++äº‹ä»¶å§”æ‰˜ã€‚Pocoå®˜æ–¹ç»™å‡ºçš„ç¤ºä¾‹æ˜¯ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &quot;Poco/BasicEvent.h&quot;#include &quot;Poco/Delegate.h&quot;#include &lt;iostream&gt;using Poco::BasicEvent;using Poco::Delegate;class Source&#123;public: BasicEvent&lt;int&gt; theEvent; void fireEvent(int n) &#123; theEvent(this, n); &#125;&#125;;class Target&#123;public: void onEvent(const void* pSender, int&amp; arg) &#123; std::cout &lt;&lt; &quot;onEvent: &quot; &lt;&lt; arg &lt;&lt; std::endl; &#125;&#125;;int main(int argc, char** argv)&#123; Source source; Target target; source.theEvent += Delegate&lt;Target, int&gt;( &amp;target, &amp;Target::onEvent); source.fireEvent(42); source.theEvent -= Delegate&lt;Target, int&gt;( &amp;target, &amp;Target::onEvent); return 0;&#125; å—¯ï¼ŒBasicEventæä¾›ä¸€ä¸ªoperator+&#x3D; å’Œä¸€ä¸ªoperator-&#x3D;å®ç°äº‹ä»¶çš„æ³¨å†Œå’Œæ³¨é”€ï¼Œä»¥åŠäº‹ä»¶å“åº”çš„operator()ã€‚æ³¨å†Œäº‹ä»¶æ¥å—çš„å‚æ•°æ˜¯ä¸€ä¸ªå§”æ‰˜ç±»(delegate)ï¼Œå¯ä»¥æ”¯æŒæ³¨å†Œå¤šä¸ªäº‹ä»¶å“åº”ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¾æƒ³åœ¨å…¶å†…éƒ¨ç”¨ä¸€ä¸ªå®¹å™¨æ¥å­˜æ”¾è¿™äº›æ³¨å†Œçš„å›è°ƒå‡½æ•°ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839template &lt;class TArgs,class TStrategy&gt;// ä»¥äº‹ä»¶å“åº”å‡½æ•°å‚æ•°å’Œå“åº”ç­–ç•¥ä»£ç†ç±»ä¸ºæ¨¡æ¿å‚æ•°ï¼Œåè€…ç¨åä»‹ç»class BasicEvent:&#123;public: BasicEvent()&#123;&#125; ~BasicEvent()&#123;&#125;///////////////////////////////////////////////// ä¸‰ä¸ªä¸»è¦çš„æˆå‘˜å‡½æ•°æ¥å£ void operator += (const Delegate&amp; aDelegate) /// Adds a delegate to the event. &#123; _strategy.add(aDelegate); &#125; void operator -= (const Delegate&amp; aDelegate) /// Removes a delegate from the event. /// /// If the delegate is not found, this function does nothing. &#123; _strategy.remove(aDelegate); &#125; void operator () (const void* pSender, TArgs&amp; args) /// Shortcut for notify(pSender, args); &#123; // ç”¨ç­–ç•¥ä»£ç†ï¼ˆProxyï¼‰ç±»å“åº”æ‰€æœ‰æ³¨å†Œå‡½æ•°ï¼ŒåŒæ ·ç¨åè§£é‡Š _strategy.notify(pSender, args); &#125;///////////////////////////////////////////////protected: TStrategy _strategy;private: // ç¦ç”¨æ‹·è´æ„é€ å’Œå¤åˆ¶æ‹·è´ BasicEvent(const BasicEvent&amp; e); BasicEvent&amp; operator = (const BasicEvent&amp; e);&#125;; é€šå¸¸ç®¡ç†å¤šä¸ªäº‹ä»¶ä¼šé‡åˆ°è¿™æ ·çš„å®ä¾‹ï¼šä¾‹å¦‚ï¼Œå¯¹äºæ™®é€šäº‹ä»¶å“åº”é‡‡ç”¨FIFOæ–¹æ³•æ˜¯å¾ˆå¥½å®¹æ˜“ç†è§£çš„å¸¸è§„ç­–ç•¥ï¼Œä½†æ˜¯å¯¹äºI&#x2F;Oè®¾å¤‡äº‹ä»¶å“åº”çš„é—®é¢˜æ›´å¤šæ—¶å€™åº”è¯¥é‡‡ç”¨ä¼˜å…ˆçº§ç­–ç•¥ï¼Œè€Œè¿™ç§ä¼˜å…ˆçº§çš„å¤„ç†ä¹Ÿæ˜¯Poco Eventåº“åº”è¯¥æ‰€å…·æœ‰çš„åŠŸèƒ½ã€‚åœ¨è¿™ç§ç‰¹ä¾‹é—®é¢˜ä¸Šï¼Œå¸¸å¸¸ä¼šçŠ¯åœ°ä¸€ä¸ªé”™è¯¯å°±æ˜¯è®¤ä¸ºå¯ä»¥å¾ˆç›´è§‚åœ°ä»BasicEventç±»æ´¾ç”Ÿä¸€ä¸ªPriorityEventå­ç±»ã€‚åŸºç±»å’Œå­ç±»çš„å…³ç³»åº”è¯¥æ°¸è¿œæ˜¯is-açš„è”ç³»ã€‚è¿™é‡Œå¹¶ä¸å­˜åœ¨PriorityEventéš¶å±äºBasicEventï¼Œç›¸åä¸¤ç§äº‹ä»¶ç±»å‹ä»åº“çš„ä½¿ç”¨è€…ï¼ˆå³åº”ç”¨å¼€å‘è€…ï¼‰è§’åº¦æ¥è¯´æœ‰ç€ä¸€è‡´çš„è¡Œä¸ºï¼šæ³¨å†Œã€å“åº”å’Œæ³¨é”€äº‹ä»¶ã€‚ å”¯ä¸€ä¸åŒåœ¨äºPriorityEventæ¯”BasicEventå¤šä¸€ä¸ªä¼˜å…ˆçº§å‚æ•°ã€‚å› æ­¤ï¼Œä¸€è‡´çš„è¡Œä¸ºå¯ä»¥æŠ½è±¡ä¸ºä¸¤è€…çš„ä¸€ä¸ªåŸºç±»ï¼ˆAbstractEventï¼Œè¿™ä¸ªåŸºç±»å®ç°äº†äº‹ä»¶çš„ç»Ÿä¸€æ¥å£ï¼Œä½†æ˜¯ä¸æ˜¯è™šåŸºç±»ï¼‰ï¼Œè€Œä¸åŒçš„å¤„ç†ç­–ç•¥æ‰æ˜¯äºŒè€…çš„å‚æ•°ã€‚äº‹å®ä¸Šä¸ä»…ä»…å¯¹åº”ç”¨å¼€å‘è€…ï¼Œè€Œä¸”å¯¹AbstractEventæ¥è¯´ï¼Œå¤„ç†äº‹ä»¶çš„æ¥å£è¡Œä¸ºä¹Ÿæ˜¯åªæœ‰ä¸‰ä¸ªï¼šæ³¨å†Œã€å“åº”å’Œæ³¨é”€äº‹ä»¶ã€‚å› æ­¤å¯ä»¥æŠŠæ‰§è¡Œå“åº”çš„ç­–ç•¥æŠ½è±¡ä¸ºä¸€ä¸ªä»£ç†ç±»æ¥æ‰§è¡Œã€‚ç°ä»£C++ä¸­ä¸ºä¸€ä¸ªæŠ½è±¡åŸºç±»å®ç°ä¸åŒè¡Œä¸ºç‰¹æ€§çš„å¸¸ç”¨æ–¹æ³•æ˜¯ç±»æ¨¡æ¿ï¼Œå‡†ç¡®ç‚¹è¯´æ˜¯æ¨¡æ¿çš„ç‰¹åŒ–ä¸åç‰¹åŒ–ã€‚è¿™æ˜¯å¾ˆå¤šC++ç¨‹åºåº“ä¸­ç»å¸¸ç”¨çš„æŠ€å·§ã€‚ ä¸‹é¢ä¸»è¦ç»™å‡ºAbstractEventçš„éƒ¨åˆ†æºç ï¼ŒBasicEventå’ŒPriorityEventå°±ç®€å•å¾ˆå¤šäº†ã€‚è‡³äºå§”æ‰˜ç±»ï¼ˆDelegateï¼‰ç®€å•æ¥è¯´å°±æ˜¯åŒ…å«äº†å›è°ƒçš„å§”æ‰˜å‡½æ•°æŒ‡é’ˆåŠå…¶æ‹¥æœ‰è€…çš„å¯¹è±¡æŒ‡é’ˆçš„ç±»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677template &lt;class TArgs, class TStrategy, class TDelegate, class TMutex = FastMutex&gt;class AbstractEvent&#123;public: typedef TArgs Args; AbstractEvent(): _executeAsync(this, &amp;AbstractEvent::executeAsyncImpl) &#123; &#125; virtual ~AbstractEvent() &#123; &#125; void operator += (const TDelegate&amp; aDelegate) /// Adds a delegate to the event. /// Exact behavior is determined by the TStrategy. &#123; // ä½œç”¨åŸŸå†…çš„äº’æ–¥å¯¹è±¡ï¼Œææ„æ—¶é‡Šæ”¾äº’æ–¥é” typename TMutex::ScopedLock lock(_mutex); // ç­–ç•¥ç±»ä¸­åŒ…å«äº†ç”¨äºå­˜æ”¾å§”æ‰˜äº‹ä»¶çš„å®¹å™¨_strategy.add(aDelegate); &#125; void operator -= (const TDelegate&amp; aDelegate) /// Removes a delegate from the event. /// If the delegate is not found, this function does nothing. &#123; typename TMutex::ScopedLock lock(_mutex); _strategy.remove(aDelegate); &#125; void operator () (const void* pSender, TArgs&amp; args) /// Shortcut for notify(pSender, args); &#123; notify(pSender, args); //æ‰§è¡Œæ‰€æœ‰å“åº” &#125; void operator () (TArgs&amp; args) /// Shortcut for notify(args). &#123; notify(0, args); &#125; void notify(const void* pSender, TArgs&amp; args) &#123; Poco::ScopedLockWithUnlock&lt;TMutex&gt; lock(_mutex); // ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼ˆthread-safenessï¼‰: // å…ˆæ‹·è´åˆ°å±€éƒ¨å˜é‡ï¼Œé˜²æ­¢å“åº”å§”æ‰˜äº‹ä»¶æ—¶å®¹å™¨å˜æ›´ TStrategy strategy(_strategy); lock.unlock(); strategy.notify(pSender, args); &#125; void clear() /// Removes all delegates. &#123; typename TMutex::ScopedLock lock(_mutex); _strategy.clear(); &#125; bool empty() const /// Checks if any delegates are registered at the delegate. &#123; typename TMutex::ScopedLock lock(_mutex); return _strategy.empty(); &#125;protected: TStrategy _strategy; /// The strategy used to notify observers. mutable TMutex _mutex;private: AbstractEvent(const AbstractEvent&amp; other); AbstractEvent&amp; operator = (const AbstractEvent&amp; other);&#125;; ä¸Šé¢ç»™å‡ºäº†ä¸»è¦çš„å®ç°ä»£ç ï¼Œå¯¹äºBasicEventå’ŒPriorityEventæ¥è¯´ï¼Œåªéœ€è¦ç»§æ‰¿è‡ªAbstractEventç‰¹åŒ–å‡ºçš„æ¨¡æ¿ç±»ï¼š 1234567891011121314151617181920212223242526272829template &lt;class TArgs, class TMutex = FastMutex&gt;class BasicEvent: public AbstractEvent &lt; TArgs, DefaultStrategy&lt;TArgs, AbstractDelegate&lt;TArgs&gt; &gt;, AbstractDelegate&lt;TArgs&gt;, TMutex&gt; /// A BasicEvent uses the DefaultStrategy which /// invokes delegates in the order they have been registered. /// DefaultStrategyé‡‡ç”¨FIFOç­–ç•¥å¤„ç†äº‹ä»¶å“åº”&#123; public: BasicEvent()&#123;&#125; ~BasicEvent()&#123;&#125; private: BasicEvent(const BasicEvent&amp; e); BasicEvent&amp; operator = (const BasicEvent&amp; e);&#125;;template &lt;class TArgs, class TMutex = FastMutex&gt;class PriorityEvent: public AbstractEvent &lt; TArgs, PriorityStrategy&lt;TArgs, AbstractPriorityDelegate&lt;TArgs&gt; &gt;, AbstractPriorityDelegate&lt;TArgs&gt;, TMutex &gt;&#123;// å’ŒBasicEventç›¸åŒ&#125;; ä»PriorityEventå¯ä»¥çœ‹å‡ºï¼ŒPriorityEventåªæ˜¯é’ˆå¯¹ä¼˜å…ˆçº§ç­–ç•¥é‡‡ç”¨äº†PriorityStrategy å’ŒAbstractPriorityDelegateï¼Œåè€…ç›¸å¯¹äºæ™®é€šçš„AbstractDelegateå¤šäº†ä¸€ä¸ªä¼˜å…ˆçº§å‚æ•°è€Œå·²ã€‚åœ¨Poco C++çš„è‡ªèº«åº“å†…çº¦å®šï¼ŒBasicEventå›ºå®šæ­é…DefaultStrategyï¼Œ PriorityEventå›ºå®šæ­é…PriorityEventï¼Œè€Œåœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„operator+&#x3D;å’Œoperator-&#x3D;ï¼Œå¿…é¡»æä¾›ä¸ä¹‹å¯¹åº”çš„Delegateç±»å‹ï¼Œä»»ä½•ä¼˜ç§€çš„C++åº“éƒ½æœ‰è‡ªèº«çš„ç¼–ç¨‹çº¦å®šï¼Œä½œä¸ºåº“çš„ä½¿ç”¨è€…ï¼Œåªæœ‰éµå¾ªè¿™äº›è§„åˆ™æ‰èƒ½ç©å¥½è¿™ä¸ªæ¸¸æˆã€‚ 12345678BasicEvent&lt;int&gt; theBasicEvent;// ä¸ä¼šæŠ¥é”™ï¼Œä½†äº‹å®ä¸Šä¼šé‡‡ç”¨FIFOç­–ç•¥theBasicEvent += PriorityDelegate&lt;Target, int&gt;( // Logic Errorï¼Œno compile error &amp;target, &amp;Target::onEvent,0);// ä¼˜å…ˆçº§0PriorityEvent&lt;int&gt; thePriorityEvent;thePriorityEvent += Delegate&lt;Target, int&gt;( // Compile errorï¼Œæ²¡æœ‰ä¼˜å…ˆçº§å±æ€§ã€‚ &amp;target, &amp;Target::onEvent);// æ²¡æœ‰ä¼˜å…ˆçº§å‚æ•° è¿˜æœ‰ä¸¤ç‚¹å¯èƒ½å¤§å®¶å·²ç»æ³¨æ„åˆ°ï¼š åªæ”¯æŒå•ä¸ªå‚æ•°çš„å›è°ƒå‡½æ•°æ³¨å†Œï¼› ä¸æ”¯æŒå›è°ƒå‡½æ•°è¿”å›å€¼æ£€æµ‹ã€‚ å¯¹äº1æ¥è¯´ï¼ŒPoco C++æ–‡æ¡£ç»™å‡ºçš„æ–¹æ³•æ˜¯ä¼ é€’ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„ç»“æ„ä½“æ¥è§£å†³ã€‚å¯¹äº2æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡å“åº”å‡½æ•°æä¾›non-const çš„senderå¼•ç”¨æ¥ä¿®æ”¹å½“å‰è¢«è°ƒè€…å½“å‰çš„çŠ¶æ€ï¼ŒArgçš„å¼•ç”¨ä¹Ÿæ˜¯å¯ä»¥è¢«æ¥å—çš„ï¼š 1void onEvent(const void* pSender, int&amp; arg); è¿™é‡Œåˆå›åˆ°äº†å¼€å§‹çš„è¯é¢˜ï¼Œlookï¼Œå›è°ƒå‡½æ•°çš„è¿”å›å€¼æ°¸è¿œæ˜¯voidï¼Œæ—¢æœ‰è‡ªæˆ‘çº¦æŸï¼Œåˆæœ‰çµæ´»å·§å¦™ï¼Œæ—¢ç®€å•åˆå¯Œå«ç¼–ç¨‹å“²å­¦ï¼Œè¿™å°±æ˜¯Poco C++ Librariesã€‚","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"Poco C++","slug":"Poco-C","permalink":"https://unpluggedcoder.me/tags/Poco-C/"},{"name":"äº‹ä»¶","slug":"äº‹ä»¶","permalink":"https://unpluggedcoder.me/tags/%E4%BA%8B%E4%BB%B6/"},{"name":"å§”æ‰˜","slug":"å§”æ‰˜","permalink":"https://unpluggedcoder.me/tags/%E5%A7%94%E6%89%98/"}]},{"title":"C++ä¸­ç±»æ¨¡æ¿ï¼ˆclass templateï¼‰å’Œæ¨¡æ¿ç±»ï¼ˆtemplate classï¼‰çš„åŒºåˆ«","slug":"C++ä¸­ç±»æ¨¡æ¿ï¼ˆclass templateï¼‰å’Œæ¨¡æ¿ç±»ï¼ˆtemplate classï¼‰çš„åŒºåˆ«","date":"2013-01-17T07:59:18.000Z","updated":"2022-09-15T15:51:05.344Z","comments":true,"path":"2013/01/17/C++ä¸­ç±»æ¨¡æ¿ï¼ˆclass templateï¼‰å’Œæ¨¡æ¿ç±»ï¼ˆtemplate classï¼‰çš„åŒºåˆ«/","link":"","permalink":"https://unpluggedcoder.me/2013/01/17/C++%E4%B8%AD%E7%B1%BB%E6%A8%A1%E6%9D%BF%EF%BC%88class%20template%EF%BC%89%E5%92%8C%E6%A8%A1%E6%9D%BF%E7%B1%BB%EF%BC%88template%20class%EF%BC%89%E7%9A%84%E5%8C%BA%E5%88%AB/","excerpt":"","text":"å¸¸è¯´çš„ç±»æ¨¡æ¿ï¼ˆclass templateï¼‰å’Œæ¨¡æ¿ç±»ï¼ˆtemplate classï¼‰ï¼Œä½†äº‹å®ä¸ŠäºŒè€…æœ‰ç€å¾ˆå¤§çš„åŒºåˆ«ã€‚ è€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š 12345678910111213141516template&lt;typename T1 , typename T2&gt;class Someclass&#123;â€¦&#125;;// æ¨¡æ¿å‚æ•°å®ä¾‹åŒ–åçš„ç±»ï¼Œnot object instancetypedef Someclass&lt;int,double&gt; TemplateClassType;template&lt; typename T1&gt;class Someclass&lt; typename T1 , double&gt;&#123;â€¦&#125;;typedef Someclass&lt;int&gt; AnotherTemplateClassType; å…ˆè§£é‡Šæ¨¡æ¿ç±»ï¼Œæ¨¡æ¿ç±»æ˜¯å°†æ¨¡æ¿ä¸­çš„å‚æ•°å®ä¾‹åŒ–æˆ–ç‰¹åŒ–åçš„ç±»å‹ï¼Œæ˜¯ç¼–è¯‘å™¨ä¸ºç±»æ¨¡æ¿ç”Ÿæˆçš„ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œè¿™å«ç¼–è¯‘å™¨å¤šæ€(ä¹Ÿå«é™æ€å¤šæ€)ã€‚ è€Œç±»æ¨¡æ¿ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ç§æ¨¡æ¿ï¼Œè€Œä¸æ˜¯ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚å¯¹è¿™ç±»æ¨¡æ¿çš„ä½¿ç”¨è€…æ¥è¯´ï¼Œçœ‹åˆ°çš„ï¼Œç”¨åˆ°çš„ç±»ï¼ˆSomeclass&lt;int,double&gt;å’ŒSomeclassï¼‰éƒ½æ˜¯ç±»æ¨¡æ¿çš„å®ä¾‹åŒ–åçš„ç±»ã€‚æœ‰ç‚¹ç±»ä¼¼äºä¸€ä¸ªçš„ç±»å®ä¾‹åŒ–åå¾—æŸä¸ªå¯¹è±¡ä¸€æ ·ï¼Œä½†æ˜¯ç±»æ¨¡æ¿å®ä¾‹åŒ–å¯ä»¥å¾—åˆ°ä¸åŒçš„å…·ä½“çš„ç±»ï¼Œè€Œä¸€ä¸ªç±»å®ä¾‹åŒ–åå¾—åˆ°çš„æ˜¯å…·æœ‰ç›¸åŒè¡Œä¸ºçš„å¯¹è±¡ã€‚","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"}]},{"title":"C++11å­¦ä¹ ç¬”è®°ä¹‹5â€”â€” æ‚é¡¹ä¸€","slug":"C++11å­¦ä¹ ç¬”è®°ä¹‹5â€”â€” æ‚é¡¹ä¸€","date":"2013-01-14T03:28:33.000Z","updated":"2022-09-15T15:51:05.343Z","comments":true,"path":"2013/01/14/C++11å­¦ä¹ ç¬”è®°ä¹‹5â€”â€” æ‚é¡¹ä¸€/","link":"","permalink":"https://unpluggedcoder.me/2013/01/14/C++11%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B5%E2%80%94%E2%80%94%20%E6%9D%82%E9%A1%B9%E4%B8%80/","excerpt":"","text":"constexprå…³é”®å­— constexprï¼Œä»å­—é¢ä¸Šçœ‹å¯ä»¥çœ‹å‡ºæ˜¯ç”¨æ¥å£°æ˜å¸¸é‡è¡¨è¾¾å¼ï¼Œä½†C++11ä¸ä»…é™äºæ­¤ã€‚constexpråŒæ—¶å¯ä»¥å£°æ˜å¸¸é‡å‡½æ•°å’Œå¸¸é‡å¯¹è±¡ï¼Œè¿™é‡Œçš„å¸¸é‡æ˜¯æŒ‡ç¼–è¯‘æ—¶æœŸå¯ä»¥ç¡®å®šçš„å¸¸é‡ã€‚ æ™®é€šçš„constå…³é”®å­—å£°æ˜çš„å‡½æ•°åœ¨ä¸‹é¢æ— æ•ˆï¼š 1234567const int getArraySize() &#123; return 32; &#125;int main()&#123; int myArray[getArraySize()]; // Invalid return 0;&#125; ä½¿ç”¨constexpré‡æ–°å®šä¹‰ï¼š 1234567constexpr int getArraySize() &#123; return 32; &#125;int main()&#123; int myArray[getArraySize()]; // OK return 0;&#125; ä¹Ÿå¯ä»¥ç”¨å¸¸é‡æ„é€ å‡½æ•°æ¥å®šä¹‰å¸¸é‡å¯¹è±¡ï¼š 12345678910111213class Rect&#123;public: constexpr Rect(int width , int height) : mWidth(width), mHeight(height) &#123;&#125; // æ„é€ å‡½æ•°ä½“å¿…é¡»ä¸ºç©º constexpr int getArea() const &#123; // å¿…é¡»åªæœ‰ä¸€ä¸ªreturn è¯­å¥ï¼Œreturn å¸¸é‡è¡¨è¾¾å¼; return mWidth * mHeight; &#125; &#125;&#125;; å¯ä»¥è¿™æ ·å£°æ˜constexprå¯¹è±¡ 123constexpr Rect r(8,2);int myArray[r.getArea()]; ç±»å‹åˆ«å C++11åœ¨typedefçš„åŸºç¡€ä¸Šå¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç±»å‹åˆ«åæœºåˆ¶ï¼Œæ›´å®¹æ˜“ç†è§£ã€‚ 1using MyInt = int; ä¸ªäººå¯¹è¿™ç§æ–¹å¼ä¹Ÿæ¯”è¾ƒç–‘æƒ‘ï¼šå°†using å’Œ èµ‹å€¼ç¬¦å·æ”¾åœ¨ä¸€èµ·ï¼Œè®©äººæœ‰äº›ä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä¸è¿‡ä»ä»£ç çš„è§’åº¦æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚ åŒæ ·å¯ä»¥ç”¨è¿™ä¸ªæ¥å£°æ˜å‡½æ•°æŒ‡é’ˆç±»å‹ï¼ŒC++11ä¹‹å‰çš„å£°æ˜æ ¼å¼æ˜¯ 1typedef ReturnType (*FuncPointerName)( ArgType ); ä¾‹å¦‚ï¼š 1typedef int (*FuncType)( char ); ä½¿ç”¨usingå£°æ˜æ ¼å¼æ˜¯ï¼š 1using FuncPointerName = ReturnType (*) (ArgType); ä¾‹å¦‚ï¼š 1using FuncType = int (*) (ArgType); è¿™ç§æ–¹å¼ç›¸å¯¹äºä¹‹å‰çš„MyIntå£°æ˜æ›´åŠ ç›´è§‚ã€‚å¯¹äºæˆå‘˜å‡½æ•°æŒ‡é’ˆæ¥è¯´å¯ä»¥åƒä¸‹é¢è¿™æ ·(å¤šåŠç”¨äºæ¨¡æ¿ç±»ä¸­çš„å£°æ˜)ï¼š 1using ClassMempFunc = ReturnType (ClassType::*) (ArgType); ç»Ÿä¸€åˆå§‹åŒ–å¯¹äºç»“æ„ä½“å’Œç±»ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ï¼š 123456789101112131415161718struct BasicStruct&#123; int x; float y;&#125;ï¼›class BasicClass&#123;public: BasicClass( int x , int y ) : _X(x), _Y(y) &#123; &#125;private: int _X, _Y;&#125;;BasicStruct myStruct = &#123; 10 , 2.5 &#125;;BasicClass myClass( 10, 15); C++11ä¹‹å‰å¯¹äºç»“æ„ä½“å¯ä»¥è°ƒç”¨{â€¦}è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶è€Œå¯¹äºç±»ï¼Œéœ€è¦ç”¨(â€¦)è°ƒç”¨æ„é€ å‡½æ•°ã€‚C++11å…è®¸ç”¨{â€¦}è¿›è¡Œå¯¹è±¡åˆå§‹åŒ–ï¼š 1BasicClass myCalss = &#123; 10ï¼Œ 15 &#125;; // = å·ä¹Ÿæ˜¯å¯é€‰çš„ è¿™ç§ç»Ÿä¸€åˆå§‹åŒ–å¯ä»¥é˜²æ­¢èŒƒå›´ç¼©é™(narrowingï¼Œåˆç§°çª„åŒ–ï¼Œæˆ‘ç†è§£ä¸ºæ•°æ®æˆªæ–­)ï¼Œå³å½“è½¬æ¢åçš„ç±»å‹æ— æ³•è¡¨ç¤ºåŸç±»å‹æ—¶å‘å‡ºç¼–è¯‘é”™è¯¯ã€‚ ä¾‹å¦‚ä¸‹é¢çš„å‡½æ•°è°ƒç”¨ï¼š 1234void Func( int i ) &#123; ... &#125;int x = &#123; 3.14 &#125;; // å»æ‰ &#123; &#125;ï¼Œç¼–è¯‘é”™è¯¯ä¼šå˜æˆè­¦å‘ŠFunc( &#123; 3.14 &#125; ); // å»æ‰ &#123; &#125;ï¼Œç¼–è¯‘é”™è¯¯ä¼šå˜æˆè­¦å‘Š å¯¹äºç±»æ¥è¯´å¯ä»¥åœ¨æŸäº›åœºåˆä»£æ›¿æ„é€ å‡½æ•°ï¼š 1234BasicClass GetBasicClassObj( )&#123; return &#123; 10 , 15&#125;; // ç”šè‡³ä¸éœ€è¦å£°æ˜ç±»å&#125; åŒæ ·ä¹Ÿé€‚ç”¨äºSTLå®¹å™¨çš„åˆå§‹åŒ–ï¼š 1std::vector&lt;int&gt; myVec = &#123;10 , 20 , 30]; ä¹Ÿå¯ä»¥ç”¨æ¥åˆå§‹åŒ–åŠ¨æ€åˆ†é…çš„æ•°ç»„ï¼š 1int *pArray = new int [4] &#123; 0, 1, 2, 3&#125;; æœ€åï¼Œä¹Ÿå¯ä»¥ç”¨äºæ„é€ å‡½æ•°çš„æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼š 12345678910class MyClass&#123;public: MyClass ( ) : mArray&#123;0, 1, 2, 3&#125; &#123;&#125;private: int mArray[4];&#125;; ç©ºæŒ‡é’ˆ C++11ä¹‹å‰ï¼Œç”¨0æ¥ä»£è¡¨ç©ºæŒ‡é’ˆï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š 1int* ptr = 0; ä½†æ˜¯è¿™å¸¸å¸¸ä¼šå’Œæ•´æ•°0æ··æ·†ï¼š 123void Func(char * pSrc) &#123; ... &#125; // å¦‚æœä¼ å…¥0ä½œä¸ºç©ºæŒ‡é’ˆå‚æ•°æƒ³è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œvoid Func(int i ) &#123; ... &#125; // è€Œç¼–è¯‘å™¨å®é™…ä¸Šä¼šè°ƒç”¨æ•´æ•°ç‰ˆæœ¬çš„åŒåå‡½æ•° å› æ­¤C++11 å¼•å…¥äº†ç©ºæŒ‡é’ˆä¸“ç”¨çš„åç§°nullptrï¼Œå¾ˆå¤šä»¥å¾€çš„C++ä»£ç è¦æ”¹å’¯ã€‚ å°–æ‹¬å· åœ¨C++11ä¹‹å‰ï¼Œæœ‰ä¸ªä¼—æ‰€å‘¨çŸ¥çš„å°–æ‹¬å·é—®é¢˜æ— æ³•è§£å†³ï¼š æ¨¡æ¿å‚æ•°ç±»å‹çš„æ¨¡æ¿ã€‚ å¿…é¡»æ‰‹åŠ¨åœ¨ä¸¤ä¸ªå°–æ‹¬å·ä¹‹å‰æ·»åŠ ç©ºæ ¼ï¼š 1vector&lt;basic_string&lt;wchart_t&gt; &gt; vec; // &gt;&gt;å¯èƒ½è¢«ä½œä¸ºæµè¾“å‡ºè¿ç®—ç¬¦ C++11å·²ç»å¯ä»¥è¯†åˆ«è¿™ç±»çš„å£°æ˜ï¼š 1vector&lt;basic_string&lt;wchart_t&gt;&gt; vec; // OK in C++11","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"}]},{"title":"C++11å­¦ä¹ ç¬”è®°ä¹‹4â€”â€”å³å€¼å¼•ç”¨(rvalue reference)å’Œç§»åŠ¨è¯­ä¹‰(Move Semantics)","slug":"C++11å­¦ä¹ ç¬”è®°ä¹‹4â€”â€”å³å€¼å¼•ç”¨(rvalue reference)å’Œç§»åŠ¨è¯­ä¹‰(Move Semantics)","date":"2013-01-04T15:17:03.000Z","updated":"2022-09-15T15:51:05.343Z","comments":true,"path":"2013/01/04/C++11å­¦ä¹ ç¬”è®°ä¹‹4â€”â€”å³å€¼å¼•ç”¨(rvalue reference)å’Œç§»åŠ¨è¯­ä¹‰(Move Semantics)/","link":"","permalink":"https://unpluggedcoder.me/2013/01/04/C++11%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B4%E2%80%94%E2%80%94%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8(rvalue%20reference)%E5%92%8C%E7%A7%BB%E5%8A%A8%E8%AF%AD%E4%B9%89(Move%20Semantics)/","excerpt":"","text":"æœ¬æ–‡æ‰€è°ˆåˆ°çš„ä¸¤ä¸ªæ ‡å‡†åœ¨VS2012ä¸­å·²ç»å¯ä»¥å®ç° 1ã€å³å€¼å¼•ç”¨ï¼ˆrvalue referenceï¼‰å·¦å€¼æ˜¯å¯ä»¥è·å–åˆ°åœ°å€çš„ä¸€ä¸ªé‡ï¼Œå…·æœ‰å˜é‡åä¾¿å¯ä»¥ä½œä¸ºå·¦å€¼æ¥å¼•ç”¨(ä¾‹å¦‚int count &#x3D; 10;)ï¼Œé€šå¸¸å‡ºç°åœ¨èµ‹å€¼ç¬¦å·å·¦è¾¹.è€Œå³å€¼å¼•ç”¨æ˜¯C++11å¼•å…¥çš„ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œç”¨æ¥å¼•ç”¨é‚£äº›ä¼šè‡ªåŠ¨é”€æ¯çš„ä¸´æ—¶å¯¹è±¡ï¼Œä¸»è¦ç›®çš„æ˜¯å¯¹è¿™äº›ä¸´æ—¶å¯¹è±¡æä¾›ç§»åŠ¨å¤åˆ¶æ„é€ å‡½æ•°å’Œç§»åŠ¨operator&#x3D;ï¼ˆç¨åè§£é‡Šï¼‰ï¼Œä½†æ˜¯å¦‚æœæ·±å…¥ç ”ç©¶æˆ–è®¸è¿˜ä¼šæœ‰æ›´å¤šæ–°çš„ç”¨é€”è¢«å‘æ˜ã€‚åœ¨C++ä¸­ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸åˆæ³•çš„ï¼Œæ˜¾è€Œæ˜“è§ï¼š 1int&amp; i = 2; // Invalidï¼Œæ— æ³•ä¸ºå¼•ç”¨ç±»å‹ i è·å–åˆ°æœ‰æ„ä¹‰çš„å®é™…åœ°å€ï¼Œæ‰€ä»¥è¿™ä¸ªå˜é‡æ— æ³•è¢«å£°æ˜ è€Œå¦‚æœåœ¨C++11ä¸­ï¼Œå¯ä»¥é€šè¿‡&amp;&amp;(æ³¨æ„ä¸æ˜¯â€œä¸â€æ“ä½œ)ç¬¦å·æ¥å£°æ˜ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå®ƒä¼šå»è°ƒç”¨é»˜è®¤çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆæˆ–è€…ç§»åŠ¨operator&#x3D;ï¼‰. 1int&amp;&amp; i = 2 + 5; // OK è¿™æ ·å†™ä¸€èˆ¬æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼Œæ›´å¤šçš„æ„ä¹‰æ˜¯åœ¨å³å€¼å¼•ç”¨è¢«ä½œä¸ºå‚æ•°ä¼ é€’æ—¶å¸¦æ¥çš„æ€§èƒ½æå‡. 123456789101112131415161718void Proc(int&amp; lvalue)// a reference of lvalueï¼Œå¿…é¡»è¦å·¦å€¼&#123; ++lvalue; cout&lt;&lt; &quot;increment the lvalue`data: &quot; &lt;&lt; lvalue &lt;&lt;endl;&#125;void Proc(int&amp;&amp; rvalue)// a reference of rvalue&#123; ++rvalue; cout&lt;&lt; &quot;increment the rvalue`data: &quot; &lt;&lt; rvalue &lt;&lt;endl;&#125;int a = 9 , b = 10 ,c = 2;Proc(a); // call Proc(int&amp; lvalue)// å¦‚æœæœªå®šä¹‰å³å€¼å¼•ç”¨å‚æ•°ç±»å‹çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä¸‹é¢å°†ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼ŒåŸå› åœ¨ä¸‹é¢ä¼šè®²è§£Proc(b+c); // call Proc(int&amp;&amp; rvalue)//è‡ªåŠ¨å°†b+cè¡¨è¾¾å¼ç”Ÿæˆçš„ä¸´æ—¶å¯¹è±¡å¼•ç”¨ä¸ºå‚æ•°ï¼Œè¿™ä¸ªå¼•ç”¨è¿‡ç¨‹ç‰µæ¶‰åˆ°ç§»åŠ¨è¯­ä¹‰ &#x2F;&#x2F; Output1013 å¯¹äºç¼–è¯‘å™¨æŠ¥é”™â€œæ— æ³•å°†intå‹è½¬åŒ–ä¸ºint&amp;â€æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼šç†Ÿæ‚‰æ±‡ç¼–çš„åŒå­¦åº”è¯¥çŸ¥é“ Proc(b+c)çš„å€¼ä¼ é€’è¿‡ç¨‹ï¼Œæ˜¯ç”±bå’Œcçš„å€¼åœ¨ç›¸åŠ åäº§ç”Ÿçš„ä¸­é—´å€¼èµ‹å€¼ç»™å¯„å­˜å™¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œè€Œå¯„å­˜å™¨ä¸­çš„å˜é‡æ˜¯ä¸´æ—¶å˜é‡ï¼Œä¸åŒäºå †æ ˆä¸Šçš„å˜é‡ï¼ˆå¯ä»¥ç”±å¼•ç”¨åœ°å€ç¡®å®šä¸€ä¸ªå”¯ä¸€çš„å˜é‡å€¼ï¼‰ã€‚å› æ­¤ç”±äºæ— æ³•å°†ä¸´æ—¶çš„æ•´å‹å˜é‡è½¬åŒ–ä¸ºæœ‰æ•ˆçš„åœ°å€å¼•ç”¨ï¼Œç¼–è¯‘å™¨å°†æ— æ³•é€šè¿‡ã€‚ å¦å¤–æ— æ³•åŒæ—¶å®šä¹‰Proc(int vlaue)å’ŒProc(int&amp; value)ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°åœ¨é‡åˆ°ä¸€ä¸ªæ™®é€šintå‚æ•°æ—¶ä¼šäº§ç”Ÿæ­§ä¹‰ï¼ŒäºŒè€…éƒ½å¯ä»¥è¢«è°ƒç”¨ã€‚åŒæ ·çš„æ— æ³•åŒæ—¶å®šä¹‰Proc(int vlaue)å’ŒProc(int&amp;&amp; value)ï¼ŒåŸå› æ˜¯ç”±äºåœ¨é‡åˆ°ä¸€ä¸ªä¸´æ—¶intå˜é‡æ—¶ï¼ŒäºŒè€…ä¹Ÿéƒ½æ˜¯å¯ä»¥è¢«è°ƒç”¨çš„ï¼ŒåŒæ ·æœ‰äºŒä¹‰æ€§ã€‚å› æ­¤åŒæ—¶å®šä¹‰Proc(int&amp; value)å’ŒProc(int&amp;&amp; value)æˆä¸ºæ–°çš„é€‰æ‹©ã€‚ä¸‹é¢çš„é‡åˆ°çš„ç¤ºä¾‹ä¹Ÿæ˜¯å’Œè¿™ä¸ªç›¸åŒçš„åŸå› ã€‚ æ‰€ä»¥æ¥ä¸‹æ¥çš„è®¨è®ºéƒ½æ˜¯ä»¥å¼•ç”¨ä½œä¸ºå‚æ•°ï¼Œå¦‚æœå‚æ•°ç±»å‹æ˜¯å€¼ä¼ é€’ int valueï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨è¿™äº›é—®é¢˜äº†ï¼ˆæœªå®šä¹‰Proc(int&amp;&amp; rvalue)ï¼ŒProc(b+c)ä¹Ÿå¯ä»¥æ­£å¸¸è¿ä½œï¼Œå®ƒå°†å¾ˆè‡ªç„¶åœ°è°ƒç”¨å€¼ä¼ é€’ç‰ˆæœ¬ï¼‰ï¼Œå³å€¼å¼•ç”¨å°±æ˜¯ä¸ºäº†å‡å°‘å‚æ•°å‰¯æœ¬å¼€é”€è€Œç”¨çš„. C++11æä¾›äº†std::move()å‡½æ•°å°†å·¦å€¼å¼ºåˆ¶è½¬æ¢ä¸ºå³å€¼ï¼Œä¸‹é¢ä¼šæ¼”ç¤ºå®ƒçš„ç”¨æ³•. 2ã€ç§»åŠ¨è¯­ä¹‰(Move Semantics) ç§»åŠ¨è¯­ä¹‰å®ç°äº†ç§»åŠ¨æ„é€ å‡½æ•°(move copy constructor)å’Œç§»åŠ¨èµ‹å€¼é¢„ç®—ç¬¦(move assignment operator). ç§»åŠ¨è¯­ä¹‰å°†ä¸Šä¸€æ¦‚å¿µä¸­çš„å³å€¼å¼•ç”¨å¼•å‡ºçš„ä¸´æ—¶å¯¹è±¡è½¬åŒ–ä¸ºå¯ä»¥è¢«å¼•ç”¨çš„å·¦å€¼(åœ¨å‚æ•°åœºåˆä¸‹ï¼Œå³è½¬ä¸ºå®å‚),è¿™ä¸ªåŠ¨ä½œå®é™…ä¸Šæä¾›äº†ç¨‹åºå‘˜æ“ä½œä¸´æ—¶å¯¹è±¡å†…å­˜çš„èƒ½åŠ›ï¼ˆthe possibility to modify the temporary object or memoryï¼‰ï¼Œå¹¶ä¸”å…è®¸æˆ‘ä»¬è‡ªç”±åœ°é€‰æ‹©ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼çš„æ“ä½œ 123MyClass(MyClass&amp;&amp; src); // move copy constructorMyClass&amp; operator=(MyClass&amp;&amp; rhs); // move assignment operator//å‚æ•°éƒ½æ˜¯none-constï¼Œå› ä¸ºæ‹·è´æ„é€ (æˆ–èµ‹å€¼æ“ä½œ)çš„æ¥æºæ˜¯ä¸ªå³å°†é”€æ¯çš„ä¸´æ—¶å¯¹è±¡ è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133class MyClass&#123;public: MyClass(double vlaue/*,int* ptr*/); // Normal copy constructor MyClass(const MyClass&amp; src); // Normal assignment operator MyClass&amp; operator=(const MyClass&amp; rhs); // Move copy constructor MyClass(MyClass&amp;&amp; src); // remove const attribute // Move assignment operator MyClass&amp; operator=(MyClass&amp;&amp; rhs); // remove const attribute double m_data; //int* m_pBuffer; //å¦‚æœå­˜åœ¨æ‹¥æœ‰æŸå—å†…å­˜çš„æƒ…å†µ&#125;;MyClass::MyClass(double value /*,int* ptr*/) :m_data(value)//,m_pBuffer(ptr)&#123;&#125;MyClass::MyClass(const MyClass&amp; src)&#123; m_data = src.m_data; /* do some Deep copy æ·±æ‹·è´ memcpy(m_pBuffer,src.m_pBuffer......); */ cout &lt;&lt; &quot;Normal copy constructor&quot; &lt;&lt;endl;&#125;MyClass&amp; MyClass::operator=(const MyClass&amp; rhs)&#123; if(this == &amp;rhs) &#123; return *this; &#125; m_data = rhs.m_data; /* do some Deep copy æ·±æ‹·è´ */ cout &lt;&lt; &quot;Normal assignment operator&quot; &lt;&lt;endl; return *this;&#125;MyClass::MyClass(MyClass&amp;&amp; src)&#123; m_data = src.m_data; // shallow copy æµ…æ‹·è´ï¼Œä»…ä»…æ˜¯æ‹·è´æŒ‡é’ˆ // ä¸´æ—¶å¯¹è±¡çš„å†…å­˜è¢«ä¼ é€’å‡ºæ¥ //m_pBuffer = src.m_pBuffer; src.m_data = 0; // ä¸´æ—¶å¯¹è±¡ä¹‹åä¼šè¢«é”€æ¯ï¼Œå¿…é¡»åœ¨è½¬ç§»å†…å­˜æ‰€æœ‰æƒåé‡ç½®ä¸ºç©ºæŒ‡é’ˆ //src.m_pBuffer = nullptr; cout &lt;&lt; &quot;Move copy constructor&quot; &lt;&lt;endl;&#125;MyClass&amp; MyClass::operator=(MyClass&amp;&amp; rhs)&#123; if(this == &amp;rhs) &#123; return *this; &#125; m_data = rhs.m_data; // shallow copy æµ…æ‹·è´ï¼Œä»…ä»…æ˜¯æ‹·è´æŒ‡é’ˆ // ä¸´æ—¶å¯¹è±¡çš„å†…å­˜è¢«ä¼ é€’å‡ºæ¥ //m_pBuffer = src.m_pBuffer; // ä¸´æ—¶å¯¹è±¡ä¹‹åä¼šè¢«é”€æ¯ï¼Œå¿…é¡»åœ¨è½¬ç§»å†…å­˜æ‰€æœ‰æƒåé‡ç½®ä¸ºç©ºæŒ‡é’ˆ //src.m_pBuffer = nullptr; cout&lt;&lt; &quot;Move assignment operator&quot; &lt;&lt;endl; return *this;&#125;MyClass CreateObject(double value)&#123; return MyClass(value);&#125;/* Can not both define Func(MyClass a) and Func(MyClass&amp;&amp; a)void Func(MyClass a)&#123; cout&lt;&lt; &quot;Called Func(MyClass a)&quot; &lt;&lt; endl;&#125;*/// Also can not both define Func(MyClass a) and Func(MyClass&amp; a)void Func(MyClass&amp; a)&#123; cout&lt;&lt; &quot;Called Func(MyClass&amp; a)&quot; &lt;&lt; endl;&#125;// Both define Func(MyClass&amp; a) and Func(MyClass&amp;&amp; a) is OKvoid Func(MyClass&amp;&amp; a)&#123; cout&lt;&lt; &quot;Called Func(MyClass&amp;&amp; a)&quot; &lt;&lt; endl;&#125;int main(int argc, char* argv[])&#123; // call MyClass(double value) MyClass a(3.0); // call Func(MyClass&amp; a) Func(a); // These 3 lines call Func(MyClass&amp;&amp; a) all, or they will call Func(MyClass a) if it`s defined Func(3.0); Func(std::move(2.0)); Func(CreateObject(1.0)); cout&lt;&lt; &quot;Before move assignment, a.m_data = &quot;&lt;&lt;a.m_data &lt;&lt; endl; // å·²å­˜åœ¨çš„å¯¹è±¡è¢«æ”¹å†™ï¼Œè°ƒç”¨èµ‹å€¼é¢„ç®— // call operator=(MyClass&amp;&amp; rhs),not operator=(const MyClass&amp; rhs) a = CreateObject(4.0); cout&lt;&lt; &quot;After move assignment, a.m_data = &quot;&lt;&lt;a.m_data &lt;&lt; endl; // call MyClass::MyClass(MyClass&amp;&amp; src) MyClass d(std::move(a)); cout&lt;&lt; &quot;After move copy constructor,&quot;&lt;&lt; endl; cout&lt;&lt; &quot;a.m_data = &quot;&lt;&lt; a.m_data &lt;&lt; endl; cout&lt;&lt; &quot;d.m_data = &quot;&lt;&lt;d.m_data &lt;&lt; endl; return 0;&#125; è¾“å‡ºå¦‚ä¸‹ï¼š 1234567891011Called Func(MyClass&amp; a)Called Func(MyClass&amp;&amp; a)Called Func(MyClass&amp;&amp; a)Called Func(MyClass&amp;&amp; a)Before move assignment, a.m_data = 3Move assignment operatorAfter move assignment, a.m_data = 4Move copy constructorAfter move copy constructor,a.m_data = 0d.m_data = 4 ç°åœ¨æˆ‘ä»¬åŠ ä¸Šææ„å‡½æ•°ï¼š 1234MyClass::~MyClass()&#123; cout&lt;&lt;&quot;Deconstructor called&quot;&lt;&lt;endl;&#125; é€šè¿‡vectoræ¥æŸ¥çœ‹å„ä¸ªå‡½æ•°è¢«è°ƒç”¨æƒ…å†µï¼Œvectoråœ¨å¢åŠ å…ƒç´ æ—¶ä¼šé‡æ–°åˆ†é…å†…å­˜ç©ºé—´ï¼Œè¿™æ—¶å€™vectorå†…éƒ¨ä¼šé‡æ–°å¼€è¾Ÿç©ºé—´ï¼Œå¹¶å¤åˆ¶æ„é€ å‡ºæ–°å¯¹è±¡ï¼Œç„¶åé”€æ¯åŸå†…å­˜ä¸­çš„æ—§å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š 123vector&lt;MyClass&amp;gt; vec;vec.push_back(CreateObject(9.0));vec.push_back(std::move(10.0)); åœ¨æœªå®šä¹‰ç§»åŠ¨æ‹·è´æ„é€ å‡½æ•°MyClass(MyClass&amp;&amp; src)æ—¶ï¼Œè°ƒç”¨æ™®é€šæ‹·è´æ„é€ å‡½æ•°MyClass(const MyClass&amp; src)æ‰§è¡Œæ·±æ‹·è´ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š 12345678Normal copy constructorDeconstructor calledNormal copy constructorDeconstructor calledNormal copy constructorDeconstructor calledDeconstructor calledDeconstructor called åœ¨åŒæ—¶å®šä¹‰ç§»åŠ¨æ‹·è´æ„é€ å‡½æ•°MyClass(MyClass&amp;&amp; src)å’Œæ™®é€šæ‹·è´æ„é€ å‡½æ•°MyClass(const MyClass&amp; src)æ—¶ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š 12345678Move copy constructorDeconstructor calledMove copy constructorDeconstructor calledMove copy constructorDeconstructor calledDeconstructor calledDeconstructor called å¯è§åœ¨ä¸´æ—¶å¯¹è±¡å‘ç”Ÿå³å€¼å¼•ç”¨æ—¶ä¼šæŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆæˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ï¼‰çš„å®šä¹‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°†ä¼šé€‰æ‹©åè€…æ‰§è¡Œæ›´å¿«çš„ä¸´æ—¶å¯¹è±¡æ•°æ®è·å–ï¼Œå¦åˆ™æ‰§è¡Œé»˜è®¤çš„æ·±æ‹·è´. å¯ä»¥ä»¥C++11ä¹‹2â€”â€”ç±»çš„æ„é€ ä¸­ç›¸åŒçš„æ–¹å¼&#x3D; default(æˆ–&#x3D;delete)æ¥å¼€å¯æˆ–ç¦ç”¨ä¸¤ä¸ªå‡½æ•°.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"}]},{"title":"C++11å­¦ä¹ ç¬”è®°ä¹‹3â€”â€”ç±»çš„ç»§æ‰¿","slug":"C++11å­¦ä¹ ç¬”è®°ä¹‹3â€”â€”ç±»çš„ç»§æ‰¿","date":"2013-01-04T15:04:12.000Z","updated":"2022-09-15T15:51:05.343Z","comments":true,"path":"2013/01/04/C++11å­¦ä¹ ç¬”è®°ä¹‹3â€”â€”ç±»çš„ç»§æ‰¿/","link":"","permalink":"https://unpluggedcoder.me/2013/01/04/C++11%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B3%E2%80%94%E2%80%94%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF/","excerpt":"","text":"ç¦æ­¢ç»§æ‰¿ åœ¨C++11ä¹‹å‰ï¼ŒC++æ²¡æœ‰finalå…³é”®å­—ï¼Œç¦æ­¢ç»§æ‰¿çš„æ–¹æ³•å¤§å¤šæ˜¯åˆ©ç”¨ä»è™šåŸºç±»æ´¾ç”Ÿçš„æ–¹å¼ã€‚ç°åœ¨finalå…³é”®å­—å·²ç»è¢«C++11æ ‡å‡†æ”¶å½•ã€‚ 12345678class BaseClass final&#123; ...&#125;;class DerivedClass : public BaseClass // compling error&#123;&#125;; ç¦æ­¢é‡å†™ï¼ˆoverride å’Œç¦æ­¢ç»§æ‰¿ä¸€æ ·ï¼Œé€šè¿‡finalå…³é”®å­—æ¥å®ç°ï¼Œç¦æ­¢é‡å†™ä¸­finalå…³é”®å­—åªèƒ½ç”¨äºvirtualæˆå‘˜å‡½æ•°ã€‚æ³¨æ„è¿™é‡ŒæŒ‡çš„ä¸æ˜¯overwriteï¼ˆè¦†å†™ï¼‰ï¼Œoverwriteæˆå‘˜å‡½æ•°å¯ä»¥ä¸æ˜¯è™šå‡½æ•°ï¼ˆå‚æ•°ä¹Ÿå¯ä»¥ä¸åŒï¼‰ã€‚ç¤ºä¾‹ä»£ç ï¼š 1234567891011121314class BaseClass&#123;public: BaseClass(); virtual void someMethod() final;&#125;;class DerivedClass : public BaseClass&#123;public: DerivedClass(); virtual void someMethod(); // compling error virtual void someMethod(int i); // overwrite, that`s OK&#125;; overrideå…³é”®å­— åŒæ ·C++11ä¹Ÿå¼•å…¥äº†å¤§å®¶æ‰€æœŸç›¼çš„overrideå…³é”®å­—ï¼Œç”¨æ¥å£°æ˜å­ç±»é‡å†™äº†åŸºç±»çš„æŸä¸ªè™šå‡½æ•°ã€‚ 12345678910111213class BaseClass&#123;public: BaseClass(); virtual void someMethod(int i);&#125;;class DerivedClass : public BaseClass&#123;public: DerivedClass(); virtual void someMethod(int i) override;&#125;; ä¸ªäººè®¤ä¸ºè¿™ä¸ªå…³é”®å­—ä¸»è¦ç”¨äºé˜²æ­¢åŸºç±»ä¿®æ”¹äº†è™šå‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œè€Œå¯¼è‡´å­ç±»æ— æ„è¯†åœ°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è™šå‡½æ•°çš„è¡Œä¸ºã€‚ ç»§æ‰¿æ„é€ å‡½æ•° è¿™ä¸ªæ¯”è¾ƒæœ‰æ„æ€ï¼ŒC++11ä¹‹å‰ï¼Œå­ç±»ä¸èƒ½é€šè¿‡åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºå­ç±»çš„å®ä¾‹ï¼Œç°åœ¨ï¼Œå­ç±»é€šè¿‡usingå£°æ˜å¯ä»¥å°†åŸºç±»çš„æ„é€ å‡½æ•°å£°æ˜ä¸ºå¯è§ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨å’ŒåŸºç±»ç›¸åŒçš„æ„é€ å‡½æ•°æ–¹å¼æ¥åˆ›å»ºè‡ªå®šä¹‰çš„å­ç±»å½¢æ€ï¼Œè¿™ç§æ–¹æ³•å°†æ¥æˆ–è®¸å¤§æœ‰å¯ä¸ºï¼Œä½†æ˜¯ä¹Ÿæœ‰éœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚ 123456789101112131415161718192021222324class BaseClass&#123;public: BaseClass(const std::string&amp; str); // not implement here BaseClass(double d); // not implement here&#125;;class DerivedClass : public BaseClass&#123;public: using BaseClass::BaseClass; // All baseclass`s constructors are visible // ç»§æ‰¿äº†æ‰€æœ‰çˆ¶ç±»çš„æ„é€ å‡½æ•° // è‡ªèº«çš„æ„é€ å‡½æ•° DerivedClass(int id) : m_nID(id)&#123; &#125; // å¦‚æœæ´¾ç”Ÿç±»ä¸­å…·æœ‰å’ŒåŸºç±»çš„æŸä¸ªæ„é€ å‡½æ•°ç›¸åŒçš„å‚æ•°ï¼Œ // é‚£ä¹ˆä¼˜å…ˆçº§ä¼šæ¯”ç›¸åŒå‚æ•°çš„åŸºç±»æ„é€ å‡½æ•°é«˜ï¼Œå°†ä¼šå¯¼è‡´è¦†ç›–åŸºç±»çš„æ„é€ å‡½æ•° // DerivedClass(const std::string&amp; str);private: int m_nID; // using &quot;int m_nID = 0&quot; instead&#125;; è¿™æ ·ä½¿ç”¨usingå£°æ˜åï¼Œå°±å¯ä»¥ä½¿ç”¨doubleå‚æ•°ç‰ˆæœ¬ï¼ˆæˆ–æ˜¯string&amp;ç±»å‹å‚æ•°çš„ç‰ˆæœ¬ï¼‰çš„åŸºç±»æ„é€ å‡½æ•°æ¥åˆ›å»ºå­ç±»å¯¹è±¡ã€‚ä½†æ˜¯éœ€è¦é¢å¯¹å­ç±»å¯¹è±¡æˆå‘˜åˆå§‹åŒ–çš„é—®é¢˜: 1DerivedClass dcFromBaseCtor(&quot;Not good&quot;); // m_nID doesn`t initialize è¿™æ ·æ„é€ å‡ºçš„å­ç±»å¯¹è±¡æ— æ³•è‡ªå®šä¹‰å…¶è‡ªèº«æˆå‘˜å˜é‡çš„åˆå§‹åŒ–ï¼Œç®€å•çš„æˆå‘˜å˜é‡å¯ä»¥ä½¿ç”¨å£°æ˜åˆå§‹åŒ–æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚int m_nID = 0;é¢å¯¹å¤æ‚çš„å­ç±»ï¼Œå¯ä»¥åœ¨åŸºç±»ä¸­å®šä¹‰ä¸€ä¸ªåˆå§‹åŒ–çš„è™šå‡½æ•°ï¼Œç”±å­ç±»é‡å†™å®ƒæ¥å®ç°å­ç±»æˆå‘˜çš„åˆå§‹åŒ–ã€‚ç”±äºæ‰‹å¤´è¾¹çš„VS2012ç¼–è¯‘å™¨ç›®å‰è¿˜ä¸æ”¯æŒç»§æ‰¿æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥æ— æ³•å®è·µï¼Œä½†æ˜¯ä¸ªäººè®¤ä¸ºä¸‹é¢è¿™ä¹ˆå†™ä¹Ÿæ˜¯ç¬¦åˆC++11æ ‡å‡†çš„ï¼š 1234567891011121314151617181920212223242526272829303132class BaseClass&#123;public: BaseClass(std::string&amp; str) &#123; m_baseData = str; Initialize(); &#125; // do nothing virtual void Initialize()&#123;&#125;protected: std::string m_baseData;&#125;;class DerivedClass : public BaseClass&#123;public: using BaseClass::BaseClass; DerivedClass(int value) :BaseClass(std::string(&quot;from dervied&quot;)), m_derivedData(value) &#123;&#125; virtual void Initialize() override &#123; m_derivedData = 0; &#125; int m_derivedData;&#125;; è¿™æ—¶å€™ä½¿ç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–å­ç±»å¯¹è±¡å°±æ›´å®‰å…¨äº†ï¼š 12std::string str(&quot;PasstoBaseClass&quot;);DerivedClass dcFromBaseCtor(str);","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"}]},{"title":"C++11å­¦ä¹ ç¬”è®°ä¹‹2â€”â€”ç±»çš„æ„é€ ","slug":"C++11å­¦ä¹ ç¬”è®°ä¹‹2â€”â€”ç±»çš„æ„é€ ","date":"2013-01-02T03:53:53.000Z","updated":"2022-09-15T15:51:05.343Z","comments":true,"path":"2013/01/02/C++11å­¦ä¹ ç¬”è®°ä¹‹2â€”â€”ç±»çš„æ„é€ /","link":"","permalink":"https://unpluggedcoder.me/2013/01/02/C++11%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B2%E2%80%94%E2%80%94%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0/","excerpt":"","text":"æ˜¾ç¤ºå£°æ˜æˆ–æ˜¾ç¤ºç¦æ­¢ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•° åœ¨æ²¡æœ‰å£°æ˜å’Œå®šä¹‰æ— å‚æ•°æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ªæ— å‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°ï¼ŒC++11ä¸­å¯ä»¥é€šè¿‡æ˜¾ç¤ºæ–¹æ³•æ¥å£°æ˜æˆ–ç¦æ­¢ç”Ÿæˆè¿™ç§æ„é€ å‡½æ•°ï¼Œåœ¨ä¸‹é¢è¿˜èƒ½çœ‹åˆ°ç›¸åŒçš„æ–¹æ³•ç”¨äºå…¶å®ƒç¼–è¯‘å™¨å¯èƒ½â€œå·å·â€ç”Ÿæˆå‡½æ•°ã€‚ 12345678910111213class MyClass&#123;public: MyClass( ) = default; // default constructor MyClass( int i );&#125;;class MyClass&#123;public: MyClass () = delete; // Disable default constructor MyClass(int i); // Enable&#125;; å¯è§å¦‚æœä¸å¸Œæœ›é»˜è®¤çš„æ— å‚æ•°æ„é€ å‡½æ•°è¢«ç¼–è¯‘å™¨è°ƒç”¨ï¼Œå¯ä»¥ç¦ç”¨å®ƒï¼Œè¿™æ ·æœ‰åŠ©äºå‡å°‘é”™è¯¯å¯¹è±¡çš„ç”Ÿæˆã€‚ æ˜¾ç¤ºå£°æ˜å’Œæ˜¾ç¤ºç¦æ­¢ç”Ÿæˆæ‹·è´ï¼ˆå¤åˆ¶ï¼‰æ„é€ å‡½æ•° 1234567class MyClass&#123;public: MyClass (); MyClass(const MyClass&amp; src) = default; //MyClass(const MyClass&amp; src) = delete; // ç¦æ­¢æ‹·è´èµ‹å€¼å‡½æ•°ç”Ÿæˆ&#125;; ç¦æ­¢æ‹·è´æ„é€ å‡½æ•°è¢«è°ƒç”¨æ¯”è¾ƒæœ‰åˆ©ç”¨ä»·å€¼ï¼Œè¿™ç§æ–¹æ³•é€šå¸¸å¯ä»¥ç”¨äºç¦æ­¢å¯¹è±¡ä½œä¸ºå‡½æ•°å‚æ•°è¢«è°ƒç”¨ï¼Œè€Œä¸éœ€è¦åƒä»¥å¾€æŠŠæ‹·è´æ„é€ å‡½æ•°å£°æ˜ä¸ºprivateå±æ€§çš„ä½œæ³•äº†ï¼Œä¹Ÿä¸éœ€è¦æä¾›æ‹·è´æ„é€ å‡½æ•°çš„å®ç°äº†ã€‚ 12345class MyClass&#123;private: MyClass(const MyClass&amp; src); // ä»¥å¾€çš„ä½œæ³•&#125; å½“ç„¶å¦‚æœå£°æ˜äº†&#x3D; delete å±æ€§è¯ï¼Œä¸‹é¢çš„æ„é€ æ–¹æ³•ä¹Ÿè¡Œä¸é€šäº†ã€‚ 12MyClass myObj1;MyClass myObj2(myObj1); æ˜¾ç¤ºå£°æ˜å’Œæ˜¾ç¤ºç¦æ­¢ç”Ÿæˆèµ‹å€¼è¿ç®—å‡½æ•° åŒæ ·ï¼Œdefault å’Œ deleteçš„å£°æ˜åç¼€ä¹Ÿé€‚ç”¨ä¸èµ‹å€¼è¿ç®—å‡½æ•°ã€‚è™½ç„¶èµ‹å€¼è¿ç®—å‡½æ•°ç®—ä¸ä¸Šæœ¬æ–‡æ ‡é¢˜æ‰€è¯´çš„â€ç±»çš„æ„é€ â€èŒƒç•´ï¼Œä½†æ˜¯å¦‚æœå¯¹C++æœ‰æ‰€äº†è§£çš„è¯ï¼Œé‚£å°±å¾ˆæ¸…æ¥šå®ƒä»¬ä¹‹é—´æ˜¯æœ‰å¤šä¹ˆçš„åƒä¸ä¸‡ç¼•äº†ã€‚ è¿™é‡Œå…ˆè¯´æ˜ä¸‹èµ‹å€¼è¿ç®—å‡½æ•°å’Œæ‹·è´æ„é€ å‡½æ•°çš„åŒºåˆ«ä»¥åŠå¦‚ä½•åŒºåˆ†å®ƒä»¬ä½•æ—¶è¢«è°ƒç”¨ï¼šå¦‚æœä¸€ä¸ªå·²ç»å…·æœ‰å€¼çš„å¯¹è±¡è¢«æ”¹å†™ï¼Œåˆ™è¿™ä¸ªåŠ¨ä½œçš„ç²¾ç¡®æœ¯è¯­æ˜¯â€œèµ‹å€¼è¿ç®—â€ï¼Œå› æ­¤èµ‹å€¼è¿ç®—å‡½æ•°è¢«è°ƒç”¨ã€‚ç„¶è€Œå¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨åˆ›å»ºæ—¶æ˜¯ç”±å¦ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‰¯æœ¬æ¥ç”Ÿæˆï¼ˆä¾‹å¦‚å¯¹è±¡ä½œä¸ºå‡½æ•°å‚æ•°çš„æŒ‰å€¼ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œä¸´æ—¶å¯¹è±¡å‰¯æœ¬çš„ç”Ÿæˆï¼‰ï¼Œé‚£å°±æ˜¯æ‹·è´æ„é€ ï¼Œå®ƒæ„é€ å‡ºäº†ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œæ›´ç²¾ç¡®çš„æœ¯è¯­æ˜¯â€œå¤åˆ¶æ„é€ â€ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå‰è€…åªèƒ½ç®—å¾—ä¸Šæ˜¯èµ‹å€¼çš„è¿ç®—å‡½æ•°ï¼Œè€Œåè€…å¯ä»¥ç§°ä¸ºæ„é€ å‡½æ•°ã€‚ ä¸‹é¢æ˜¯å…·ä½“å£°æ˜çš„ä»£ç ï¼š 1234567class MyClass&#123;public: MyClass (); MyClass&amp; operator= (const MyClass&amp; rhs) = default; //MyClass&amp; operator= (const MyClass&amp; rhs) = delete // ç¦æ­¢ç”Ÿæˆèµ‹å€¼è¿ç®—å‡½æ•°&#125;; ç¦æ­¢èµ‹å€¼è¿ç®—å‡½æ•°çš„æ–¹æ³•å¯ä»¥ç”¨äºè®¾è®¡æ¨¡å¼ä¸­æŸäº›åœºåˆä¸­ã€‚ä¾‹å¦‚å¯ä»¥ç”¨äºå¯¹è±¡å°è£…çš„ä»£ç†ç±»æ“ä½œå…±äº«æ•°æ®å†…å­˜çš„æ¨¡å¼ä¸­ã€‚ åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•°(Initializer-List Constructors) è¿™ä¸ªåå­—çœ‹ä¸Šå»å°±å¾ˆå¸¦åŠ²å„¿ã€å¾ˆç¥å¥‡å§ã€‚C++11çš„ç¡®ç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤šæƒŠå–œã€‚ åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªä»¥initializer_listå¯¹è±¡ä¸ºå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œåè€…æ˜¯ä¸ªæ¨¡æ¿ç±»ï¼Œéœ€è¦åŒ…å«å¤´æ–‡ä»¶&lt;intializer_list&gt;ï¼Œå¯ä»¥è¿™ä¹ˆå®ç°è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œå¤§è‡´ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314#include &lt;vector&gt;#include &lt;initializer_list&gt;class MySequenceClass&#123;public: MySequenceClass(initializer_list&lt;double&gt; args) &#123; for(auto citer : args) m_VecPoints.push_back(*citer); &#125; vector&lt;double&gt; m_VecPoints;&#125;; å’‹ä¸€çœ‹è¿™ä¸ªå¯¹è±¡å****_listï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸ªå®¹å™¨äº†ï¼Œä½†æ˜¯å…‰ä»è¿™ä¸ªæ„é€ å‡½æ•°çœ‹ä¸å‡ºå…¶ä¾¿æ·å’Œå¼ºå¤§ä¹‹å¤„ï¼Œçœ‹çœ‹ä¸‹é¢å¦‚ä½•æ„é€ è¿™ä¸ªç±»çš„å¯¹è±¡å°±æ˜ç™½äº†ï¼š 12345MySequenceClass s1 = &#123;1.0, 2.0, 3.0, 4.0, 5.0&#125;;// same as : MySequenceClass s1&#123;1.0, 2.0, 3.0, 4.0, 5.0&#125;;for(auto point : s1.m_vecPoints) std::cout &lt;&lt; point &lt;&lt; &quot; &quot; &lt;&lt; std::endl; æ€ä¹ˆæ ·ï¼Œç±»çš„ä½¿ç”¨è€…å®Œå…¨ä¸çŸ¥é“initializer_listçš„å­˜åœ¨ï¼Œå¯¹å¼€å‘è€…æ¥è¯´æ•°æ®çš„å¤„ç†æ›´åŠ ç®€å•äº†ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•çš„æ•ˆç‡è¿˜éœ€è¦çœ‹å…·ä½“C++11çš„å®ç°ï¼Œæˆ‘è§‰å¾—å¯¹äºéåŸºç¡€æ•°æ®ç±»å‹çš„æ¨¡æ¿å‚æ•°ç±»å‹ï¼ˆä¾‹å¦‚å¤§é‡çš„std::stringï¼‰å¾ˆå¯èƒ½ä¼šæœ‰æ•ˆç‡ä¸Šçš„æ€¥å‰§ä¸‹é™ï¼Œå› æ­¤è¿˜æ˜¯æ¨èå°†å¼•ç”¨æˆ–è€…smartpträ½œä¸ºæ¨¡æ¿å‚æ•°ç±»å‹æ¥æ„é€ ã€‚å¦‚æœæ˜¯å·²å­˜åœ¨çš„listï¼ˆéå¸¸é‡ï¼‰ï¼Œé‚£ç”¨list&amp;æˆ–å…¶å®ƒçš„å®¹å™¨å¼•ç”¨ä½œä¸ºå‚æ•°è¿˜æ¥å¾—æ›´å¿«ã€‚ ç±»æˆå‘˜å£°æ˜åˆå§‹åŒ– è¿™é¡¹æ–°ç‰¹æ€§åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå¤§å®¶éƒ½æœŸæœ›å·²ä¹…çš„å£°æ˜åˆå§‹åŒ–ï¼š 123456class MyClass&#123;protected: int m_nCount = 1; std::string m_str = &quot;test&quot;;&#125;; å¾ˆç®€å•æ˜äº†ï¼Œä½¿ç”¨åœºæ™¯å¾ˆæ™®éï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚ å§”æ‰˜æ„é€ å‡½æ•° å§”æ‰˜è¿™ä¸ªè¯åœ¨å¾ˆå¤šé«˜çº§è¯­è¨€ä¸­æ—©å°±è¢«å¼•å…¥äº†ï¼Œè€ŒC++11çš„è¿™ä¸ªæ ‡å‡†ç¨ç¨æ¥è¿Ÿäº†ã€‚ è¿™é‡ŒæŒ‡çš„å§”æ‰˜æ„é€ å‡½æ•°ä¸æ˜¯å¾ˆå¤æ‚: 12345678910111213141516171819202122class MyClass&#123;public: MyClass(int value); MyClass(const string&amp; strValue);&#125;;MyClass::MyClass(int value)&#123; ...&#125;MyClass::MyClass(const string&amp; strValue) :MyClass(stringToint(strValue))&#123;&#125; è¿™ä¸ªå§”æ‰˜è°ƒç”¨å¿…é¡»æ”¾åœ¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼ˆåˆç§°åˆå§‹åŒ–å™¨ï¼‰â€œ : â€œä¸­,å½“MyClass(stringToint(strValue))æ‰§è¡Œç»“æŸåæ‰ä¼šè¿”å›stringå‚æ•°çš„æ„é€ å‡½æ•°ã€‚æ²¡æœ‰ä»€ä¹ˆå¥½å¤šè¯´çš„ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œé¿å…é€’å½’çš„å§”æ‰˜è°ƒç”¨ï¼š 12345MyClass::MyClass(int value) : MyClass( intTostring(value) )// é€’å½’è°ƒç”¨&#123; ...&#125; è¿™æ ·çš„é€’å½’è°ƒç”¨æ˜¯å¦åœ¨ç¼–è¯‘æ—¶æœŸæŠ¥é”™å–å†³äºç¼–è¯‘å™¨çš„å®ç°äº†ã€‚ å…³äºC++11æ–°ç‰¹æ€§ä¸­ç±»çš„æ„é€ å°±è¿™æ ·å§ï¼Œåç»­æœ‰æ›´æ–°ä¼šå†åŠ å…¥ã€‚ ä¸‹ä¸€ç¯‡è®²ä»‹ç»C++11ä¸­å…³äºç±»ç»§æ‰¿çš„æ–°ç‰¹æ€§ã€‚","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"}]},{"title":"C++11å­¦ä¹ ç¬”è®°ä¹‹1â€”â€”åˆè¯†æ–°ç‰¹æ€§","slug":"C++11å­¦ä¹ ç¬”è®°ä¹‹1â€”â€”åˆè¯†æ–°ç‰¹æ€§","date":"2012-12-31T15:28:49.000Z","updated":"2022-09-15T15:51:05.343Z","comments":true,"path":"2012/12/31/C++11å­¦ä¹ ç¬”è®°ä¹‹1â€”â€”åˆè¯†æ–°ç‰¹æ€§/","link":"","permalink":"https://unpluggedcoder.me/2012/12/31/C++11%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B1%E2%80%94%E2%80%94%E5%88%9D%E8%AF%86%E6%96%B0%E7%89%B9%E6%80%A7/","excerpt":"","text":"C++11æ ‡å‡†è™½å·²å‘å¸ƒï¼Œä½†æ˜¯VCå’ŒGCCä¸¤å¤§ç¼–è¯‘å¯¹æ–°æ ‡å‡†çš„æ”¯æŒå„ä¸ç›¸åŒï¼Œä»GCCå®˜ç½‘ç»™å‡ºçš„èµ„æ–™çœ‹ï¼Œç›®å‰GCCå¯¹C++11æ ‡å‡†çš„æ”¯æŒç®—æ˜¯æœ€å¤šçš„äº†ã€‚ VS 2012(VC11)åˆ™ç›¸å¯¹é€Šè‰²ï¼Œè®©å¤§ä¼—æœ‰äº›å¤±æœ›ã€‚ç›¸æ¯”ä¹‹ä¸‹VS2012æ›´åŠ æ³¨é‡è‡ªå·±çš„æ–°C++è¯­è¨€æ‰©å±•C++&#x2F;CXã€‚ å› æ­¤ï¼ŒC++11çš„æ–°ç‰¹æ€§åœ¨ç°åœ¨çœ‹æ¥åªèƒ½ç®—æ˜¯ä¸ºå°†æ¥çš„çŸ¥è¯†ä½œä¸ºç§¯ç´¯ï¼Œè°ˆä¸ä¸Šå®ç”¨ä»·å€¼ï¼Œå¦‚æœå·¥ä½œä¸Šæ²¡æœ‰éœ€è¦äº†è§£ä¸€äºŒä¾¿å¯ã€‚ä½œè€…åœ¨è¿™é‡Œä¹Ÿåªæ˜¯å°†ä¹¦ä¸­(ã€ŠC++é«˜çº§ç¼–ç¨‹ ç¬¬äºŒç‰ˆã€‹)æ‰€å­¦åŠ ä»¥ç¬”å½•ï¼Œä»¥å¤‡æŸ¥é˜…ã€‚ forå¾ªç¯ C++11æä¾›äº†ä¸€ç§æ›´ä¸ºæ–¹ä¾¿çš„forå¾ªç¯è¯­å¥ï¼Œæœ‰ç‚¹ç±»ä¼¼è„šæœ¬è¯­è¨€è¯­æ³•: 1234567891011121314151617int arr[] = &#123;1, 2, 3, 4&#125;;int idx = 0;for (auto i : arr)&#123; i += 2; // reference iterator , OK cout &lt;&lt; arr[idx++] &lt;&lt; &quot; &quot;;&#125;// 3 4 5 6idx = 0;cout &lt;&lt; endl;for (auto i : arr)&#123; i -= 2; // const iterator , nothing changed in arr cout &lt;&lt; arr[idx++] &lt;&lt; &quot; &quot;;&#125;// 3 4 5 6 __func__é¢„å®šä¹‰ ä»¥å¾€Cè¯­è¨€ä¸­æœ‰é¢„å®šä¹‰çš„å®æ¥è¡¨ç¤ºå½“å‰çš„æ–‡ä»¶ã€è¡Œå·å’Œå‡½æ•°åï¼š__FILE__ , __LINE__ , __FUNCTION__ ç°åœ¨C++11ä¸­æœ‰äº†è‡ªå·±çš„å‡½æ•°åé¢„å®šä¹‰ï¼Œæš‚ä¸”ç§°ä¸ºé¢„å®šä¹‰ï¼Œå› ä¸ºæ²¡æœ‰æºç å¯æŸ¥ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å®ï¼Œä¹¦ä¸­æŠŠè¿™ä¸ªå½’ç±»ä¸ºC++11æ–°å†…å®¹ï¼Œä½†æ˜¯è¿™ä¸ªåœ¨C99æ ‡å‡†ä¸­å·²æœ‰äº†â€¦ï¼Œç”¨æ³•å¾ˆç®€å•ï¼š 1234int add(int a ,int b)&#123; std::cout &lt;&lt; &quot;Entering function :&quot; &lt;&lt; __func__ &lt;&lt; endl; // Local variable&#125; ä¸‹ä¸€ç¯‡ä»‹ç»ä¸ç±»æ„é€ æœ‰å…³çš„C++11æ–°ç‰¹æ€§.","categories":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"}]},{"title":"ä¸‘ç”»è¦æ”¾åœ¨å‰é¢","slug":"ä¸‘ç”»è¦æ”¾åœ¨å‰é¢","date":"2012-12-31T14:51:50.000Z","updated":"2022-09-20T15:51:58.967Z","comments":true,"path":"2012/12/31/ä¸‘ç”»è¦æ”¾åœ¨å‰é¢/","link":"","permalink":"https://unpluggedcoder.me/2012/12/31/%E4%B8%91%E7%94%BB%E8%A6%81%E6%94%BE%E5%9C%A8%E5%89%8D%E9%9D%A2/","excerpt":"","text":"é¡¶ç€é£ï¼Œç¬¨é¸Ÿèƒ½å…ˆé£å—ï¼Ÿ","categories":[{"name":"æ¶‚é¸¦","slug":"æ¶‚é¸¦","permalink":"https://unpluggedcoder.me/categories/%E6%B6%82%E9%B8%A6/"}],"tags":[{"name":"ç´ æ","slug":"ç´ æ","permalink":"https://unpluggedcoder.me/tags/%E7%B4%A0%E6%8F%8F/"}]}],"categories":[{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/categories/Rust/"},{"name":"Flamegraph","slug":"Rust/Flamegraph","permalink":"https://unpluggedcoder.me/categories/Rust/Flamegraph/"},{"name":"ä¹¦","slug":"ä¹¦","permalink":"https://unpluggedcoder.me/categories/%E4%B9%A6/"},{"name":"å…¥é—¨å¤±è´¥","slug":"Rust/å…¥é—¨å¤±è´¥","permalink":"https://unpluggedcoder.me/categories/Rust/%E5%85%A5%E9%97%A8%E5%A4%B1%E8%B4%A5/"},{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/%E6%9D%82%E9%A1%B9/"},{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/categories/Python/"},{"name":"æ•°æ®ç›¸å…³","slug":"æ•°æ®ç›¸å…³","permalink":"https://unpluggedcoder.me/categories/%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/"},{"name":"AWS","slug":"AWS","permalink":"https://unpluggedcoder.me/categories/AWS/"},{"name":"æ¶‚é¸¦","slug":"æ¶‚é¸¦","permalink":"https://unpluggedcoder.me/categories/%E6%B6%82%E9%B8%A6/"},{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/categories/Windows/"},{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/categories/C-C/"},{"name":"Unix/Linux","slug":"Unix-Linux","permalink":"https://unpluggedcoder.me/categories/Unix-Linux/"},{"name":"DrumCover","slug":"DrumCover","permalink":"https://unpluggedcoder.me/categories/DrumCover/"},{"name":"æ‚é¡¹","slug":"C-C/æ‚é¡¹","permalink":"https://unpluggedcoder.me/categories/C-C/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"FILCO","slug":"FILCO","permalink":"https://unpluggedcoder.me/tags/FILCO/"},{"name":"Minila","slug":"Minila","permalink":"https://unpluggedcoder.me/tags/Minila/"},{"name":"Mechanical Keyboard","slug":"Mechanical-Keyboard","permalink":"https://unpluggedcoder.me/tags/Mechanical-Keyboard/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://unpluggedcoder.me/tags/%E7%AE%97%E6%B3%95/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://unpluggedcoder.me/tags/Algorithm/"},{"name":"Rust","slug":"Rust","permalink":"https://unpluggedcoder.me/tags/Rust/"},{"name":"Python","slug":"Python","permalink":"https://unpluggedcoder.me/tags/Python/"},{"name":"ç»Ÿè®¡å­¦","slug":"ç»Ÿè®¡å­¦","permalink":"https://unpluggedcoder.me/tags/%E7%BB%9F%E8%AE%A1%E5%AD%A6/"},{"name":"é‡‘èå­¦","slug":"é‡‘èå­¦","permalink":"https://unpluggedcoder.me/tags/%E9%87%91%E8%9E%8D%E5%AD%A6/"},{"name":"Productivity tools","slug":"Productivity-tools","permalink":"https://unpluggedcoder.me/tags/Productivity-tools/"},{"name":"ripgrep","slug":"ripgrep","permalink":"https://unpluggedcoder.me/tags/ripgrep/"},{"name":"lsd","slug":"lsd","permalink":"https://unpluggedcoder.me/tags/lsd/"},{"name":"broot","slug":"broot","permalink":"https://unpluggedcoder.me/tags/broot/"},{"name":"starship","slug":"starship","permalink":"https://unpluggedcoder.me/tags/starship/"},{"name":"procs","slug":"procs","permalink":"https://unpluggedcoder.me/tags/procs/"},{"name":"dua-cli","slug":"dua-cli","permalink":"https://unpluggedcoder.me/tags/dua-cli/"},{"name":"dust","slug":"dust","permalink":"https://unpluggedcoder.me/tags/dust/"},{"name":"dutree","slug":"dutree","permalink":"https://unpluggedcoder.me/tags/dutree/"},{"name":"inferno","slug":"inferno","permalink":"https://unpluggedcoder.me/tags/inferno/"},{"name":"dtool","slug":"dtool","permalink":"https://unpluggedcoder.me/tags/dtool/"},{"name":"ytop","slug":"ytop","permalink":"https://unpluggedcoder.me/tags/ytop/"},{"name":"bat","slug":"bat","permalink":"https://unpluggedcoder.me/tags/bat/"},{"name":"tui-rs","slug":"tui-rs","permalink":"https://unpluggedcoder.me/tags/tui-rs/"},{"name":"Rustæ•™ç¨‹","slug":"Rustæ•™ç¨‹","permalink":"https://unpluggedcoder.me/tags/Rust%E6%95%99%E7%A8%8B/"},{"name":"Rustç¬”è®°","slug":"Rustç¬”è®°","permalink":"https://unpluggedcoder.me/tags/Rust%E7%AC%94%E8%AE%B0/"},{"name":"Pattern","slug":"Pattern","permalink":"https://unpluggedcoder.me/tags/Pattern/"},{"name":"Macros","slug":"Macros","permalink":"https://unpluggedcoder.me/tags/Macros/"},{"name":"Deep Learning","slug":"Deep-Learning","permalink":"https://unpluggedcoder.me/tags/Deep-Learning/"},{"name":"è‚²å„¿","slug":"è‚²å„¿","permalink":"https://unpluggedcoder.me/tags/%E8%82%B2%E5%84%BF/"},{"name":"ç†è´¢","slug":"ç†è´¢","permalink":"https://unpluggedcoder.me/tags/%E7%90%86%E8%B4%A2/"},{"name":"é£é™©","slug":"é£é™©","permalink":"https://unpluggedcoder.me/tags/%E9%A3%8E%E9%99%A9/"},{"name":"ç»æµå­¦","slug":"ç»æµå­¦","permalink":"https://unpluggedcoder.me/tags/%E7%BB%8F%E6%B5%8E%E5%AD%A6/"},{"name":"Compression","slug":"Compression","permalink":"https://unpluggedcoder.me/tags/Compression/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://unpluggedcoder.me/tags/Concurrency/"},{"name":"Mutex","slug":"Mutex","permalink":"https://unpluggedcoder.me/tags/Mutex/"},{"name":"Channel","slug":"Channel","permalink":"https://unpluggedcoder.me/tags/Channel/"},{"name":"Sync","slug":"Sync","permalink":"https://unpluggedcoder.me/tags/Sync/"},{"name":"Send","slug":"Send","permalink":"https://unpluggedcoder.me/tags/Send/"},{"name":"Atmoic","slug":"Atmoic","permalink":"https://unpluggedcoder.me/tags/Atmoic/"},{"name":"Condvar","slug":"Condvar","permalink":"https://unpluggedcoder.me/tags/Condvar/"},{"name":"Read","slug":"Read","permalink":"https://unpluggedcoder.me/tags/Read/"},{"name":"BufRead","slug":"BufRead","permalink":"https://unpluggedcoder.me/tags/BufRead/"},{"name":"Write","slug":"Write","permalink":"https://unpluggedcoder.me/tags/Write/"},{"name":"BufWrite","slug":"BufWrite","permalink":"https://unpluggedcoder.me/tags/BufWrite/"},{"name":"Talk","slug":"Talk","permalink":"https://unpluggedcoder.me/tags/Talk/"},{"name":"String","slug":"String","permalink":"https://unpluggedcoder.me/tags/String/"},{"name":"str","slug":"str","permalink":"https://unpluggedcoder.me/tags/str/"},{"name":"slice","slug":"slice","permalink":"https://unpluggedcoder.me/tags/slice/"},{"name":"FromStr","slug":"FromStr","permalink":"https://unpluggedcoder.me/tags/FromStr/"},{"name":"ToString","slug":"ToString","permalink":"https://unpluggedcoder.me/tags/ToString/"},{"name":"Collections","slug":"Collections","permalink":"https://unpluggedcoder.me/tags/Collections/"},{"name":"Vec","slug":"Vec","permalink":"https://unpluggedcoder.me/tags/Vec/"},{"name":"VecDeque","slug":"VecDeque","permalink":"https://unpluggedcoder.me/tags/VecDeque/"},{"name":"HashMap","slug":"HashMap","permalink":"https://unpluggedcoder.me/tags/HashMap/"},{"name":"HashSet","slug":"HashSet","permalink":"https://unpluggedcoder.me/tags/HashSet/"},{"name":"BTreeMap","slug":"BTreeMap","permalink":"https://unpluggedcoder.me/tags/BTreeMap/"},{"name":"BTreeSet","slug":"BTreeSet","permalink":"https://unpluggedcoder.me/tags/BTreeSet/"},{"name":"Performance","slug":"Performance","permalink":"https://unpluggedcoder.me/tags/Performance/"},{"name":"Iterator","slug":"Iterator","permalink":"https://unpluggedcoder.me/tags/Iterator/"},{"name":"Adapter","slug":"Adapter","permalink":"https://unpluggedcoder.me/tags/Adapter/"},{"name":"map","slug":"map","permalink":"https://unpluggedcoder.me/tags/map/"},{"name":"filter","slug":"filter","permalink":"https://unpluggedcoder.me/tags/filter/"},{"name":"IntoIterator","slug":"IntoIterator","permalink":"https://unpluggedcoder.me/tags/IntoIterator/"},{"name":"into_iter","slug":"into-iter","permalink":"https://unpluggedcoder.me/tags/into-iter/"},{"name":"drain","slug":"drain","permalink":"https://unpluggedcoder.me/tags/drain/"},{"name":"Closure","slug":"Closure","permalink":"https://unpluggedcoder.me/tags/Closure/"},{"name":"Fn","slug":"Fn","permalink":"https://unpluggedcoder.me/tags/Fn/"},{"name":"FnMut","slug":"FnMut","permalink":"https://unpluggedcoder.me/tags/FnMut/"},{"name":"FnOnce","slug":"FnOnce","permalink":"https://unpluggedcoder.me/tags/FnOnce/"},{"name":"Callback","slug":"Callback","permalink":"https://unpluggedcoder.me/tags/Callback/"},{"name":"Trait","slug":"Trait","permalink":"https://unpluggedcoder.me/tags/Trait/"},{"name":"Copy","slug":"Copy","permalink":"https://unpluggedcoder.me/tags/Copy/"},{"name":"Clone","slug":"Clone","permalink":"https://unpluggedcoder.me/tags/Clone/"},{"name":"Drop","slug":"Drop","permalink":"https://unpluggedcoder.me/tags/Drop/"},{"name":"Sized","slug":"Sized","permalink":"https://unpluggedcoder.me/tags/Sized/"},{"name":"AsRef","slug":"AsRef","permalink":"https://unpluggedcoder.me/tags/AsRef/"},{"name":"Borrow","slug":"Borrow","permalink":"https://unpluggedcoder.me/tags/Borrow/"},{"name":"ToOwned","slug":"ToOwned","permalink":"https://unpluggedcoder.me/tags/ToOwned/"},{"name":"Cow","slug":"Cow","permalink":"https://unpluggedcoder.me/tags/Cow/"},{"name":"From","slug":"From","permalink":"https://unpluggedcoder.me/tags/From/"},{"name":"Into","slug":"Into","permalink":"https://unpluggedcoder.me/tags/Into/"},{"name":"Generics","slug":"Generics","permalink":"https://unpluggedcoder.me/tags/Generics/"},{"name":"ç‰¹è´¨","slug":"ç‰¹è´¨","permalink":"https://unpluggedcoder.me/tags/%E7%89%B9%E8%B4%A8/"},{"name":"æ³›å‹","slug":"æ³›å‹","permalink":"https://unpluggedcoder.me/tags/%E6%B3%9B%E5%9E%8B/"},{"name":"Enum","slug":"Enum","permalink":"https://unpluggedcoder.me/tags/Enum/"},{"name":"PatternGuard","slug":"PatternGuard","permalink":"https://unpluggedcoder.me/tags/PatternGuard/"},{"name":"refutable","slug":"refutable","permalink":"https://unpluggedcoder.me/tags/refutable/"},{"name":"irrefutable","slug":"irrefutable","permalink":"https://unpluggedcoder.me/tags/irrefutable/"},{"name":"Struct","slug":"Struct","permalink":"https://unpluggedcoder.me/tags/Struct/"},{"name":"Cell<T>","slug":"Cell-T","permalink":"https://unpluggedcoder.me/tags/Cell-T/"},{"name":"RefCell<T>","slug":"RefCell-T","permalink":"https://unpluggedcoder.me/tags/RefCell-T/"},{"name":"Crates","slug":"Crates","permalink":"https://unpluggedcoder.me/tags/Crates/"},{"name":"Modules","slug":"Modules","permalink":"https://unpluggedcoder.me/tags/Modules/"},{"name":"pub","slug":"pub","permalink":"https://unpluggedcoder.me/tags/pub/"},{"name":"doc-tests","slug":"doc-tests","permalink":"https://unpluggedcoder.me/tags/doc-tests/"},{"name":"cargo","slug":"cargo","permalink":"https://unpluggedcoder.me/tags/cargo/"},{"name":"Error Handling","slug":"Error-Handling","permalink":"https://unpluggedcoder.me/tags/Error-Handling/"},{"name":"Result","slug":"Result","permalink":"https://unpluggedcoder.me/tags/Result/"},{"name":"painc","slug":"painc","permalink":"https://unpluggedcoder.me/tags/painc/"},{"name":"Option","slug":"Option","permalink":"https://unpluggedcoder.me/tags/Option/"},{"name":"Ownership","slug":"Ownership","permalink":"https://unpluggedcoder.me/tags/Ownership/"},{"name":"Reference","slug":"Reference","permalink":"https://unpluggedcoder.me/tags/Reference/"},{"name":"Shared Reference","slug":"Shared-Reference","permalink":"https://unpluggedcoder.me/tags/Shared-Reference/"},{"name":"Box","slug":"Box","permalink":"https://unpluggedcoder.me/tags/Box/"},{"name":"Rc","slug":"Rc","permalink":"https://unpluggedcoder.me/tags/Rc/"},{"name":"Arc","slug":"Arc","permalink":"https://unpluggedcoder.me/tags/Arc/"},{"name":"å¯Œäººæ€ç»´","slug":"å¯Œäººæ€ç»´","permalink":"https://unpluggedcoder.me/tags/%E5%AF%8C%E4%BA%BA%E6%80%9D%E7%BB%B4/"},{"name":"æ€§èƒ½","slug":"æ€§èƒ½","permalink":"https://unpluggedcoder.me/tags/%E6%80%A7%E8%83%BD/"},{"name":"åˆ†å¸ƒå¼é”","slug":"åˆ†å¸ƒå¼é”","permalink":"https://unpluggedcoder.me/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"},{"name":"Distribution Lock","slug":"Distribution-Lock","permalink":"https://unpluggedcoder.me/tags/Distribution-Lock/"},{"name":"Redis","slug":"Redis","permalink":"https://unpluggedcoder.me/tags/Redis/"},{"name":"asynchronous","slug":"asynchronous","permalink":"https://unpluggedcoder.me/tags/asynchronous/"},{"name":"logging","slug":"logging","permalink":"https://unpluggedcoder.me/tags/logging/"},{"name":"Celery","slug":"Celery","permalink":"https://unpluggedcoder.me/tags/Celery/"},{"name":"SSH","slug":"SSH","permalink":"https://unpluggedcoder.me/tags/SSH/"},{"name":"Resilio Sync","slug":"Resilio-Sync","permalink":"https://unpluggedcoder.me/tags/Resilio-Sync/"},{"name":"BT Sync","slug":"BT-Sync","permalink":"https://unpluggedcoder.me/tags/BT-Sync/"},{"name":"Django","slug":"Django","permalink":"https://unpluggedcoder.me/tags/Django/"},{"name":"Django Rest Framework","slug":"Django-Rest-Framework","permalink":"https://unpluggedcoder.me/tags/Django-Rest-Framework/"},{"name":"Data Visualization","slug":"Data-Visualization","permalink":"https://unpluggedcoder.me/tags/Data-Visualization/"},{"name":"ModeAnalytics","slug":"ModeAnalytics","permalink":"https://unpluggedcoder.me/tags/ModeAnalytics/"},{"name":"RDS","slug":"RDS","permalink":"https://unpluggedcoder.me/tags/RDS/"},{"name":"SQL","slug":"SQL","permalink":"https://unpluggedcoder.me/tags/SQL/"},{"name":"Aliyun","slug":"Aliyun","permalink":"https://unpluggedcoder.me/tags/Aliyun/"},{"name":"AWS","slug":"AWS","permalink":"https://unpluggedcoder.me/tags/AWS/"},{"name":"DataPipeline","slug":"DataPipeline","permalink":"https://unpluggedcoder.me/tags/DataPipeline/"},{"name":"RedShift","slug":"RedShift","permalink":"https://unpluggedcoder.me/tags/RedShift/"},{"name":"Mac","slug":"Mac","permalink":"https://unpluggedcoder.me/tags/Mac/"},{"name":"pip","slug":"pip","permalink":"https://unpluggedcoder.me/tags/pip/"},{"name":"ç´ æ","slug":"ç´ æ","permalink":"https://unpluggedcoder.me/tags/%E7%B4%A0%E6%8F%8F/"},{"name":"Windows","slug":"Windows","permalink":"https://unpluggedcoder.me/tags/Windows/"},{"name":"c#","slug":"c","permalink":"https://unpluggedcoder.me/tags/c/"},{"name":"MVVM","slug":"MVVM","permalink":"https://unpluggedcoder.me/tags/MVVM/"},{"name":"WPF","slug":"WPF","permalink":"https://unpluggedcoder.me/tags/WPF/"},{"name":"MySQLdb","slug":"MySQLdb","permalink":"https://unpluggedcoder.me/tags/MySQLdb/"},{"name":"Linux","slug":"Linux","permalink":"https://unpluggedcoder.me/tags/Linux/"},{"name":"quota","slug":"quota","permalink":"https://unpluggedcoder.me/tags/quota/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://unpluggedcoder.me/tags/%E7%88%AC%E8%99%AB/"},{"name":"å°åº¦WIFI","slug":"å°åº¦WIFI","permalink":"https://unpluggedcoder.me/tags/%E5%B0%8F%E5%BA%A6WIFI/"},{"name":"ATL","slug":"ATL","permalink":"https://unpluggedcoder.me/tags/ATL/"},{"name":"C#","slug":"C","permalink":"https://unpluggedcoder.me/tags/C/"},{"name":"C/C++","slug":"C-C","permalink":"https://unpluggedcoder.me/tags/C-C/"},{"name":"jabberd2","slug":"jabberd2","permalink":"https://unpluggedcoder.me/tags/jabberd2/"},{"name":"xmpp","slug":"xmpp","permalink":"https://unpluggedcoder.me/tags/xmpp/"},{"name":"Poco","slug":"Poco","permalink":"https://unpluggedcoder.me/tags/Poco/"},{"name":"GCC","slug":"GCC","permalink":"https://unpluggedcoder.me/tags/GCC/"},{"name":"Drum","slug":"Drum","permalink":"https://unpluggedcoder.me/tags/Drum/"},{"name":"ä½æ™ºå•†ç¤¾ä¼š","slug":"ä½æ™ºå•†ç¤¾ä¼š","permalink":"https://unpluggedcoder.me/tags/%E4%BD%8E%E6%99%BA%E5%95%86%E7%A4%BE%E4%BC%9A/"},{"name":"Unix/Linux","slug":"Unix-Linux","permalink":"https://unpluggedcoder.me/tags/Unix-Linux/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://unpluggedcoder.me/tags/%E5%B9%B6%E5%8F%91/"},{"name":"exception","slug":"exception","permalink":"https://unpluggedcoder.me/tags/exception/"},{"name":"Poco C++","slug":"Poco-C","permalink":"https://unpluggedcoder.me/tags/Poco-C/"},{"name":"C++11","slug":"C-11","permalink":"https://unpluggedcoder.me/tags/C-11/"},{"name":"auto_ptr","slug":"auto-ptr","permalink":"https://unpluggedcoder.me/tags/auto-ptr/"},{"name":"shared_ptr","slug":"shared-ptr","permalink":"https://unpluggedcoder.me/tags/shared-ptr/"},{"name":"SmartPointer","slug":"SmartPointer","permalink":"https://unpluggedcoder.me/tags/SmartPointer/"},{"name":"unique_ptr","slug":"unique-ptr","permalink":"https://unpluggedcoder.me/tags/unique-ptr/"},{"name":"weak_ptr","slug":"weak-ptr","permalink":"https://unpluggedcoder.me/tags/weak-ptr/"},{"name":"äº‹ä»¶","slug":"äº‹ä»¶","permalink":"https://unpluggedcoder.me/tags/%E4%BA%8B%E4%BB%B6/"},{"name":"å§”æ‰˜","slug":"å§”æ‰˜","permalink":"https://unpluggedcoder.me/tags/%E5%A7%94%E6%89%98/"}]}